<?xml version="1.0" encoding="utf-8" standalone="yes"?><!DOCTYPE html []><html xmlns="http://www.w3.org/1999/xhtml"><head><title>About this Course</title><link rel="stylesheet" href="Styles/custom-style.css" /><link rel="stylesheet" href="Styles/prism.css" /></head><body id="content"><script type="text/javascript" src="Scripts/arvato.js"> </script><script>
          window.onload = function() {
          // Create quiz instances for each quiz and add them to the quizzes map.
          // The key is the ID of the quiz element, same as what we pass to the Quiz object as the first argument.
          
          };
          </script>
		 <h3 class="da-h3" id="1191594">Resource Groups</h3><p>Resource groups are a fundamental element of the Azure platform. A resource group is a logical container for resources deployed on Azure. These resources are anything you create in an Azure subscription like virtual machines, Application Gateways, and CosmosDB instances.</p><p>All resources must be in a resource group and a resource can only be a member of a single resource group. Many resources can be moved between resource groups with some services having specific limitations or requirements to move.</p><p>Resource groups can't be nested. Before any resource can be provisioned, you need a resource group for it to be placed in.</p><h4 class="da-h4">Logical grouping</h4><p>Resource groups exist to help manage and organize your Azure resources. By placing resources of similar usage, type, or location, you can provide some order and organization to resources you create in Azure.</p><p><span><img alt="" src="../Images/1192033-490171.png" width="" height="" /></span></p><h4 class="da-h4">Life cycle</h4><p>If you delete a resource group, all resources contained within are also deleted.</p><p>Organizing resources by life cycle can be useful in non-production environments, where you might try an experiment, but then dispose of it when done. Resource groups make it easy to remove a set of resources at once.</p><h3 class="da-h3" id="1191595">Resource Group Organization</h3><p>Below are best practices for resource groups within your organization.</p><h4 class="da-h4">Consistent naming convention</h4><p>Earlier in this lesson, you named a resource group <i>msftlearn-core-infrastructure-rg</i>. The name indicates it's used for (msftlearn), the types of resources contained within (core-infrastructure), and the type of resource it is itself (rg). This descriptive name gives us a better idea of what it is.</p><p>If you had named the <i>group my-resource-group</i> or <i>rg1</i>, you have no idea on a glance of what the usage may be. In this case, you can deduce that there are probably core pieces of infrastructure contained within. If you created additional virtual networks, storage accounts, or other resources the company may consider core infrastructure, you could place them here as well, to improve the organization of our resources.</p><h4 class="da-h4">Organizing principles</h4><p>You might put all resources that are core infrastructure into this resource group. But you could also organize them strictly by resource type. For example, put all virtual networks in one resource group, all virtual machines in another resource group, and all Azure Cosmos DB instances in yet another resource group.</p><p><span><img alt="" src="../Images/1192219-490357.png" width="" height="" /></span></p><p>You could organize them by environment (prod, qa, dev). In this case, all production resources are in one resource group, all test resources are in another resource group, and so on.</p><p><span><img alt="" src="../Images/1192220-490358.png" width="" height="" /></span></p><p>You could organize them by department (marketing, finance, human resources). Marketing resources go in one resource group, finance in another resource group, and HR in a third resource group.</p><p><span><img alt="" src="../Images/1192221-490359.png" width="" height="" /></span></p><p>You could even use a combination of these strategies and organize by environment and department. Put production finance resources in one resource group, dev finance resources in another, and the same for the marketing resources.</p><p><span><img alt="" src="../Images/1192222-490360.png" width="" height="" /></span></p><h4 class="da-h4">Organizing for authorization</h4><p>Since resource groups are a scope of RBAC, you can organize resources by who needs to administer them. If a database administration team is responsible for managing all of your Azure SQL Database instances, putting them in the same resource group would simplify administration. You could give them the proper permissions at the resource group level to administer the databases within the resource group.</p><h4 class="da-h4">Organizing for life cycle</h4><p>If you delete a resource group, you delete all the resources in it. Use this where resources are more disposable, like non-production environments. If you deploy 10 servers for a project that you know will only last a couple of months, you might put them all in a single resource group. One resource group is easier to clean up than 10 or more resource groups.</p><h4 class="da-h4">Organizing for billing</h4><p>Placing resources in the same resource group is a way to group them for usage in billing reports. If you're trying to understand how your costs are distributed in your Azure environment, grouping them by resource group is one way to filter and sort the data to better understand where costs are allocated.</p><h3 class="da-h3" id="1191596">Management Groups</h3><p>If your organization has several subscriptions, you may need a way to efficiently manage access, policies, and compliance for those subscriptions. Azure management groups provide a level of scope above subscriptions. You organize subscriptions into containers called <i>management groups</i> and apply your governance conditions to the management groups. Management group enable:</p><ul class="square"><li class="square"><p>Organizational alignment for your Azure subscriptions through custom hierarchies and grouping.</p></li><li class="square"><p>Targeting of policies and spend budgets across subscriptions and inheritance down the hierarchies.</p></li><li class="square"><p>Compliance and cost reporting by organization (business/teams).</p></li></ul><p><span><img alt="" src="../Images/1192269-490407.png" width="" height="" /></span></p><p>All subscriptions within a management group automatically inherit the conditions applied to the management group. For example, you can apply policies to a management group that limits the regions available for virtual machine (VM) creation. This policy would be applied to all management groups, subscriptions, and resources under that management group by only allowing VMs to be created in that region.</p><h4 class="da-h4">Creating management groups</h4><p>You can create the management group by using the portal, PowerShell, or Azure CLI. Currently, you can't use Resource Manager templates to create management groups.</p><p><span><img alt="" src="../Images/1192270-490408.png" width="" height="" /></span></p><ul class="square"><li class="square"><p>The <b>Management Group ID</b> is the directory unique identifier that is used to submit commands on this management group. This identifier is not editable after creation as it is used throughout the Azure system to identify this group.</p></li><li class="square"><p><b>The Display Name</b> field is the name that is displayed within the Azure portal. A separate display name is an optional field when creating the management group and can be changed at any time.</p></li></ul><p>✔️ Do you think you will want to use Management Groups?</p><p>For more information, <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/management-groups-overview" title="" target="_blank">Organize your resources with Azure management groups</a></p><h3 class="da-h3" id="1191597">Azure Subscription and Service Limits</h3><p>This topic lists some of the most common Microsoft Azure limits, which are also sometimes called quotas.</p><h4 class="da-h4">Managing limits</h4><p>✔️ <b>Note:</b>
Some services have adjustable limits.
When a service doesn't have adjustable limits, the following tables use the header Limit. In those cases, the default and the maximum limits are the same.
When the limit can be adjusted, the tables include Default limit and Maximum limit headers. The limit can be raised above the default limit but not above the maximum limit.</p><p>If you want to raise the limit or quota above the default limit, <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/error-resource-quota" title="" target="_blank">open an online customer support request at no charge</a>.</p><p>Some limits are managed at a regional level.</p><p>For example, to request a quota increase with support for vCPUs, you must decide how many vCPUs you want to use in which regions. You then make a specific request for Azure resource group vCPU quotas for the amounts and regions that you want. If you need to use 30 vCPUs in West Europe to run your application there, you specifically request 30 vCPUs in West Europe. Your vCPU quota isn't increased in any other region–only West Europe has the 30-vCPU quota.</p><p>As a result, decide what your Azure resource group quotas must be for your workload in any one region. Then request that amount in each region into which you want to deploy.</p><h3 class="da-h3" id="1191598">Subscription and Service General Limits</h3><p>For limits on resource names, see <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/resource-name-rules" title="" target="_blank">Naming rules and restrictions for Azure resources</a>.</p><h4 class="da-h4">Management group limits</h4><p>The following limits apply to management groups.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Resource</p></td><td><p>Limit</p></td></tr></thead><tbody><tr><td><p>Management groups per directory</p></td><td><p>10,000</p></td></tr><tr><td><p>Subscriptions per management group</p></td><td><p>Unlimited.</p></td></tr><tr><td><p>Levels of management group hierarchy</p></td><td><p>Root level plus 6 levels<sup>1</sup></p></td></tr><tr><td><p>Direct parent management group per management group</p></td><td><p>One</p></td></tr><tr><td><p>Management group level deployments per location</p></td><td><p>800<sup>2</sup></p></td></tr></tbody></table><p><sup>1</sup>The 6 levels don't include the subscription level.</p><p><sup>2</sup>If you reach the limit of 800 deployments, delete deployments from the history that are no longer needed. To delete management group level deployments, use <a href="https://docs.microsoft.com/en-us/powershell/module/az.resources/Remove-AzManagementGroupDeployment" title="" target="_blank">Remove-AzManagementGroupDeployment</a> or <a href="https://docs.microsoft.com/en-us/cli/azure/deployment/mg?view=azure-cli-latest" title="" target="_blank">az deployment mg delete</a>.</p><h4 class="da-h4">Subscription limits</h4><p>The following limits apply when you use Azure Resource Manager and Azure resource groups.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Resource</p></td><td><p>Limit</p></td></tr></thead><tbody><tr><td><p>Subscriptions per Azure Active Directory tenant</p></td><td><p>Unlimited.</p></td></tr><tr><td><p>Coadministrators per subscription</p></td><td><p>Unlimited.</p></td></tr><tr><td><p>Resource groups per subscription</p></td><td><p>980</p></td></tr><tr><td><p>Azure Resource Manager API request size</p></td><td><p>4,194,304 bytes.</p></td></tr><tr><td><p>Tags per subscription<sup>1</sup></p></td><td><p>50</p></td></tr><tr><td><p>Unique tag calculations per subscription1</p></td><td><p>10,000</p></td></tr><tr><td><p>Subscription-level deployments per location</p></td><td><p>800<sup>2</sup></p></td></tr></tbody></table><p><sup>1</sup>You can apply up to 50 tags directly to a subscription. However, the subscription can contain an unlimited number of tags that are applied to resource groups and resources within the subscription. The number of tags per resource or resource group is limited to 50. Resource Manager returns a <a href="https://docs.microsoft.com/en-us/rest/api/resources/tags" title="" target="_blank">list of unique tag name and values</a> in the subscription only when the number of tags is 10,000 or less. You still can find a resource by tag when the number exceeds 10,000.</p><p><sup>2</sup>If you reach the limit of 800 deployments, delete deployments from the history that are no longer needed. To delete subscription level deployments, use <a href="https://docs.microsoft.com/en-us/powershell/module/az.resources/Remove-AzDeployment" title="" target="_blank">Remove-AzDeployment</a> or <a href="https://docs.microsoft.com/en-us/cli/azure/deployment/sub?view=azure-cli-latest" title="" target="_blank">az deployment sub delete</a>.</p><h4 class="da-h4">Resource group limits</h4><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p>Resource</p></td><td><p>Limit</p></td><td><p /></td></tr></thead><tbody><tr><td><p>Resources per resource group</p></td><td><p>Resources aren't limited by resource group. Instead, they're limited by resource type in a resource group. See next row.</p></td><td><p /></td></tr><tr><td><p>Resources per resource group, per resource type</p></td><td><p>800 - Some resource types can exceed the 800 limit. See Resources not limited to 800 instances per resource group.</p></td><td><p /></td></tr><tr><td><p>Deployments per resource group in the deployment history</p></td><td><p>800<sup>1</sup></p></td><td><p /></td></tr><tr><td><p>Resources per deployment</p></td><td><p>800</p></td><td><p /></td></tr><tr><td><p>Management locks per unique scope</p></td><td><p>20</p></td><td><p /></td></tr><tr><td><p>Number of tags per resource or resource group</p></td><td><p>50</p></td><td><p /></td></tr><tr><td><p>Tag key length</p></td><td><p>512</p></td><td><p /></td></tr><tr><td><p>Tag value length</p></td><td><p>256</p></td><td><p /></td></tr></tbody></table><p><sup>1</sup>If you reach the limit of 800 deployments per resource group, delete deployments from the history that are no longer needed. Deleting an entry from the deployment history doesn't affect the deployed resources.</p><h4 class="da-h4">Template limits</h4><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Value</p></td><td><p>Limit</p></td></tr></thead><tbody><tr><td><p>Parameters</p></td><td><p>256</p></td></tr><tr><td><p>Variables</p></td><td><p>256</p></td></tr><tr><td><p>Resources (including copy count)</p></td><td><p>800</p></td></tr><tr><td><p>Outputs</p></td><td><p>64</p></td></tr><tr><td><p>Template expression</p></td><td><p>24,576 chars</p></td></tr><tr><td><p>Resources in exported templates</p></td><td><p>200</p></td></tr><tr><td><p>Template size</p></td><td><p>4 MB</p></td></tr><tr><td><p>Parameter file size</p></td><td><p>64 KB</p></td></tr></tbody></table><p>You can exceed some template limits by using a nested template.</p><h3 class="da-h3" id="1191600">User accounts</h3><p>To view the Azure AD users, simply access the All users blade.</p><p><span><img alt="" src="../Images/1192156-490294.png" width="" height="" /></span></p><p>Typically, Azure AD defines users in three ways:</p><ul class="square"><li class="square"><p><b>Cloud identities</b>. These users exist only in Azure AD. Examples are administrator accounts and users that you manage yourself. Their source is Azure Active Directory or External Azure Active Directory if the user is defined in another Azure AD instance but needs access to subscription resources controlled by this directory. When these accounts are removed from the primary directory, they are deleted.</p></li><li class="square"><p><b>Directory-synchronized identities</b>. These users exist in an on-premises Active Directory. A synchronization activity that occurs via Azure AD Connect brings these users in to Azure. Their source is Windows Server AD.</p></li><li class="square"><p><b>Guest users</b>. These users exist outside Azure. Examples are accounts from other cloud providers and Microsoft accounts such as an Xbox LIVE account. Their source is Invited user. This type of account is useful when external vendors or contractors need access to your Azure resources. Once their help is no longer necessary, you can remove the account and all of their access.</p></li></ul><p>✔️ Have you given any thought as to the type of users you will need?</p><h3 class="da-h3" id="1191582">About this Course</h3><h4 class="da-h4">AZ-303: Microsoft Azure Architect Technologies</h4><p>This course teaches Solutions Architects how to translate business requirements into secure, scalable, and reliable solutions. Lessons include virtualization, automation, networking, storage, identity, security, data platform, and application infrastructure. This course outlines how decisions in each these areas affects an overall solution.</p><p><b>Level</b>: Advanced</p><h4 class="da-h4">Audience</h4><p>This course is for IT Professionals with expertise in designing and implementing solutions running on Microsoft Azure. They should have broad knowledge of IT operations, including networking, virtualization, identity, security, business continuity, disaster recovery, data platform, budgeting, and governance. Azure Solution Architects use the Azure Portal and as they become more adept they use the Command Line Interface.</p><p>Candidates must have expert-level skills in Azure administration and have experience with Azure development processes and DevOps processes.</p><h4 class="da-h4">Prerequisites</h4><p>Successful Azure Architect students have prior experience with operating systems, virtualization, cloud infrastructure, storage structures, and networking:</p><ul class="square"><li class="square"><p>Understanding of on-premises virtualization technologies, including VMs and virtual networking</p></li><li class="square"><p>Understanding of network configuration, including TCP/IP, Domain Name System (DNS), virtual private networks (VPNs), firewalls, and encryption technologies</p></li><li class="square"><p>Understanding of Active Directory concepts, including domains, forests, and domain controllers</p></li></ul><p>If you are new to Azure and cloud computing, consider one of the following resources:</p><ul class="square"><li class="square"><p>Free online: Azure Fundamentals (https://docs.microsoft.com/en-us/learn/paths/azure-fundamentals/)</p></li></ul><h4 class="da-h4">Expected learning</h4><ul class="square"><li class="square"><p>Secure identities with Azure Active Directory and users and groups.</p></li><li class="square"><p>Implement identity solutions spanning on-premises and cloud-based capabilities</p></li><li class="square"><p>Apply monitoring solutions for collecting, combining, and analyzing data from different sources.</p></li><li class="square"><p>Manage subscriptions, accounts, Azure policies, and Role-Based Access Control.</p></li><li class="square"><p>Deploy globally distributed elastic database solutions with Azure Cosmos DB.</p></li><li class="square"><p>Administer Azure using the Resource Manager, Azure portal, Cloud Shell, Azure PowerShell, CLI, and ARM templates.</p></li><li class="square"><p>Configure intersite connectivity solutions like VNet Peering, virtual network gateways, and Site-to-Site VPN connections.</p></li><li class="square"><p>Manage network traffic using network routing and service endpoints, Azure load balancer, and Azure Application Gateway.</p></li><li class="square"><p>Implement, manage and secure Azure storage accounts and blob storage.</p></li><li class="square"><p>Administer Azure App Service, Azure Container Instances, and Kubernetes.</p></li></ul><h3 class="da-h3" id="1191583">Syllabus</h3><p>The course content includes a mix of content, demonstrations, hands-on labs, reference links, and module review questions.</p><p><b>Module 1: Implement Azure Active Directory</b></p><ul class="square"><li class="square"><p>Lesson 1: Overview of Azure Active Directory</p></li><li class="square"><p>Lesson 2: Create Management Groups, Subscriptions, and Resource Groups</p></li><li class="square"><p>Lesson 3: Users and Groups</p></li><li class="square"><p>Lesson 4: Configure Fraud Alerts for MFA</p></li><li class="square"><p>Lesson 5: Domains and Custom Domains</p></li><li class="square"><p>Lesson 6: Azure AD Identity Protection</p></li><li class="square"><p>Lesson 7: Implement Conditional Access</p></li><li class="square"><p>Lesson 8: Configure Trusted IPs</p></li><li class="square"><p>Lesson 9: Configure Guest Users in Azure AD</p></li><li class="square"><p>Lesson 10: Module 1 Review Questions</p></li></ul><p><b>Module 2: Implement and Manage Hybrid Identities</b></p><ul class="square"><li class="square"><p>Lesson 1: Install and Configure Azure AD Connect</p></li><li class="square"><p>Lesson 2: Configure Password Sync and Password Writeback</p></li><li class="square"><p>Lesson 3: Configure Azure AD Connect Health</p></li><li class="square"><p>Lesson 4: Module 2 Review Questions</p></li></ul><p><b>Module 3: Implement Virtual Networking</b></p><ul class="square"><li class="square"><p>Lesson 1: Virtual Networking</p></li><li class="square"><p>Lesson 2: Virtual Network Peering</p></li><li class="square"><p>Lesson 3: Implement VNet Peering</p></li><li class="square"><p>Lesson 4: Module 3 Review Questions</p></li></ul><p><b>Module 4: Implement VMs for Windows and Linux</b></p><ul class="square"><li class="square"><p>Lesson 1: Overview Running Linux and Windows Virtual Machines on Azure</p></li><li class="square"><p>Lesson 2: Select Virtual Machine Size</p></li><li class="square"><p>Lesson 3: Configure High Availability</p></li><li class="square"><p>Lesson 4: Implement Azure Dedicated Hosts</p></li><li class="square"><p>Lesson 5: Deploy and Configure Scale Sets</p></li><li class="square"><p>Lesson 6: Configure Azure Disk Encryption</p></li><li class="square"><p>Lesson 7: Module 4 Review Questions</p></li></ul><p><b>Module 5: Implement Load Balancing and Network Security</b></p><ul class="square"><li class="square"><p>Lesson 1: Implement Azure Load Balancer</p></li><li class="square"><p>Lesson 2: Implement an Application Gateway</p></li><li class="square"><p>Lesson 3: Web Application Firewall</p></li><li class="square"><p>Lesson 4: Implement Azure Firewall</p></li><li class="square"><p>Lesson 5: Implement Azure Front Door</p></li><li class="square"><p>Lesson 6: Implementing Azure Traffic Manager</p></li><li class="square"><p>Lesson 7: Implement Network Security Groups and Application Security Groups</p></li><li class="square"><p>Lesson 8: Implement Azure Bastion</p></li><li class="square"><p>Lesson 9: Module 5 Review Questions</p></li></ul><p><b>Module 6: Implement Storage Accounts</b></p><ul class="square"><li class="square"><p>Lesson 1: Storage Accounts</p></li><li class="square"><p>Lesson 2: Blob Storage</p></li><li class="square"><p>Lesson 3: Storage Security</p></li><li class="square"><p>Lesson 4: Managing Storage</p></li><li class="square"><p>Lesson 5: Accessing Blobs and Queues using AAD</p></li><li class="square"><p>Lesson 6: Configure Azure Storage Firewalls and Virtual Networks</p></li><li class="square"><p>Lesson 7: Module 6 Review Questions</p></li></ul><p><b>Module 7: Implement NoSQL Databases</b></p><ul class="square"><li class="square"><p>Lesson 1: Configure Storage Account Tables</p></li><li class="square"><p>Lesson 2: Select Appropriate CosmosDB APIs</p></li><li class="square"><p>Lesson 3: Module 7 Review Questions</p></li></ul><p><b>Module 8: Implement Azure SQL Databases</b></p><ul class="square"><li class="square"><p>Lesson 1: Configure Azure SQL Database Settings</p></li><li class="square"><p>Lesson 2: Implement Azure SQL Database Managed Instances</p></li><li class="square"><p>Lesson 3: High-Availability and Azure SQL Database</p></li><li class="square"><p>Lesson 4: Module 8 Review Questions</p></li></ul><p><b>Module 9: Automate Deployment and Configuration of Resources</b></p><ul class="square"><li class="square"><p>Lesson 1: Azure Resource Manager Templates</p></li><li class="square"><p>Lesson 2: Save a Template for a VM</p></li><li class="square"><p>Lesson 3: Evaluate Location of New Resources</p></li><li class="square"><p>Lesson 4: Configure a Virtual Hard Disk Template</p></li><li class="square"><p>Lesson 5: Deploy from a Template</p></li><li class="square"><p>Lesson 6: Create and Execute an Automation Runbook</p></li><li class="square"><p>Lesson 7: Module 9 Review Questions</p></li></ul><p><b>Module 10: Implement and Manage Azure Governance Solutions</b></p><ul class="square"><li class="square"><p>Lesson 1: Overview of Role-Based Access Control (RBAC)</p></li><li class="square"><p>Lesson 2: Role-Based Access Control (RBAC) Roles</p></li><li class="square"><p>Lesson 3: Azure AD Access Reviews</p></li><li class="square"><p>Lesson 4: Implement and Configure an Azure Policy</p></li><li class="square"><p>Lesson 5: Azure Blueprints</p></li><li class="square"><p>Lesson 6: Lab</p></li><li class="square"><p>Lesson 7: Module 10 Review Questions</p></li></ul><p><b>Module 11: Manage Security for Applications</b></p><ul class="square"><li class="square"><p>Lesson 1: Azure Key Vault</p></li><li class="square"><p>Lesson 2: Azure Managed Identity</p></li><li class="square"><p>Lesson 3: Module 11 Review Questions</p></li></ul><p><b>Module 12: Manage Workloads in Azure</b></p><ul class="square"><li class="square"><p>Lesson 1: Migrate Workloads using Azure Migrate</p></li><li class="square"><p>Lesson 2: VMware Agentless Migration</p></li><li class="square"><p>Lesson 3: VMware Agent-Based Migration</p></li><li class="square"><p>Lesson 4: Implement Azure Backup</p></li><li class="square"><p>Lesson 5: Azure to Azure Site Recovery</p></li><li class="square"><p>Lesson 6: Implement Azure Update Management</p></li><li class="square"><p>Lesson 7: Lab</p></li><li class="square"><p>Lesson 8: Module 12 Review Questions</p></li></ul><p><b>Module 13: Implement Container-Based Applications</b></p><ul class="square"><li class="square"><p>Lesson 1: Azure Container Instances</p></li><li class="square"><p>Lesson 2: Configure Azure Kubernetes Service</p></li><li class="square"><p>Lesson 3: Module 13 Review Questions</p></li></ul><p><b>Module 14: Implement an Application Infrastructure</b></p><ul class="square"><li class="square"><p>Lesson 1: Create and Configure Azure App Service</p></li><li class="square"><p>Lesson 2: Create an App Service Web App for Containers</p></li><li class="square"><p>Lesson 3: Create and Configure an App Service Plan</p></li><li class="square"><p>Lesson 4: Configure Networking for an App Service</p></li><li class="square"><p>Lesson 5: Create and Manage Deployment Slots</p></li><li class="square"><p>Lesson 6: Implement Logic Apps</p></li><li class="square"><p>Lesson 7: Implement Azure Functions</p></li><li class="square"><p>Lesson 8: Labs</p></li><li class="square"><p>Lesson 9: Module 14 Review Questions</p></li></ul><p><b>Module 15: Implement Cloud Infrastructure Monitoring</b></p><ul class="square"><li class="square"><p>Lesson 1: Azure Infrastructure Security Monitoring</p></li><li class="square"><p>Lesson 2: Azure Monitor</p></li><li class="square"><p>Lesson 3: Azure Workbooks</p></li><li class="square"><p>Lesson 4: Azure Alerts</p></li><li class="square"><p>Lesson 5: Log Analytics</p></li><li class="square"><p>Lesson 6: Network Watcher</p></li><li class="square"><p>Lesson 7: Azure Service Health</p></li><li class="square"><p>Lesson 8: Monitor Azure Costs</p></li><li class="square"><p>Lesson 9: Azure Application Insights</p></li><li class="square"><p>Lesson 10: Unified Monitoring in Azure</p></li><li class="square"><p>Lesson 11: Module 15 Review Questions</p></li></ul><h3 class="da-h3" id="1191584">AZ-303 Certification Exam</h3><p>The AZ-303, <a href="https://docs.microsoft.com/en-us/learn/certifications/exams/az-303" title="" target="_blank">Microsoft Azure Architect Technologies</a>, certification exam is geared towards Azure Solutions Architect candidates who   advise stakeholders and translate business requirements into secure, scalable, and reliable solutions.</p><p>Candidates should have advanced experience and knowledge of IT operations, including networking, virtualization, identity, security, business continuity, disaster recovery, data platform, budgeting, and governance. This role requires managing how decisions in each area affects an overall solution.</p><p>The exam includes four study areas. The percentages indicate the relative weight of each area on the exam. The higher the percentage, the more questions the exam will contain.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p><b>AZ-303 Study Areas</b></p></td><td><p><b>Weights</b></p></td></tr></thead><tbody><tr><td><p>Implement and Monitor an Azure Infrastructure</p></td><td><p>50-55%</p></td></tr><tr><td><p>Implement Management and Security Solutions</p></td><td><p>25-30%</p></td></tr><tr><td><p>Implement Solutions for Apps</p></td><td><p>10-15%</p></td></tr><tr><td><p>Implement and Manage Data Platforms</p></td><td><p>10-15%</p></td></tr></tbody></table><h3 class="da-h3" id="1191640">Azure AD Connect Installation</h3><p><b>Azure AD Connect Express Settings</b> is used when you have a single-forest topology and password hash synchronization for authentication. Express Settings is the default option and is used for the most commonly deployed scenario.</p><p><b>Azure AD Connect Custom</b> settings is used when you want more options for the installation. It is used if you have multiple forests or if you want to configure optional features not covered in the express installation. It is used in all cases where the express installation option does not satisfy your deployment or topology.</p><h4 class="da-h4">Install Azure AD Connect</h4><p>✔️ <b>Important</b>
Microsoft doesn't support modifying or operating Azure AD Connect sync outside of the actions that are formally documented. Any of these actions might result in an inconsistent or unsupported state of Azure AD Connect sync. As a result, Microsoft can't provide technical support for such deployments.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Solution</p></td><td><p>Scenario</p></td></tr></thead><tbody><tr><td><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-install-express" title="" target="_blank">Express settings</a></p></td><td><p>If you have a single forest AD then this is the recommended option to use. User sign in with the same password using password synchronization.</p></td></tr><tr><td><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-install-custom" title="" target="_blank">Customized settings</a></p></td><td><p>Used when you have multiple forests. Supports many on-premises topologies. Customize your sign-in option, such as pass-through authentication, ADFS for federation or use a 3rd party identity provider. Customize synchronization features, such as filtering and writeback.</p></td></tr><tr><td><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-dirsync-upgrade-get-started" title="" target="_blank">Upgrade from DirSync</a></p></td><td><p>Used when you have an existing DirSync server already running.</p></td></tr><tr><td><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-upgrade-previous-version" title="" target="_blank">Upgrade from Azure AD Sync or Azure AD Connect</a></p></td><td><p>There are several different methods depending on your preference.</p></td></tr></tbody></table><h4 class="da-h4">Next steps to Install Azure AD Connect</h4><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Topic</p></td><td><p>Link</p></td></tr></thead><tbody><tr><td><p>Download Azure AD Connect</p></td><td><p><a href="https://go.microsoft.com/fwlink/?LinkId=615771" title="" target="_blank">Download Azure AD Connect</a></p></td></tr><tr><td><p>Install using Express settings</p></td><td><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-install-express" title="" target="_blank">Express installation of Azure AD Connect</a></p></td></tr><tr><td><p>Install using Customized settings</p></td><td><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-install-custom" title="" target="_blank">Custom installation of Azure AD Connect</a></p></td></tr><tr><td><p>Upgrade from DirSync</p></td><td><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-dirsync-upgrade-get-started" title="" target="_blank">Upgrade from Azure AD sync tool (DirSync)</a></p></td></tr><tr><td><p>After installation</p></td><td><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-post-installation" title="" target="_blank">Verify the installation and assign licenses</a></p></td></tr></tbody></table><h4 class="da-h4">Configure sync features</h4><p>Azure AD Connect comes with several features you can optionally turn on or are enabled by default. Some features might sometimes require more configuration in certain scenarios and topologies.</p><ul class="square"><li class="square"><p><b>Filtering</b> is used when you want to limit which objects are synchronized to Azure AD. By default all users, contacts, groups, and Windows 10 computers are synchronized. You can change the filtering based on domains, OUs, or attributes.</p></li><li class="square"><p><b>Password hash synchronization</b> synchronizes the password hash in Active Directory to Azure AD. The end-user can use the same password on-premises and in the cloud but only manage it in one location. Since it uses your on-premises Active Directory as the authority, you can also use your own password policy.</p></li><li class="square"><p><b>Password writeback</b> allows your users to change and reset their passwords in the cloud and have your on-premises password policy applied.</p></li><li class="square"><p><b>Device writeback</b> allows a device registered in Azure AD to be written back to on-premises Active Directory so it can be used for Conditional Access.</p></li><li class="square"><p>The <b>prevent accidental deletes</b> feature is turned on by default and protects your cloud directory from numerous deletes at the same time. By default it allows 500 deletes per run. You can change this setting depending on your organization size.</p></li><li class="square"><p><b>Automatic upgrade</b> is enabled by default for express settings installations and ensures your Azure AD Connect is always up to date with the latest release.</p></li></ul><h3 class="da-h3" id="1191585">Microsoft Learn</h3><p>Microsoft Learn provides self paced skills training on a variety of topics. These Learn modules cover the content you have just learned. You can also search for additional content that might be helpful.</p><h4 class="da-h4">Module 01 - Identity</h4><ul class="square"><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/create-users-and-groups-in-azure-active-directory/" title="" target="_blank">Create Azure users and groups in Azure Active Directory</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/manage-users-and-groups-in-aad/" title="" target="_blank">Manage users and groups in Azure Active Directory</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/secure-azure-resources-with-rbac/" title="" target="_blank">Secure your Azure resources with role-based access control</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/secure-aad-users-with-mfa/" title="" target="_blank">Secure Azure Active Directory users with Multi-Factor Authentication</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/allow-users-reset-their-password/" title="" target="_blank">Allow users to reset their password with Azure Active Directory self-service password reset</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/secure-app-with-oidc-and-azure-ad/" title="" target="_blank">Secure your application by using OpenID Connect and Azure AD</a></p></li></ul><h4 class="da-h4">Module 02 - Governance and Compliance</h4><ul class="square"><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/analyze-costs-create-budgets-azure-cost-management/" title="" target="_blank">Analyze costs and create budgets with Azure Cost Management</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/predict-costs-and-optimize-spending/" title="" target="_blank">Predict costs and optimize spending for Azure</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/control-and-organize-with-azure-resource-manager/" title="" target="_blank">Control and organize Azure resources with Azure Resource Manager</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/intro-to-governance/" title="" target="_blank">Apply and monitor infrastructure standards with Azure Policy</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/create-custom-azure-roles-with-rbac/" title="" target="_blank">Create custom roles for Azure resources with role-based access control</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/manage-subscription-access-azure-rbac/" title="" target="_blank">Manage access to an Azure subscription by using Azure role-based access control</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/secure-azure-resources-with-rbac/" title="" target="_blank">Secure your Azure resources with role-based access control</a></p></li></ul><h4 class="da-h4">Module 03 - Azure Administration</h4><ul class="square"><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/tour-azure-portal/" title="" target="_blank">Core Cloud Services - Manage services with the Azure portal</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/control-and-organize-with-azure-resource-manager/" title="" target="_blank">Control and organize Azure resources with Azure Resource Manager</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/build-azure-vm-templates/" title="" target="_blank">Build Azure Resource Manager templates</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/automate-azure-tasks-with-powershell/" title="" target="_blank">Automate Azure tasks using scripts with PowerShell</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/manage-virtual-machines-with-azure-cli/" title="" target="_blank">Manage virtual machines with the Azure CLI</a></p></li></ul><h4 class="da-h4">Module 04 - Virtual Networking</h4><ul class="square"><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/network-fundamentals/" title="" target="_blank">Networking Fundamentals - Principals</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/design-ip-addressing-for-azure/" title="" target="_blank">Design an IP addressing schema for your Azure deployment</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/secure-and-isolate-with-nsg-and-service-endpoints/" title="" target="_blank">Secure and isolate access to Azure resources by using network security groups and service endpoints</a></p></li></ul><h4 class="da-h4">Module 05 - Intersite Connectivity</h4><ul class="square"><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/integrate-vnets-with-vnet-peering/" title="" target="_blank">Distribute your services across Azure virtual networks and integrate them by using virtual network peering</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/connect-on-premises-network-with-vpn-gateway/" title="" target="_blank">Connect your on-premises network to Azure with VPN Gateway</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/connect-on-premises-network-with-expressroute/" title="" target="_blank">Connect your on-premises network to the Microsoft global network by using ExpressRoute</a></p></li></ul><h4 class="da-h4">Module 06 - Network Traffic Management</h4><ul class="square"><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/control-network-traffic-flow-with-routes/" title="" target="_blank">Manage and control traffic flow in your Azure deployment with routes</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/improve-app-scalability-resiliency-with-load-balancer/" title="" target="_blank">Improve application scalability and resiliency by using Azure Load Balancer</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/load-balance-web-traffic-with-application-gateway/" title="" target="_blank">Load balance your web service traffic with Application Gateway</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/distribute-load-with-traffic-manager/" title="" target="_blank">Enhance your service availability and data locality by using Azure Traffic Manager</a></p></li></ul><h4 class="da-h4">Module 07 - Azure Storage</h4><ul class="square"><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/create-azure-storage-account/" title="" target="_blank">Create an Azure Storage account</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/secure-azure-storage-account/" title="" target="_blank">Secure your Azure Storage</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/optimize-archive-costs-blob-storage/" title="" target="_blank">Optimize storage performance and costs using Blob storage tiers</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/ha-application-storage-with-grs/" title="" target="_blank">Make your application storage highly available with read-access geo-redundant storage</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/copy-blobs-from-command-line-and-code/" title="" target="_blank">Copy and move blobs from one container or storage account to another from the command line and in code</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/move-data-with-azure-data-box/" title="" target="_blank">Move large amounts of data to the cloud by using Azure Data Box family</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/monitor-diagnose-and-troubleshoot-azure-storage/" title="" target="_blank">Monitor, diagnose, and troubleshoot your Azure storage</a></p></li></ul><h4 class="da-h4">Module 08 - Azure Virtual Machines</h4><ul class="square"><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/build-app-with-scale-sets/" title="" target="_blank">Build a scalable application with virtual machine scale sets</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/deploy-vms-from-vhd-templates/" title="" target="_blank">Deploy Azure virtual machines from VHD templates</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/choose-the-right-disk-storage-for-vm-workload/" title="" target="_blank">Choose the right disk storage for your virtual machine workload</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/add-and-size-disks-in-azure-virtual-machines/" title="" target="_blank">Add and size disks in Azure virtual machines</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/protect-vm-settings-with-dsc/" title="" target="_blank">Protect your virtual machine settings with Azure Automation State Configuration</a></p></li></ul><h4 class="da-h4">Module 09 - Serverless Computing</h4><ul class="square"><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/host-a-web-app-with-azure-app-service/" title="" target="_blank">Host a web application with Azure App service</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/stage-deploy-app-service-deployment-slots/" title="" target="_blank">Stage a web app deployment for testing and rollback by using App Service deployment slots</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/app-service-scale-up-scale-out/" title="" target="_blank">Scale an App Service web app to efficiently meet demand with App Service scale up and scale out</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/app-service-autoscale-rules/" title="" target="_blank">Dynamically meet changing web app performance requirements with autoscale rules</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/capture-page-load-times-application-insights/" title="" target="_blank">Capture and view page load times in your Azure web app with Application Insights</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/run-docker-with-azure-container-instances/" title="" target="_blank">Run Docker containers with Azure Container Instances</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/intro-to-azure-kubernetes-service/" title="" target="_blank">Introduction to the Azure Kubernetes Service</a></p></li></ul><h4 class="da-h4">Module 10 - Data Protection</h4><ul class="square"><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/protect-virtual-machines-with-azure-backup/" title="" target="_blank">Protect your virtual machines by using Azure Backup</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/backup-restore-azure-sql/" title="" target="_blank">Back up and restore your Azure SQL database</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/protect-infrastructure-with-site-recovery/" title="" target="_blank">Protect your Azure infrastructure with Azure Site Recovery</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/protect-on-premises-infrastructure-with-azure-site-recovery/" title="" target="_blank">Protect your on-premises infrastructure from disasters with Azure Site Recovery</a></p></li></ul><h4 class="da-h4">Module 11 - Monitoring</h4><ul class="square"><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/analyze-infrastructure-with-azure-monitor-logs/" title="" target="_blank">Analyze your Azure infrastructure by using Azure Monitor logs</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/incident-response-with-alerting-on-azure/" title="" target="_blank">Improve incident response with alerting on Azure</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/monitor-azure-vm-using-diagnostic-data/" title="" target="_blank">Monitor the health of your Azure virtual machine by collecting and analyzing diagnostic data</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/learn/modules/monitor-diagnose-and-troubleshoot-azure-storage/" title="" target="_blank">Monitor, diagnose, and troubleshoot your Azure storage</a></p></li></ul><h3 class="da-h3" id="1191586">Additional Study Resources</h3><p>There are a lot of additional resources to help you learn about Azure. We recommend you bookmark these pages.</p><ul class="square"><li class="square"><p><a href="https://social.msdn.microsoft.com/Forums/en-US/home?category=windowsazureplatform" title="" target="_blank">Azure forums</a>. The Azure forums are very active. You can search the threads for a specific area of interest. You can also browse categories like Azure Storage, Pricing and Billing, Azure Virtual Machines, and Azure Migrate.</p></li><li class="square"><p><a href="https://www.microsoft.com/en-us/learning/community-blog.aspx" title="" target="_blank">Microsoft Learning Community Blog</a>. Get the latest information about the certification tests and exam study groups.</p></li><li class="square"><p><a href="https://channel9.msdn.com/" title="" target="_blank">Channel 9</a>. Channel 9 provides a wealth of informational videos, shows, and events.</p></li><li class="square"><p><a href="https://channel9.msdn.com/Shows/Tuesdays-With-Corey/" title="" target="_blank">Azure Tuesdays with Corey</a>. Corey Sanders answers your questions about Microsoft Azure - Virtual Machines, Web Sites, Mobile Services, Dev/Test etc.</p></li><li class="square"><p><a href="https://channel9.msdn.com/Shows/Azure-Friday" title="" target="_blank">Azure Fridays</a>. Join Scott Hanselman as he engages one-on-one with the engineers who build the services that power Microsoft Azure, as they demo capabilities, answer Scott's questions, and share their insights.</p></li><li class="square"><p><a href="https://azure.microsoft.com/en-us/blog/" title="" target="_blank">Microsoft Azure Blog</a>. Keep current on what's happening in Azure, including what's now in preview, generally available, news &amp; updates, and more.</p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/" title="" target="_blank">Azure Documentation</a>. Stay informed on the latest products, tools, and features. Get information on pricing, partners, support, and solutions.</p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/architecture/" title="" target="_blank">Azure Architecture Center</a>. The Azure Architecture Center provides best practices for running your workloads on Azure.</p><ul class="square"><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/architecture/browse/" title="" target="_blank">Azure Reference Architectures</a>. Architecture diagrams, reference architectures, example scenarios, and solutions for common workloads on Azure.</p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/" title="" target="_blank">Cloud Design Patterns</a>. Cloud design patterns for building reliable, scalable, secure applications in the cloud.</p></li><li class="square"><p><a href="https://github.com/microsoft/ignite-learning-paths-training-ops" title="" target="_blank">Tailwind Traders</a>.  A three-tier legacy app re-written for modern cloud app ARM Solution]</p></li></ul></li></ul><h3 class="da-h3" id="1191641">Single Sign-On</h3><p>Single sign-on (SSO) adds security and convenience when users sign-on to applications in Azure Active Directory (Azure AD). This article describes the single sign-on methods, and helps you choose the most appropriate SSO method when configuring your applications.</p><ul class="square"><li class="square"><p><b>With single sign-on</b>, users sign in once with one account to access domain-joined devices, company resources, software as a service (SaaS) applications, and web applications. After signing in, the user can launch applications from the Office 365 portal or the Azure AD MyApps access panel. Administrators can centralize user account management, and automatically add or remove user access to applications based on group membership.</p></li><li class="square"><p><b>Without single sign-on</b>, users must remember application-specific passwords and sign in to each application. IT staff needs to create and update user accounts for each application such as Office 365, Box, and Salesforce. Users need to remember their passwords, plus spend the time to sign in to each application.</p></li></ul><h4 class="da-h4">Choosing a single sign-on method</h4><p>There are several ways to configure an application for single sign-on. Choosing a single sign-on method depends on how the application is configured for authentication.</p><ul class="square"><li class="square"><p>Cloud applications can use OpenID Connect, OAuth, SAML, password-based, linked, or disabled methods for single sign-on.</p></li><li class="square"><p>On-premises applications can use password-based, Integrated Windows Authentication, header-based, linked, or disabled methods for single sign-on. The on-premises choices work when applications are configured for Application Proxy.</p></li></ul><p>This flowchart helps you decide which single sign-on method is best for your situation.</p><p><span><img alt="" src="../Images/1192155-490293.png" width="" height="" /></span></p><p>The following table summarizes the single sign-on methods, and links to more details.</p><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p><b>Single sign-on method</b></p></td><td><p><b>Application types</b></p></td><td><p><b>When to use</b></p></td></tr></thead><tbody><tr><td><p><b>OpenID Connect   and OAuth</b></p></td><td><p>cloud only</p></td><td><p>Use OpenID Connect and OAuth when developing a new   application. This protocol simplifies application configuration, has   easy-to-use SDKs, and enables your application to use MS Graph.</p></td></tr><tr><td><p><b>SAML</b></p></td><td><p>cloud and on-premises</p></td><td><p>Choose SAML whenever possible for existing applications   that do not use OpenID Connect or OAuth. SAML works for applications that   authenticate using one of the SAML protocols.</p></td></tr><tr><td><p><b>Password-based</b></p></td><td><p>cloud and on-premises</p></td><td><p>Choose password-based when the application authenticates   with username and password. Password-based single sign-on enables secure   application password storage and replay using a web browser extension or   mobile app. This method uses the existing sign-in process provided by the   application, but enables an administrator to manage the passwords.</p></td></tr><tr><td><p><b>Linked</b></p></td><td><p>cloud and on-premises</p></td><td><p>Choose linked sign-on when the application is configured   for single sign-on in another identity provider service. This option doesn't   add single sign-on to the application. However, the application might already   have single sign-on implemented using another service such as Active Directory   Federation Services.</p></td></tr><tr><td><p><b>Disabled</b></p></td><td><p>cloud and on-premises</p></td><td><p>Choose disabled single sign-on when the app isn't ready to   be configured for single sign-on. This mode is the default when you create   the app.</p></td></tr><tr><td><p><b>Integrated   Windows Authentication (IWA)</b></p></td><td><p>on-premises only</p></td><td><p>Choose IWA single sign-on for applications that use Integrated   Windows Authentication (IWA), or claims-aware applications. For   IWA, the Application Proxy connectors use Kerberos Constrained Delegation   (KCD) to authenticate users to the application.</p></td></tr><tr><td><p><b>Header-based</b></p></td><td><p>on-premises only</p></td><td><p>Use header-based single sign-on when the application uses   headers for authentication. Header-based single sign-on requires PingAccess   for Azure AD. Application Proxy uses Azure AD to authenticate the user and   then passes traffic through the connector</p></td></tr></tbody></table><h3 class="da-h3" id="1191642">Demonstration - Azure AD Seamless Single Sign-On</h3><p>Azure Active Directory (Azure AD) Seamless Single Sign-On (Seamless SSO) automatically signs in users when they are on their corporate desktops that are connected to your corporate network. Seamless SSO provides your users with easy access to your cloud-based applications without needing any additional on-premises components.</p><h4 class="da-h4">Prerequisites</h4><p>Ensure that the following prerequisites are in place prior to this demonstration:</p><ul class="square"><li class="square"><p><b>Set up your Azure AD Connect server</b>: If you use Pass-through Authentication as your sign-in method, no additional prerequisite check is required. If you use password hash synchronization as your sign-in method, and if there is a firewall between Azure AD Connect and Azure AD, ensure that:</p><ul class="square"><li class="square"><p>You use version 1.1.644.0 or later of Azure AD Connect.</p></li><li class="square"><p>If your firewall or proxy allows DNS whitelisting, whitelist the connections to the *.msappproxy.net URLs over port 443.</p></li></ul></li><li class="square"><p><b>Set up domain administrator credentials</b>: You need to have enterprise administrator credentials for each Active Directory forest that:</p><ul class="square"><li class="square"><p>You synchronize to Azure AD through Azure AD Connect.</p></li><li class="square"><p>Contains users you want to enable for Seamless SSO.</p></li></ul></li></ul><h4 class="da-h4">Enable Azure AD Connect.</h4><p>Enable Seamless SSO through <a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/whatis-hybrid-identity" title="" target="_blank">Azure AD Connect</a>.</p><p>If you're doing a fresh installation of Azure AD Connect, choose the <a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-install-custom" title="" target="_blank">custom installation path</a>. At the User sign-in page, select the Enable single sign on option.</p><p><span><img alt="" src="../Images/1192062-490200.png" width="" height="" /></span></p><p>If you already have an installation of Azure AD Connect, select the Change user sign-in page in Azure AD Connect, and then select Next.</p><p><span><img alt="" src="../Images/1192063-490201.png" width="" height="" /></span></p><p>Continue through the wizard until you get to the Enable single sign on page. Provide domain administrator credentials for each Active Directory forest that:</p><ul class="square"><li class="square"><p>You synchronize to Azure AD through Azure AD Connect.</p></li><li class="square"><p>Contains users you want to enable for Seamless SSO.</p></li></ul><p>After completion of the wizard, Seamless SSO is enabled on your tenant.</p><h4 class="da-h4">Verify Seamless SSO is enabled</h4><p>Follow procedure below to verify that you have enabled Seamless SSO correctly:</p><ol class="number"><li><p>Sign in to the <a href="https://aad.portal.azure.com/" title="" target="_blank">Azure Active Directory administrative center</a> with the global administrator credentials for your tenant.</p></li><li><p>Select <b>Azure Active Directory</b> in the left pane.</p></li><li><p>Select <b>Azure AD Connect</b>.</p></li><li><p>Verify that the Seamless single sign-on feature appears as <i>Enabled</i>.</p></li></ol><p><span><img alt="" src="../Images/1192064-490202.png" width="" height="" /></span></p><p><b>Important</b>
Seamless SSO creates a computer account named AZUREADSSOACC in your on-premises Active Directory (AD) in each AD forest. The AZUREADSSOACC computer account needs to be strongly protected for security reasons. Only Domain Admins should be able to manage the computer account. Ensure that Kerberos delegation on the computer account is disabled, and that no other account in Active Directory has delegation permissions on the AZUREADSSOACC computer account. Store the computer account in an Organization Unit (OU) where they are safe from accidental deletions and where only Domain Admins have access.</p><h3 class="da-h3" id="1191589">Azure Active Directory (Azure AD)</h3><p>Azure Active Directory (Azure AD) is Microsoft’s multi-tenant cloud-based directory and identity management service. For IT Admins, Azure AD provides an affordable, easy to use solution to give employees and business partners single sign-on (SSO) access to thousands of cloud SaaS Applications like Office365, Salesforce, DropBox, and Concur.</p><p>For application developers, Azure AD lets you focus on building your application by making it fast and simple to integrate with a world class identity management solution used by millions of organizations around the world.</p><p><span><img alt="" src="../Images/1192231-490369.png" width="" height="" /></span></p><h4 class="da-h4">Benefits and features</h4><ul class="square"><li class="square"><p><b>Single sign-on to any cloud or on-premises web app</b>. Azure Active Directory provides secure single sign-on to cloud and on-premises applications including Microsoft Office 365 and thousands of SaaS applications such as Salesforce, Workday, DocuSign, ServiceNow, and Box.</p></li><li class="square"><p><b>Works with iOS, Mac OS X, Android, and Windows devices</b>. Users can launch applications from a personalized web-based access panel, mobile app, Office 365, or custom company portals using their existing work credentials—and have the same experience whether they’re working on iOS, Mac OS X, Android, and Windows devices.</p></li><li class="square"><p><b>Protect on-premises web applications with secure remote access</b>. Access your on-premises web applications from everywhere and protect with multi-factor authentication, conditional access policies, and group-based access management. Users can access SaaS and on-premises web apps from the same portal.</p></li><li class="square"><p><b>Easily extend Active Directory to the cloud</b>. Connect Active Directory and other on-premises directories to Azure Active Directory in just a few clicks and maintain a consistent set of users, groups, passwords, and devices across both environments.</p></li><li class="square"><p><b>Protect sensitive data and applications</b>. Enhance application access security with unique identity protection capabilities that provide a consolidated view into suspicious sign-in activities and potential vulnerabilities. Take advantage of advanced security reports, notifications, remediation recommendations and risk-based policies to protect your business from current and future threats.</p></li><li class="square"><p><b>Reduce costs and enhance security with self-service capabilities</b>. Delegate important tasks such as resetting passwords and the creation and management of groups to your employees. Providing self-service application access and password management through verification steps can reduce helpdesk calls and enhance security.</p></li></ul><p>✔️ If you are an Office365, Azure or Dynamics CRM Online customer, you might not realize that you are already using Azure AD. Every Office365, Azure and Dynamics CRM tenant is already an Azure AD tenant. Whenever you want you can start using that tenant to manage access to thousands of other cloud applications Azure AD integrates with.</p><h3 class="da-h3" id="1191644">Enable Azure AD Self-Service Password</h3><p>Azure Active Directory (Azure AD) self-service password reset (SSPR) gives users the ability to change or reset their password, with no administrator or help desk involvement. If a user's account is locked or they forget their password, they can follow prompts to unblock themselves and get back to work. This ability reduces help desk calls and loss of productivity when a user can't sign in to their device or an application.</p><p>This topic demonstrates how to enable self-service password reset.</p><ul class="square"><li class="square"><p>Enable self-service password reset for a group of Azure AD users</p></li><li class="square"><p>Configure authentication methods and registration options</p></li><li class="square"><p>Test the SSPR process as a user</p></li></ul><h4 class="da-h4">Prerequisites</h4><p>To complete this demonstration, you need the following resources and privileges:</p><ul class="square"><li class="square"><p>A working Azure AD tenant with at least a trial license enabled.</p></li><li class="square"><p>An account with Global Administrator privileges.</p></li><li class="square"><p>A non-administrator user with a password you know, such as testuser. You test the end-user SSPR experience using this account in this demonstration.</p></li><li class="square"><p>A group that the non-administrator user is a member of, such as SSPR-Test-Group. You enable SSPR for this group in this demonstration.</p></li></ul><h4 class="da-h4">Enable self-service password reset</h4><p>Azure AD lets you enable SSPR for None, Selected, or All users. This granular ability lets you choose a subset of users to test the SSPR registration process and workflow. When you're comfortable with the process and can communicate the requirements with a broader set of users, you can select additional groups of users to enable for SSPR. Or, you can enable SSPR for everyone in the Azure AD tenant.</p><p>In this demonstration, configure SSPR for a set of users in a test group. In the following example, the group SSPR-Test-Group is used. Provide your own Azure AD group as needed:</p><ol class="number"><li><p>Sign in to the <a href="https://portal.azure.com/" title="" target="_blank">Azure portal</a> using an account with global administrator permissions.</p></li><li><p>Search for and select <b>Azure Active Directory</b>, then choose <b>Password reset</b> from the menu on the left-hand side.</p></li><li><p>From the <b>Properties</b> page, under the option Self service password reset enabled, choose <b>Select group</b>.</p></li><li><p>Browse for and select your Azure AD group, such as <i>SSPR-Test-Group</i>, then choose <b>Select</b>.</p></li></ol><p><span><img alt="" src="../Images/1192186-490324.png" width="" height="" /></span></p><p>
As part of a wider deployment of SSPR, nested groups are supported. Make sure that the users in the group(s) you choose have the appropriate licenses assigned. There's currently no validation process of these licensing requirements.
</p><ol class="number"><li value="5"><p>To enable SSPR for the select users, select <b>Save</b>.</p></li></ol><h4 class="da-h4">Select authentication methods and registration options</h4><p>When users need to unlock their account or reset their password, they're prompted for an additional confirmation method. This additional authentication factor makes sure that only approved SSPR events are completed. You can choose which authentication methods to allow, based on the registration information the user provides.</p><ol class="number"><li><p>On the <b>Authentication methods</b> page from the menu in the left-hand side, set the <b>Number of methods required to reset</b> to <i>1</i>.</p></li></ol><p>To improve security, you can increase the number of authentication methods required for SSPR.</p><ol class="number"><li value="2"><p>Choose the <b>Methods available to users</b> that your organization wants to allow. For this demonstration, check the boxes to enable the following methods:</p></li></ol><ul class="square"><li class="square"><p><i>Mobile app notification</i></p></li><li class="square"><p><i>Mobile app code</i></p></li><li class="square"><p><i>Email</i></p></li><li class="square"><p><i>Mobile phone</i></p></li><li class="square"><p><i>Office phone</i></p></li></ul><ol class="number"><li value="3"><p>To apply the authentication methods, select <b>Save</b>.</p></li></ol><p>Before users can unlock their account or reset a password, they must register their contact information. This contact information is used for the different authentication methods configured in the previous steps.</p><p>An administrator can manually provide this contact information, or users can go to a registration portal to provide the information themselves. In this demonstration, configure the users to be prompted for registration when they next sign in.</p><ol class="number"><li><p>On the <b>Registration</b> page from the menu in the left-hand side, select Yes for <b>Require users to register when signing in</b>.</p></li><li><p>It's important that contact information is kept up to date. If the contact information is outdated when an SSPR event is started, the user may not be able to unlock their account or reset their password.</p></li></ol><p>Set <b>Number of days before users are asked to reconfirm their authentication information</b> to <i>180</i>.</p><ol class="number"><li value="3"><p>To apply the registration settings, select <b>Save</b>.</p></li></ol><h4 class="da-h4">Configure notifications and customizations</h4><p>To keep users informed about account activity, you can configure e-mail notifications to be sent when an SSPR event happens. These notifications can cover both regular user accounts and admin accounts. For admin accounts, this notification provides an additional layer of awareness when a privileged administrator account password is reset using SSPR.</p><ol class="number"><li><p>On the <b>Notifications</b> page from the menu in the left-hand side, configure the following options:</p></li></ol><ul class="square"><li class="square"><p>Set <b>Notify users on password resets option</b> to <i>Yes</i>.</p></li><li class="square"><p>Set <b>Notify all admins when other admins reset their password</b> to <i>Yes</i>.</p></li></ul><ol class="number"><li value="2"><p>To apply the notification preferences, select <b>Save</b>.</p></li></ol><h3 class="da-h3" id="1191590">Azure AD Concepts</h3><ul class="square"><li class="square"><p><b>Identity</b>. A thing that can get authenticated. An identity can be a user with a username and password. Identities also include applications or other servers that might require authentication through secret keys or certificates.</p></li><li class="square"><p><b>Account</b>. An identity that has data associated with it. You cannot have an account without an identity.</p></li><li class="square"><p><b>Azure AD Account</b>. An identity created through Azure AD or another Microsoft cloud service, such as Office 365. Identities are stored in Azure AD and accessible to your organization's cloud service subscriptions. This account is also sometimes called a Work or school account.</p></li><li class="square"><p><b>Azure subscription</b>. Used to pay for Azure cloud services. You can have many subscriptions and they're linked to a credit card.</p></li><li class="square"><p><b>Azure tenant</b>. A dedicated and trusted instance of Azure AD that's automatically created when your organization signs up for a Microsoft cloud service subscription, such as Microsoft Azure, Microsoft Intune, or Office 365. An Azure tenant represents a single organization.</p></li><li class="square"><p><b>Azure AD directory</b>. Each Azure tenant has a dedicated and trusted Azure AD directory. The Azure AD directory includes the tenant's users, groups, and apps and is used to perform identity and access management functions for tenant resources.</p></li></ul><h3 class="da-h3" id="1191645">Test Self-Service Password Reset</h3><p>With SSPR enabled and configured, test the SSPR process with a user that's part of the group you selected in the previous section, such as Test-SSPR-Group. In the following example, the testuser account is used. Provide your own user account that's part of the group you enabled for SSPR in the first section of this demonstration.</p><p>✔️ <b>Note</b>
When you test the self-service password reset, use a non-administrator account. Admins are always enabled for self-service password reset and are required to use two authentication methods to reset their password.</p><ol class="number"><li><p>To see the manual registration process, open a new browser window in InPrivate or incognito mode, and browse to <a href="https://aka.ms/ssprsetup" title="" target="_blank">https://aka.ms/ssprsetup</a>. Users should be directed to this registration portal when they next sign-in.</p></li><li><p>Sign in with a non-administrator test user, such as testuser, and register your authentication methods contact information.</p></li><li><p>Once complete, select the button marked <b>Looks good</b> and close the browser window.</p></li><li><p>Open a new browser window in InPrivate or incognito mode, and browse to <a href="https://aka.ms/sspr" title="" target="_blank">https://aka.ms/sspr</a>.</p></li><li><p>Enter your non-administrator test users' account information, such as testuser, the characters from the CAPTCHA, and then select <b>Next</b>.</p></li></ol><p><span><img alt="" src="../Images/1192053-490191.png" width="" height="" /></span></p><ol class="number"><li value="6"><p>Follow the verification steps to reset your password. When complete, you should receive an e-mail notification that your password was reset.</p></li></ol><h3 class="da-h3" id="1191646">Self-Service Password Reset (SSPR) Writeback</h3><p>Azure Active Directory (Azure AD) self-service password reset (SSPR) lets users reset their passwords in the cloud, but most companies also have an on-premises Active Directory Domain Services (AD DS) environment where their users exist. Password writeback is a feature enabled with Azure AD Connect that allows password changes in the cloud to be written back to an existing on-premises directory in real time. In this configuration, as users change or reset their passwords using SSPR in the cloud, the updated passwords also written back to the on-premises AD DS environment</p><p>Password writeback is supported in environments that use the following hybrid identity models:</p><ul class="square"><li class="square"><p>Password hash synchronization</p></li><li class="square"><p>Pass-through authentication</p></li><li class="square"><p>Active Directory Federation Services</p></li></ul><p>Password writeback provides the following features:</p><ul class="square"><li class="square"><p><b>Enforcement of on-premises Active Directory Domain Services (AD DS) password policies:</b> When a user resets their password, it's checked to ensure it meets your on-premises AD DS policy before committing it to that directory. This review includes checking the history, complexity, age, password filters, and any other password restrictions that you define in AD DS.</p></li><li class="square"><p><b>Zero-delay feedback:</b> Password writeback is a synchronous operation. Users are notified immediately if their password doesn't meet the policy or can't be reset or changed for any reason.</p></li><li class="square"><p><b>Supports password changes from the access panel and Office 365:</b> When federated or password hash synchronized users come to change their expired or non-expired passwords, those passwords are written back to AD DS.</p></li><li class="square"><p><b>Supports password writeback when an admin resets them from the Azure portal</b>: When an admin resets a user's password in the Azure portal, if that user is federated or password hash synchronized, the password is written back to on-premises. This functionality is currently not supported in the Office admin portal.</p></li><li class="square"><p><b>Doesn't require any inbound firewall rules</b>: Password writeback uses an Azure Service Bus relay as an underlying communication channel. All communication is outbound over port 443.</p></li></ul><h4 class="da-h4">How password writeback works</h4><p>When a federated or password hash synchronized user attempts to reset or change their password in the cloud, the following actions occur:</p><ol class="number"><li><p>A check is performed to see what type of password the user has. If the password is managed on-premises:</p></li></ol><ul class="square"><li class="square"><p>A check is performed to see if the writeback service is up and running. If it is, the user can proceed.</p></li><li class="square"><p>If the writeback service is down, the user is informed that their password can't be reset right now.</p></li></ul><ol class="number"><li value="2"><p>Next, the user passes the appropriate authentication gates and reaches the <b>Reset password</b> page.</p></li><li><p>The user selects a new password and confirms it.</p></li><li><p>When the user selects <b>Submit</b>, the plaintext password is encrypted with a symmetric key created during the writeback setup process.</p></li><li><p>The encrypted password is included in a payload that gets sent over an HTTPS channel to your tenant-specific service bus relay (that is set up for you during the writeback setup process). This relay is protected by a randomly generated password that only your on-premises installation knows.</p></li><li><p>After the message reaches the service bus, the password-reset endpoint automatically wakes up and sees that it has a reset request pending.</p></li><li><p>The service then looks for the user by using the cloud anchor attribute. For this lookup to succeed, the following conditions must be met:</p></li></ol><ul class="square"><li class="square"><p>The user object must exist in the Active Directory connector space.</p></li><li class="square"><p>The user object must be linked to the corresponding metaverse (MV) object.</p></li><li class="square"><p>The user object must be linked to the corresponding Azure Active Directory connector object.</p></li><li class="square"><p>The link from the Active Directory connector object to the MV must have the synchronization rule Microsoft.InfromADUserAccountEnabled.xxx on the link.</p></li></ul><p>When the call comes in from the cloud, the synchronization engine uses the <b>cloudAnchor</b> attribute to look up the Azure Active Directory connector space object. It then follows the link back to the MV object, and then follows the link back to the Active Directory object. Because there can be multiple Active Directory objects (multi-forest) for the same user, the sync engine relies on the Microsoft.InfromADUserAccountEnabled.xxx link to pick the correct one.</p><ol class="number"><li value="8"><p>After the user account is found, an attempt to reset the password directly in the appropriate Active Directory forest is made.</p></li><li><p>If the password set operation is successful, the user is told their password has been changed.</p></li><li><p>If the password set operation fails, an error prompts the user to try again. The operation might fail because of the following reasons:</p></li></ol><ul class="square"><li class="square"><p>The service was down.</p></li><li class="square"><p>The password they selected doesn't meet the organization's policies.</p></li><li class="square"><p>Unable to find the user in local Active Directory.</p></li></ul><p>The error messages provide guidance to users so they can attempt to resolve without administrator intervention.</p><h3 class="da-h3" id="1191591">Azure AD Join</h3><p>Azure Active Directory (Azure AD) enables single sign-on to devices, apps, and services from anywhere. The proliferation of devices - including Bring Your Own Device (BYOD) – empowers end users to be productive wherever and whenever. But, IT administrators must ensure corporate assets are protected and that devices meet standards for security and compliance.</p><p><span><img alt="" src="../Images/1192103-490241.png" width="" height="" /></span></p><p>Azure AD Join is designed provide access to organizational apps and resources and to simply Windows deployments of work-owned devices. AD Join has these benefits.</p><ul class="square"><li class="square"><p><b>Single-Sign-On (SSO)</b> to your Azure managed SaaS apps and services. Your users will not have additional authentication prompts when accessing work resources. The SSO functionality is available even when users are not connected to the domain network.</p></li><li class="square"><p><b>Enterprise compliant roaming</b> of user settings across joined devices. Users don’t need to connect to a Microsoft account (for example, Hotmail) to observe settings across devices.</p></li><li class="square"><p><b>Access to Microsoft Store for Business</b> using an Azure AD account. Your users can choose from an inventory of applications pre-selected by the organization.</p></li><li class="square"><p><b>Windows Hello</b> support for secure and convenient access to work resources.</p></li><li class="square"><p><b>Restriction of access</b> to apps from only devices that meet compliance policy.</p></li><li class="square"><p><b>Seamless access to on-premise resources</b> when the device has line of sight to the on-premises domain controller.</p></li></ul><h4 class="da-h4">Connection options</h4><p>To get a device under the control of Azure AD, you have two options:</p><ul class="square"><li class="square"><p><b>Registering</b> a device to Azure AD enables you to manage a device’s identity. When a device is registered, Azure AD device registration provides the device with an identity that is used to authenticate the device when a user signs-in to Azure AD. You can use the identity to enable or disable a device.</p></li><li class="square"><p><b>Joining</b> a device is an extension to registering a device. This means, it provides you with all the benefits of registering a device and in addition to this, it also changes the local state of a device. Changing the local state enables your users to sign-in to a device using an organizational work or school account instead of a personal account.</p></li></ul><p>✔️ Registration combined with a mobile device management (MDM) solution such as Microsoft Intune, provides additional device attributes in Azure AD. This allows you to create conditional access rules that enforce access from devices to meet your standards for security and compliance.</p><p>✔️ Although AD Join is intended for organizations that do not have on-premises Windows Server Active Directory infrastructure it can be used for other scenarios like branch offices.</p><h3 class="da-h3" id="1191592">Devices in Azure AD</h3><p>Below are the following options for devices in Azure AD:</p><p><b>Azure AD registered</b></p><p>Devices that are Azure AD registered are typically personally owned or mobile devices and are signed in with a personal Microsoft account or another local account.</p><ul class="square"><li class="square"><p>Windows 10</p></li><li class="square"><p>iOS</p></li><li class="square"><p>Android</p></li><li class="square"><p>MacOS</p></li></ul><p><b>Azure AD joined</b></p><p>Devices that are Azure AD joined are owned by an organization, and are signed in with an Azure AD account belonging to that organization. They exist only in the cloud.</p><ul class="square"><li class="square"><p>Windows 10</p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/devices/howto-vm-sign-in-azure-ad-windows" title="" target="_blank">Windows Server 2019 Virtual Machines running in Azure</a> (Server core is not supported)</p></li></ul><p><b>Hybrid Azure AD joined</b></p><p>Devices that are hybrid Azure AD joined are owned by an organization and are signed in with an Active Directory Domain Services account belonging to that organization. They exist in the cloud and on-premises.</p><ul class="square"><li class="square"><p>Windows 7, 8.1, or 10</p></li><li class="square"><p>Windows Server 2008 or newer</p></li></ul><p><span><img alt="" src="../Images/1192228-490366.png" width="" height="" /></span></p><p><b>Note:</b> A hybrid state refers to more than just the state of a device. For a hybrid state to be valid, a valid Azure AD user also is required.</p><h3 class="da-h3" id="1191637">Hybrid Identity with Azure Active Directory</h3><p>Organizations are a mixture of on-premises and cloud applications. Users require access to those applications both on-premises and in the cloud.</p><p>Microsoft’s identity solutions span on-premises and cloud-based capabilities. These solutions create a common user identity for authentication and authorization to all resources, regardless of location. We call this hybrid identity.</p><p>With hybrid identity to Azure AD and hybrid identity management these scenarios become possible.</p><p>To achieve hybrid identity with Azure AD, one of three authentication methods can be used, depending on your scenarios. The three methods are:</p><ul class="square"><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/whatis-phs" title="" target="_blank">Password hash synchronization (PHS)</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-pta" title="" target="_blank">Pass-through authentication (PTA)</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/whatis-fed" title="" target="_blank">Federation (AD FS)</a></p></li></ul><p>These authentication methods also provide single-sign on capabilities. Single-sign on automatically signs your users in when they are on their corporate devices, connected to your corporate network.</p><h4 class="da-h4">Common scenarios and recommendations</h4><p>Below are common hybrid identity and access management scenarios with recommendations as to which hybrid identity option (or options) might be appropriate for each.</p><table style="width:100%" class=""><col width="25%" /><col width="25%" /><col width="25%" /><col width="25%" /><thead><tr><td><p>I need to:</p></td><td><p>PHS and SSO1<sup>1</sup></p></td><td><p>PTA and SSO2<sup>2</sup></p></td><td><p>AD FS3<sup>3</sup></p></td></tr></thead><tbody><tr><td><p>Sync new user, contact, and group accounts created in my on-premises Active Directory to the cloud automatically.</p></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td></tr><tr><td><p>Set up my tenant for Office 365 hybrid scenarios.</p></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td></tr><tr><td><p>Enable my users to sign in and access cloud services using their on-premises password.</p></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td></tr><tr><td><p>Implement single sign-on using corporate credentials.</p></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td></tr><tr><td><p>Ensure no password hashes are stored in the cloud.</p></td><td><p /></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td></tr><tr><td><p>Enable cloud-based multi-factor authentication solutions.</p></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td></tr><tr><td><p>Enable on-premises multi-factor authentication solutions.</p></td><td><p /></td><td><p /></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td></tr><tr><td><p>Support smartcard authentication for my users.<sup>4</sup></p></td><td><p /></td><td><p /></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td></tr><tr><td><p>Display password expiry notifications in the Office Portal and on the Windows 10 desktop.</p></td><td><p /></td><td><p /></td><td><p><span><img alt="" src="../Images/1192112-490250.png" width="" height="" /></span></p></td></tr></tbody></table><p><sup>1</sup> Password hash synchronization with single sign-on.</p><p><sup>2</sup> Pass-through authentication and single sign-on.</p><p><sup>3</sup> Federated single sign-on with AD FS.</p><p><sup>4</sup> AD FS can be integrated with your enterprise PKI to allow sign-in using certificates. These certificates can be soft-certificates deployed via trusted provisioning channels such as MDM or GPO or smartcard certificates (including PIV/CAC cards) or Hello for Business (cert-trust).</p><h3 class="da-h3" id="1191639">Azure AD Connect</h3><p>Azure AD Connect is the Microsoft tool designed to meet and accomplish your hybrid identity goals. It provides the following features:</p><ul class="square"><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/whatis-phs" title="" target="_blank">Password hash synchronization</a> - A sign-in method that synchronizes a hash of a users on-premises AD password with Azure AD.</p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-pta" title="" target="_blank">Pass-through authentication</a> - A sign-in method that allows users to use the same password on-premises and in the cloud, but doesn't require the additional infrastructure of a federated environment.</p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-fed-whatis" title="" target="_blank">Federation integration</a> - Federation is an optional part of Azure AD Connect and can be used to configure a hybrid environment using an on-premises AD FS infrastructure. It also provides AD FS management capabilities such as certificate renewal and additional AD FS server deployments.</p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-sync-whatis" title="" target="_blank">Synchronization</a> - Responsible for creating users, groups, and other objects. As well as, making sure identity information for your on-premises users and groups is matching the cloud. This synchronization also includes password hashes.</p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/whatis-hybrid-identity-health" title="" target="_blank">Health Monitoring</a> - Azure AD Connect Health can provide robust monitoring and provide a central location in the Azure portal to view this activity.</p><p><img alt="" src="../Images/1192054-490192.png" width="" height="" /></p></li></ul><h4 class="da-h4">Why use Azure AD Connect?</h4><p>Integrating your on-premises directories with Azure AD makes your users more productive by providing a common identity for accessing both cloud and on-premises resources. Users and organizations can take advantage of:</p><ul class="square"><li class="square"><p>Users can use a single identity to access on-premises applications and cloud services such as Office 365.</p></li><li class="square"><p>Single tool to provide an easy deployment experience for synchronization and sign-in.</p></li><li class="square"><p>Provides the newest capabilities for your scenarios. Azure AD Connect replaces older versions of identity integration tools such as DirSync and Azure AD Sync.</p></li></ul><h3 class="da-h3" id="1191648">Azure AD Health Overview</h3><p>Azure Active Directory (Azure AD) Connect Health provides monitoring of on-premises identity infrastructure. It enables you to maintain a reliable connection to Office 365 and Microsoft Online Services. This reliability is achieved by providing monitoring capabilities for your key identity components. Also, it makes the key data points about these components easily accessible.</p><p><span><img alt="" src="../Images/1192171-490309.png" width="" height="" /></span></p><h4 class="da-h4">Why use Azure AD Connect Health?</h4><p>When with Azure AD, users are more productive because there's a common identity to access both cloud and on-premises resources. Ensuring the environment is reliable, so that users can access these resources, becomes a challenge. Azure AD Connect Health helps monitor and gain insights into your on-premises identity infrastructure thus ensuring the reliability of this environment. It is enabled by installing an agent on each on-premises identity server.</p><p>Azure AD Connect Health for AD FS supports AD FS 2.0 on Windows Server 2008 R2, Windows Server 2012, Windows Server 2012 R2 and Windows Server 2016. It also supports monitoring the AD FS proxy or web application proxy servers that provide authentication support for extranet access. With an easy and quick installation of the Health Agent, Azure AD Connect Health for AD FS provides you a set of key capabilities.</p><p>Key benefits and best practices:</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Key Benefits</p></td><td><p>Best Practices</p></td></tr></thead><tbody><tr><td><p><b>Enhanced security</b></p></td><td><p>Extranet lockout trends Failed sign-ins report In privacy compliant</p></td></tr><tr><td><p><b>Get alerted on all critical ADFS system issues</b></p></td><td><p>Server configuration and availability Performance and connectivity Regular maintenance</p></td></tr><tr><td><p><b>Easy to deploy and manage</b></p></td><td><p>Quick agent installation Agent auto upgrade to the latest Data available in portal within minutes</p></td></tr><tr><td><p><b>Rich usage metrics</b></p></td><td><p>Top applications usage Network locations and TCP connection Token requests per server</p></td></tr><tr><td><p><b>Great user experience</b></p></td><td><p>Dashboard fashion from Azure portal Alerts through emails</p></td></tr></tbody></table><h3 class="da-h3" id="1191962">Azure Monitor Service</h3><p>Monitoring is the act of collecting and analyzing data to determine the performance, health, and availability of your business application and the resources that it depends on. An effective monitoring strategy helps you understand the detailed operation of the components of your application. It also helps you increase your uptime by proactively notifying you of critical issues so that you can resolve them before they become problems.</p><p>Azure includes multiple services that individually perform a specific role or task in the monitoring space. Together, these services deliver a comprehensive solution for collecting, analyzing, and acting on telemetry from your application and the Azure resources that support them. They can also work to monitor critical on-premises resources to provide a hybrid monitoring environment. Understanding the tools and data that are available is the first step in developing a complete monitoring strategy for your application.</p><p>The next diagram gives a high-level view of Azure Monitor. At the center of the diagram are the data stores for metrics and logs, which are the two fundamental types of data use by Azure Monitor. On the left are the sources of monitoring data that populate these data stores. On the right are the different functions that Azure Monitor performs with this collected data such as analysis, alerting, and streaming to external systems.</p><p><span><img alt="" src="../Images/1192357-490495.png" width="" height="" /></span></p><h3 class="da-h3" id="1191963">Key Capabilities</h3><ul class="square"><li class="square"><p><b>Monitor and visualize metrics</b>. Metrics are numerical values available from Azure resources helping you understand the health, operation and performance of your system.</p></li><li class="square"><p><b>Query and analyze logs</b>. Logs are activity logs, diagnostic logs, and telemetry from monitoring solutions; analytics queries help with troubleshooting and visualizations.</p></li><li class="square"><p><b>Setup alerts and actions</b>. Alerts notify you of critical conditions and potentially take automated corrective actions based on triggers from metrics or logs.</p></li></ul><p><span><img alt="" src="../Images/1192072-490210.png" width="" height="" /></span></p><h3 class="da-h3" id="1191964">Monitoring Data Platform</h3><p>All data collected by Azure Monitor fits into one of two fundamental types, <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/platform/data-collection" title="" target="_blank">metrics and logs</a>.</p><ul class="square"><li class="square"><p><b>Metrics</b> are numerical values that describe some aspect of a system at a particular point in time. They are lightweight and capable of supporting near real-time scenarios.</p></li><li class="square"><p><b>Logs</b> contain different kinds of data organized into records with different sets of properties for each type. Telemetry such as events and traces are stored as logs in addition to performance data so that it can all be combined for analysis.</p></li></ul><p>For many Azure resources, the data collected by Azure Monitor is displayed on the Overview page in the Azure portal. For example, virtual machines have several charts displaying performance metrics. Click on any of the graphs to open the data in Metric explorer in the Azure portal, which allows you to chart the values of multiple metrics over time. You can view the charts interactively or pin them to a dashboard to view them with other visualizations.</p><p><span><img alt="" src="../Images/1192212-490350.png" width="" height="" /></span></p><h3 class="da-h3" id="1191965">Log Data</h3><p>Log data collected by Azure Monitor is stored in Log Analytics which includes a <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/log-query/log-query-overview" title="" target="_blank">rich query language</a> to quickly retrieve, consolidate, and analyze collected data. You can create and test queries using the Log Analytics page in the Azure portal and then either directly analyze the data using these tools or save queries for use with visualizations or alert rules.</p><p>Azure Monitor uses a version of the <a href="https://docs.microsoft.com/en-us/azure/kusto/query/" title="" target="_blank">Data Explorer</a> query language that is suitable for simple log queries but also includes advanced functionality such as aggregations, joins, and smart analytics. You can quickly learn the query language using multiple lessons. Particular guidance is provided to users who are already familiar with SQL and Splunk.</p><p><span><img alt="" src="../Images/1192078-490216.png" width="" height="" /></span></p><h3 class="da-h3" id="1191670">Checklist for Creating an Azure Virtual Machine</h3><p>Performing a migration of on-premises servers to Azure requires planning and care. You can move them all at once, or more likely, in small batches or even individually. Before you create a single VM, you should sit down and sketch out your current infrastructure model and see how it might map to the cloud.</p><h4 class="da-h4">Required resources for IaaS Virtual Machines</h4><p>Below is a checklist of things to consider as you work through this lesson:</p><ul class="square"><li class="square"><p>Start with the network</p></li><li class="square"><p>Name the VM</p></li><li class="square"><p>Decide the location for the VM</p></li><li class="square"><p>Determine the size of the VM</p></li><li class="square"><p>Understanding the pricing model</p></li><li class="square"><p>Storage for the VM</p></li><li class="square"><p>Select an operating system</p></li></ul><h3 class="da-h3" id="1191966">Data Types</h3><p>Azure Monitor can collect data from a variety of sources. You can think of monitoring data for your applications in tiers ranging from your application, any operating system and services it relies on, down to the platform itself. Azure Monitor collects data from each of the following tiers:</p><ul class="square"><li class="square"><p><b>Application monitoring data</b>: Data about the performance and functionality of the code you have written, regardless of its platform.</p></li><li class="square"><p><b>Guest OS monitoring data</b>: Data about the operating system on which your application is running. This could be running in Azure, another cloud, or on-premises.</p></li><li class="square"><p><b>Azure resource monitoring data</b>: Data about the operation of an Azure resource.</p></li><li class="square"><p><b>Azure subscription monitoring data</b>: Data about the operation and management of an Azure subscription, as well as data about the health and operation of Azure itself.</p></li><li class="square"><p><b>Azure tenant monitoring data</b>: Data about the operation of tenant-level Azure services, such as Azure Active Directory.</p></li></ul><p>As soon as you create an Azure subscription and start adding resources such as virtual machines and web apps, Azure Monitor starts collecting data. Activity Logs record when resources are created or modified. Metrics tell you how the resource is performing and the resources that it's consuming.</p><p>Extend the data you're collecting into the actual operation of the resources by enabling diagnostics and adding an agent to compute resources. This will collect telemetry for the internal operation of the resource and allow you to configure different data sources to collect logs and metrics from Windows and Linux guest operating systems.</p><p>✔️ Azure Monitor can collect log data from any REST client using the Data Collector API. This allows you to create custom monitoring scenarios and extend monitoring to resources that don't expose telemetry through other sources.</p><h3 class="da-h3" id="1191795">Azure SQL Database Service</h3><p>SQL Database is a fully managed Platform as a Service (PaaS) Database Engine that handles most of the database management functions such as upgrading, patching, backups, and monitoring without user involvement. Azure SQL Database is always running on the latest stable version of SQL Server Database Engine and patched OS with 99.99% availability.</p><p>With Azure SQL Database, you can create a highly available and high-performance data storage layer for the applications and solutions in Azure. SQL Database can be the right choice for a variety of modern cloud applications because it enables you to process both relational data and non-relational structures, such as graphs, JSON, spatial, and XML.</p><h4 class="da-h4">Deployment models</h4><p>Azure SQL Database provides the following deployment options for an Azure SQL database:</p><p><span><img alt="" src="../Images/1192344-490482.png" width="" height="" /></span></p><ul class="square"><li class="square"><p>Single database represents a fully managed, isolated database. You might use this option if you have modern cloud applications and microservices that need a single reliable data source. A single database is similar to a contained database in Microsoft SQL Server Database Engine.</p></li><li class="square"><p>Managed instance is a fully managed instance of the Microsoft SQL Server Database Engine. It contains a set of databases that can be used together. Use this option for easy migration of on-premises SQL Server databases to the Azure cloud, and for applications that need to use the database features that SQL Server Database Engine provides.</p></li><li class="square"><p>Elastic pool is a collection of single databases with a shared set of resources, such as CPU or memory. Single databases can be moved into and out of an elastic pool.</p></li></ul><h3 class="da-h3" id="1191796">Demonstration - Create an Azure SQL Database Single Database</h3><p>In this demonstration, you use the Azure portal to create an Azure SQL Database single database. You then query the database using Query editor in the Azure portal.</p><p>A single database is the quickest and simplest deployment option for Azure SQL Database. You manage a single database within a SQL Database server, which is inside an Azure resource group in a specified Azure region. In this demonstration, you create a new resource group and SQL server for the new database.</p><p>You can create a single database in the <i>provisioned</i> or <i>serverless</i> compute tier. A provisioned database is pre-allocated a fixed amount of compute resources, including CPU and memory, and uses one of two purchasing models. This demonstration creates a provisioned database using the vCore-based purchasing model.</p><h4 class="da-h4">Create a single database</h4><p>In this step, you create an Azure SQL Database server and a single database that uses AdventureWorksLT sample data. You can create the database by using Azure portal menus and screens, or by using an Azure CLI or PowerShell script in the Azure Cloud Shell.</p><p>To create a resource group, SQL server, and single database in the Azure portal:</p><ol class="number"><li><p>Sign in to the <a href="https://portal.azure.com/" title="" target="_blank">portal</a>.</p></li><li><p>From the Search bar, search for and select <b>Azure SQL</b>.</p></li><li><p>On the Azure SQL page, select <b>Add</b>.</p></li></ol><p><span><img alt="" src="../Images/1192233-490371.png" width="" height="" /></span></p><ol class="number"><li value="4"><p>On the <b>Select SQL deployment option</b> page, select the <b>SQL databases</b> tile, with <b>Single database</b> under <b>Resource</b> type. You can view more information about the different databases by selecting <b>Show details</b>.</p></li><li><p>Select <b>Create</b>.</p></li></ol><p><span><img alt="" src="../Images/1192234-490372.png" width="" height="" /></span></p><ol class="number"><li value="6"><p>On the <b>Basics</b> tab of the Create SQL database form, under <b>Project details</b>, select the correct Azure Subscription if it isn't already selected.</p></li><li><p>Under <b>Resource group</b>, select <b>Create new</b>, enter <i>myResourceGroup</i>, and select <b>OK</b>.</p></li><li><p>Under <b>Database details</b>, for <b>Database name</b> enter mySampleDatabase.</p></li><li><p>For <b>Server</b>, select <b>Create new</b>, and fill out the New server form as follows:</p></li></ol><ul class="square"><li class="square"><p><b>Server name</b>: Enter <i>mysqlserver</i>, and some characters for uniqueness.</p></li><li class="square"><p><b>Server admin login</b>: Enter <i>azureuser</i>.</p></li><li class="square"><p><b>Password</b>: Enter a password that meets requirements, and enter it again in the <b>Confirm password</b> field.</p></li><li class="square"><p><b>Location</b>: Drop down and choose a location, such as <b>(US) East US</b>.</p></li></ul><p>Select <b>OK</b>.</p><p><span><img alt="" src="../Images/1192235-490373.png" width="" height="" /></span></p><p>Record the server admin login and password so you can log in to the server and databases. If you forget your login or password, you can get the login name or reset the password on the <b>SQL server</b> page after database creation. To open the <b>SQL server</b> page, select the server name on the database <b>Overview</b> page.</p><ol class="number"><li value="10"><p>Under <b>Compute + storage</b>, if you want to reconfigure the defaults, select <b>Configure database</b>.</p></li></ol><p>On the <b>Configure</b> page, you can optionally:</p><ul class="square"><li class="square"><p>Change the <b>Compute tier</b> from <b>Provisioned</b> to <b>Serverless</b>.</p></li><li class="square"><p>Review and change the settings for <b>vCores</b> and <b>Data max size</b>.</p></li><li class="square"><p>Select <b>Change configuration</b> to change the hardware generation.</p></li></ul><p>After making any changes, select <b>Apply</b>.</p><ol class="number"><li value="11"><p>Select <b>Next: Networking</b> at the bottom of the page.</p></li></ol><p><span><img alt="" src="../Images/1192236-490374.png" width="" height="" /></span></p><ol class="number"><li value="12"><p>On the <b>Networking</b> tab, under <b>Connectivity method</b>, select <b>Public endpoint</b>.</p></li><li><p>Under <b>Firewall rules</b>, set <b>Add current client IP address</b> to <b>Yes</b>.</p></li><li><p>Select <b>Next: Additional</b> settings at the bottom of the page.</p></li></ol><p><span><img alt="" src="../Images/1192237-490375.png" width="" height="" /></span></p><ol class="number"><li value="15"><p>On the <b>Additional settings</b> tab, in the <b>Data source</b> section, for <b>Use existing data</b>, select <b>Sample</b>.</p></li><li><p>Select <b>Review + create</b> at the bottom of the page.</p></li></ol><p><span><img alt="" src="../Images/1192238-490376.png" width="" height="" /></span></p><ol class="number"><li value="17"><p>After reviewing settings, select <b>Create</b>.</p></li></ol><h4 class="da-h4">Query the database</h4><p>Once your database is created, you can use the built-in Query editor in the Azure portal to connect to the database and query the data.</p><ol class="number"><li><p>In the portal, search for and select <b>SQL databases</b>, and then select your database from the list.</p></li><li><p>On the <b>SQL Database</b> page for your database, select <b>Query editor</b> in the left menu.</p></li><li><p>Enter your server admin login information, and select <b>OK</b>.</p></li></ol><p><span><img alt="" src="../Images/1192239-490377.png" width="" height="" /></span></p><ol class="number"><li value="4"><p>Enter the following query in the Query editor pane.</p></li></ol><div class="code language-SQL"><p class="da-divtext"><code><span class="token keyword">SELECT</span> <span class="token keyword">TOP</span> <span class="token number">20</span> pc<span class="token punctuation">.</span>Name <span class="token keyword">as</span> CategoryName<span class="token punctuation">,</span> p<span class="token punctuation">.</span>name <span class="token keyword">as</span> ProductName

<span class="token keyword">FROM</span> SalesLT<span class="token punctuation">.</span>ProductCategory pc

<span class="token keyword">JOIN</span> SalesLT<span class="token punctuation">.</span>Product p

<span class="token keyword">ON</span> pc<span class="token punctuation">.</span>productcategoryid <span class="token operator">=</span> p<span class="token punctuation">.</span>productcategoryid<span class="token punctuation">;</span></code></p></div><ol class="number"><li value="5"><p>Select <b>Run</b>, and then review the query results in the <b>Results</b> pane.</p></li></ol><p><span><img alt="" src="../Images/1192240-490378.png" width="" height="" /></span></p><ol class="number"><li value="6"><p>Close the <b>Query editor</b> page, and select <b>OK</b> when prompted to discard your unsaved edits.</p></li></ol><h3 class="da-h3" id="1191829">Role-Based Access Control (RBAC)</h3><p>Role-based access control (RBAC) is an authorization system built on Azure Resource Manager that provides fine-grained access management of resources in Azure. With RBAC, you can grant the exact access that users need to do their jobs.</p><h4 class="da-h4">What is role-based access control?</h4><p>You grant access by assigning the appropriate RBAC role to users, groups, and applications at a certain scope. The scope of a role assignment can be a subscription, a resource group, or a single resource. A role assigned at a parent scope also grants access to the child scopes contained within it.</p><p>Below are scenarios you can implement with RBAC.</p><ul class="square"><li class="square"><p>Allow one user to manage virtual machines in a subscription and another user to manage virtual networks</p></li><li class="square"><p>Allow a database administrator group to manage SQL databases in a subscription</p></li><li class="square"><p>Allow a user to manage all resources in a resource group, such as virtual machines, websites, and subnets</p></li><li class="square"><p>Allow an application to access all resources in a resource group</p></li></ul><h3 class="da-h3" id="1191830">RBAC in the Azure portal</h3><p>In several areas in the Azure portal, you'll see a pane named <b>Access control (IAM)</b>, also known as identity and access management. On this pane, you can see who has access to that area and their role. Using this same pane, you can grant or remove access.</p><p>The following shows an example of the Access control (IAM) pane for a resource group. In this example, Alain Charon has been assigned the Backup Operator role for this resource group.</p><p><span><img alt="" src="../Images/1192260-490398.png" width="" height="" /></span></p><h3 class="da-h3" id="1191831">How RBAC Works</h3><p>You control access to resources using RBAC by creating role assignments, which control how permissions are enforced. To create a role assignment, you need three elements: a security principal, a role definition, and a scope. You can think of these elements as “who”, "what", and “where”.</p><p><b>1. Security principal (who)</b></p><p>A <i>security principal</i> is a user, group, service principal, or managed identity that is requesting access to Azure resources.</p><p><span><img alt="" src="../Images/1192287-490425.png" width="" height="" /></span></p><p><b>2. Role definition (what you can do)</b></p><p>A role definition is a collection of permissions. It's sometimes just called a role. A role definition lists the permissions that can be performed, such as read, write, and delete. Roles can be high-level, like Owner, or specific, like Virtual Machine Contributor.</p><p><span><img alt="" src="../Images/1192288-490426.png" width="" height="" /></span></p><p>Azure includes several built-in roles that you can use. The following lists four fundamental built-in roles:</p><ul class="square"><li class="square"><p><b>Owner</b> - Has full access to all resources, including the right to delegate access to others.</p></li><li class="square"><p><b>Contributor</b> - Can create and manage all types of Azure resources, but can’t grant access to others.</p></li><li class="square"><p><b>Reader</b> - Can view existing Azure resources.</p></li><li class="square"><p><b>User Access Administrator</b> - Lets you manage user access to Azure resources.</p></li></ul><p>If the built-in roles don't meet the specific needs of your organization, you can create your own custom roles.</p><p><b>3. Scope (where)</b></p><p><i>Scope</i> is where the access applies to. This is helpful if you want to make someone a Website Contributor, but only for one resource group.</p><p>In Azure, you can specify a scope at multiple levels: management group, subscription, resource group, or resource. Scopes are structured in a parent-child relationship. When you grant access at a parent scope, those permissions are inherited by the child scopes. For example, if you assign the Contributor role to a group at the subscription scope, that role is inherited by all resource groups and resources in the subscription.</p><p><span><img alt="" src="../Images/1192289-490427.png" width="" height="" /></span></p><h4 class="da-h4">Role assignment</h4><p>Once you have determined the who, what, and where, you can combine those elements to grant access. A role assignment is the process of binding a role to a security principal at a particular scope, for the purpose of granting access. To grant access, you create a role assignment. To revoke access, you remove a role assignment.</p><p>The following example shows how the Marketing group has been assigned the Contributor role at the sales resource group scope.</p><p><span><img alt="" src="../Images/1192290-490428.png" width="" height="" /></span></p><h4 class="da-h4">Multiple role assignments</h4><p>Azure RBAC is an additive model, so your effective permissions are the sum of your role assignments. Consider the following example where a user is granted the Contributor role at the subscription scope and the Reader role on a resource group. The sum of the Contributor permissions and the Reader permissions is effectively the Contributor role for the resource group. Therefore, in this case, the Reader role assignment has no impact.</p><p><span><img alt="" src="../Images/1192291-490429.png" width="" height="" /></span></p><h4 class="da-h4">Deny assignments</h4><p>Previously, Azure RBAC was an allow-only model with no deny, but now Azure RBAC supports deny assignments in a limited way. Similar to a role assignment, a deny assignment attaches a set of deny actions to a user, group, service principal, or managed identity at a particular scope for the purpose of denying access. A role assignment defines a set of actions that are allowed, while a deny assignment defines a set of actions that are not allowed. In other words, deny assignments block users from performing specified actions even if a role assignment grants them access. Deny assignments take precedence over role assignments.</p><h3 class="da-h3" id="1191967">Azure Advisor</h3><p><span><img alt="" src="../Images/1192187-490325.png" width="" height="" /></span></p><p>Advisor is a personalized cloud consultant that helps you follow best practices to optimize your Azure deployments. It analyzes your resource configuration and usage telemetry and then recommends solutions that can help you improve the cost effectiveness, performance, high availability, and security of your Azure resources.</p><p>The Advisor cost recommendations page helps you optimize and reduce your overall Azure spend by identifying idle and underutilized resources.</p><p><span><img alt="" src="../Images/1192188-490326.png" width="" height="" /></span></p><p>Select the recommended action for a recommendation to implement the recommendation. A simple interface will open that enables you to implement the recommendation or refer you to documentation that assists you with implementation.</p><p>✔️ Advisor provides recommendations for virtual machines, availability sets, application gateways, App Services, SQL servers, and Redis Cache.</p><h3 class="da-h3" id="1191846">Lab: Managing Azure Role-Based Access Control</h3><p>✔️ <b>Important:</b> To download the most recent version of this lab, please visit the AZ-303 <a href="https://github.com/MicrosoftLearning/AZ-303-Microsoft-Azure-Architect-Technologies" title="" target="_blank">GitHub repository</a>.</p><p>Direct link to the <a href="https://aka.ms/303_Module_10_Lab" title="" target="_blank">Lab: Managing Azure Role-Based Access Control</a>.</p><h4 class="da-h4">Lab scenario</h4><p><span><img alt="" src="../Images/1192088-490226.png" width="" height="" /></span></p><p>With Azure Active Directory (Azure AD) becoming integral part of its identity management environment, the Adatum Enterprise Architecture team must also determine the optimal authorization approach. In the context of controlling access to Azure resources, such approach must involve the use of Azure Role-Based Access Control (RBAC). Azure RBAC is an authorization system built on Azure Resource Manager that provides fine-grained access management of Azure resources.</p><p>The key concept of Azure RBAC is role assignment. A role assignment consists of three elements: security principal, role definition, and scope. A security principal is an object that represents a user, group, service principal, or managed identity that is requesting access to Azure resources. A role definition is a collection of the operations that the role assignments will grant, such as read, write, or delete. Roles can be generic or resource specific. Azure includes four built-in generic roles (Owner, Contributor, Reader, and User Access Administrator) and a fairly large number of built-in resource-specific roles (such as, for example, Virtual Machine Contributor, which includes permissions to create and manage Azure virtual machines). It is also possible to define custom roles. A scope is the set of resources that the access applies to. A scope can be set at multiple levels: management group, subscription, resource group, or resource. Scopes are structured in a parent-child relationship.</p><p>The Adatum Enterprise Architecture team wants to test delegation of Azure management by using custom Role-Based Access Control roles. To start its evaluation, the team intends to create a custom role that provides restricted access to Azure virtual machines.</p><h4 class="da-h4">Objectives</h4><p>After completing this lab, you will be able to:</p><ul class="square"><li class="square"><p>Define a custom RBAC role</p></li><li class="square"><p>Assign a custom RBAC role</p></li></ul><h4 class="da-h4">Lab Environment</h4><p>Windows Server admin credentials</p><ul class="square"><li class="square"><p>User Name: <b>Student</b></p></li><li class="square"><p>Password: <b>Pa55w.rd1234</b></p></li></ul><p>Estimated Time: 60 minutes</p><h4 class="da-h4">Lab Files (Located in the GitHub repository listed above)</h4><ul class="square"><li class="square"><p>\\AZ303\AllFiles\Labs\11\azuredeploy30311suba.json</p></li><li class="square"><p>\\AZ303\AllFiles\Labs\11\azuredeploy30311rga.json</p></li><li class="square"><p>\\AZ303\AllFiles\Labs\11\azuredeploy30311rga.parameters.json</p></li><li class="square"><p>\\AZ303\AllFiles\Labs\11\roledefinition30311.json</p></li></ul><h5 class="da-h5">Exercise 0: Prepare the lab environment</h5><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Deploy an Azure VM by using an Azure Resource Manager template</p></li><li><p>Create an Azure Active Directory user</p></li></ol><h5 class="da-h5">Exercise 1: Define a custom RBAC role</h5><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Identify actions to delegate via RBAC</p></li><li><p>Create a custom RBAC role in an Azure AD tenant</p></li></ol><h5 class="da-h5">Exercise 2: Assign and test a custom RBAC role</h5><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Create an RBAC role assignment</p></li><li><p>Test the RBAC role assignment</p></li></ol><h3 class="da-h3" id="1191851">Authentication with Azure Managed Identities</h3><p>Azure managed identity automatically creates identities to allow apps to authenticate with Azure resources and services.</p><p>In this lesson, you'll explore the managed identity feature. You'll see how it works and what resources you can access in Azure.</p><h4 class="da-h4">What are managed identities in Azure?</h4><p>You use managed identities to authenticate any Azure service that supports the feature. To use managed identities, you don't need to provide authentication credentials in code. The managed identity feature solves the credential problem by granting an automatically managed identity. You use this service principal to authenticate to Azure services.</p><p>A managed identity combines Azure AD authentication and Azure role-based access control (RBAC).</p><p>When you use managed identities, you don't need to rotate credentials or worry about expiring certifications. Azure handles credential rotation and expiration in the background. To configure an application to use a managed identity, you use the provided token to call the service.</p><h4 class="da-h4">How managed identities work</h4><p>When you work with managed identities, you should know some common terms:</p><ul class="square"><li class="square"><p><b>Client ID</b>: A unique ID that's linked to the Azure AD application and service principal that was created when you provisioned the identity.</p></li><li class="square"><p><b>Object ID</b>: The service principal object of the managed identity.</p></li><li class="square"><p><b>Azure Instance Metadata Service:</b> A REST API that's enabled when Azure Resource Manager provisions a VM. The endpoint is accessible only from within the VM.</p></li></ul><p>You can create two types of managed identity: system-assigned identity and user-assigned managed identity. These types are similar, but they're used differently.</p><h4 class="da-h4">System-assigned managed identity</h4><p>You enable system-assigned identity directly on an Azure service instance, such as a VM. When you enable that identity, Azure creates a service principal through Azure Resource Manager.</p><p>The service principal is for the resource that's connected to the information about the managed identity on the Azure AD tenant. For example, if you have two VMs, managed identity must be enabled on each VM.</p><p>The status of the managed identity is directly linked to the status of the resource. If the resource is deleted, so is the managed identity. A resource can have only one system-assigned managed identity.</p><h4 class="da-h4">User-assigned managed identity</h4><p>User-assigned managed identity is created as a standalone Azure resource. It's independent of any app. When user-assigned identity is provisioned, Azure creates a service principal just as it does for a system-assigned identity.</p><p>However, a user-assigned identity isn't tied to a specific resource, so you can assign it to more than one application. For example, if your web app is deployed on 10 front-end VMs, you create a user-assigned managed identity for the app and then associate it with all 10 VMs. If you used system-assigned identity, you would need 10 identities, and then you would have to manage the access for each one.</p><h3 class="da-h3" id="1191854">Azure Key Vault</h3><p>Azure Key Vault is a centralized cloud service for storing application secrets such as encryption keys, certificates, and server-side tokens. Key Vault helps you control your applications' secrets by keeping them in a single central location and providing secure access, permissions control, and access logging.</p><p>There are three primary concepts used in an Azure Key Vault: <i>vaults, keys</i>, and <i>secrets</i>.</p><h4 class="da-h4">Vaults</h4><p>You use Azure Key Vault to create multiple secure containers, called vaults. Vaults help reduce the chances of accidental loss of security information by centralizing application secrets storage. Organizations will have several key vaults. Each key vault is a collection of cryptographic keys and cryptographically protected data (call them “secrets”) managed by one or more responsible individuals within your organization. These key vaults represent the logical groups of keys and secrets for your organization; those that you want to manage together. They are like folders in the file system. Key vaults also control and log the access to anything stored in them.</p><p>You can create and manage vaults using command line tools such as Azure PowerShell or the Azure CLI, using the REST API, or through the Azure portal.</p><p>For example, here's a sample Azure CLI command line to create a new vault in a resource group:</p><div class="code language-Azure"><p class="da-divtext">az keyvault create \
    --resource-group &lt;resource-group&gt; \
    --name &lt;your-unique-vault-name&gt;
</p></div><p>Here's the same command using Azure PowerShell:</p><div class="code language-PowerShell"><p class="da-divtext"><code>New<span class="token operator">-</span>AzKeyVault <span class="token operator">-</span>Name &lt;your<span class="token operator">-</span>unique<span class="token operator">-</span>vault<span class="token operator">-</span>name&gt; <span class="token operator">-</span>ResourceGroupName &lt;resource<span class="token operator">-</span><span class="token function">group</span>&gt;</code></p></div><h4 class="da-h4">Keys</h4><p>Keys are the central actor in the Azure Key Vault service. A given key in a key vault is a cryptographic asset destined for a particular use such as the asymmetric master key of Microsoft Azure RMS, or the asymmetric keys used for SQL Server TDE (Transparent Data Encryption), CLE (Column Level Encryption) and Encrypted backup.</p><p>Microsoft and your apps don't have access to the stored keys directly once a key is created or added to a key vault. Applications must use your keys by calling cryptography methods on the Key Vault service. The Key Vault service performs the requested operation within its hardened boundary. The application never has direct access to the keys.</p><p>Keys can be single instanced (only one key exists) or be versioned. In the versioned case, a key is an object with a primary (active) key and a collection of one or more secondary (archived) keys created when keys are rolled (renewed). Key Vault supports asymmetric keys (RSA 2048). Your applications may use these for encryption or digital signatures.</p><p>There are two variations on keys in Key Vault: hardware-protected, and software-protected.</p><h4 class="da-h4">Hardware protected keys</h4><p>The Key Vault service supports using HSMs that provide a hardened, tamper-resistant environment for cryptographic processing and key generation. Azure has dedicated HSMs validated to FIPS 140-2 Level 2 that Key Vault uses to generate or store keys. These HSM-backed keys are always locked to the boundary of the HSM. When you ask the Key Vault service to decrypt or sign with a key, the operation is performed inside an HSM.</p><p>You can import keys from your own hardware security modules (HSMs) and transfer them to Key Vault without leaving the HSM boundary. This scenario is often referred to as bring your own key, or BYOK. More details on generating your own HSM-protected key and then transferring it to Azure Key Vault is available in the summary of this module. You can also use these Azure HSMs directly through the Microsoft Azure Dedicated Hardware Security Module (HSM) service if you need to migrate HSM-protected apps or maintain a high security compliance requirement.</p><h4 class="da-h4">Software protected keys</h4><p>Key Vault can also generate and protect keys using software-based RSA and ECC algorithms. In general, software-protected keys offer most of the features as HSM-protected keys except the FIPS 140-2 Level 2 assurance:</p><ul class="square"><li class="square"><p>Your key is still isolated from the application (and Microsoft) in a container that you manage</p></li><li class="square"><p>It's stored at rest encrypted with HSMs</p></li><li class="square"><p>You can monitor usage using Key Vault logs</p></li></ul><p>The primary difference (besides price) with a software-protected key is when cryptographic operations are performed, they are done in software using Azure compute services while for HSM-protected keys the cryptographic operations are performed within the HSM.</p><p>You determine the key generation type when you create the key. For example, the Azure PowerShell command Add-AzureKeyVaultKey has a Destination parameter that can be set to either Software or HSM:</p><div class="code language-PowerShell"><p class="da-divtext"><code><span class="token variable">$key</span> = Add<span class="token operator">-</span>AzureKeyVaultKey <span class="token operator">-</span>VaultName <span class="token string">'contoso'</span> <span class="token operator">-</span>Name <span class="token string">'MyFirstKey'</span> <span class="token operator">-</span>Destination <span class="token string">'HSM'</span></code></p></div><h4 class="da-h4">Secrets</h4><p>Secrets are small (less than 10K) data blobs protected by a HSM-generated key created with the Key Vault. Secrets exist to simplify the process of persisting sensitive settings that almost every application has: storage account keys, .PFX files, SQL connection strings, data encryption keys, etc.</p><h3 class="da-h3" id="1191861">Overview of Azure Migrate Server Migration</h3><p>Azure Migrate helps you migrate to the Microsoft Azure cloud. The latest version of Azure Migrate provides a central hub to track discovery, assessment and migration of on-premises apps and workloads, and cloud VMs, to Azure. The hub provides Azure Migrate tools for assessment and migration, as well as third-party independent software vendor (ISV) offerings.</p><p><span><img alt="" src="../Images/1192367-490505.png" width="" height="" /></span></p><h4 class="da-h4">Key features of Azure Migrate</h4><p>Azure Migrate provides:</p><p><b>Unified migration platform</b>: Use a single portal to start, run, and track your migration journey to Azure, with an improved deployment flow and portal experience.</p><p><b>Range of tools</b>: Azure Migrate provides native tools, and integrates with other Azure services, as well as with independent software vendor ISV tools. Select the right assessment and migration tools, based on your organizational requirements.</p><ul class="square"><li class="square"><p><b>Azure Migrate Server Assessment</b>: Using the Azure Migrate Server Assessment tool, you can assess VMware VMs and Hyper-V VMs for migration to Azure. You can also assess for migration using other Azure services, and ISV tools.</p></li><li class="square"><p><b>Azure Migrate Server Migration</b>: Using the Azure Migrate Server Migration tool, you can migrate on-premises VMware VMs and Hyper-V VMs to Azure, as well as physical servers, other virtualized servers, and private/public cloud VMs. In addition, you can migrate to Azure using ISV tools.</p></li><li class="square"><p><b>Database assessment/migration</b>: Assess on-premises databases for migration to Azure, using the Microsoft Data Migration Assistant (DMA). Migrate on-premises databases to Azure using the Azure Database Migration Service (DMS).</p></li><li class="square"><p><b>Azure Migrate appliance</b>: Azure Migrate deploys a lightweight appliance for discovery and assessment of on-premises VMware VMs and Hyper-V VMs.</p><p>This appliance is used by Azure Migrate Server Assessment, and Azure Migrate Server Migration for agentless migration and continuously discovers server metadata and performance data, for the purposes of assessment and migration.</p></li></ul><p><b>VMware VM migration</b>: Azure Migrate Server Migration provides a couple of methods for migrating on-premises VMware VMs to Azure. An agentless migration using the Azure Migrate appliance, and an agent-based migration that uses a replication appliance, and deploys an agent on each VM you want to migrate.</p><p><b>Database assessment and migration</b>: From Azure Migrate, you can assess on-premises databases for migration to Azure using the Azure Database Migration Assistant. You can migrate databases using the Azure Database Migration Service.</p><p><b>Web app migration</b>: You can assess web apps using a public endpoint URL with the Azure App Service. For migration of internal .NET apps, you can download and run the App Service Migration Assistant.</p><p><b>Data Box</b>: Import large amounts offline data into Azure using Azure Data Box in Azure Migrate.</p><h3 class="da-h3" id="1191862">VMware Migration</h3><p>VMware VMs can be migrated  using Azure Migrate Server Migration with the following two options:</p><ul class="square"><li class="square"><p><b>Agentless replication</b>: Migrate VMs without needing to install anything on them.</p></li><li class="square"><p><b>Agent based replication</b>: Install an agent on the VM for replication.</p></li></ul><p>Although agentless replication is easier from a deployment perspective, it currently has the following limitations:</p><p><b>Simultaneous replication</b>: A maximum of 300 VMs can be simultaneously replicated from a vCenter Server. If you have more than 50 VMs for migration, create multiple batches of VMs.
Replicating more at a single time will impact performance.</p><p><b>VM disks</b>: A VM that you want to migrate must have 60 or fewer disks (Agentless) or 63 or fewer disks (Agent-based).</p><p>For more information, go to <a href="https://docs.microsoft.com/en-us/azure/migrate/server-migrate-overview#agentless-migration-limitations" title="" target="_blank">Select a VMware migration option</a>.</p><p>Both agentless and agent-based replication will be discussed in detail in Lessons 2 and 3.</p><h3 class="da-h3" id="1191863">Deployment Steps Comparison</h3><p>There are differences between agentless and agent-based deployment tasks in the VMware migration process. Lessons 2 and 3 provide more detail. This is just a high-level summary of the differences.</p><table style="width:100%" class=""><col width="25%" /><col width="25%" /><col width="25%" /><col width="25%" /><thead><tr><td><p><b>Task</b></p></td><td><p><b>Details</b></p></td><td><p><b>Agentless</b></p></td><td><p><b>Agent-based</b></p></td></tr></thead><tbody><tr><td><p><b>Prepare VMware servers and VM for migration</b></p></td><td><p>Configure a number of settings on VM servers and VMs</p></td><td><p>Required</p></td><td><p>Required</p></td></tr><tr><td><p><b>Add the Server Migration tool</b></p></td><td><p>Add the Azure Migrate Server Migration tool in the Azure Migrate project</p></td><td><p>Required</p></td><td><p>Required</p></td></tr><tr><td><p><b>Deploy the Azure Migrate appliance</b></p></td><td><p>Set up a lightweight appliance on a VMware VM for discovery and assessment</p></td><td><p>Required</p></td><td><p>Not required</p></td></tr><tr><td><p><b>Install the Mobility service on VMs</b></p></td><td><p>Install the Mobility service on each VM you want to replicated</p></td><td><p>Not required</p></td><td><p>Required</p></td></tr><tr><td><p><b>Deploy the Azure Migrate Server Migration replication appliance</b></p></td><td><p>Set up an appliance on a VMware VM to discover VMs and bridge between the Mobility service running on VMs and Azure Migrate Server Migration</p></td><td><p>Not required</p></td><td><p>Required</p></td></tr><tr><td><p><b>Replicate VMs. Enable VM replication</b></p></td><td><p>Configure replication settings and select VMs to replicate</p></td><td><p>Required</p></td><td><p>Required</p></td></tr><tr><td><p><b>Run a test migration</b></p></td><td><p>Run a test migration to make sure everything is working correctly</p></td><td><p>Required</p></td><td><p>Required</p></td></tr><tr><td><p><b>Run a full migration</b></p></td><td><p>Migrate the VMs</p></td><td><p>Required</p></td><td><p>Required</p></td></tr></tbody></table><h3 class="da-h3" id="1191907">Lab: Protecting Hyper-V VMs by using Azure Site Recovery</h3><p>✔️ <b>Important:</b> To download the most recent version of this lab, please visit the AZ-303 <a href="https://github.com/MicrosoftLearning/AZ-303-Microsoft-Azure-Architect-Technologies" title="" target="_blank">GitHub repository</a>.</p><p>Direct link to the <a href="https://aka.ms/303_Module_12_Lab" title="" target="_blank">Lab: Protecting Hyper-V VMs by using Azure Site Recovery</a>.</p><h4 class="da-h4">Lab scenario</h4><p><span><img alt="" src="../Images/1192088-490226.png" width="" height="" /></span></p><p>While Adatum Corporation has, over the years, implemented a number of high availability provisions for their on-premises workloads, its disaster recovery capabilities are still insufficient to address the Recovery Point Objectives (RPOs) and Recovery Time Objectives (RTOs) demanded by its business. Maintaining the existing secondary on-premises site requires an extensive effort and incurs significant costs. The failover and failback procedures are, for the most part, manual and are poorly documented.</p><p>To address these shortcomings, the Adatum Enterprise Architecture team decided to explore capabilities of Azure Site Recovery, with Azure taking on the role of the hoster of the secondary site. Azure Site Recovery automatically and continuously replicates workloads running on physical and virtual machines from the primary to the secondary site. Site Recovery uses storage-based replication mechanism, without intercepting application data. With Azure as the secondary site, data is stored in Azure Storage, with built-in resilience and low cost. The target Azure VMs are hydrated following a failover by using the replicated data. The Recovery Time Objectives (RTO) and Recovery Point objectives are minimized since Site Recovery provides continuous replication for VMware VMs and replication frequency as low as 30 seconds for Hyper-V VMs. In addition, Azure Site Recovery also handles orchestration of failover and failback processes, which, to large extent, can be automated. It is also possible to use Azure Site Recovery for migrations to Azure, although the recommended approach relies on Azure Migrate instead.</p><p>The Adatum Enterprise Architecture team wants to evaluate the use of Azure Site Recovery for protecting on-premises Hyper-V virtual machines to Azure VM.</p><h4 class="da-h4">Objectives</h4><p>After completing this lab, you will be able to:</p><ul class="square"><li class="square"><p>Configure Azure Site Recovery</p></li><li class="square"><p>Perform test failover</p></li><li class="square"><p>Perform planned failover</p></li><li class="square"><p>Perform unplanned failover</p></li></ul><h4 class="da-h4">Lab Environment</h4><p>Windows Server admin credentials</p><ul class="square"><li class="square"><p>User Name: <b>Student</b></p></li><li class="square"><p>Password: <b>Pa55w.rd1234</b></p></li></ul><p>Estimated Time: 120 minutes</p><h4 class="da-h4">Lab Files (Located in the GitHub repository listed above)</h4><ul class="square"><li class="square"><p>\\AZ303\AllFiles\Labs\07\azuredeploy30307suba.json</p></li></ul><h5 class="da-h5">Exercise 0: Prepare the lab environment</h5><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Deploy an Azure VM by using an Azure Resource Manager QuickStart template</p></li><li><p>Configure nested virtualization in the Azure VM</p></li></ol><h5 class="da-h5">Exercise 1: Create and configure an Azure Site Recovery vault</h5><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Create an Azure Site Recovery vault</p></li><li><p>Configure the Azure Site Recovery vault</p></li></ol><h5 class="da-h5">Exercise 2: Implement Hyper-V protection by using Azure Site Recovery vault</h5><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Implement the target Azure environment</p></li><li><p>Implement protection of a Hyper-V virtual machine</p></li><li><p>Perform a failover of the Hyper-V virtual machine</p></li><li><p>Remove Azure resources deployed in the lab</p></li></ol><h3 class="da-h3" id="1191968">Activity Log</h3><p>The Azure Activity Log is a subscription log that provides insight into subscription-level events that have occurred in Azure. This includes a range of data, from Azure Resource Manager operational data to updates on Service Health events.</p><p>With the Activity Log, you can determine the ‘what, who, and when’ for any write operations (PUT, POST, DELETE) taken on the resources in your subscription. You can also understand the status of the operation and other relevant properties. Through activity logs, you can determine:</p><ul class="square"><li class="square"><p>What operations were taken on the resources in your subscription.</p></li><li class="square"><p>Who started the operation.</p></li><li class="square"><p>When the operation occurred.</p></li><li class="square"><p>The status of the operation.</p></li><li class="square"><p>The values of other properties that might help you research the operation.</p></li></ul><p><span><img alt="" src="../Images/1192146-490284.png" width="" height="" /></span></p><p>✔️ Activity logs are kept for 90 days. You can query for any range of dates, as long as the starting date isn't more than 90 days in the past. You can retrieve events from your Activity Log using the Azure portal, CLI, PowerShell cmdlets, and Azure Monitor REST API.</p><h3 class="da-h3" id="1191921">Azure App Service Overview</h3><p><span><img alt="" src="../Images/1192419-490557.png" width="" height="" /></span></p><p>Azure App Service is an HTTP-based service for hosting web applications, REST APIs, and mobile back ends. You can develop in your favorite language, be it .NET, .NET Core, Java, Ruby, Node.js, PHP, or Python. Applications run and scale with ease on both Windows and Linux-based environments.</p><p>App Service not only adds the power of Microsoft Azure to your application, such as security, load balancing, autoscaling, and automated management. You can also take advantage of its DevOps capabilities, such as continuous deployment from Azure DevOps, GitHub, Docker Hub, and other sources, package management, staging environments, custom domain, and TLS/SSL certificates.</p><p>With App Service, you pay for the Azure compute resources you use. The compute resources you use is determined by the App Service plan that you run your apps on.</p><h4 class="da-h4">Deployment slots</h4><p>Using the Azure portal, you can easily add <b>deployment slots</b> to an App Service web app. For instance, you can create a <b>staging</b> deployment slot where you can push your code to test on Azure. Once you are happy with your code, you can easily <b>swap</b> the staging deployment slot with the production slot. You do all this with a few simple mouse clicks in the Azure portal.</p><p><span><img alt="" src="../Images/1192420-490558.png" width="" height="" /></span></p><h4 class="da-h4">Continuous integration/deployment support</h4><p>The Azure portal provides out-of-the-box continuous integration and deployment with Azure DevOps, GitHub, Bitbucket, FTP, or a local Git repository on your development machine. Connect your web app with any of the above sources and App Service will do the rest for you by automatically syncing your code and any future changes on the code into the web app.</p><p><span><img alt="" src="../Images/1192421-490559.png" width="" height="" /></span></p><h4 class="da-h4">Creating a web app</h4><p>When you're ready to run a web app on Azure, you visit the Azure portal and create a <b>Web App</b> resource. Creating a web app allocates a set of hosting resources in App Service, which you can use to host any web-based application that is supported by Azure, whether it be ASP.NET Core, Node.js, Java, Python, etc.</p><p>The Azure portal provides a wizard to create a web app. This wizard requires the following fields:</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Field</p></td><td><p>Description</p></td></tr></thead><tbody><tr><td><p>Subscription</p></td><td><p>A valid and active Azure subscription.</p></td></tr><tr><td><p>Resource group</p></td><td><p>A valid resource group.</p></td></tr><tr><td><p>App name</p></td><td><p>The name of the web app. This name becomes part of the app's URL, so it must be unique among all Azure App Service web apps.</p></td></tr><tr><td><p>Publish</p></td><td><p>You can deploy your application to App Service as code or as a ready-to-run Docker image. Selecting Docker image will activate the Docker tab of the wizard, where you provide information about the Docker registry from which App Service will retrieve your image.</p></td></tr><tr><td><p>Runtime stack</p></td><td><p>If you choose to deploy your application as code, App Service needs to know what runtime your application uses (examples include Node.js, Python, Java, and .NET). If you deploy your application as a Docker image, you will not need to choose a runtime stack, since your image will include it.</p></td></tr><tr><td><p>Operating system</p></td><td><p>App Service can host applications on Windows or Linux servers. See below for additional information.</p></td></tr><tr><td><p>Region</p></td><td><p>The Azure region from which your application will be served.</p></td></tr><tr><td><p>App Service Plan</p></td><td><p>See below for information about App Service plans.</p></td></tr></tbody></table><h4 class="da-h4">App Service plans</h4><p>An App Service plan is a set of virtual server resources that run App Service apps. A plan's size (sometimes referred to as its sku or pricing tier) determines the performance characteristics of the virtual servers that run the apps assigned to the plan and the App Service features that those apps have access to. Every App Service web app you create must be assigned to a single App Service plan that runs it.</p><p>A single App Service plan can host multiple App Service web apps. In most cases, the number of apps you can run on a single plan will be limited by the performance characteristics of the apps and the resource limitations of the plan.</p><p>App Service plans are the unit of billing for App Service. The size of each App Service plan in your subscription, in addition to the bandwidth resources used by the apps deployed to those plans, determines the price that you pay. The number of web apps deployed to your App Service plans has no effect on your bill.</p><h3 class="da-h3" id="1191922">Demonstration - Azure App Service</h3><p>In this demonstration, you will use the Azure portal to create a web app and an Azure App Service.</p><p>Sign into the <a href="https://portal.azure.com/learn.docs.microsoft.com" title="" target="_blank">Azure portal </a>.</p><ol class="number"><li><p>On the Azure portal menu or from the <b>Home</b> page, select <b>App Services</b>.</p></li></ol><p><span><img alt="" src="../Images/1192335-490473.png" width="" height="" /></span></p><ol class="number"><li value="2"><p>From the <b>App Services page</b>, select <b>Create app service</b>.</p></li></ol><p><span><img alt="" src="../Images/1192336-490474.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>From the <b>Web App</b>, complete the following values:</p></li></ol><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p>Field</p></td><td><p>Value</p></td><td><p>Details</p></td></tr></thead><tbody><tr><td><p>Subscription</p></td><td><p>Select your subscription</p></td><td><p>The web app you are creating must belong to a resource group. Here, you select the Azure subscription to which the resource group belongs (or will belong, if you are creating it within the wizard).</p></td></tr><tr><td><p>Resource Group</p></td><td><p>Select from the menu</p></td><td><p>The resource group to which the web app will belong. All Azure resources must belong to a resource group.</p></td></tr><tr><td><p>Name</p></td><td><p>Enter a unique name</p></td><td><p>The name of your web app. This name will be part of the app's URL: appname.azurewebsites.net. The name you choose must be unique among all Azure web apps.</p></td></tr><tr><td><p>Publish</p></td><td><p>Code</p></td><td><p>The method you will use to publish your application. When publishing your application as code, you also must configure Runtime stack to prepare your App Service resources to run your app.</p></td></tr><tr><td><p>Runtime stack</p></td><td><p>.NET Core 3.1 (LTS)</p></td><td><p>The platform on which your application runs. Your choice may affect whether you have a choice of operating system - for some runtime stacks, App Service supports only one operating system.</p></td></tr><tr><td><p>Operating System</p></td><td><p>Linux</p></td><td><p>The operating system used on the virtual servers that run your app.</p></td></tr><tr><td><p>Region</p></td><td><p>Central US</p></td><td><p>The geographical region from which your app will be hosted.</p></td></tr><tr><td><p>Linux Plan</p></td><td><p>Leave default</p></td><td><p>The name of the App Service plan that will power your app. By default, the wizard will create a new plan in the same region as the web app.</p></td></tr><tr><td><p>Sku and size</p></td><td><p>Default</p></td><td><p>The pricing tier of the plan being created. This determines the performance characteristics of the virtual servers that power your app, and the features it has access to. To select the F1 tier, select Change size to open the Spec Picker wizard. On the Dev / Test tab, select F1 from the list, then select Apply.</p></td></tr></tbody></table><p><span><img alt="" src="../Images/1192337-490475.png" width="" height="" /></span></p><ol class="number"><li value="4"><p>Select <b>Review and Create</b> to navigate to the review page, then select <b>Create</b> to create the web app.</p></li></ol><p><span><img alt="" src="../Images/1192338-490476.png" width="" height="" /></span></p><p>✔️ <b>Note</b></p><p>It can take a few seconds to get your web app created and ready for your use.</p><p>The portal will display the deployment page, where you can view the status of your deployment. Once the app is ready, navigate to the new app in the Azure portal:</p><ol class="number"><li><p>On the Azure portal menu or from the <b>Home page</b>, select <b>All resources</b>.</p></li><li><p>Select the App Service for your web app from the list. Make sure to select the App Service, and not the App Service plan.</p></li></ol><p><span><img alt="" src="../Images/1192339-490477.png" width="" height="" /></span></p><p>The portal displays the <b>App Services</b> overview page.</p><p><span><img alt="" src="../Images/1192340-490478.png" width="" height="" /></span></p><p>To preview your new web app's default content, select its URL at the top right. The placeholder page that loads indicates that your web app is up and running and ready to receive deployment of your app's code.</p><p><span><img alt="" src="../Images/1192341-490479.png" width="" height="" /></span></p><h3 class="da-h3" id="1191937">Deployment Slots</h3><p><span><img alt="" src="../Images/1192299-490437.png" width="" height="" /></span></p><p>Within a single Azure App Service web app, you can create multiple deployment slots. Each slot is a separate instance of that web app, and it has a separate host name. You can deploy a different version of your web app into each slot.</p><p>One slot is the production slot. This slot is the web app that users see when they connect. Make sure that the app deployed to this slot is stable and well tested.</p><p>Use additional slots to host new versions of your web app. Against these instances, you can run tests such as integration tests, acceptance tests, and capacity tests. Fix any problems before you move the code to the production slot. Additional slots behave like their own App Service instances, so you can have confidence that your tests show how the app will run in production.</p><p>When you use more than one deployment slot for a web app, those slots are treated as separate instances of that web app. For example, they're listed separately on the <b>All resources</b> page in the Azure portal. They each have their own URL. However, each slot shares the resources of the App Service plan, including virtual machine memory and CPU as well as disk space.</p><h3 class="da-h3" id="1191938">Slots and Tiers</h3><p>Deployment slots are available only when your web app uses an App Service plan in the Standard, Premium, or Isolated tier. The following table shows the maximum number of slots you can create:</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Tier</p></td><td><p>Maximum staging slots</p></td></tr></thead><tbody><tr><td><p>Free</p></td><td><p>0</p></td></tr><tr><td><p>Shared</p></td><td><p>0</p></td></tr><tr><td><p>Basic</p></td><td><p>0</p></td></tr><tr><td><p>Standard</p></td><td><p>5</p></td></tr><tr><td><p>Premium</p></td><td><p>20</p></td></tr><tr><td><p>Isolated</p></td><td><p>20</p></td></tr></tbody></table><h4 class="da-h4">Avoid a cold start during swaps</h4><p>Many of the technologies that developers use to create web apps require final compilation and other actions on the server before they deliver a page to a user. Many of these tasks are completed when the app starts up and receives a request. For example, if you use ASP.NET to build your app, code is compiled and views are completed when the first user requests a page. Subsequent requests for that page receive a faster response because the code is already compiled.</p><p>The initial delay is called a cold start. You can avoid a cold start by using slot swaps to deploy to production. When you swap a slot into production, you “warm up” the app because your action sends a request to the root of the site. The warm-up request ensures that all compilation and caching tasks finish. After the swap, the site responds as fast as if it had been deployed for days.</p><h3 class="da-h3" id="1191942">Azure Functions</h3><p>Azure Functions allows you to run small pieces of code (called “functions”) without worrying about application infrastructure. With Azure Functions, the cloud infrastructure provides all the up-to-date servers you need to keep your application running at scale.</p><p>A function is “triggered” by a specific type of event. Supported triggers include responding to changes in data, responding to messages, running on a schedule, or as the result of an HTTP request.</p><p>While you can always code directly against a myriad of services, integrating with other services is streamlined by using bindings. Bindings give you declarative access to a wide variety of Azure and third-party services.</p><h4 class="da-h4">Features</h4><p>Some key features of Azure Functions include:</p><ul class="square"><li class="square"><p><b>Serverless applications</b>: Functions allow you to develop <a href="https://azure.microsoft.com/solutions/serverless/" title="" target="_blank">serverless</a> applications on Microsoft Azure.</p></li><li class="square"><p><b>Choice of language</b>: Write functions using your choice of <a href="https://docs.microsoft.com/en-us/azure/azure-functions/supported-languages" title="" target="_blank">C#, Java, JavaScript, Python, and PowerShell</a>.</p></li><li class="square"><p><b>Pay-per-use pricing model</b>: Pay only for the time spent running your code. See the Consumption hosting plan option in the <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-overview?WT.mc_id=thomasmaurer-blog-thmaure" title="" target="_blank">pricing section</a>.</p></li><li class="square"><p><b>Bring your own dependencie</b>s: Functions supports NuGet and NPM, giving you access to your favorite libraries.</p></li><li class="square"><p><b>Integrated security</b>: Protect HTTP-triggered functions with OAuth providers such as Azure Active Directory, Facebook, Google, Twitter, and Microsoft Account.</p></li><li class="square"><p><b>Simplified integration</b>: Easily integrate with Azure services and software-as-a-service (SaaS) offerings.</p></li><li class="square"><p><b>Flexible development</b>: Set up continuous integration and deploy your code through <a href="https://docs.microsoft.com/en-us/azure/app-service/scripts/cli-continuous-deployment-github" title="" target="_blank">GitHub</a>, <a href="https://docs.microsoft.com/en-us/azure/app-service/scripts/cli-continuous-deployment-vsts" title="" target="_blank">Azure DevOps Services</a>, and other <a href="https://docs.microsoft.com/en-us/azure/app-service/deploy-local-git" title="" target="_blank">supported development tools</a>.</p></li><li class="square"><p><b>Stateful serverless architecture</b>: Orchestrate serverless applications with <a href="https://docs.microsoft.com/en-us/azure/azure-functions/durable/durable-functions-overview" title="" target="_blank">Durable Functions</a>.</p></li><li class="square"><p><b>Open-source</b>: The Functions runtime is open-source and <a href="https://github.com/azure/azure-webjobs-sdk-script" title="" target="_blank">available on GitHub</a>.</p></li></ul><h4 class="da-h4">What Azure Functions Do?</h4><p>Functions is a great solution for processing bulk data, integrating systems, working with the internet-of-things (IoT), and building simple APIs and micro-services.</p><p>A series of templates is available to get you started with key scenarios including:</p><ul class="square"><li class="square"><p><b>HTTP</b>: Run code based on <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-create-first-azure-function" title="" target="_blank">HTTP requests</a></p></li><li class="square"><p><b>Timer</b>: Schedule code to <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-create-scheduled-function" title="" target="_blank">run at predefined times</a></p></li><li class="square"><p><b>Azure Cosmos DB</b>: Process <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-create-cosmos-db-triggered-function" title="" target="_blank">new and modified Azure Cosmos DB documents</a></p></li><li class="square"><p><b>Blob storage</b>: Process <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-create-storage-blob-triggered-function" title="" target="_blank">new and modified Azure Storage blobs</a></p></li><li class="square"><p><b>Queue storage</b>: Respond to <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-create-storage-queue-triggered-function" title="" target="_blank">Azure Storage queue messages</a></p></li><li class="square"><p><b>Event Grid</b>: Respond to <a href="https://docs.microsoft.com/en-us/azure/event-grid/resize-images-on-storage-blob-upload-event" title="" target="_blank">Azure Event Grid events via subscriptions and filters</a></p></li><li class="square"><p><b>Event Hub</b>: Respond to <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-event-hubs" title="" target="_blank">high-volumes of Azure Event Hub events</a></p></li><li class="square"><p><b>Service Bus Queue</b>: Connect to other Azure or on-premises services by <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-service-bus" title="" target="_blank">responding Service Bus queue messages</a></p></li><li class="square"><p><b>Service Bus Topic</b>: Connect other Azure services or on-premises services by <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-service-bus" title="" target="_blank">responding to Service Bus topic messages</a></p></li></ul><p><span><img alt="" src="../Images/1192388-490526.png" width="" height="" /></span></p><h3 class="da-h3" id="1191953">Module 14 Review Questions</h3><p><span><img alt="" src="../Images/1192029-490167.png" width="" height="" /></span></p><h4 class="problem">Review Question 1</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-488f017a-f5aa-6033-a875-62be951baea0"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You are administering a production web app. The app requires scaling to five instances, 40GB of storage, and a custom domain name. Which App Service Plan should you select? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q488f017a-f5aa-6033-a875-62be951baea0" value="1" />Free<br /></label></li><li><label><input type="radio" name="q488f017a-f5aa-6033-a875-62be951baea0" value="2" />Shared<br /></label></li><li><label><input type="radio" name="q488f017a-f5aa-6033-a875-62be951baea0" value="3" />Basic<br /></label></li><li><label><input type="radio" name="q488f017a-f5aa-6033-a875-62be951baea0" value="4" />Standard<br /></label></li><li><label><input type="radio" name="q488f017a-f5aa-6033-a875-62be951baea0" value="5" />Premium<br /></label></li></ul></div></div><div id="feedback-problem-488f017a-f5aa-6033-a875-62be951baea0" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Standard. The Standard App Service Plan meets the requirements at the least cost.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 2</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-dd78f786-ceb4-76c2-73ab-df53a63cebc9"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You are backing up your App Service. Which of the following is included in the backup? Select two.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="checkbox" name="qdd78f786-ceb4-76c2-73ab-df53a63cebc9" value="1" />App configuration<br /></label></li><li><label><input type="checkbox" name="qdd78f786-ceb4-76c2-73ab-df53a63cebc9" value="2" />Azure database for MySQL<br /></label></li><li><label><input type="checkbox" name="qdd78f786-ceb4-76c2-73ab-df53a63cebc9" value="3" />Files and database content totalling 15GB<br /></label></li><li><label><input type="checkbox" name="qdd78f786-ceb4-76c2-73ab-df53a63cebc9" value="4" />Firewall enabled-storage account<br /></label></li><li><label><input type="checkbox" name="qdd78f786-ceb4-76c2-73ab-df53a63cebc9" value="5" />SSL enabled Azure Database for MySQL<br /></label></li></ul></div></div><div id="feedback-problem-dd78f786-ceb4-76c2-73ab-df53a63cebc9" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">App configuration and Azure database for MySQL. App Service can back up: app configuration, file content, and a database connected to your app (SQL Database, Azure Database for MySQL, Azure Database for PostgreSQL, MySQL in-app). Backups can be up to 10 GB of app and database content. Using a firewall enabled storage account as the destination for your backups is not supported. SSL enabled Azure Database for MySQL does not get backed up.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem"> Review Question 3</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-0818681d-7754-0566-f291-db45edb73732"><div class="card quizlib-question"><div class="quizlib-question-title"><p>What method does Microsoft Azure App Service use to obtain credentials for users attempting to access an app? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q0818681d-7754-0566-f291-db45edb73732" value="1" />credentials that are stored in the browser<br /></label></li><li><label><input type="radio" name="q0818681d-7754-0566-f291-db45edb73732" value="2" />pass-through authentication<br /></label></li><li><label><input type="radio" name="q0818681d-7754-0566-f291-db45edb73732" value="3" />redirection to a provider endpoint<br /></label></li><li><label><input type="radio" name="q0818681d-7754-0566-f291-db45edb73732" value="4" />synchronization of accounts across providers<br /></label></li></ul></div></div><div id="feedback-problem-0818681d-7754-0566-f291-db45edb73732" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Redirection to a provider endpoint. Microsoft Azure App Service apps redirect requests to an endpoint that signs in users for that provider. The App Service can automatically direct all unauthenticated users to the endpoint that signs in users. Course: Module 4<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 4</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-9e660e4c-9516-8418-6f3b-13f9e1a782ef"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You have multiple apps running in a single App Service plan. True or False: Each app in the service plan can have different scaling rules.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q9e660e4c-9516-8418-6f3b-13f9e1a782ef" value="1" />True<br /></label></li><li><label><input type="radio" name="q9e660e4c-9516-8418-6f3b-13f9e1a782ef" value="2" />False<br /></label></li></ul></div></div><div id="feedback-problem-9e660e4c-9516-8418-6f3b-13f9e1a782ef" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">False. The App Service plan is the scale unit of the App Service apps. If the plan is configured to run five VM instances, then all apps in the plan run on all five instances. If the plan is configured for autoscaling, then all apps in the plan are scaled out together based on the autoscale settings.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 5</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-2c90f218-5717-c5c2-0c9e-4bdaa254248f"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You are backing up your App Service. Which of the following is included in the backup? Select two.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="checkbox" name="q2c90f218-5717-c5c2-0c9e-4bdaa254248f" value="1" />App configuration<br /></label></li><li><label><input type="checkbox" name="q2c90f218-5717-c5c2-0c9e-4bdaa254248f" value="2" />Azure database for MySQL<br /></label></li><li><label><input type="checkbox" name="q2c90f218-5717-c5c2-0c9e-4bdaa254248f" value="3" />Files and database content totalling 15GB<br /></label></li><li><label><input type="checkbox" name="q2c90f218-5717-c5c2-0c9e-4bdaa254248f" value="4" />Firewall enabled-storage account<br /></label></li><li><label><input type="checkbox" name="q2c90f218-5717-c5c2-0c9e-4bdaa254248f" value="5" />SSL enabled Azure Database for MySQL<br /></label></li></ul></div></div><div id="feedback-problem-2c90f218-5717-c5c2-0c9e-4bdaa254248f" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">App configuration and Azure database for MySQL. App Service can back up: app configuration, file content, and a database connected to your app (SQL Database, Azure Database for MySQL, Azure Database for PostgreSQL, MySQL in-app). Backups can be up to 10 GB of app and database content. Using a firewall enabled storage account as the destination for your backups is not supported. SSL enabled Azure Database for MySQL does not get backed up.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 6</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-7ece7566-87a1-bdfe-ecc2-8080a5c311fa"><div class="card quizlib-question"><div class="quizlib-question-title"><p>Your organization has a Basic App Service plan named OEM_Plan_1 that hosts an Azure App Service named OEM_AppSvc_1.<br /></p><ul class="square"><li class="square"><p>You are asked to configure a custom domain and enable backups for OEM_AppSvc_1.</p></li></ul><p>
What do you recommend be done first?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q7ece7566-87a1-bdfe-ecc2-8080a5c311fa" value="1" />Scale out OEM_Plan_1<br /></label></li><li><label><input type="radio" name="q7ece7566-87a1-bdfe-ecc2-8080a5c311fa" value="2" />Scale up OEM_Plan_1<br /></label></li><li><label><input type="radio" name="q7ece7566-87a1-bdfe-ecc2-8080a5c311fa" value="3" />Configure the application settings for OEM_AppSvc_1<br /></label></li><li><label><input type="radio" name="q7ece7566-87a1-bdfe-ecc2-8080a5c311fa" value="4" />Create an separate Azure App Service for OEM_Plan_1<br /></label></li></ul></div></div><div id="feedback-problem-7ece7566-87a1-bdfe-ecc2-8080a5c311fa" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct Answer: Scale up OEM_Plan_1. Scaling up is similar to switching to a Production plan that will enable the required features.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h3 class="da-h3" id="1191956">Azure Infrastructure Monitoring</h3><p><b>Configuration and Change Management</b></p><p>Azure reviews and updates configuration settings and baseline configurations of hardware, software, and network devices annually. Changes are developed, tested, and approved prior to entering the production environment from a development and/or test environment.</p><p>The baseline configurations that are required for Azure-based services are reviewed by the Azure security and compliance team and by service teams. A service team review is part of the testing that occurs before the deployment of their production service.</p><p><b>Vulnerability Management</b></p><p>Security update management helps protect systems from known vulnerabilities. Azure uses integrated deployment systems to manage the distribution and installation of security updates for Microsoft software. Azure is also able to draw on the resources of the Microsoft Security Response Center (MSRC). The MSRC identifies, monitors, responds to, and resolves security incidents and cloud vulnerabilities around the clock, every day of the year.</p><p><b>Vulnerability Scanning</b></p><p>Vulnerability scanning is performed on server operating systems, databases, and network devices. The vulnerability scans are performed on a quarterly basis at minimum. Azure contracts with independent assessors to perform penetration testing of the Azure boundary. Red-team exercises are also routinely performed and the results are used to make security improvements.</p><p><b>Protective Monitoring</b></p><p>Azure security has defined requirements for active monitoring. Service teams configure active monitoring tools in accordance with these requirements. Active monitoring tools include the Microsoft Monitoring Agent (MMA) and System Center Operations Manager. These tools are configured to provide time alerts to Azure security personnel in situations that require immediate action.</p><p><b>Incident Management</b></p><p>Microsoft implements a security incident management process to facilitate a coordinated response to incidents, should one occur.</p><p>If Microsoft becomes aware of unauthorized access to customer data that's stored on its equipment or in its facilities, or it becomes aware of unauthorized access to such equipment or facilities resulting in loss, disclosure, or alteration of customer data, Microsoft takes the following actions:</p><ul class="square"><li class="square"><p>Promptly notifies the customer of the security incident.</p></li><li class="square"><p>Promptly investigates the security incident and provides customers detailed information about the security incident.</p></li><li class="square"><p>Takes reasonable and prompt steps to mitigate the effects and minimize any damage resulting from the security incident.</p></li></ul><p>An incident management framework has been established that defines roles and allocates responsibilities. The Azure security incident management team is responsible for managing security incidents, including escalation, and ensuring the involvement of specialist teams when necessary. Azure operations managers are responsible for overseeing the investigation and resolution of security and privacy incidents.</p><h3 class="da-h3" id="1191957">Security Posture</h3><p>We often think of monitoring as watching and waiting for an event to occur so that we can react to the situation. Strengthening your security posture refers to having a proactive strategy that audits your resources to identify systems that do not meet organizational standards or best practices.</p><p>Azure Security Center enables you to strengthen your security posture. This means it helps you identify and perform the hardening tasks recommended as security best practices and implement them across your machines, data services, and apps. This includes managing and enforcing your security policies, and making sure your Azure virtual machines, non-Azure servers, and Azure PaaS services are compliant. Security Center provides you with the tools you need to have a bird's eye view on your workloads, with focused visibility on your network security estate.</p><p>You can view the security state of your resources and any issues per resource type:</p><ul class="square"><li class="square"><p>To monitor the health of your computer resources and your apps and receive recommendations for improving their security.</p></li><li class="square"><p>To monitor your network resources, such as virtual machines, network security groups and endpoints, and receive recommendations for improving their security.</p></li><li class="square"><p>To monitor your data and storage resources, such as SQL servers and storage accounts, and receive recommendations for improving their security.</p></li><li class="square"><p>To monitor your identity and access resources, including MFA and account permissions, and receive recommendations for improving their security.</p></li><li class="square"><p>To monitor just-in-time access to your resources.</p></li></ul><p>You can monitor capabilities in Azure Security Center to make sure your resource security is as tight as possible and monitor compliance with policies.</p><p><span><img alt="" src="../Images/1192102-490240.png" width="" height="" /></span></p><h3 class="da-h3" id="1191958">Azure Security Center</h3><p>Azure Security Center is a unified infrastructure security management system that strengthens the security posture of your data centers, and provides advanced threat protection across your hybrid workloads in the cloud - whether they're in Azure or not - as well as on premises.</p><p>Keeping your resources safe is a joint effort between your cloud provider, Azure, and you, the customer. You have to make sure your workloads are secure as you move to the cloud, and at the same time, when you move to IaaS (infrastructure as a service) there is more customer responsibility than there was in PaaS (platform as a service), and SaaS (software as a service). Azure Security Center provides you the tools needed to harden your network, secure your services and make sure you're on top of your security posture.</p><p><b>Azure Security Center addresses the three most urgent security challenges:</b></p><ul class="square"><li class="square"><p>Rapidly changing workloads – It's both a strength and a challenge of the cloud. On the one hand, end users are empowered to do more. On the other, how do you make sure that the ever-changing services people are using and creating are up to your security standards and follow security best practices?</p></li><li class="square"><p>Increasingly sophisticated attacks - Wherever you run your workloads, the attacks keep getting more sophisticated. You have to secure your public cloud workloads, which are, in effect, an Internet facing workload that can leave you even more vulnerable if you don't follow security best practices.</p></li><li class="square"><p>Security skills are in short supply - The number of security alerts and alerting systems far outnumbers the number of administrators with the necessary background and experience to make sure your environments are protected. Staying up-to-date with the latest attacks is a constant challenge, making it impossible to stay in place while the world of security is an ever-changing front.</p></li></ul><p><b>To help you protect yourself against these challenges, Security Center provides you with the tools to:</b></p><ul class="square"><li class="square"><p>Strengthen security posture: Security Center assesses your environment and enables you to understand the status of your resources, and whether they are secure.</p></li><li class="square"><p>Protect against threats: Security Center assesses your workloads and raises threat prevention recommendations and security alerts.</p></li><li class="square"><p>Get secure faster: In Security Center, everything is done in cloud speed. Because it is natively integrated, deployment of Security Center is easy, providing you with autoprovisioning and protection with Azure services.</p></li></ul><p><b>Architecture</b></p><p>Because Security Center is natively part of Azure, PaaS services in Azure - including Service Fabric, SQL databases, and storage accounts - are monitored and protected by Security Center without necessitating any deployment.</p><p>In addition, Security Center protects non-Azure servers and virtual machines in the cloud or on premises, for both Windows and Linux servers, by installing the Log Analytics agent on them. Azure virtual machines are auto-provisioned in Security Center.</p><p>The events collected from the agents and from Azure are correlated in the security analytics engine to provide you tailored recommendations (hardening tasks), that you should follow to make sure your workloads are secure, and security alerts. You should investigate such alerts as soon as possible to make sure malicious attacks aren't taking place on your workloads.</p><p>When you enable Security Center, the security policy built-in to Security Center is reflected in Azure Policy as a built in initiative under Security Center category. The built-in initiative is automatically assigned to all Security Center registered subscriptions (Free or Standard tiers). The built-in initiative contains only Audit policies.</p><p>You'll provide information on how to protect resources and respond to threats by using Azure Security Center.</p><p><b>Criteria for assessing Azure Security Center</b></p><p>You use Security Center if:</p><ul class="square"><li class="square"><p>You want to identify and address risks and threats to your infrastructure.</p></li><li class="square"><p>You don't have the traditional in-house skills and capital needed to secure a complex infrastructure.</p></li><li class="square"><p>You want to secure an infrastructure that consists of on-premises and cloud resources.</p></li></ul><p><b>Understand the security posture of your architecture</b></p><p>Security Center gives detailed analyses of different components of your environment. These components include data security, network security, identity and access, and application security. This way, Security Center helps you understand the security of your architecture. You can then build and maintain better infrastructures.</p><p><span><img alt="" src="../Images/1192172-490310.png" width="" height="" /></span></p><p>Security Center recommends how to address the issues and risks that it has uncovered. You use recommendations like the following one to improve the security and compliance of your architecture.</p><p><span><img alt="" src="../Images/1192173-490311.png" width="" height="" /></span></p><h3 class="da-h3" id="1191959">Strengthened Security Posture</h3><p>It's good to make sure your workloads are secure, and it starts with having tailored security policies in place. Because all the policies in Security Center are built on top of Azure policy controls, you're getting the full range and flexibility of a world-class policy solution. In Security Center, you can set your policies to run on management groups, across subscriptions, and even for a whole tenant.</p><p><span><img alt="" src="../Images/1192382-490520.png" width="" height="" /></span></p><p>Security Center helps you <b>identify Shadow IT subscriptions</b>. By looking at subscriptions labeled <b>not covered</b> in your dashboard, you can know immediately when there are newly created subscriptions and make sure they are covered by your policies, and protected by Azure Security Center.</p><p><span><img alt="" src="../Images/1192383-490521.png" width="" height="" /></span></p><p>The advanced monitoring capabilities in Security Center also let you <b>track and manage compliance and governance over time</b>. The <b>overall compliance</b> provides you with a measure of how much your subscriptions are compliant with policies associated with your workload.</p><p><span><img alt="" src="../Images/1192384-490522.png" width="" height="" /></span></p><p><b>Continuous assessments</b></p><p>Security Center continuously discovers new resources that are being deployed across your workloads and assesses whether they are configured according to security best practices, if not, they're flagged and you get a prioritized list of recommendations for what you need to fix in order to protect your machines.</p><p>One of the most powerful tools Security Center provides for continuously monitoring the security status of your network is the <b>Network map</b>. The map enables you to see the topology of your workloads, so you can see if each node is properly configured. You can see how your nodes are connected, which helps you block unwanted connections that could potentially make it easier for an attacker to creep along your network.</p><p><span><img alt="" src="../Images/1192385-490523.png" width="" height="" /></span></p><p>Security Center makes mitigating your security alerts one step easier, by adding a <b>Secure Score</b>. The Secure Scores are now associated with each recommendation you receive to help you understand how important each recommendation is to your overall security posture. This is crucial in enabling you to <b>prioritize your security work</b>.</p><p><span><img alt="" src="../Images/1192386-490524.png" width="" height="" /></span></p><h3 class="da-h3" id="1191969">Query the Activity Log</h3><p><span><img alt="" src="../Images/1192405-490543.png" width="" height="" /></span></p><p>In the Azure portal, you can filter your Activity Log by these fields:</p><ul class="square"><li class="square"><p><b>Subscription</b>. One or more Azure subscription names.</p></li><li class="square"><p><b>Timespan</b>. The start and end time for events.</p></li><li class="square"><p><b>Event Severity</b>. The severity level of the event (Informational, Warning, Error, Critical).</p></li><li class="square"><p><b>Resource group</b>. One or more resource groups within those subscriptions.</p></li><li class="square"><p><b>Resource (name)</b>. The name of a specific resource.</p></li><li class="square"><p><b>Resource type</b>. The type of resource, for example, Microsoft.Compute/virtualmachines.</p></li><li class="square"><p><b>Operation name</b>. The name of an Azure Resource Manager operation, for example, Microsoft.SQL/servers/Write.</p></li><li class="square"><p><b>Event initiated by</b>. The ‘caller,’ or user who performed the operation.</p></li><li class="square"><p><b>Search</b>. This is an open text search box that searches for that string across all fields in all events.</p></li></ul><h4 class="da-h4">Event categories</h4><ul class="square"><li class="square"><p><b>Administrative</b>. This category contains the record of all create, update, delete, and action operations performed through Resource Manager. Examples of the types of events you would observe in this category include “create virtual machine” and "delete network security group". The Administrative category also includes any changes to role-based access control in a subscription.</p></li><li class="square"><p><b>Service Health</b>. This category contains the record of any service health incidents that have occurred in Azure. An example of the type of event you would observe in this category is “SQL Azure in East US is experiencing downtime.” Service health events come in five varieties: Action Required, Assisted Recovery, Incident, Maintenance, Information, or Security.</p></li><li class="square"><p><b>Resource Health</b>. This category contains the record of any resource health events that have occurred to your Azure resources. An example of the type of event you would see in this category is “Virtual Machine health status changed to unavailable.” Resource health events can represent one of four health statuses: Available, Unavailable, Degraded, and Unknown.</p></li><li class="square"><p><b>Alert</b>. This category contains the record of all activations of Azure alerts. An example of the type of event you would observe in this category is “CPU % on myVM has been over 80 for the past 5 minutes.”</p></li><li class="square"><p><b>Autoscale</b>. This category contains the record of any events related to the operation of the autoscale engine based on any autoscale settings you have defined in your subscription. An example of the type of event you would observe in this category is “Autoscale scale up action failed.”</p></li><li class="square"><p><b>Recommendation</b>. This category contains recommendation events from certain resource types, such as web sites and SQL servers. These events offer recommendations for how to better utilize your resources.</p></li><li class="square"><p><b>Security</b>. This category contains the record of any alerts generated by Azure Security Center. An example of the type of event you would observe in this category is “Suspicious double extension file executed.”</p></li><li class="square"><p><b>Policy</b>. This category contains records of all effect action operations performed by Azure Policy. Examples of the types of events you would see in this category include Audit and Deny.</p></li></ul><p>✔️ Once you have defined a set of filters, you can pin the filtered state to the dashboard or download the search results as a CSV file.</p><h3 class="da-h3" id="1191960">Protect Against Threats with Azure Security Center</h3><p>You have the responsibility to dismiss alerts if no action is required, such as if there are false positives. You also need to act to address known attacks and block, for example, known malicious IP addresses. Also, you must decide which alerts require more investigation.</p><p>Security Center gives a centralized view of all your security alerts. Security Center ranks security alerts based on their severity. Security Center also combines related alerts as much as possible into a single security incident.</p><p><span><img alt="" src="../Images/1192197-490335.png" width="" height="" /></span></p><p>Security Center helps you respond to threats faster, and in an automated way, through playbooks. Playbooks are automated procedures that you run against alerts. You configure a playbook in the Playbooks pane of the Azure Security Center menu. You create a playbook by configuring a logic app.</p><p><span><img alt="" src="../Images/1192198-490336.png" width="" height="" /></span></p><p>Your created playbook appears in a list.</p><p><span><img alt="" src="../Images/1192199-490337.png" width="" height="" /></span></p><p>Edit your playbook by selecting it and using the Azure Logic Apps Designer that appears.</p><p><span><img alt="" src="../Images/1192200-490338.png" width="" height="" /></span></p><p>After you create a new blank logic app, you can use the designer to search for Security Center connectors and triggers for your playbook. For example, look for Azure Security Center and see all the triggers you can use. You then choose a trigger that details what should happen when the playbook is triggered.</p><p><span><img alt="" src="../Images/1192201-490339.png" width="" height="" /></span></p><p>You then define actions that should be taken and which conditions must be met for these actions. Your actions can specify that an email should be sent when an alert is triggered.</p><p><span><img alt="" src="../Images/1192202-490340.png" width="" height="" /></span></p><p>View your security alerts through the <b>Security</b> alerts pane under the <span><img alt="" src="../Images/1192197-490335.png" width="" height="" /></span>
section on the main menu.</p><p><span><img alt="" src="../Images/1192203-490341.png" width="" height="" /></span></p><p>You drill down into specific security incidents by selecting an incident.</p><p><span><img alt="" src="../Images/1192204-490342.png" width="" height="" /></span></p><p>From here, you can see the list of alerts that the incident holds. You request more information about a specific alert by selecting one.</p><p><span><img alt="" src="../Images/1192205-490343.png" width="" height="" /></span></p><p>You can then choose to run your configured playbooks against your alert.</p><p>You can further investigate the alert by using the <b>Continue investigation</b> option. An investigation map shows all of the entities that are related to this alert.</p><p><span><img alt="" src="../Images/1192206-490344.png" width="" height="" /></span></p><p>You request more information about a specific entity in the map by selecting it. Entities include devices or even users. The map expands with new entities, and properties for the selected entity are displayed on the right. Use this information to better understand a particular path that an attack might have taken.</p><h3 class="da-h3" id="1191971">Azure Monitor Alerts</h3><p><span><img alt="" src="../Images/1192356-490494.png" width="" height="" /></span></p><p>The Monitor Alerts experience has many benefits.</p><ul class="square"><li class="square"><p><b>Better notification system</b>. All newer alerts use action groups, which are named groups of notifications and actions that can be reused in multiple alerts.</p></li><li class="square"><p><b>A unified authoring experience</b>. All alert creation for metrics, logs and activity log across Azure Monitor, Log Analytics, and Application Insights is in one place.</p></li><li class="square"><p><b>View Log Analytics alerts in Azure portal</b>. You can now also observe Log Analytics alerts in your subscription. Previously these were in a separate portal.</p></li><li class="square"><p><b>Separation of Fired Alerts and Alert Rules</b>.  Alert Rules (the definition of the condition that triggers an alert), and Fired Alerts (an instance of the alert rule firing) are differentiated, so the operational and configuration views are separated.</p></li><li class="square"><p><b>Better workflow</b>. The new alerts authoring experience guides the user along the process of configuring an alert rule, which makes it simpler to discover the right things to get alerted on.</p></li></ul><h4 class="da-h4">Managing Alerts</h4><p>You can alert on metrics and logs as described in monitoring data sources. These include but are not limited to:</p><ul class="square"><li class="square"><p>Metric values</p></li><li class="square"><p>Log search queries</p></li><li class="square"><p>Activity Log events</p></li><li class="square"><p>Health of the underlying Azure platform</p></li><li class="square"><p>Tests for web site availability</p></li></ul><h4 class="da-h4">Alert states</h4><p>You can set the state of an alert to specify where it is in the resolution process. When the criteria specified in the alert rule is met, an alert is created or fired, it has a status of <b>New</b>. You can change the status when you acknowledge an alert and when you close it. All state changes are stored in the history of the alert. The following alert states are supported.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>State</p></td><td><p>Description</p></td></tr></thead><tbody><tr><td><p><b>New</b></p></td><td><p>The issue has just been detected and has not yet been reviewed.</p></td></tr><tr><td><p><b>Acknowledged</b></p></td><td><p>An administrator has reviewed the alert and started working on it.</p></td></tr><tr><td><p><b>Closed</b></p></td><td><p>The issue has been resolved. After an alert has been closed, you can reopen it by changing it to another state.</p></td></tr></tbody></table><p>✔️ Alert state is different and independent of the monitor condition. Alert state is set by the user. Monitor condition is set by the system. When an alert fires, the alert's monitor condition is set to fired. When the underlying condition that caused the alert to fire clears, the monitor condition is set to resolved. The alert state isn't changed until the user changes it.</p><p>For more information, <a href="https://docs.microsoft.com/en-us/azure/monitoring-and-diagnostics/monitoring-overview-unified-alerts" title="" target="_blank">The new alerts experience in Azure Monitor</a></p><h3 class="da-h3" id="1191972">Creating Alert Rules</h3><p>Alerts proactively notify you when important conditions are found in your monitoring data. They allow you to identify and address issues before the users of your system notice them. Alerts consists of alert rules, action groups, and monitor conditions.</p><p><span><img alt="" src="../Images/1192075-490213.png" width="" height="" /></span></p><p>Alert rules are separated from alerts and the actions that are taken when an alert fires. The alert rule captures the target and criteria for alerting. The alert rule can be in an enabled or a disabled state. Alerts only fire when enabled. The key attributes of an alert rule are:</p><ul class="square"><li class="square"><p><b>Target Resource</b> – Defines the scope and signals available for alerting. A target can be any Azure resource. Example targets: a virtual machine, a storage account, a virtual machine scale set, a Log Analytics workspace, or an Application Insights resource. For certain resources (like Virtual Machines), you can specify multiple resources as the target of the alert rule.</p></li><li class="square"><p><b>Signal</b> – Signals are emitted by the target resource and can be of several types. Metric, Activity log, Application Insights, and Log.</p></li><li class="square"><p><b>Criteria</b> – Criteria is a combination of Signal and Logic applied on a Target resource. Examples: * Percentage CPU &gt; 70%; Server Response Time &gt; 4 ms; and Result count of a log query &gt; 100.</p></li><li class="square"><p><b>Alert Name</b> – A specific name for the alert rule configured by the user.</p></li><li class="square"><p><b>Alert Description</b> – A description for the alert rule configured by the user.</p></li><li class="square"><p><b>Severity</b> – The severity of the alert once the criteria specified in the alert rule is met. Severity can range from 0 to 4.</p></li><li class="square"><p><b>Action</b> – A specific action taken when the alert is fired. Tje Action Groups topic is coming up.</p></li></ul><h3 class="da-h3" id="1191973">Action Groups</h3><p>An action group is a collection of notification preferences defined by the owner of an Azure subscription. Azure Monitor and Service Health alerts use action groups to notify users that an alert has been triggered. Various alerts may use the same action group or different action groups depending on the user's requirements.</p><p>When an action is configured to notify a person by email or SMS the person will receive a confirmation indicating they have been added to the action group.</p><p><span><img alt="" src="../Images/1192144-490282.png" width="" height="" /></span></p><ul class="square"><li class="square"><p><b>Automation runbook</b> - An automation runbook is the ability to define, build, orchestrate, manage, and report on workflows that support system and network operational processes. A runbook workflow can potentially interact with all types of infrastructure elements, such as applications, databases, and hardware.</p></li><li class="square"><p><b>Azure Function</b> – Azure functions is a serverless compute service that lets you run event-triggered code without having to explicitly provision or manage infrastructure.</p></li><li class="square"><p><b>Email Azure Resource Manager role</b> – Send email to the members of the subscription's role. Email will only be sent to Azure AD user members of the role. Email will not be sent to Azure AD groups or service principals.</p></li><li class="square"><p><b>Email/SMS/Push/Voice</b> - Specify any email, SMS, push, or voice actions.</p></li><li class="square"><p><b>ITSM</b> – Connect Azure and a supported IT Service Management (ITSM) product/service. This requires an ITSM Connection.</p></li><li class="square"><p><b>Logic App</b> – Logic apps connect your business-critical apps and services by automating your workflows.</p></li><li class="square"><p><b>Webhook</b> – A webhook is a HTTP endpoint that allows external applications to communicate with your system.</p></li></ul><p>✔️ Always check the documentation for the number of actions you can create.</p><h3 class="da-h3" id="1191974">Demonstration - Alerts</h3><p>In this demonstration, we will create an alert rule.</p><p><b>Create an alert rule</b></p><ol class="number"><li><p>In Azure portal, click on <b>Monitor</b>. The Monitor blade consolidates all your monitoring settings and data in one view.</p></li><li><p>Click <b>Alerts</b> then click <b>+ New alert rule</b>. As most resource blades also have Alerts in their resource menu under Monitoring, you could create alerts from there as well.</p></li></ol><p><b>Explore alert targets</b></p><ol class="number"><li><p>Click <b>Select</b> under Target, to select a target resource that you want to alert on. Use <b>Subscription</b> and <b>Resource type</b> drop-downs to find the resource you want to monitor. You can also use the search bar to find your resource.</p></li><li><p>If the selected resource has metrics you can create alerts on, Available signals on the bottom right will include metrics. You can view the full list of resource types supported for metric alerts in this article.</p></li><li><p>Click <b>Done</b> when you have made your selection.</p></li></ol><p><b>Explore alert conditions</b></p><ol class="number"><li><p>Once you have selected a target resource, click on <b>Add condition</b>.</p></li><li><p>You will observe a list of signals supported for the resource, select the metric you want to create an alert on.</p></li><li><p>Optionally, refine the metric by adjusting Period and Aggregation. If the metric has dimensions, the Dimensions table will be presented.</p></li><li><p>Observe a chart for the metric for the last 6 hours. Adjust the <b>Show history</b> drop-down.</p></li><li><p>Define the <b>Alert logic</b>. This will determine the logic which the metric alert rule will evaluate.</p></li><li><p>If you are using a static threshold, the metric chart can help determine what might be a reasonable threshold. If you are using a Dynamic Thresholds, the metric chart will display the calculated thresholds based on recent data.</p></li><li><p>Click <b>Done</b>.</p></li><li><p>Optionally, add another criteria if you want to monitor a complex alert rule.</p></li></ol><p><b>Explore alert details</b></p><ol class="number"><li><p>Fill in Alert details like <b>Alert Rule Name</b>, <b>Description</b> and <b>Severity</b>.</p></li><li><p>Add an action group to the alert either by selecting an existing action group or creating a new action group.</p></li><li><p>Click <b>Done</b> to save the metric alert rule.</p></li></ol><h3 class="da-h3" id="1191976">Log Analytics</h3><p>Log Analytics is a service in that helps you collect and analyze data generated by resources in your cloud and on-premises environments.</p><p>Log queries helps you to fully leverage the value of the data collected in Azure Monitor Logs. A powerful query language allows you to join data from multiple tables, aggregate large sets of data, and perform complex operations with minimal code. Virtually any question can be answered and analysis performed as long as the supporting data has been collected, and you understand how to construct the right query.</p><p>Some features in Azure Monitor such as insights and solutions process log data without exposing you to the underlying queries. To fully leverage other features of Azure Monitor, you should understand how queries are constructed and how you can use them to interactively analyze data in Azure Monitor Logs.</p><p><span><img alt="" src="../Images/1192381-490519.png" width="" height="" /></span></p><h4 class="da-h4">Example 1 - Assessing updates</h4><p>An important part of the daily routine for any IT administrator is assessing systems update requirements and planning patches. Accurate scheduling is critical, as it directly relates to SLAs to the business and can seriously impact business functions. In the past, you had to schedule an update with only limited knowledge of how long the patching would take. Operations Management Suite collects data from all customers performing patches and uses that data to provide an average patching time for specific missing updates. This use of “crowd-sourced” data is unique to cloud systems, and is a great example of how Log Analytics can help meet strict SLAs.</p><h4 class="da-h4">Example 2 - Change tracking</h4><p>Troubleshooting an operational incident is a complex process, requiring access to multiple data streams. With Operations Management Suite, you can easily perform analysis from multiple angles, using data from a wide variety of sources through a single interface for correlation of information. By tracking changes throughout the environment, Log Analytics helps to easily identify things like abnormal behavior from a specific account, users installing unapproved software, unexpected system reboots or shutdowns, evidence of security breaches, or specific problems in loosely coupled applications.</p><h3 class="da-h3" id="1191977">Create a Workspace</h3><p>To get started with Log Analytics you need to add a workspace.</p><p><span><img alt="" src="../Images/1192387-490525.png" width="" height="" /></span></p><ul class="square"><li class="square"><p>Provide a name for the new Log Analyics workspace.</p></li><li class="square"><p>Select a Subscription from the drop-down list.</p></li><li class="square"><p>For Resource Group, select an existing resource group that contains one or more Azure virtual machines.</p></li><li class="square"><p>Select the Location your VMs are deployed to.</p></li><li class="square"><p>The workspace will automatically use the Per GB pricing plan.</p></li></ul><h3 class="da-h3" id="1191978">Connected Sources</h3><p>Connected Sources are the computers and other resources that generate data collected by Log Analytics. This can include agents installed on <a href="https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-windows-agents" title="" target="_blank">Windows</a> and <a href="https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-linux-agents" title="" target="_blank">Linux</a> computers that connect directly or agents in a connected <a href="https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-om-agents" title="" target="_blank">System Center Operations Manager management group</a> . Log Analytics can also collect data from <a href="https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-azure-storage" title="" target="_blank">Azure storage</a>.</p><p><span><img alt="" src="../Images/1192403-490541.png" width="" height="" /></span></p><p>This following diagram shows how Connected Sources flow data to the Log Analytics service.</p><p><span><img alt="" src="../Images/1192404-490542.png" width="" height="" /></span></p><p>Ensure you can locate each of the following.</p><ul class="square"><li class="square"><p>The Log Analytics service (1) collects data and stores it in the repository (2). The repository is hosted in Azure. Connected Sources provide information to the Log Analytics service.</p></li><li class="square"><p>Computer agents (3) generate data to the Log Analytics service. These agents can run on Windows or Linux computers, virtual or physical computers, on-premises or cloud computers, and Azure or other cloud providers.</p></li><li class="square"><p>A System Center Operations Manager (SCOM) management group can be connected to Log Analytics. SCOM agents (4) communicate with management servers which forward events and performance data to Log Analytics.</p></li><li class="square"><p>An Azure storage account (5) can also collect Azure Diagnostics data from a worker role, web role, or virtual machine in Azure. This information can be sent to the Log Analytics service.</p></li></ul><h3 class="da-h3" id="1191979">Data Sources</h3><p>Data sources are the different kinds of data collected from each connected source. These can include events and performance data from Windows and Linux agents, in addition to sources such as IIS logs and custom text logs. You configure each data source that you want to collect, and the configuration is automatically delivered to each connected source.</p><p><span><img alt="" src="../Images/1192379-490517.png" width="" height="" /></span></p><p>When you configure the Log Analytics settings the available data sources are shown. Data sources include: Windows Event Logs, Windows Performance Counters, Linux Performance Counters, IIS Logs, Custom Fields, Custom Logs, and Syslog. Each data source has additional configuration options. For example, the Windows Event Log can be configured to forward Error, Warning, or Informational messages.</p><p><span><img alt="" src="../Images/1192380-490518.png" width="" height="" /></span></p><h3 class="da-h3" id="1191980">Log Analytics Querying</h3><p>Log Analytics provides a query syntax to quickly retrieve and consolidate data in the repository. You can create and save Log Searches to directly analyze data in the portal or have log searches run automatically to create an alert if the results of the query indicate an important condition.</p><p><span><img alt="" src="../Images/1192131-490269.png" width="" height="" /></span></p><p>To give a quick graphical view of the health of your overall environment, you can add visualizations for saved log searches to your dashboard. To analyze data outside of Log Analytics, you can export the data from the repository into tools such as Power BI or Excel. You can also leverage the Log Search API to build custom solutions that leverage Log Analytics data or to integrate with other systems.</p><h3 class="da-h3" id="1191981">Query Language Syntax</h3><p>When you build a query, you start by determining which tables have the data that you're looking for. Each data source and solution stores its data in dedicated tables in the Log Analytics workspace. Documentation for each data source and solution includes the name of the data type that it creates and a description of each of its properties. Many queries will only require data from a single table, but others may use a variety of options to include data from multiple tables.</p><p><span><img alt="" src="../Images/1192406-490544.png" width="" height="" /></span></p><p>Some common query tables are: Event, Syslog, Heartbeat, and Alert.</p><p>The basic structure of a query is a source table followed by a series of operators separated by a pipe character |. You can chain together multiple operators to refine the data and perform advanced functions. For example, this query returns a count of the top 10 errors in the Event log during the last day. The results are in descending order.</p><div class="code"><p class="da-divtext">Event
 | where (EventLevelName == "Error")
 | where (TimeGenerated &gt; ago(1days))
 | summarize ErrorCount = count() by Computer
 | top 10 by ErrorCount desc
</p></div><p>Some common operators are:</p><ul class="square"><li class="square"><p><b>count</b> - Returns the number of records in the input record set.</p></li></ul><div class="code"><p class="da-divtext">StormEvents | count
</p></div><ul class="square"><li class="square"><p><b>limit</b> - Return up to the specified number of rows.</p></li></ul><div class="code"><p class="da-divtext">T | limit 5
</p></div><ul class="square"><li class="square"><p><b>summarize</b> - Produces a table that aggregates the content of the input table.</p></li></ul><div class="code"><p class="da-divtext">T | summarize count(), avg(price) by fruit, supplier
</p></div><ul class="square"><li class="square"><p><b>top</b> - Returns the first N records sorted by the specified columns.</p></li></ul><div class="code"><p class="da-divtext">T | top 5 by Name desc nulls last
</p></div><ul class="square"><li class="square"><p><b>where</b> - Filters a table to the subset of rows that satisfy a predicate.</p></li></ul><div class="code"><p class="da-divtext">T | where fruit=="apple"
</p></div><p>For more information, <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/log-query/query-language" title="" target="_blank">Azure Monitor log queries</a></p><h3 class="da-h3" id="1191983">Network Watcher</h3><p><b>Network Watcher</b> provides tools to <b>monitor</b>, <b>diagnose</b>, view <b>metrics</b>, and enable or disable <b>logs</b> for resources in an Azure virtual network.  Network Watcher is a regional service that enables you to monitor and diagnose conditions at a network scenario level.</p><ul class="square"><li class="square"><p><b>Automate remote network monitoring with packet capture.</b> Monitor and diagnose networking issues without logging in to your virtual machines (VMs) using Network Watcher. Trigger packet capture by setting alerts, and gain access to real-time performance information at the packet level. When you observe an issue, you can investigate in detail for better diagnoses.</p></li><li class="square"><p><b>Gain insight into your network traffic using flow logs</b>. Build a deeper understanding of your network traffic pattern using Network Security Group flow logs. Information provided by flow logs helps you gather data for compliance, auditing and monitoring your network security profile.</p></li><li class="square"><p><b>Diagnose VPN connectivity issues</b>. Network Watcher provides you the ability to diagnose your most common VPN Gateway and Connections issues. Allowing you, not only, to identify the issue but also to use the detailed logs created to help further investigate.</p></li></ul><p><b>Connection monitor</b></p><p>Connection monitor  is a feature of Network Watcher that can monitor communication between a virtual machine and an endpoint. The connection monitor capability monitors communication at a regular interval and informs you of reachability, latency, and network topology changes between the VM and the endpoint.</p><p>For example, you might have a web server VM that communicates with a database server VM. Someone in your organization may, unknown to you, apply a custom route or network security rule to the web server or database server VM or subnet.
If an endpoint becomes unreachable, connection troubleshoot informs you of the reason. Potential reasons might be DNS name resolution problem, the CPU, memory, or firewall within the operating system of a VM, or the hop type of a custom route, or security rule for the VM or subnet of the outbound connection. Connection monitor also provides the minimum, average, and maximum latency observed over time.</p><h4 class="da-h4">Network performance monitor</h4><p>Network performance monitor is a cloud-based hybrid network monitoring solution that helps you monitor network performance between various points in your network infrastructure. It also helps you monitor network connectivity to service and application endpoints and monitor the performance of Azure ExpressRoute. Network performance monitor detects network issues like traffic blackholing, routing errors, and issues that conventional network monitoring methods aren't able to detect. The solution generates alerts and notifies you when a threshold is breached for a network link. It also ensures timely detection of network performance issues and localizes the source of the problem to a particular network segment or device.</p><p>✔️ To use Network Watcher capabilities, the account you log into Azure with, must be assigned to the Owner, Contributor, or Network contributor built-in roles, or assigned to a custom role. A custom role can be given permissions to read, write, and delete the Network Watcher.</p><p>For more information, <a href="https://azure.microsoft.com/en-us/services/network-watcher/" title="" target="_blank">Network Watcher</a></p><h3 class="da-h3" id="1191984">Network Watcher Diagnostics</h3><p><span><img alt="" src="../Images/1192254-490392.png" width="" height="" /></span></p><p><b>Verify IP Flow</b>: Quickly diagnose connectivity issues from or to the internet and from or to the on-premises environment. For example, confirming if a security rule is blocking ingress or egress traffic to or from a virtual machine. IP flow verify is ideal for making sure security rules are being correctly applied. When used for troubleshooting, if IP flow verify doesn’t show a problem, you will need to explore other areas such as firewall restrictions.</p><p><b>Next Hop</b>: To determine if traffic is being directed to the intended destination by showing the next hop. This will help determine if networking routing is correctly configured. Next hop also returns the route table associated with the next hop. If the route is defined as a user-defined route, that route is returned. Otherwise, next hop returns System Route. Depending on your situation the next hop could be Internet, Virtual Appliance, Virtual Network Gateway, VNet Local, VNet Peering, or None. None lets you know that while there may be a valid system route to the destination, there is no next hop to route the traffic to the destination. When you create a virtual network, Azure creates several default outbound routes for network traffic. The outbound traffic from all resources, such as VMs, deployed in a virtual network, are routed based on Azure's default routes. You might override Azure's default routes or create additional routes.</p><p><b>VPN Diagnostics</b>: Troubleshoot gateways and connections. VPN Diagnostics returns a wealth of information. Summary information is available in the portal and more detailed information is provided in log files. The log files are stored in a storage account and include things like connection statistics, CPU and memory information, IKE security errors, packet drops, and buffers and events.</p><p><b>NSG Flow Logs</b>: NSG Flow Logs maps IP traffic through a network security group. These capabilities can be used in security compliance and auditing. You can define a prescriptive set of security rules as a model for security governance in your organization. A periodic compliance audit can be implemented in a programmatic way by comparing the prescriptive rules with the effective rules for each of the VMs in your network.</p><p><b>Connection Troubleshoot</b>. Azure Network Watcher Connection Troubleshoot is a more recent addition to the Network Watcher suite of networking tools and capabilities. Connection Troubleshoot enables you to troubleshoot network performance and connectivity issues in Azure.</p><h3 class="da-h3" id="1191985">Diagnostics - IP Flow Verify</h3><p><b>Verify IP Flow Purpose</b>: Quickly diagnose connectivity issues from or to the internet and from or to the on-premises environment. For example, confirming if a security rule is blocking ingress or egress traffic to or from a virtual machine.</p><p><b>Example</b></p><p>When you deploy a VM, Azure applies several default security rules to the VM that allow or deny traffic to or from the VM. You might override Azure's default rules or create additional rules. At some point, a VM may become unable to communicate with other resources, because of a security rule.</p><p>The IP flow verify capability enables you to specify a source and destination IPv4 address, port, protocol (TCP or UDP), and traffic direction (inbound or outbound). IP flow verify then tests the communication and informs you if the connection succeeds or fails. If the connection fails, IP flow verify tells you which security rule allowed or denied the communication, so that you can resolve the problem.</p><p><span><img alt="" src="../Images/1192104-490242.png" width="" height="" /></span></p><p>✔️ IP flow verify is ideal for making sure security rules are being correctly applied. When used for troubleshooting, if IP flow verify doesn’t show a problem, you will need to explore other areas such as firewall restrictions.</p><h3 class="da-h3" id="1191986">Diagnostics - Next Hop</h3><p><b>Next Hop Purpose</b>: To determine if traffic is being directed to the intended destination by showing the next hop. This will help determine if networking routing is correctly configured.</p><p>When you create a virtual network, Azure creates several default outbound routes for network traffic. The outbound traffic from all resources, such as VMs, deployed in a virtual network, are routed based on Azure's default routes. You might override Azure's default routes or create additional routes.</p><p><b>Example</b></p><p>You may find that a VM can no longer communicate with other resources because of a specific route. The next hop capability enables you to specify a source and destination IPv4 address. Next hop then tests the communication and informs you what type of next hop is used to route the traffic. You can then remove, change, or add a route, to resolve a routing problem.</p><p><span><img alt="" src="../Images/1192089-490227.png" width="" height="" /></span></p><p>Next hop also returns the route table associated with the next hop. If the route is defined as a user-defined route, that route is returned. Otherwise, next hop returns System Route. Depending on your situation the next hop could be Internet, Virtual Appliance, Virtual Network Gateway, VNet Local, VNet Peering, or None. None lets you know that while there may be a valid system route to the destination, there is no next hop to route the traffic to the destination.</p><h3 class="da-h3" id="1191987">Diagnostics - Effective Security Rules</h3><p>If you have several NSGs and are not sure which security rules are being applied, you can examine the Effective security rules.</p><p><span><img alt="" src="../Images/1192286-490424.png" width="" height="" /></span></p><ul class="square"><li class="square"><p><b>Priority</b>. A number between 100 and 4096. Rules are processed in priority order, with lower numbers processed before higher numbers, because lower numbers have higher priority. Once traffic matches a rule, processing stops. As a result, any rules that exist with lower priorities (higher numbers) that have the same attributes as rules with higher priorities are not processed.</p></li><li class="square"><p><b>Source</b>. Any, or an individual IP address, classless inter-domain routing (CIDR) block (10.0.0.0/24, for example), service tag, or application security group. Specifying a range, a service tag, or application security group, enables you to create fewer security rules.</p></li><li class="square"><p><b>Protocol</b>. TCP, UDP, ICMP or Any.</p></li><li class="square"><p><b>Action</b>. Allow or deny.</p></li></ul><h3 class="da-h3" id="1191988">Diagnostics - VPN Troubleshoot</h3><p><b>VPN Troubleshoot Purpose</b>: Troubleshoot gateways and connections.</p><p><b>Example</b></p><p>Virtual Network Gateways provide connectivity between on-premises resources and other virtual networks within Azure. Monitoring gateways and their connections are critical to ensuring communication is working as expected. VPN diagnostics can troubleshoot the health of the gateway, or connection, and provide detailed logging. The request is a long running transaction and results are returned once the diagnosis is complete.</p><p><span><img alt="" src="../Images/1192397-490535.png" width="" height="" /></span></p><p>VPN Troubleshoot returns a wealth of information. Summary information is available in the portal and more detailed information is provided in log files. The log files are stored in a storage account and include things like connection statistics, CPU and memory information, IKE security errors, packet drops, and buffers and events.</p><p>✔️ You can select multiple gateways or connections to troubleshoot simultaneously or you can focus on an individual component.</p><h3 class="da-h3" id="1191989">Diagnostics - Packet Capture</h3><p><span><img alt="" src="../Images/1192031-490169.png" width="" height="" /></span></p><p>Network Watcher packet capture allows you to create capture sessions to track traffic to and from a virtual machine. Filters are provided for the capture session to ensure you capture only the traffic you want. Packet capture helps to diagnose network anomalies, both reactively, and proactively. Other uses include gathering network statistics, gaining information on network intrusions, to debug client-server communication, and much more. Being able to remotely trigger packet captures, eases the burden of running a packet capture manually on a desired virtual machine, which saves valuable time.</p><h3 class="da-h3" id="1191990">Diagnostics - Connection Troubleshoot</h3><p>The connection troubleshoot feature of Network Watcher provides the capability to check a direct TCP connection from a virtual machine to a virtual machine (VM), fully qualified domain name (FQDN), URI, or IPv4 address. Network scenarios are complex, they are implemented using network security groups, firewalls, user-defined routes, and resources provided by Azure. Complex configurations make troubleshooting connectivity issues challenging. Network Watcher helps reduce the amount of time to find and detect connectivity issues. The results returned can provide insights into whether a connectivity issue is due to a platform or a user configuration issue.</p><p><span><img alt="" src="../Images/1192378-490516.png" width="" height="" /></span></p><p>Further examples of different supported network troubleshooting scenarios include:</p><ul class="square"><li class="square"><p>Checking the connectivity and latency to a remote endpoint, such as for websites and storage endpoints.</p></li><li class="square"><p>Connectivity between an Azure VM and an Azure resource like Azure SQL server, where all Azure traffic is tunneled through an on-premises network.</p></li><li class="square"><p>Connectivity between VMs in different VNets connected using VNet peering.</p></li></ul><h3 class="da-h3" id="1191991">Logs - NSG Flow Logs</h3><p>NSG flow logs allows you to view information about ingress and egress IP traffic through an NSG. Flow logs are written in JSON format and show outbound and inbound flows on a per rule basis. The JSON format can be visually displayed in Power BI or third-party tools like Kibana.</p><p><span><img alt="" src="../Images/1192426-490564.png" width="" height="" /></span></p><p>✔️ This feature now supports (January 2020) firewalled storage accounts and service endpoints for storage.</p><h3 class="da-h3" id="1191992">Monitoring - Topology</h3><p>Suppose you have to troubleshoot a virtual network created by your colleagues. Unless you were involved in the creation process of the network, you might not know about all the aspects of the infrastructure. You can use the topology tool to visualize and understand the infrastructure you're dealing with before you start troubleshooting.</p><p>Network Watcher's Topology capability enables you to generate a visual diagram of the resources in a virtual network, and the relationships between the resources. The following picture shows an example topology diagram for a virtual network that has three subnets, two VMs, network interfaces, public IP addresses, network security groups, route tables, and the relationships between the resources:</p><p><span><img alt="" src="../Images/1192229-490367.png" width="" height="" /></span></p><p>The topology tool generates a graphical display of your Azure virtual network, its resources, its interconnections, and their relationships with each other.</p><p>✔️ To generate the topology, you need a Network Watcher instance in the same region as the virtual network.</p><h3 class="da-h3" id="1191994">Azure Service Health</h3><p><span><img alt="" src="../Images/1192248-490386.png" width="" height="" /></span></p><p>Azure offers a suite of experiences to keep you informed about the health of your cloud resources. This information includes current and upcoming issues such as service impacting events, planned maintenance, and other changes that may affect your availability.</p><p>Azure Service Health is a combination of three separate smaller services.</p><p><b>Azure status</b> informs you of service outages in Azure on the Azure Status page. The page is a global view of the health of all Azure services across all Azure regions. The status page is a good reference for incidents with widespread impact, but we strongly recommend that current Azure users leverage Azure service health to stay informed about Azure incidents and maintenance.</p><p><b>Azure service health</b> provides a personalized view of the health of the Azure services and regions you're using. This is the best place to look for service impacting communications about outages, planned maintenance activities, and other health advisories because the authenticated Azure Service Health experience knows which services and resources you currently use. The best way to use Service Health is to set up Service Health alerts to notify you via your preferred communication channels when service issues, planned maintenance, or other changes may affect the Azure services and regions you use.</p><p><b>Azure resource health</b> provides information about the health of your individual cloud resources such as a specific virtual machine instance. Using Azure Monitor, you can also configure alerts to notify you of availability changes to your cloud resources. Azure Resource Health along with Azure Monitor notifications will help you stay better informed about the availability of your resources minute by minute and quickly assess whether an issue is due to a problem on your side or related to an Azure platform event.</p><p>Together, these experiences provide you with a comprehensive view into the health of Azure, at the granularity that is most relevant to you.</p><p><b>Note</b>:
This service supports <a href="https://docs.microsoft.com/en-us/azure/lighthouse/concepts/azure-delegated-resource-management" title="" target="_blank">Azure delegated resource management</a>, which lets service providers sign in to their own tenant to manage subscriptions and resource groups that customers have delegated.</p><h3 class="da-h3" id="1191995">Azure Status Page</h3><p>Azure status provides you with a global view of the health of Azure services and regions. With Azure status, you can get information on service availability. Azure status is available to everyone to view all services that report their service health, as well as incidents with wide-ranging impact. If you're a current Azure user, however, we strongly encourage you to use the personalized experience in Azure Service Health. Azure Service Health includes all outages, upcoming planned maintenance activities, and service advisories.</p><p><span><img alt="" src="../Images/1192070-490208.png" width="" height="" /></span></p><p><b>Azure status updates</b></p><p>The Azure status page gets updated in real time as the health of Azure services change. If you leave the Azure status page open, you can control the rate at which the page refreshes with new data. At the top, you can see the last time the page was updated.</p><p><b>Azure status history</b></p><p>While the Azure status page always shows the latest health information, you can view older events using the Azure status history page.</p><h3 class="da-h3" id="1191996">Service Health  Walkthrough</h3><p><span><img alt="" src="../Images/1192248-490386.png" width="" height="" /></span></p><p>Service Health provides you with a customizable dashboard which tracks the health of your Azure services in the regions where you use them. In this dashboard, you can track active events like ongoing service issues, upcoming planned maintenance, or relevant health advisories. When events become inactive, they get placed in your health history for up to 90 days. Finally, you can use the Service Health dashboard to create and manage service health alerts which proactively notify you when service issues are affecting you.</p><p><b>Service Health Events</b></p><p>Service Health tracks four types of health events that may impact your resources:</p><ol class="number"><li><p><b>Service issues</b> - Problems in the Azure services that affect you right now.</p></li><li><p><b>Planned maintenance</b> - Upcoming maintenance that can affect the availability of your services in the future.</p></li><li><p><b>Health advisories</b> - Changes in Azure services that require your attention. Examples include deprecation of Azure features or upgrade requirements (e.g upgrade to a supported PHP framework).</p></li><li><p><b>Security advisories</b> - Security related notifications that may affect the availability of your Azure services.</p></li></ol><p>✔️<b>Note:</b>
To view Service Health events, users must be granted the Reader role on a subscription.</p><p><b>Get started with Service Health</b></p><p>To launch your Service Health dashboard, select the Service Health tile on your portal dashboard. If you have previously removed the tile or you're using custom dashboard, search for Service Health service in “More services” (bottom left on your dashboard).</p><p><b>See current issues which impact your services</b></p><p>The Service issues view shows any ongoing problems in Azure services that are impacting your resources. You can understand when the issue began, and what services and regions are impacted. You can also read the most recent update to understand what Azure is doing to resolve the issue.</p><p><span><img alt="" src="../Images/1192249-490387.png" width="" height="" /></span></p><p>Choose the Potential impact tab to see the specific list of resources you own that might be impacted by the issue. You can download a CSV list of these resources to share with your team.</p><p><span><img alt="" src="../Images/1192250-490388.png" width="" height="" /></span></p><p><b>Get links and downloadable explanations</b></p><p>You can get a link for the issue to use in your problem management system. You can download PDF and sometimes CSV files to share with people who don't have access to the Azure portal.</p><p><span><img alt="" src="../Images/1192251-490389.png" width="" height="" /></span></p><p><b>Get support from Microsof</b>t</p><p>Contact support if your resource is left in a bad state even after the issue is resolved. Use the support links on the right of the page.</p><p><b>Pin a personalized health map to your dashboard</b></p><p>Filter Service Health to show your business-critical subscriptions, regions, and resource types. Save the filter and pin a personalized health world map to your portal dashboard.</p><p><span><img alt="" src="../Images/1192252-490390.png" width="" height="" /></span></p><p><span><img alt="" src="../Images/1192253-490391.png" width="" height="" /></span></p><p><b>Configure service health alerts</b></p><p>Service Health integrates with Azure Monitor to alert you via emails, text messages, and webhook notifications when your business-critical resources are impacted. Set up an activity log alert for the appropriate service health event. Route that alert to the appropriate people in your organization using Action Groups.</p><h3 class="da-h3" id="1191997">Resource Health Overview</h3><p>Azure Resource Health helps you diagnose and get support for service problems that affect your Azure resources. It reports on the current and past health of your resources.</p><p>Azure status reports on service problems that affect a broad set of Azure customers. Resource Health gives you a personalized dashboard of the health of your resources. Resource Health shows all the times that your resources have been unavailable because of Azure service problems. This data makes it easy for you to see if an SLA was violated.</p><p><b>Resource definition and health assessment</b></p><p>A resource is a specific instance of an Azure service, such as a virtual machine, web app, or SQL database. Resource Health relies on signals from different Azure services to assess whether a resource is healthy. If a resource is unhealthy, Resource Health analyzes additional information to determine the source of the problem. It also reports on actions that Microsoft is taking to fix the problem and identifies things that you can do to address it.</p><p><b>Health status</b></p><p>The health of a resource is displayed as one of the following statuses.</p><p><b>Available</b></p><p>Available means that there are no events detected that affect the health of the resource. In cases where the resource recovered from unplanned downtime during the last 24 hours, you'll see a “Recently resolved” notification.</p><p><span><img alt="" src="../Images/1192148-490286.png" width="" height="" /></span></p><p><b>Unavailable</b></p><p>Unavailable means that the service detected an ongoing platform or non-platform event that affects the health of the resource.</p><p><b>Platform events</b></p><p>Platform events are triggered by multiple components of the Azure infrastructure. They include both scheduled actions (for example, planned maintenance) and unexpected incidents (for example, an unplanned host reboot or degraded host hardware that is predicted to fail after a specified time window).</p><p>Resource Health provides additional details about the event and the recovery process. It also enables you to contact Microsoft Support even if you don't have an active support agreement.</p><p><span><img alt="" src="../Images/1192149-490287.png" width="" height="" /></span></p><p><b>Non-platform events</b></p><p>Non-platform events are triggered by user actions. Examples include stopping a virtual machine or reaching the maximum number of connections to Azure Cache for Redis.</p><p><span><img alt="" src="../Images/1192150-490288.png" width="" height="" /></span></p><p><b>Unknown</b></p><p>Unknown means that Resource Health hasn't received information about the resource for more than 10 minutes. Although this status isn't a definitive indication of the state of the resource, it's an important data point for troubleshooting.</p><p>If the resource is running as expected, the status of the resource will change to Available after a few minutes.</p><p>If you experience problems with the resource, the Unknown health status might mean that an event in the platform is affecting the resource.</p><p><span><img alt="" src="../Images/1192151-490289.png" width="" height="" /></span></p><p><b>Degraded</b></p><p>Degraded means that your resource detected a loss in performance, although it's still available for use.</p><p>Different resources have their own criteria for when they report that they are degraded.</p><p><span><img alt="" src="../Images/1192152-490290.png" width="" height="" /></span></p><p><b>Reporting an incorrect status</b></p><p>If you think that the current health status is incorrect, you can tell us by selecting Report incorrect health status. In cases where an Azure problem is affecting you, we encourage you to contact Support from Resource Health.</p><p><span><img alt="" src="../Images/1192153-490291.png" width="" height="" /></span></p><p><b>History information</b></p><p>You can access up to 30 days of history in the Health history section of Resource Health.</p><p><span><img alt="" src="../Images/1192154-490292.png" width="" height="" /></span></p><h3 class="da-h3" id="1191999">Azure Workbooks Overview</h3><p>Workbooks provide a flexible canvas for data analysis and the creation of rich visual reports within the Azure portal. They allow you to tap into multiple data sources from across Azure and combine them into unified interactive experiences.</p><p><b>Data sources</b></p><p>Workbooks can query data from multiple sources within Azure. Authors of workbooks can transform this data to provide insights into the availability, performance, usage, and overall health of the underlying components. For instance, analyzing performance logs from virtual machines to identify high CPU or low memory instances and displaying the results as a grid in an interactive report.</p><p>But the real power of workbooks is the ability to combine data from disparate sources within a single report. This allows for the creation of composite resource views or joins across resources enabling richer data and insights that would otherwise be impossible.</p><p>Workbooks are currently compatible with the following data sources:</p><ul class="square"><li class="square"><p>Logs</p></li><li class="square"><p>Metrics</p></li><li class="square"><p>Azure Resource Graph</p></li><li class="square"><p>Alerts (Preview)</p></li><li class="square"><p>Workload Health (Preview)</p></li><li class="square"><p>Azure Resource Health (Preview)</p></li><li class="square"><p>Azure Data Explorer (Preview)</p></li></ul><p><b>Visualizations</b></p><p>Workbooks provide a rich set of capabilities for visualizing your data. For detailed examples of each visualization type you can consult the example links below:</p><ul class="square"><li class="square"><p>Text</p></li><li class="square"><p>Charts</p></li><li class="square"><p>Grids</p></li><li class="square"><p>Tiles</p></li><li class="square"><p>Trees</p></li><li class="square"><p>Graphs</p></li></ul><p><span><img alt="" src="../Images/1192050-490188.png" width="" height="" /></span></p><h3 class="da-h3" id="1192000">Using Azure Workbooks</h3><p>To explore the workbooks experience, first navigate to the Azure Monitor service. This can be done by typing <b>Monitor</b> into the search box in the Azure portal.</p><p>Then select <b>Workbooks</b>.</p><p><span><img alt="" src="../Images/1192398-490536.png" width="" height="" /></span></p><p><b>Gallery</b></p><p>This takes you to the workbooks gallery:</p><p><span><img alt="" src="../Images/1192399-490537.png" width="" height="" /></span></p><p><b>Workbooks versus workbook templates</b></p><p>You can see a <i>workbook</i> in green and a number of <i>workbook templates</i> in purple. Templates serve as curated reports that are designed for flexible reuse by multiple users and teams. Opening a template creates a transient workbook populated with the content of the template.</p><p>You can adjust the template-based workbook's parameters and perform analysis without fear of breaking the future reporting experience for colleagues. If you open a template, make some adjustments, and then select the save icon you will be saving the template as a workbook which would then show in green leaving the original template untouched.</p><p>Under the hood, templates also differ from saved workbooks. Saving a workbook creates an associated Azure Resource Manager resource, whereas the transient workbook created when just opening a template has no unique resource associated with it.</p><p><b>Exploring a workbook template</b></p><p>Select <b>Application Failure Analysis</b> to see one of the default application workbook templates.</p><p>As stated previously, opening the template creates a temporary workbook for you to be able to interact with. By default, the workbook opens in reading mode which displays only the information for the intended analysis experience that was created by the original template author.</p><p>In the case of this particular workbook, the experience is interactive. You can adjust the subscription, targeted apps, and the time range of the data you want to display. Once you have made those selections the grid of HTTP Requests is also interactive whereby selecting an individual row will change what data is rendered in the two charts at the bottom of the report.</p><p><b>Editing mode</b></p><p>To understand how this workbook template is put together you need to swap to editing mode by selecting <b>Edit</b>.</p><p><span><img alt="" src="../Images/1192400-490538.png" width="" height="" /></span></p><p>Once you have switched to editing mode you will notice a number of Edit boxes appear to the right corresponding with each individual aspect of your workbook.</p><p><span><img alt="" src="../Images/1192401-490539.png" width="" height="" /></span></p><p>If we select the edit button immediately under the grid of request data we can see that this part of our workbook consists of a Kusto query against data from an Application Insights resource.</p><p><span><img alt="" src="../Images/1192402-490540.png" width="" height="" /></span></p><p>Clicking the other <b>Edit</b> buttons on the right will reveal a number of the core components that make up workbooks like markdown-based text boxes, parameter selection UI elements, and other chart/visualization types.</p><p>Exploring the pre-built templates in edit-mode and then modifying them to fit your needs and save your own custom workbook is an excellent way to start to learn about what is possible with Azure Monitor workbooks.</p><h3 class="da-h3" id="1192002">Integrate Application Insight</h3><p>To integrate Application Insights with your applications, you set up an Application Insights resource in the Azure portal. You also install an instrumentation package in your application. The package will monitor your application and send log data to the Log Analytics workspace.</p><p>For example, in your JavaScript web applications, you use a Node.js SDK as the instrumentation package. You need the Application Insights resource's instrumentation key from the Azure portal. You're going to use the key in your application's code.</p><p><span><img alt="" src="../Images/1192079-490217.png" width="" height="" /></span></p><p>You then need to add the Node.js library via the package.json file as a dependency, by using npm.</p><div class="code language-bash"><p class="da-divtext"><code><span class="token function">npm</span> <span class="token function">install</span> applicationinsights --save</code></p></div><p>Your code needs to load the library. You load it before everything else, including other require statements. You need to add the following code to your top-level .js file:</p><div class="code language-javascript"><p class="da-divtext"><code><span class="token keyword">const</span> appInsights <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"applicationinsights"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

appInsights<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span><span class="token string">"&lt;your-instrumentation_key&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

appInsights<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></p></div><p>You also use the environment variable APPINSIGHTS_INSTRUMENTATIONKEY to hold your key. The environment variable helps keep the key invisible in commits when you're using version control.</p><p>The SDK automatically gathers data about your Node.js runtime as you use your application. You can view this data in the Application Insights dashboard, in the Azure portal. From there you can, for example, get a list of all failures that have been collected and drill down into each one.</p><p><span><img alt="" src="../Images/1192080-490218.png" width="" height="" /></span></p><p>The SDK also analyzes your application for a typology. You see this typology through the Application map option. View more details of each component in the map by selecting it. You can, among other things, view the slowest requests for an instance and investigate performance further. These detailed analytics help you understand the application better and respond to its needs.</p><p><span><img alt="" src="../Images/1192081-490219.png" width="" height="" /></span></p><h3 class="da-h3" id="1192003">Monitor Applications Continuously</h3><p>Application Insights can send alerts for issues like failures or unavailability of your application. You can create availability tests to monitor the health of your applications continuously. Availability tests allow you to check the health of your application from different geographic locations.</p><p><span><img alt="" src="../Images/1192271-490409.png" width="" height="" /></span></p><p>You can create an availability test in the Azure portal. You need to specify details like the frequency, the URL of your application, and locations from which to test it.</p><p><span><img alt="" src="../Images/1192272-490410.png" width="" height="" /></span></p><p>The preceding example shows the configuration of a test that will send a request to an application every five minutes. The test is done from five geographic locations.</p><p>You also need to configure an alert rule for your availability test. Use alert rules to dictate how alerts should be handled for your tests.</p><p><span><img alt="" src="../Images/1192273-490411.png" width="" height="" /></span></p><p>You specify the conditions that should trigger an alert. For example, Application Insights can send an alert if a certain number of locations are unavailable. And you specify who should be notified. Send notifications through email or text message. Or use runbooks and webhooks to respond to alerts in an automated way.</p><p><span><img alt="" src="../Images/1192274-490412.png" width="" height="" /></span></p><p>When you've created your availability test, you'll see how your application is doing across different locations. Each dot in the preceding example represents a test that was run. A red dot means that a test failed. You can find more information about a failed test when you select a dot.</p><p><span><img alt="" src="../Images/1192275-490413.png" width="" height="" /></span></p><p>You'll then see a detailed breakdown of the test failure, including information on what might have caused it. Use the information to respond appropriately.</p><h3 class="da-h3" id="1192005">Unified Metrics and Logs</h3><p>Azure Monitor centralizes and combines your metrics and log data from different sources. In the following diagram, the left side shows the sources that Azure Monitor supports. The right side shows what Azure Monitor lets you do with the data collected from those sources. You can analyze data, respond to alerts, and visualize by using different tools.</p><p><span><img alt="" src="../Images/1192357-490495.png" width="" height="" /></span></p><p>Additionally, you can run a single query over the logs collected from your services. You can then analyze log data collected from several sources, and have a unified understanding of all of your data.</p><p>Azure Monitor requires little to no configuration to get started. For example, Azure Monitor automatically makes log data available to you from your virtual machines. That's because the Log Analytics Agent in Azure Security Center automatically collects all the data into a workspace for Azure Monitor. The agent is enabled and deployed on all your virtual machines through a switch on the portal.</p><h3 class="da-h3" id="1192006">Integration with Azure Security Center</h3><p>Azure Security Center collects data from resources such as virtual machines by using the Log Analytics Agent. The agent gathers security-related information from resources like virtual machines and puts it into a workspace that you can use for analysis. Information such as operating system logs and running processes are copied to the workspace, along with any crash dump files. Your workspace consists of multiple tables, each of which stores data from a specific source.</p><p>The Log Analytics Agent can be installed automatically on all virtual machines. You'll need to set automatic provisioning to On in Azure Security Center under Settings - Data Collection.</p><p><span><img alt="" src="../Images/1192394-490532.png" width="" height="" /></span></p><p>From that point, your data will be stored in a Log Analytics workspace. A workspace is created for you, or you choose an existing one.</p><p>A workspace can be used with multiple subscriptions. You can gather data from machines across multiple subscriptions and analyze it together from one central location.</p><p>You can analyze log data in workspaces by using Log Analytics. Log Analytics is an interactive tool in Azure that you use to write and test queries for your logs, and analyze results.</p><p><span><img alt="" src="../Images/1192395-490533.png" width="" height="" /></span></p><h3 class="da-h3" id="1192007">Integration with Application Insights</h3><p>Azure Application Insights and Azure Monitor come integrated. Your Application Insights data is collected and stored in logs that you can view and analyze by using Log Analytics. You can open Log Analytics from Application Insights by selecting <b>Analytics</b> from the <b>Overview</b> pane of your application.</p><p><span><img alt="" src="../Images/1192407-490545.png" width="" height="" /></span></p><p>From here, you create and run queries on your logs and view results.</p><p>Queries for logs are written in the Kusto query language (KQL). A KQL query might look like this:</p><div class="code language-Kusto"><p class="da-divtext">SecurityEvent

| where TimeGenerated &gt; ago(7d)

| where EventID == 12345

| summarize count() by Computer, bin(TimeGenerated, 1h)

| render timechart
</p></div><p>This query filters for specific records based on how long ago an event was generated and renders the summarized result to a time chart.</p><p>You can use a cross-resource query to analyze the log data collected from other sources such as Security Center, together with your Application Insights data. Use a cross-resource query to gain a deeper understanding of your applications and environment.</p><p><span><img alt="" src="../Images/1192408-490546.png" width="" height="" /></span></p><p>Your cross-resource query might look like this:</p><div class="code language-Kusto"><p class="da-divtext">union Update, workspace("contosofinance-it").Update, workspace("c65g7445-914x-4h7j-6nbv-w876499056").Update

| where TimeGenerated &gt;= ago(24h)

| where UpdateState == "Needed"

| summarize dcount(Computer) by Classification
</p></div><p>You reference workspaces by using <span class="code">workspace()</span>.</p><p>Cross-resource querying can result in complex queries. Saving your query as a function in Log Analytics will help you reduce the complexity of your query structure.</p><p>The following query checks workspaces from multiple applications for requests. The query is saved as a function.</p><p><span><img alt="" src="../Images/1192409-490547.png" width="" height="" /></span></p><p>From this point on, we can use this function for cross-resource querying. In the following cross-resource query, the returned result for applicationsFunction is further filtered by the new query for any requests that have failed.</p><p><span><img alt="" src="../Images/1192410-490548.png" width="" height="" /></span></p><p>The query renders its results to a time chart.</p><p><span><img alt="" src="../Images/1192411-490549.png" width="" height="" /></span></p><h3 class="da-h3" id="1192008">Azure Security Center</h3><p>Azure Security Center is a unified infrastructure security management system that strengthens the security posture of your data centers, and provides advanced threat protection across your hybrid workloads in the cloud - whether they're in Azure or not - as well as on premises.</p><p>Keeping your resources safe is a joint effort between your cloud provider, Azure, and you, the customer. You have to make sure your workloads are secure as you move to the cloud, and at the same time, when you move to IaaS (infrastructure as a service) there is more customer responsibility than there was in PaaS (platform as a service), and SaaS (software as a service). Azure Security Center provides you the tools needed to harden your network, secure your services and make sure you're on top of your security posture.</p><p><b>Azure Security Center addresses the three most urgent security challenges:</b></p><ul class="square"><li class="square"><p>Rapidly changing workloads – It's both a strength and a challenge of the cloud. On the one hand, end users are empowered to do more. On the other, how do you make sure that the ever-changing services people are using and creating are up to your security standards and follow security best practices?</p></li><li class="square"><p>Increasingly sophisticated attacks - Wherever you run your workloads, the attacks keep getting more sophisticated. You have to secure your public cloud workloads, which are, in effect, an Internet facing workload that can leave you even more vulnerable if you don't follow security best practices.</p></li><li class="square"><p>Security skills are in short supply - The number of security alerts and alerting systems far outnumbers the number of administrators with the necessary background and experience to make sure your environments are protected. Staying up-to-date with the latest attacks is a constant challenge, making it impossible to stay in place while the world of security is an ever-changing front.</p></li></ul><p><b>To help you protect yourself against these challenges, Security Center provides you with the tools to:</b></p><ul class="square"><li class="square"><p>Strengthen security posture: Security Center assesses your environment and enables you to understand the status of your resources, and whether they are secure.</p></li><li class="square"><p>Protect against threats: Security Center assesses your workloads and raises threat prevention recommendations and security alerts.</p></li><li class="square"><p>Get secure faster: In Security Center, everything is done in cloud speed. Because it is natively integrated, deployment of Security Center is easy, providing you with autoprovisioning and protection with Azure services.</p></li></ul><p><b>Architecture</b></p><p>Because Security Center is natively part of Azure, PaaS services in Azure - including Service Fabric, SQL databases, and storage accounts - are monitored and protected by Security Center without necessitating any deployment.</p><p>In addition, Security Center protects non-Azure servers and virtual machines in the cloud or on premises, for both Windows and Linux servers, by installing the Log Analytics agent on them. Azure virtual machines are auto-provisioned in Security Center.</p><p>The events collected from the agents and from Azure are correlated in the security analytics engine to provide you tailored recommendations (hardening tasks), that you should follow to make sure your workloads are secure, and security alerts. You should investigate such alerts as soon as possible to make sure malicious attacks aren't taking place on your workloads.</p><p>When you enable Security Center, the security policy built-in to Security Center is reflected in Azure Policy as a built in initiative under Security Center category. The built-in initiative is automatically assigned to all Security Center registered subscriptions (Free or Standard tiers). The built-in initiative contains only Audit policies.</p><p>You'll provide information on how to protect resources and respond to threats by using Azure Security Center.</p><p><b>Criteria for assessing Azure Security Center</b></p><p>You use Security Center if:</p><ul class="square"><li class="square"><p>You want to identify and address risks and threats to your infrastructure.</p></li><li class="square"><p>You don't have the traditional in-house skills and capital needed to secure a complex infrastructure.</p></li><li class="square"><p>You want to secure an infrastructure that consists of on-premises and cloud resources.</p></li></ul><p><b>Understand the security posture of your architecture</b></p><p>Security Center gives detailed analyses of different components of your environment. These components include data security, network security, identity and access, and application security. This way, Security Center helps you understand the security of your architecture. You can then build and maintain better infrastructures.</p><p><span><img alt="" src="../Images/1192172-490310.png" width="" height="" /></span></p><p>Security Center recommends how to address the issues and risks that it has uncovered. You use recommendations like the following one to improve the security and compliance of your architecture.</p><p><span><img alt="" src="../Images/1192173-490311.png" width="" height="" /></span></p><h3 class="da-h3" id="1192009">Protect Against Threats with Azure Security Center</h3><p>You have the responsibility to dismiss alerts if no action is required, such as if there are false positives. You also need to act to address known attacks and block, for example, known malicious IP addresses. Also, you must decide which alerts require more investigation.</p><p>Security Center gives a centralized view of all your security alerts. Security Center ranks security alerts based on their severity. Security Center also combines related alerts as much as possible into a single security incident.</p><p><span><img alt="" src="../Images/1192197-490335.png" width="" height="" /></span></p><p>Security Center helps you respond to threats faster, and in an automated way, through playbooks. Playbooks are automated procedures that you run against alerts. You configure a playbook in the Playbooks pane of the Azure Security Center menu. You create a playbook by configuring a logic app.</p><p><span><img alt="" src="../Images/1192198-490336.png" width="" height="" /></span></p><p>Your created playbook appears in a list.</p><p><span><img alt="" src="../Images/1192199-490337.png" width="" height="" /></span></p><p>Edit your playbook by selecting it and using the Azure Logic Apps Designer that appears.</p><p><span><img alt="" src="../Images/1192200-490338.png" width="" height="" /></span></p><p>After you create a new blank logic app, you can use the designer to search for Security Center connectors and triggers for your playbook. For example, look for Azure Security Center and see all the triggers you can use. You then choose a trigger that details what should happen when the playbook is triggered.</p><p><span><img alt="" src="../Images/1192201-490339.png" width="" height="" /></span></p><p>You then define actions that should be taken and which conditions must be met for these actions. Your actions can specify that an email should be sent when an alert is triggered.</p><p><span><img alt="" src="../Images/1192202-490340.png" width="" height="" /></span></p><p>View your security alerts through the <b>Security</b> alerts pane under the <span><img alt="" src="../Images/1192197-490335.png" width="" height="" /></span>
section on the main menu.</p><p><span><img alt="" src="../Images/1192203-490341.png" width="" height="" /></span></p><p>You drill down into specific security incidents by selecting an incident.</p><p><span><img alt="" src="../Images/1192204-490342.png" width="" height="" /></span></p><p>From here, you can see the list of alerts that the incident holds. You request more information about a specific alert by selecting one.</p><p><span><img alt="" src="../Images/1192205-490343.png" width="" height="" /></span></p><p>You can then choose to run your configured playbooks against your alert.</p><p>You can further investigate the alert by using the <b>Continue investigation</b> option. An investigation map shows all of the entities that are related to this alert.</p><p><span><img alt="" src="../Images/1192206-490344.png" width="" height="" /></span></p><p>You request more information about a specific entity in the map by selecting it. Entities include devices or even users. The map expands with new entities, and properties for the selected entity are displayed on the right. Use this information to better understand a particular path that an attack might have taken.</p><h3 class="da-h3" id="1192011">Monitoring Azure Costs</h3><p>Cost monitoring is about establishing controls and business processes for reviewing your cloud spend to avoid any misuse and take advantage of new opportunities through flexibility provided by the cloud. Effective ongoing cost management includes informed cost reviews with key stakeholders. Reviews should be scheduled on a regular cadence. You may also need to have reactive cost reviews, for example when a budget limit causes an alert.</p><p><b>Identify stakeholders</b></p><p>Which of your regular financial stakeholders need visibility and input for your cloud costs? Do they understand cloud billing, capabilities, and business benefits to enable them to understand both the financial metrics and the impact of their decisions? Consider what additional knowledge or training they may need to help them understand cloud cost metering and cloud architectures.</p><p>Which additional stakeholders also need to be present? This could include key application owners, systems administrators who monitor and back-up cloud systems, and business unit representatives.</p><p>Which other stakeholders may be required but only when necessary? Are your resources appropriately tagged so you can easily identify owners of systems or applications that are contributing to cost noise? Are they aware that their participation in cost reviews may be required and what is expected of them?</p><p><b>Determine frequency</b></p><p>You may have regular business reviews where it would make sense to also review, or you may wish to schedule an additional meeting. Cloud costs can be reviewed:</p><ul class="square"><li class="square"><p>During the billing period for an awareness of the estimated pending billing.</p></li><li class="square"><p>After the billing period to review actual spend with activity that occurred that month</p></li><li class="square"><p>On an ad-hoc basis – usually triggered by a <a href="https://docs.microsoft.com/azure/cost-management/cost-mgt-alerts-monitor-usage-spending" title="" target="_blank">budget alert</a> or Azure Advisor recommendation.</p></li></ul><p>Web Direct (pay as you go) and CSP billing occurs monthly. While Enterprise Agreement (EA) billing occurs annually, costs should still be reviewed monthly.</p><p><b>Responding to cost alerts</b></p><p>Check the current consumption data first. Budget alerts do not fire in real time and there may be a delay (up to 8 hrs) between this alert and your current actual cost. Check for any significant difference between when the alert happened and your current costs.</p><p>Are the costs due to unnecessary or expensive resources? Do you need to implement additional Azure Policy controls to prevent this in the future? Do you need to add <a href="https://docs.microsoft.com/azure/billing/billing-cost-management-budget-scenario" title="" target="_blank">budget automation</a> to trigger resource scaling or shutdowns?</p><p><b>Define budgets</b></p><p>After you identify and analyze your spending patterns, you can set budget limits for applications or business units. You will want to assign access to view or manage each budget to the appropriate groups. Setting several alert thresholds for each budget can help track your burn down rate.</p><p><b>Gather information</b></p><p>It's natural to reach for the invoice as the soled basis for your costs. Stakeholders should review this information in relation to other data and events. Identify the business data that's relevant to your cost conversation to ensure that all factors are considered.</p><p>In addition to usage details on your invoice, Azure provides tools that can make recommendations on cost savings. It's important to consider building custom solutions to maximize cost savings where it makes sense for your business.</p><p><b>Azure Cost Management – Cost Analysis</b></p><p>Cost Analysis allows you to view aggregated costs to understand your spending trends. Spending can be viewed by time period against your budgets. You can also view costs at different scopes, such as for a resource group or specific resource tag. Cost Analysis provides built-in charts as well as custom views. You can also download your cost data in CSV format to analyze with other tools. For more information, see: <a href="https://docs.microsoft.com/azure/cost-management/quick-acm-cost-analysis" title="" target="_blank">quick acm cost analysis</a></p><p><b>Azure Cost Management - Advisor</b></p><p>Advisor cost management recommendations highlight over provisioned services and steps you can take to realize cost savings. This includes virtual machines which could be resized to a lower SKU, unprovisioned ExpressRoute circuits and idle virtual network gateways. You can act on these recommendations, postpone them or download them as a CSV or PDF file. To get started visit <a href="https://docs.microsoft.com/azure/advisor/advisor-cost-recommendations" title="" target="_blank">Advisor cost management recommendations</a>.</p><p>✔️<b>Note:</b> There are several different ways of purchasing Azure services and not all of them are supported by Azure Cost Management. For example, detailed billing information for services purchased through a Cloud Solution Provider must be obtained directly from your CSP. Review <a href="https://docs.microsoft.com/azure/cost-management/understand-cost-mgt-data" title="" target="_blank">understand cost management data</a> for information on supported cost data.</p><h3 class="da-h3" id="1192012">Optimizing Azure Costs</h3><p>When the first calculation is close to on-premises in terms of the cost - customers prefer to migrate to the cloud. And after migration, continue to optimize the infrastructure by using the right types/sizes of VMs and arrange the scale-down of unused resources.</p><p>For example, looking at a VM running the SAP on Azure project can show you how initially the VM was sized based on the size of existing hardware server (with cost around €1 K per month), but the real utilization of VM was not more than 25% - but simple choosing the right VM size in the cloud we can achieve 75% saving (resize saving). And by applying the snoozing you can get additional 14% of economy:</p><p><span><img alt="" src="../Images/1192065-490203.png" width="" height="" /></span></p><p>It is easy to handle cost comparison when you are well equipped and for this Microsoft provides the set of specific services and tools that help you to understand and plan costs. These include the TCO Calculator, Azure Pricing Calculator, Azure Cost Management (Cloudyn), Azure Migrate, Cosmos DB Sizing Calculator, and the Azure Site Recovery Deployment Planner.</p><p>As we are talking about financial things - the way how you purchase cloud services, in which selling channel, may also bring the difference into the final cost. Consider the following methods of purchasing Azure and ways of modifying your pricing:</p><ul class="square"><li class="square"><p>Enterprise Agreement</p></li><li class="square"><p>Enterprise Dev Test Subscription</p></li><li class="square"><p>Cloud Service Provider (Partner Program)</p></li><li class="square"><p>Azure Hybrid Use Benefit</p></li><li class="square"><p>Azure Reserved Instances</p></li></ul><p><b>Azure Advisor</b> enables you to act on cost management recommendations from within the Azure portal, such as resizing virtual machines. <a href="https://docs.microsoft.com/azure/cost-management/tutorial-acm-opt-recommendations" title="" target="_blank">Act on recommendations</a>. Make sure that all stakeholders agree regarding the implementation and timing of this change. Resizing a virtual machine does require the VM to be shut down and restarted, causing a period when it will be unavailable, so time this carefully for minimal business impact.</p><h3 class="da-h3" id="1191609">Add a Custom Domain Name to Azure AD</h3><p>After you create your directory, you can add your custom domain name.</p><ol class="number"><li><p>Sign in to the <a href="https://portal.azure.com/" title="" target="_blank">Azure portal</a> using a <i>Global administrator</i> account for the directory.</p></li><li><p>Search for and select <b>Azure Active Directory</b> from any page. Then select <b>Custom domain names</b> &gt; <b>Add custom domain</b>.</p></li></ol><p><span><img alt="" src="../Images/1192304-490442.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>In Custom domain name, enter your organization's new name, in this example, <i>contoso.com</i>. Select <b>Add domain</b>.</p></li></ol><p><span><img alt="" src="../Images/1192305-490443.png" width="" height="" /></span></p><p>✔️<b>Important:</b>
You must include .com, .net, or any other top-level extension for this to work properly.</p><p>The unverified domain is added. The contoso.com page appears showing your DNS information.</p><p><span><img alt="" src="../Images/1192282-490420.png" width="" height="" /></span></p><h3 class="da-h3" id="1191612">Azure Active Directory Identity Protection</h3><p>Protection is a tool that allows organizations to accomplish three key tasks:</p><ul class="square"><li class="square"><p>Automate the detection and remediation of identity-based risks.</p></li><li class="square"><p>Investigate risks using data in the portal.</p></li><li class="square"><p>Export risk detection data to third-party utilities for further analysis.</p></li></ul><p><b>Risk detection and remediation</b></p><p>Identity Protection identifies risks in the following classifications:</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Risk detection type</p></td><td><p>Description</p></td></tr></thead><tbody><tr><td><p><b>Atypical travel</b></p></td><td><p>Sign in from an atypical location based on the user's recent sign-ins.</p></td></tr><tr><td><p><b>Anonymous IP address</b></p></td><td><p>Sign in from an anonymous IP address (for example: Tor browser, anonymizer VPNs).</p></td></tr><tr><td><p><b>Unfamiliar sign-in properties</b></p></td><td><p>Sign in with properties we've not seen recently for the given user.</p></td></tr><tr><td><p><b>Malware linked IP address</b></p></td><td><p>Sign in from a malware linked IP address</p></td></tr><tr><td><p><b>Leaked Credentials</b></p></td><td><p>This risk detection indicates that the user's valid credentials have been leaked</p></td></tr><tr><td><p><b>Azure AD threat intelligence</b></p></td><td><p>Microsoft's internal and external threat intelligence sources have identified a known attack pattern</p></td></tr></tbody></table><p>The risk signals can trigger remediation efforts such as requiring users to: perform Azure Multi-Factor Authentication, reset their password using self-service password reset, or blocking until an administrator takes action.</p><p><b>Risk investigation</b></p><p>Administrators can review detections and take manual action on them if needed. There are three key reports that administrators use for investigations in Identity Protection:</p><ul class="square"><li class="square"><p>Risky users</p></li><li class="square"><p>Risky sign-ins</p></li><li class="square"><p>Risk detections</p></li></ul><h3 class="da-h3" id="1191615">Conditional Access and Azure Multi-Factor Authentication</h3><p>Users and groups can be enabled for Azure Multi-Factor Authentication to prompt for additional verification during the sign-in event. Security defaults are available for all Azure AD tenants to quickly enable the use of the Microsoft Authenticator app for all users.</p><p>For more granular controls, Conditional Access policies can be used to define events or applications that require MFA. These policies can allow regular sign-in events when the user is on the corporate network or a registered device, but prompt for additional verification factors when remote or on a personal device.</p><p><span><img alt="" src="../Images/1192181-490319.png" width="" height="" /></span></p><h3 class="da-h3" id="1191614">Overview of Conditional Access</h3><p>The modern security perimeter now extends beyond an organization's network to include user and device identity. Organizations can utilize these identity signals as part of their access control decisions.</p><p>Conditional Access is the tool used by Azure Active Directory to bring signals together, to make decisions, and enforce organizational policies. Conditional Access is at the heart of the new identity driven control plane.</p><p><span><img alt="" src="../Images/1192034-490172.png" width="" height="" /></span></p><p>Conditional Access policies at their simplest are if-then statements, if a user wants to access a resource, then they must complete an action. Example: A payroll manager wants to access the payroll application and is required to perform multi-factor authentication to access it.</p><p>Administrators are faced with two primary goals:</p><ul class="square"><li class="square"><p>Empower users to be productive wherever and whenever</p></li><li class="square"><p>Protect the organization's assets</p></li></ul><p>By using Conditional Access policies, you can apply the right access controls when needed to keep your organization secure and stay out of your user’s way when not needed.</p><p>Conditional Access policies are enforced after the first-factor authentication has been completed. Conditional Access is not intended as an organization's first line of defense for scenarios like denial-of-service (DoS) attacks, but can use signals from these events to determine access.</p><h3 class="da-h3" id="1191616">Conditional Access - Signals and Decisions</h3><p>Common signals that Conditional Access can take in to account when making a policy decision include the following signals:</p><p><b>User or group membership</b></p><ul class="square"><li class="square"><p>Policies can be targeted to specific users and groups giving administrators fine-grained control over access.</p></li></ul><p><b>IP Location information</b></p><ul class="square"><li class="square"><p>Organizations can create trusted IP address ranges that can be used when making policy decisions.</p></li><li class="square"><p>Administrators can specify entire countries IP ranges to block or allow traffic from.</p></li></ul><p><b>Device</b></p><ul class="square"><li class="square"><p>Users with devices of specific platforms or marked with a specific state can be used when enforcing Conditional Access policies.</p></li></ul><p><b>Application</b></p><ul class="square"><li class="square"><p>Users attempting to access specific applications can trigger different Conditional Access policies.</p></li></ul><p><b>Real-time and calculated risk detection</b></p><ul class="square"><li class="square"><p>Signals integration with Azure AD Identity Protection allows Conditional Access policies to identify risky sign-in behavior. Policies can then force users to perform password changes or multi-factor authentication to reduce their risk level or be blocked from access until an administrator takes manual action.</p></li></ul><p><b>Microsoft Cloud App Security (MCAS)</b></p><ul class="square"><li class="square"><p>Enables user application access and sessions to be monitored and controlled in real time, increasing visibility and control over access to and activities performed within your cloud environment.</p></li></ul><h4 class="da-h4">Common Decisions</h4><p><b>Block access</b></p><ul class="square"><li class="square"><p>Most restrictive decision</p></li></ul><p><b>Grant access</b></p><p>Least restrictive decision, can still require one or more of the following options:</p><ul class="square"><li class="square"><p>Require multi-factor authentication</p></li><li class="square"><p>Require device to be marked as compliant</p></li><li class="square"><p>Require Hybrid Azure AD joined device</p></li><li class="square"><p>Require approved client app</p></li><li class="square"><p>Require app protection policy (preview)</p></li></ul><h4 class="da-h4">Common Applied Policies</h4><p>Many organizations have common access concerns that Conditional Access policies can help with such as:</p><ul class="square"><li class="square"><p>Requiring multi-factor authentication for users with administrative roles</p></li><li class="square"><p>Requiring multi-factor authentication for Azure management tasks</p></li><li class="square"><p>Blocking sign-ins for users attempting to use legacy authentication protocols</p></li><li class="square"><p>Requiring trusted locations for Azure Multi-Factor Authentication registration</p></li><li class="square"><p>Blocking or granting access from specific locations</p></li><li class="square"><p>Blocking risky sign-in behaviors</p></li><li class="square"><p>Requiring organization-managed devices for specific applications</p></li></ul><h3 class="da-h3" id="1191659">Choose Between Virtual Network Peering and VPN Gateways in Azure</h3><p>This section compares two ways to connect virtual networks in Azure: virtual network peering and VPN gateways.</p><p>A virtual network is a virtual, isolated portion of the Azure public network. By default, traffic cannot be routed between two virtual networks. However, it's possible to connect virtual networks, either within a single region or across two regions, so that traffic can be routed between them.</p><h4 class="da-h4">Overview</h4><p><b>Virtual network peering</b>. Virtual network peering connects two Azure virtual networks. Once peered, the virtual networks appear as one for connectivity purposes. Traffic between virtual machines in the peered virtual networks is routed through the Microsoft backbone infrastructure, through private IP addresses only. No public internet is involved. You can also peer virtual networks across Azure regions (global peering).</p><p><b>VPN gateways</b>. A VPN gateway is a specific type of virtual network gateway that is used to send traffic between an Azure virtual network and an on-premises location over the public internet. You can also use a VPN gateway to send traffic between Azure virtual networks. Each virtual network can have at most one VPN gateway.</p><p>Virtual network peering provides a low-latency, high-bandwidth connection. There is no gateway in the path, so there are no extra hops, ensuring low latency connections. It's useful in scenarios such as cross-region data replication and database failover. Because traffic is private and remains on the Microsoft backbone, also consider virtual network peering if you have strict data policies and want to avoid sending any traffic over the internet.</p><p>VPN gateways provide a limited bandwidth connection and are useful in scenarios where you need encryption but can tolerate bandwidth restrictions. In these scenarios, customers are also not as latency-sensitive.</p><h4 class="da-h4">Gateway transit</h4><p>Virtual network peering and VPN Gateways can also coexist via gateway transit</p><p>Gateway transit enables you to use a peered virtual network's gateway for connecting to on-premises, instead of creating a new gateway for connectivity. As you increase your workloads in Azure, you need to scale your networks across regions and virtual networks to keep up with the growth. Gateway transit allows you to share an ExpressRoute or VPN gateway with all peered virtual networks and lets you manage the connectivity in one place. Sharing enables cost-savings and reduction in management overhead.</p><p>With gateway transit enabled on virtual network peering, you can create a transit virtual network that contains your VPN gateway, Network Virtual Appliance, and other shared services. As your organization grows with new applications or business units and as you spin up new virtual networks, you can connect to your transit virtual network using peering. This prevents adding complexity to your network and reduces management overhead of managing multiple gateways and other appliances.</p><h3 class="da-h3" id="1191672">Naming the VM</h3><p>One piece of information people often don't put much thought into is the name of the VM. The VM name is used as the computer name, which is configured as part of the operating system. You can specify a name of up to 15 characters on a Windows VM and 64 characters on a Linux VM.</p><p>This name also defines a manageable <b>Azure resource</b>, and it's not trivial to change later. That means you should choose names that are meaningful and consistent, so you can easily identify what the VM does. A good convention is to include the following information in the name:</p><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p>Element</p></td><td><p>Example</p></td><td><p>Notes</p></td></tr></thead><tbody><tr><td><p>Environment</p></td><td><p>dev, prod, QA</p></td><td><p>Identifies the environment for the resource</p></td></tr><tr><td><p>Location</p></td><td><p>uw (US West), ue (US East)</p></td><td><p>Identifies the region into which the resource is deployed</p></td></tr><tr><td><p>Instance</p></td><td><p>01, 02</p></td><td><p>For resources that have more than one named instance (web servers, etc.)</p></td></tr><tr><td><p>Product or Service</p></td><td><p>service</p></td><td><p>Identifies the product, application, or service that the resource supports</p></td></tr><tr><td><p>Role</p></td><td><p>sql, web, messaging</p></td><td><p>Identifies the role of the associated resource</p></td></tr></tbody></table><p>For example, devusc-webvm01 might represent the first development web server hosted in the US South Central location.</p><h4 class="da-h4">What is an Azure resource?</h4><p>An Azure resource is a manageable item in Azure. Just like a physical computer in your datacenter, VMs have several elements that are needed to do their job:</p><ul class="square"><li class="square"><p>The VM itself</p></li><li class="square"><p>Storage account for the disks</p></li><li class="square"><p>Virtual network (shared with other VMs and services)</p></li><li class="square"><p>Network interface to communicate on the network</p></li><li class="square"><p>Network Security Group(s) to secure the network traffic</p></li><li class="square"><p>Public Internet address (optional)</p></li></ul><p>Azure will create all of these resources if necessary, or you can supply existing ones as part of the deployment process. Each resource needs a name that will be used to identify it. If Azure creates the resource, it will use the VM name to generate a resource name - another reason to be very consistent with your VM names!</p><h3 class="da-h3" id="1191671">Start with the Network</h3><p>When you set up a virtual network, you specify the available address spaces, subnets, and security. If the VNet will be connected to other VNets, you must select address ranges that are not overlapping. This is the range of private addresses that the VMs and services in your network can use. You can use unrouteable IP addresses such as 10.0.0.0/8, 172.16.0.0/12, or 192.168.0.0/16, or define your own range. Azure will treat any address range as part of the private VNet IP address space if it is only reachable within the VNet, within interconnected VNets, and from your on-premises location. If someone else is responsible for the internal networks, you should work with that person before selecting your address space to make sure there is no overlap and to let them know what space you want to use, so they don’t try to use the same range of IP addresses.</p><h4 class="da-h4">Segregate the network</h4><p>After deciding the virtual network address space(s), you can create one or more subnets for your virtual network. You do this to break up your network into more manageable sections. For example, you might assign 10.1.0.0 to VMs, 10.2.0.0 to back-end services, and 10.3.0.0 to SQL Server VMs.</p><h4 class="da-h4">Secure the network</h4><p>By default, there is no security boundary between subnets, so services in each of these subnets can talk to one another. However, you can set up Network Security Groups (NSGs), which allow you to control the traffic flow to and from subnets and to and from VMs. NSGs act as software firewalls, applying custom rules to each inbound or outbound request at the network interface and subnet level. This allows you to fully control every network request coming in or out of the VM.</p><h4 class="da-h4">Plan each VM deployment</h4><p>Once you have mapped out your communication and network requirements, you can start thinking about the VMs you want to create. A good plan is to select a server and take an inventory:</p><ul class="square"><li class="square"><p>Which ports are open?</p></li><li class="square"><p>Which OS is used?</p></li><li class="square"><p>How much disk space is in use?</p></li><li class="square"><p>What kind of data does this use? Are there restrictions (legal or otherwise) with not having it on-premises?</p></li><li class="square"><p>What sort of CPU, memory, and disk I/O load does the server have? Is there burst traffic to account for?</p></li></ul><p>We can then start to answer some of the questions Azure will have for a new virtual machine.</p><h3 class="da-h3" id="1191675">Virtual Machine Sizes (Windows and Linux)</h3><p>This section describes the available sizes and options for the Azure virtual machines you can use to run your Linux and Windows apps and workloads. It also provides deployment considerations to be aware of when you're planning to use these resources.</p><p><b>Sizes for Windows and Linux virtual machines in Azure</b></p><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p><b>Type</b></p></td><td><p><b>Sizes</b></p></td><td><p><b>Description</b></p></td></tr></thead><tbody><tr><td><p><b>General purpose</b></p></td><td><p>B, Dsv3, Dv3, Dasv4, Dav4, DSv2, Dv2, Av2, DC, DCv2, Dv4, Dsv4, Ddv4, Ddsv4</p></td><td><p>Balanced CPU-to-memory ratio. Ideal for testing and development, small to medium databases, and low to medium traffic web servers.</p></td></tr><tr><td><p><b>Compute optimized</b></p></td><td><p>Fsv2</p></td><td><p>High CPU-to-memory ratio. Good for medium traffic web servers, network appliances, batch processes, and application servers.</p></td></tr><tr><td><p><b>Memory optimized</b></p></td><td><p>Esv3, Ev3, Easv4, Eav4, Ev4, Esv4, Edv4, Edsv4, Mv2, M, DSv2, Dv2</p></td><td><p>High memory-to-CPU ratio. Great for relational database servers, medium to large caches, and in-memory analytics.</p></td></tr><tr><td><p><b>Storage optimized</b></p></td><td><p>Lsv2</p></td><td><p>High disk throughput and IO ideal for Big Data, SQL, NoSQL databases, data warehousing and large transactional databases.</p></td></tr><tr><td><p><b>GPU</b></p></td><td><p>NC, NCv2, NCv3, ND, NDv2 (Preview), NV, NVv3, NVv4</p></td><td><p>Specialized virtual machines targeted for heavy graphic rendering and video editing, as well as model training and inferencing (ND) with deep learning. Available with single or multiple GPUs.</p></td></tr><tr><td><p><b>High performance compute</b></p></td><td><p>HB, HBv2, HC,  H</p></td><td><p>Our fastest and most powerful CPU virtual machines with optional high-throughput network interfaces (RDMA).</p></td></tr><tr><td><p><b>Confidential compute</b></p></td><td><p>DCsv2-Series</p></td><td><p>Supports a larger range of deployment capabilities, have 2x the Enclave Page Cache (EPC) and a larger selection of sizes compared to the DC-Series VMs.</p></td></tr></tbody></table><h3 class="da-h3" id="1191676">The Pricing Model</h3><p>There are two separate costs the subscription will be charged for every VM: compute and storage. By separating these costs, you scale them independently and only pay for what you need.</p><p><b>Compute costs</b> - Compute expenses are priced on a per-hour basis but billed on a per-second basis. For example, you are only charged for 455 seconds of usage if the VM is deployed for 455 seconds. You are not charged for compute capacity if you stop and deallocate the VM since this releases the hardware. The hourly price varies based on the VM size and OS you select. The cost for a VM includes the charge for the Windows operating system. Linux-based instances are cheaper because there is no operating system license charge.</p><p><b>Storage costs</b> - You are charged separately for the storage the VM uses. The status of the VM has no relation to the storage charges that will be incurred; even if the VM is stopped/deallocated and you aren’t billed for the running VM, you will be charged for the storage used by the disks.</p><p>You're able to choose from the following payment options for compute costs.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Option</p></td><td><p>Description</p></td></tr></thead><tbody><tr><td><p><b>Pay as you go</b></p></td><td><p>With the pay-as-you-go option, you pay for compute capacity by the second, with no long-term commitment or upfront payments. You're able to increase or decrease compute capacity on demand as well as start or stop at any time. Prefer this option if you run applications with short-term or unpredictable workloads that cannot be interrupted. For example, if you are doing a quick test, or developing an app in a VM, this would be the appropriate option.</p></td></tr><tr><td><p><b>Reserved Virtual Machine Instances</b></p></td><td><p>The Reserved Virtual Machine Instances (RI) option is an advance purchase of a virtual machine for one or three years in a specified region. The commitment is made up front, and in return, you get up to 72% price savings compared to pay-as-you-go pricing. RIs are flexible and can easily be exchanged or returned for an early termination fee. Prefer this option if the VM has to run continuously, or you need budget predictability, and you can commit to using the VM for at least a year.</p></td></tr><tr><td><p><b>Spot Pricing</b></p></td><td><p>Purchase unused compute capacity at a discount.  Spot VMs are for workloads that can be interrupted, providing scalability while reducing costs.  Run  workloads on Virtual Machines or Virtual Machine Scale Sets.</p></td></tr><tr><td><p><b>Azure Hybrid Benefit</b></p></td><td><p>For customers who have licenses with Software Assurance, which helps maximize the value of existing on-premises Windows Server and/or SQL Server license investments when migrating to Azure.</p></td></tr></tbody></table><h3 class="da-h3" id="1191677">Select an Operating System</h3><p>Azure provides a variety of OS images that you can install into the VM, including several versions of Windows and flavors of Linux. As mentioned earlier, the choice of OS will influence your hourly compute pricing as Azure bundles the cost of the OS license into the price.</p><p>If you are looking for more than just base OS images, you can search the Azure Marketplace for more sophisticated install images that include the OS and popular software tools installed for specific scenarios. For example, if you needed a new WordPress site, the standard technology stack would consist of a Linux server, Apache web server, a MySQL database, and PHP. Instead of setting up and configuring each component, you can leverage a Marketplace image and install the entire stack all at once.</p><p>Finally, if you can't find a suitable OS image, you can create your disk image with what you need, upload it to Azure storage, and use it to create an Azure VM. Keep in mind that Azure only supports 64-bit operating systems.</p><h3 class="da-h3" id="1191673">Decide the Location for the VM</h3><p>Azure has datacenters all over the world filled with servers and disks. These datacenters are grouped into geographic regions (‘West US’, 'North Europe', ‘Southeast Asia’, etc.) to provide redundancy and availability.</p><p>When you create and deploy a virtual machine, you must select a region where you want the resources (CPU, storage, etc.) to be allocated. This lets you place your VMs as close as possible to your users to improve performance and to meet any legal, compliance, or tax requirements.</p><p>Two other things to think about regarding the location choice. First, the location can limit your available options. Each region has different hardware available and some configurations are not available in all regions. Second, there are price differences between locations. If your workload isn't bound to a specific location, it can be very cost effective to check your required configuration in multiple regions to find the lowest price.</p><h3 class="da-h3" id="1191674">Determine the Size of the VM</h3><p>Once you have the name and location set, you need to decide on the size of your VM. Rather than specify processing power, memory, and storage capacity independently, Azure provides different VM sizes that offer variations of these elements in different sizes. Azure provides a wide range of VM size options allowing you to select the appropriate mix of compute, memory, and storage for what you want to do.</p><p>The best way to determine the appropriate VM size is to consider the type of workload your VM needs to run. Based on the workload, you're able to choose from a subset of available VM sizes. Workload options are classified as follows on Azure:</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p><b>Option</b></p></td><td><p><b>Description</b></p></td></tr></thead><tbody><tr><td><p><b>General purpose</b></p></td><td><p>General-purpose VMs are designed to have a balanced CPU-to-memory ratio. Ideal for testing and development, small to medium databases, and low to medium traffic web servers.</p></td></tr><tr><td><p><b>Compute optimized</b></p></td><td><p>Compute optimized VMs are designed to have a high CPU-to-memory ratio. Suitable for medium traffic web servers, network appliances, batch processes, and application servers.</p></td></tr><tr><td><p><b>Memory optimized</b></p></td><td><p>Memory optimized VMs are designed to have a high memory-to-CPU ratio. Great for relational database servers, medium to large caches, and in-memory analytics.</p></td></tr><tr><td><p><b>Storage optimized</b></p></td><td><p>Storage optimized VMs are designed to have high disk throughput and IO. Ideal for VMs running databases.</p></td></tr><tr><td><p><b>GPU</b></p></td><td><p>GPU VMs are specialized virtual machines targeted for heavy graphics rendering and video editing. These VMs are ideal options for model training and inferencing with deep learning.</p></td></tr><tr><td><p><b>High performance computes</b></p></td><td><p>High performance compute is the fastest and most powerful CPU virtual machines with optional high-throughput network interfaces.</p></td></tr><tr><td><p><b>Confidential compute</b></p></td><td><p>Designed to protect the confidentiality and the integrity of data and code while it's processed in the cloud.</p></td></tr></tbody></table><h4 class="da-h4">What if my size needs change?</h4><p>Azure allows you to change the VM size when the existing size no longer meets your needs. You can upgrade or downgrade the VM - as long as your current hardware configuration is allowed in the new size. This provides a fully agile and elastic approach to VM management.</p><p>The VM size can be changed while the VM is running, as long as the new size is available in the current hardware cluster the VM is running on. The Azure portal makes this obvious by only showing you available size choices. The command line tools will report an error if you attempt to resize a VM to an unavailable size. Changing a running VM size will automatically reboot the machine to complete the request.</p><p>If you stop and deallocate the VM, you can then select any size available in your region since this removes your VM from the cluster it was running on.</p><h3 class="da-h3" id="1191679">Storage for the VM</h3><p>All Azure virtual machines will have at least two virtual hard disks (VHDs). The first disk stores the operating system, and the second is used as temporary storage. You can add additional disks to store application data; the maximum number is determined by the VM size selection (typically two per CPU). It's common to create one or more data disks, particularly since the OS disk tends to be quite small. Also, separating out the data to different VHDs allows you to manage the security, reliability, and performance of the disk independently.</p><p>The data for each VHD is held in <b>Azure Storage</b> as page blobs, which allows Azure to allocate space only for the storage you use. It's also how your storage cost is measured; you pay for the storage you are consuming.</p><h4 class="da-h4">What is Azure Storage?</h4><p>Azure Storage is Microsoft's cloud-based data storage solution. It supports almost any type of data and provides security, redundancy, and scalable access to the stored data. A storage account provides access to objects in Azure Storage for a specific subscription. VMs always have one or more storage accounts to hold each attached virtual disk.</p><p>Virtual disks can be backed by either <b>Standard</b> or <b>Premium</b> Storage accounts. Azure Premium Storage leverages solid-state drives (SSDs) to enable high performance and low latency for VMs running I/O-intensive workloads. Use Azure Premium Storage for production workloads, especially those that are sensitive to performance variations or are I/O intensive. For development or testing, Standard storage is fine.</p><p>When you create disks, you will have two options for managing the relationship between the storage account and each VHD. You can choose either <b>unmanaged disks</b> or <b>managed disks</b>.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Option</p></td><td><p>Description</p></td></tr></thead><tbody><tr><td><p>Unmanaged disks</p></td><td><p>With unmanaged disks, you are responsible for the storage accounts that are used to hold the VHDs that correspond to your VM disks. You pay the storage account rates for the amount of space you use. A single storage account has a fixed-rate limit of 20,000 I/O operations/sec. This means that a storage account is capable of supporting 40 standard virtual hard disks at full utilization. If you need to scale out with more disks, then you'll need more storage accounts, which can get complicated.</p></td></tr><tr><td><p>Managed disks</p></td><td><p>Managed disks are the newer and recommended disk storage model. They elegantly solve this complexity by putting the burden of managing the storage accounts onto Azure. You specify the size of the disk, up to 4 TB, and Azure creates and manages both the disk and the storage. You don't have to worry about storage account limits, which makes managed disks easier to scale out.</p></td></tr></tbody></table><h3 class="da-h3" id="1191678">Running Linux and Windows Virtual Machines on Azure</h3><p>Provisioning a virtual machine (VM) in Azure requires some additional components besides the VM itself, including networking and storage resources. This lesson describes best practices for running a Linux or Windows virtual machine on Azure.<span><img alt="" src="../Images/1192110-490248.png" width="" height="" /></span></p><h4 class="da-h4">Resource Groups and Virtual Machines</h4><p>A resource group is a logical container that holds related Azure resources. In general, group resources based on their lifetime and who will manage them.</p><p>Place closely associated resources that share the same lifecycle into the same resource group. Resource groups allow you to deploy and monitor resources as a group and track billing costs by resource group.</p><p>You can also delete resources as a set, which is useful for test deployments. Assign meaningful resource names to simplify locating a specific resource and understanding its role.</p><h3 class="da-h3" id="1191783">Table Service Data Model</h3><p>The Table service offers structured storage in the form of tables. The following sections outline the Table service data model.</p><h4 class="da-h4">Storage Account</h4><p>A storage account is a globally unique entity within the storage system. The storage account is the parent namespace for the Table service and is the basis for authorization. You can create any number of tables within a given storage account, if each table is uniquely named.</p><p>The storage account must always be specified in the request URI. The base URI for accessing the Table service is as follows:</p><div class="code"><p class="da-divtext">https://myaccount.table.core.windows.net</p></div><h4 class="da-h4">Tables, Entities, and Properties</h4><p>Tables store data as collections of entities. Entities are similar to rows. An entity has a primary key and a set of properties. A property is a name, typed-value pair, similar to a column.</p><p>The Table service does not enforce any schema for tables, so two entities in the same table may have different sets of properties. Developers may choose to enforce a schema on the client side. A table may contain any number of entities.</p><h4 class="da-h4">Table Names</h4><p>Table names must conform to these rules:</p><ul class="square"><li class="square"><p>Table names must be unique within an account.</p></li><li class="square"><p>Table names may contain only alphanumeric characters.</p></li><li class="square"><p>Table names cannot begin with a numeric character.</p></li><li class="square"><p>Table names are case-insensitive.</p></li><li class="square"><p>Table names must be from 3 to 63 characters long.</p></li><li class="square"><p>Some table names are reserved, including “tables”. Attempting to create a table with a reserved table name returns error code 404 (Bad Request).</p></li></ul><p>These rules are also described by the regular expression "^[A-Za-z][A-Za-z0-9]{2,62}$".</p><p>Table names preserve the case with which they were created but are case-insensitive when used.</p><h4 class="da-h4">Property Names</h4><p>Property names are case-sensitive strings up to 255 characters in size. Property names should follow naming rules for C# identifiers.</p><h4 class="da-h4">Property Limitations</h4><p>An entity can have up to 255 properties, including 3 system properties described in the following section. Therefore, the user may include up to 252 custom properties, in addition to the 3 system properties. The combined size of all data in an entity's properties cannot exceed 1 MB.</p><h4 class="da-h4">System Properties</h4><p>An entity always has the following system properties:</p><ul class="square"><li class="square"><p><span class="code">PartitionKey</span> property</p></li><li class="square"><p><span class="code">RowKey</span> property</p></li><li class="square"><p><span class="code">Timestamp</span> property</p></li></ul><p>These system properties are automatically included for every entity in a table. The names of these properties are reserved and cannot be changed. The developer is responsible for inserting and updating the values of <span class="code">PartitionKey</span> and <span class="code">RowKey</span>. The server manages the value of Timestamp, which cannot be modified.</p><h4 class="da-h4">Characters Disallowed in Key Fields</h4><p>The following characters are not allowed in values for the <span class="code">PartitionKey</span> and <span class="code">RowKey</span> properties:</p><ul class="square"><li class="square"><p>The forward slash (/) character</p></li><li class="square"><p>The backslash () character</p></li><li class="square"><p>The number sign (#) character</p></li><li class="square"><p>The question mark (?) character</p></li><li class="square"><p>Control characters from U+0000 to U+001F, including:</p><ul class="square"><li class="square"><p>The horizontal tab (\t) character</p></li><li class="square"><p>The linefeed (\n) character</p></li><li class="square"><p>The carriage return (\r) character</p></li></ul></li><li class="square"><p>Control characters from U+007F to U+009F</p></li></ul><h4 class="da-h4">PartitionKey Property</h4><p>Tables are partitioned to support load balancing across storage nodes. A table's entities are organized by partition. A partition is a consecutive range of entities possessing the same partition key value. The partition key is a unique identifier for the partition within a given table, specified by the <span class="code">PartitionKey</span> property. The partition key forms the first part of an entity's primary key. The partition key may be a string value up to 1 KB in size.</p><p>You must include the <span class="code">PartitionKey</span> property in every insert, update, and delete operation.</p><h4 class="da-h4">RowKey Property</h4><p>The second part of the primary key is the row key, specified by the <span class="code">RowKey</span> property. The row key is a unique identifier for an entity within a given partition. Together the <span class="code">PartitionKey</span> and <span class="code">RowKey</span> uniquely identify every entity within a table.</p><p>The row key is a string value that may be up to 1 KB in size.</p><p>You must include the <span class="code">RowKey</span> property in every insert, update, and delete operation.</p><h4 class="da-h4">Timestamp Property</h4><p>The <span class="code">Timestamp</span> property is a <span class="code">DateTime</span> value that is maintained on the server side to record the time an entity was last modified. The Table service uses the Timestamp property internally to provide optimistic concurrency. The value of <span class="code">Timestamp</span> is a monotonically increasing value, meaning that each time the entity is modified, the value of <span class="code">Timestamp</span> increases for that entity. This property should not be set on insert or update operations (the value will be ignored).</p><h3 class="da-h3" id="1191782">Azure Table Storage</h3><p>Azure Table storage is a service that stores structured NoSQL data in the cloud, providing a key/attribute store with a schemaless design. Because Table storage is schemaless, it's easy to adapt your data as the needs of your application evolve. Access to Table storage data is fast and cost-effective for many types of applications and is typically lower in cost than traditional SQL for similar volumes of data.</p><p>You can use Table storage to store flexible datasets like user data for web applications, address books, device information, or other types of metadata your service requires. You can store any number of entities in a table, and a storage account may contain any number of tables, up to the capacity limit of the storage account.</p><h4 class="da-h4">What is Table storage</h4><p>Azure Table storage stores large amounts of structured data. The service is a NoSQL datastore which accepts authenticated calls from inside and outside the Azure cloud. Azure tables are ideal for storing structured, non-relational data. Common uses of Table storage include:</p><ul class="square"><li class="square"><p>Storing TBs of structured data capable of serving web scale applications</p></li><li class="square"><p>Storing datasets that don't require complex joins, foreign keys, or stored procedures and can be denormalized for fast access</p></li><li class="square"><p>Quickly querying data using a clustered index</p></li><li class="square"><p>Accessing data using the OData protocol and LINQ queries with WCF Data Service .NET Libraries</p></li></ul><p>You can use Table storage to store and query huge sets of structured, non-relational data, and your tables will scale as demand increases.</p><h4 class="da-h4">Table storage concepts</h4><p>Table storage contains the following components:</p><p><span><img alt="" src="../Images/1192098-490236.png" width="" height="" /></span></p><ul class="square"><li class="square"><p><b>URL format</b>:</p><ul class="square"><li class="square"><p><b>Azure Table Storage accounts use this format:</b><span class="code">http://&lt;storage account&gt;.table.core.windows.net/&lt;table&gt;</span></p></li><li class="square"><p><b>Azure Cosmos DB Table API accounts use this format:</b><span class="code">http://&lt;storage account&gt;.table.cosmosdb.azure.com/&lt;table&gt;</span></p></li></ul></li><li class="square"><p><b>Accounts</b>: All access to Azure Storage is done through a storage account.</p></li><li class="square"><p><b>Table</b>: A table is a collection of entities. Tables don't enforce a schema on entities, which means a single table can contain entities that have different sets of properties.</p></li><li class="square"><p><b>Entity</b>: An entity is a set of properties, similar to a database row. An entity in Azure Storage can be up to 1MB in size. An entity in Azure Cosmos DB can be up to 2MB in size.</p></li><li class="square"><p><b>Properties</b>: A property is a name-value pair. Each entity can include up to 252 properties to store data. Each entity also has three system properties that specify a partition key, a row key, and a timestamp. Entities with the same partition key can be queried more quickly, and inserted/updated in atomic operations. An entity's row key is its unique identifier within a partition.</p></li></ul><h3 class="da-h3" id="1191785">Overview of Azure Cosmos DB</h3><p><span><img alt="" src="../Images/1192276-490414.png" width="" height="" /></span></p><p>
Azure Cosmos DB is a globally distributed and elastically scalable database. It has a guaranteed low latency that is backed by a comprehensive set of Service Level Agreements (SLAs). Consistency can sometimes be an issue when you are working with distributed systems, but Azure Cosmos DB alleviates this situation by offering you five different consistency levels: strong, bounded staleness, session, consistent prefix, and eventual.
</p><p><span><img alt="" src="../Images/1192277-490415.png" width="" height="" /></span></p><p>
Core (SQL) is the default API for Azure Cosmos DB, which provides you with a view of your data that resembles a traditional NoSQL document store. You can query the hierarchical JSON documents with a SQL-like language. Core (SQL) uses JavaScript's type system, expression evaluation, and function invocation.
For a e-commerce website, you could choose to use Core (SQL) to store your product catalog. 
</p><p><span><img alt="" src="../Images/1192278-490416.png" width="" height="" /></span></p><p>
 Azure Cosmos DB's API for MongoDB supports the MongoDB wire protocol. This API allows existing MongoDB client SDKs, drivers, and tools to interact with the data transparently, as if they are running against an actual MongoDB database. The data is stored in document format, which is the same as using Core (SQL). 
</p><p><span><img alt="" src="../Images/1192279-490417.png" width="" height="" /></span></p><p>
Azure Cosmos DB's support for the Cassandra API makes it possible to query data by using the Cassandra Query Language (CQL), and your data will appear to be a partitioned row store. Just like the MongoDB API, any clients or tools should be able to connect transparently to Azure Cosmos DB; only your connection settings should need to be updated. 
For developers who have experience with the CQL query language, Azure Cosmos DB provides several familiar CQL statements and clauses.
</p><p><span><img alt="" src="../Images/1192280-490418.png" width="" height="" /></span></p><p>
Azure Cosmos DB's Azure Table API provides support for applications that are written for Azure Table Storage that need premium capabilities like global distribution, high availability, scalable throughput. The original Table API only allows for indexing on the Partition and Row keys; there are no secondary indexes. Storing table data in Comsos DB automatically indexes all the properties and requires no index management.
Querying is accomplished by using OData and LINQ queries in code, and the original REST API for GET operations.
</p><p><span><img alt="" src="../Images/1192281-490419.png" width="" height="" /></span></p><p>
Choosing Gremlin as the API provides a graph-based view over the data. Remember that at the lowest level, all data in any Azure Cosmos DB is stored in an ARS format. A graph-based view on the database means data is either a vertex (which is an individual item in the database), or an edge (which is a relationship between items in the database).
You typically use a traversal language to query a graph database, and Azure Cosmos DB supports Apache Tinkerpop's Gremlin language.
</p><h3 class="da-h3" id="1191786">High Availability with CosmosDB</h3><p>Azure Cosmos DB transparently replicates your data across all the Azure regions associated with your Cosmos account. Cosmos DB employs multiple layers of redundancy for your data as shown in the following image:</p><p><span><img alt="" src="../Images/1192396-490534.png" width="" height="" /></span></p><ul class="square"><li class="square"><p>The data within Cosmos containers is horizontally partitioned.</p></li><li class="square"><p>Within each region, every partition is protected by a replica-set with all writes replicated and durably committed by most replicas. Replicas are distributed across as many as 10-20 fault domains.</p></li><li class="square"><p>Each partition across all the regions is replicated. Each region contains all the data partitions of a Cosmos container and can accept writes and serve reads.</p></li></ul><p>If your Cosmos account is distributed across *N * regions, there will be at least <i>N</i> x 4 copies of all your data. In addition to providing low latency data access and scaling write/read throughput across the regions associated with your Cosmos account, having more regions (higher <i>N</i>) further improves availability.</p><h4 class="da-h4">SLAs for availability</h4><p>As a globally distributed database, Cosmos DB provides comprehensive SLAs that encompass throughput, latency at the 99th percentile, consistency, and high availability. The table below shows the guarantees for high availability provided by Cosmos DB for single and multi-region accounts. For high availability, always configure your Cosmos accounts to have multiple write regions.</p><table style="width:100%" class=""><col width="25%" /><col width="25%" /><col width="25%" /><col width="25%" /><thead><tr><td><p>Operation type</p></td><td><p>Single region</p></td><td><p>Multi-region (single region writes)</p></td><td><p>Multi-region (multi-region writes)</p></td></tr></thead><tbody><tr><td><p>Writes</p></td><td><p>99.99</p></td><td><p>99.99</p></td><td><p>99.999</p></td></tr><tr><td><p>Reads</p></td><td><p>99.99</p></td><td><p>99.999</p></td><td><p>99.999</p></td></tr></tbody></table><h4 class="da-h4">High availability with Cosmos DB in the event of regional outages</h4><p>Regional outages aren't uncommon, and Azure Cosmos DB makes sure your database is always highly available. The following details capture Cosmos DB behavior during an outage, depending on your Cosmos account configuration:</p><ul class="square"><li class="square"><p>With Cosmos DB, before a write operation is acknowledged to the client, the data is durably committed by a quorum of replicas within the region that accepts the write operations.</p></li><li class="square"><p>Multi-region accounts configured with multiple-write regions will be highly available for both writes and reads. Regional failovers are instantaneous and don't require any changes from the application.</p></li></ul><h4 class="da-h4">Multi-region accounts with a single-write region (write region outage)</h4><ul class="square"><li class="square"><p>During a write region outage, the Cosmos account will automatically promote a secondary region to be the new primary write region when <b>enable automatic failover</b> is configured on the Azure Cosmos account. When enabled, the failover will occur to another region in the order of region priority you've specified.</p></li><li class="square"><p>When the previously impacted region is back online, any write data that was not replicated when the region failed, is made available through the conflicts feed. Applications can read the conflicts feed, resolve the conflicts based on the application-specific logic, and write the updated data back to the Azure Cosmos container as appropriate.</p></li><li class="square"><p>Once the previously impacted write region recovers, it becomes automatically available as a read region. You can switch back to the recovered region as the write region.</p></li></ul><h4 class="da-h4">Multi-region accounts with a single-write region (read region outage)</h4><ul class="square"><li class="square"><p>During a read region outage, Cosmos accounts using any consistency level or strong consistency with three or more read regions will remain highly available for reads and writes.</p></li><li class="square"><p>The impacted region is automatically disconnected and will be marked offline. The Azure Cosmos DB SDKs will redirect read calls to the next available region in the preferred region list.</p></li><li class="square"><p>If none of the regions in the preferred region list is available, calls automatically fall back to the current write region.</p></li></ul><h4 class="da-h4">Availability Zone support</h4><p>In addition to cross region resiliency, you can now enable <b>zone redundancy</b> when selecting a region to associate with your Azure Cosmos database.</p><p>With Availability Zone support, Azure Cosmos DB will ensure replicas are placed across multiple zones within a given region to provide high availability and resiliency during zonal failures.</p><h3 class="da-h3" id="1191787">Azure Cosmos DB Cassandra API</h3><p>Azure Cosmos DB Cassandra API can be used as the data store for apps written for Apache Cassandra. This means that by using existing Apache drivers compliant with CQLv4, your existing Cassandra application can now communicate with the Azure Cosmos DB Cassandra API. In many cases, you can switch from using Apache Cassandra to using Azure Cosmos DB's Cassandra API, by just changing a connection string.</p><p>The Cassandra API enables you to interact with data stored in Azure Cosmos DB using the Cassandra Query Language (CQL) , Cassandra-based tools (like cqlsh) and Cassandra client drivers that you're already familiar with.</p><h4 class="da-h4">Benefits of using Apache Cassandra API for Azure Cosmos DB</h4><p><b>No operations management</b>: As a fully managed cloud service, Azure Cosmos DB Cassandra API removes the overhead of managing and monitoring a myriad of settings across OS, JVM, and yaml files and their interactions. Azure Cosmos DB provides monitoring of throughput, latency, storage, availability, and configurable alerts.</p><p><b>Open source standard</b>: Despite being a fully managed service, Cassandra API still supports a large surface area of the native Apache Cassandra wire protocol, allowing you to build applications on a widely used and cloud agnostic open source standard.</p><p><b>Performance management</b>: Azure Cosmos DB provides guaranteed low latency reads and writes at the 99th percentile, backed up by the SLAs. Users do not have to worry about operational overhead to ensure high performance and low latency reads and writes. This means that users do not need to deal with scheduling compaction, managing tombstones, setting up bloom filters and replicas manually. Azure Cosmos DB removes the overhead to manage these issues and lets you focus on the application logic.</p><p><b>Ability to use existing code and tools</b>: Azure Cosmos DB provides wire protocol level compatibility with existing Cassandra SDKs and tools. This compatibility ensures you can use your existing codebase with Azure Cosmos DB Cassandra API with trivial changes.</p><p><b>Throughput and storage elasticity</b>: Azure Cosmos DB provides guaranteed throughput across all regions and can scale the provisioned throughput with Azure portal, PowerShell, or CLI operations. You can elastically scale storage and throughput for your tables as needed with predictable performance.</p><p><b>Global distribution and availability</b>: Azure Cosmos DB provides the ability to globally distribute data across all Azure regions and serve the data locally while ensuring low latency data access and high availability. Azure Cosmos DB provides 99.99% high availability within a region and 99.999% read and write availability across multiple regions with no operations overhead. Learn more in Distribute data globally article.</p><p><b>Choice of consistency</b>: Azure Cosmos DB provides the choice of five well-defined consistency levels to achieve optimal tradeoffs between consistency and performance. These consistency levels are strong, bounded-staleness, session, consistent prefix and eventual. These well-defined, practical, and intuitive consistency levels allow developers to make precise trade-offs between consistency, availability, and latency. Learn more in consistency levels article.</p><p><b>Enterprise grade</b>: Azure cosmos DB provides compliance certifications to ensure users can use the platform securely. Azure Cosmos DB also provides encryption at rest and in motion, IP firewall, and audit logs for control plane activities.</p><p><b>Event Sourcing</b>: Cassandra API provides access to a persistent change log, the Change Feed, which can facilitate event sourcing directly from the database. In Apache Cassandra, the only equivalent is change data capture (CDC), which is merely a mechanism to flag specific tables for archival as well as rejecting writes to those tables once a configurable size-on-disk for the CDC log is reached (these capabilities are redundant in Cosmos DB as the relevant aspects are automatically governed).</p><h3 class="da-h3" id="1191602">Group Accounts</h3><p>Azure AD allows you to define two different types of groups.</p><ul class="square"><li class="square"><p><b>Security groups</b>. These are the most common and are used to manage member and computer access to shared resources for a group of users. For example, you can create a security group for a specific security policy. By doing it this way, you can give a set of permissions to all the members at once, instead of having to add permissions to each member individually. This option requires an Azure AD administrator.</p></li><li class="square"><p><b>Office 365 groups</b>. These groups provide collaboration opportunities by giving members access to a shared mailbox, calendar, files, SharePoint site, and more. This option also lets you give people outside of your organization access to the group. This option is available to users as well as admins.</p></li></ul><p><span><img alt="" src="../Images/1192424-490562.png" width="" height="" /></span></p><h4 class="da-h4">Adding Members to Groups</h4><p>There are different ways you can assign access rights:</p><ul class="square"><li class="square"><p><b>Assigned</b>. Lets you add specific users to be members of this group and to have unique permissions.</p></li><li class="square"><p><b>Dynamic User</b>. Lets you use dynamic membership rules to automatically add and remove members. If a member's attributes change, the system looks at your dynamic group rules for the directory to see if the member meets the rule requirements (is added) or no longer meets the rules requirements (is removed).</p></li><li class="square"><p><b>Dynamic Device (Security groups only)</b>. Lets you use dynamic group rules to automatically add and remove devices. If a device's attributes change, the system looks at your dynamic group rules for the directory to see if the device meets the rule requirements (is added) or no longer meets the rules requirements (is removed).</p></li></ul><p>✔️ Have you given any thought to which groups you need to create? Would you directly assign or dynamically assign membership?</p><h3 class="da-h3" id="1191738">Storage Account Types</h3><p>Azure Storage offers several types of storage accounts. Each type supports different features and has its own pricing model. Consider these differences before you create a storage account to determine the type of account that is best for your applications. The types of storage accounts are:</p><table style="width:100%" class=""><col width="25%" /><col width="25%" /><col width="25%" /><col width="25%" /><thead><tr><td><p><b>Storage account type</b></p></td><td><p><b>Supported services</b></p></td><td><p><b>Supported performance tiers</b></p></td><td><p><b>Replication options</b></p></td></tr></thead><tbody><tr><td><p><b>BlobStorage</b></p></td><td><p>Blob (block blobs and append blobs only)</p></td><td><p>Standard</p></td><td><p>LRS, GRS, RA-GRS</p></td></tr><tr><td><p><b>General-purpose V1</b></p></td><td><p>Blob, File, Queue, Table, and Disk</p></td><td><p>Standard, Premium</p></td><td><p>LRS, GRS, RA-GRS</p></td></tr><tr><td><p><b>General-purpose V2</b></p></td><td><p>Blob, File, Queue, Table, and Disk</p></td><td><p>Standard, Premium</p></td><td><p>LRS, GRS, RA-GRS, ZRS, GZRS (preview), RA-GZRS (preview)</p></td></tr><tr><td><p><b>Block blob storage</b></p></td><td><p>Blob (block blobs and append blobs only)</p></td><td><p>Premium</p></td><td><p>LRS, ZRS (limited regions)​</p></td></tr><tr><td><p><b>FileStorage</b></p></td><td><p>Files only</p></td><td><p>Premium</p></td><td><p>LRS, ZRS (limited regions)​</p></td></tr></tbody></table><p><b>General-purpose v1 accounts (Storage)</b>. Legacy account type for blobs, files, queues, and tables. Use general-purpose v2 accounts instead when possible.</p><p><b>General-purpose v2 accounts (StorageV2)</b>. Basic storage account type for blobs, files, queues, and tables. Recommended for most scenarios using Azure Storage.</p><p><b>Block blob storage accounts (BlockBlobStorage)</b>. Blob-only storage accounts with premium performance characteristics. Recommended for scenarios with high transactions rates, using smaller objects, or requiring consistently low storage latency.</p><p><b>FileStorage storage accounts (FileStorage)</b>. Files-only storage accounts with premium performance characteristics. Recommended for enterprise or high performance scale applications.</p><p><b>Blob storage accounts (BlobStorage)</b>. Blob-only storage accounts. Use general-purpose v2 accounts instead when possible.</p><p>✔️ All storage accounts are encrypted using Storage Service Encryption (SSE) for data at rest.</p><h3 class="da-h3" id="1191604">Managing Multiple Directories</h3><p>In Azure Active Directory (Azure AD), each tenant is a fully independent resource: a peer that is logically independent from the other tenants that you manage. There is no parent-child relationship between tenants. This independence between tenants includes resource independence, administrative independence, and synchronization independence.</p><p><span><img alt="" src="../Images/1192106-490244.png" width="" height="" /></span></p><p><b>Resource independence</b></p><ul class="square"><li class="square"><p>If you create or delete a resource in one tenant, it has no impact on any resource in another tenant, with the partial exception of external users.</p></li><li class="square"><p>If you use one of your domain names with one tenant, it cannot be used with any other tenant.</p></li></ul><p><b>Administrative independence</b></p><p>If a non-administrative user of tenant ‘Contoso’ creates a test tenant 'Test,' then:</p><ul class="square"><li class="square"><p>By default, the user who creates a tenant is added as an external user in that new tenant, and assigned the global administrator role in that tenant.</p></li><li class="square"><p>The administrators of tenant ‘Contoso’ have no direct administrative privileges to tenant 'Test,' unless an administrator of ‘Test’ specifically grants them these privileges. However, administrators of 'Contoso' can control access to tenant ‘Test’ if they control the user account that created 'Test.'</p></li><li class="square"><p>If you add/remove an administrator role for a user in one tenant, the change does not affect the administrator roles that the user has in another tenant.</p></li></ul><p><b>Synchronization independence</b></p><p>You can configure each Azure AD tenant independently to get data synchronized from a single instance of either:</p><ul class="square"><li class="square"><p>The Azure AD Connect tool, to synchronize data with a single AD forest.</p></li><li class="square"><p>The Azure Active tenant Connector for Forefront Identity Manager, to synchronize data with one or more on-premises forests, and/or non-Azure AD data sources.</p></li></ul><p><b>Add an Azure AD tenant</b></p><p>To add an Azure AD tenant in the Azure portal, sign in to the Azure portal with an account that is an Azure AD global administrator, and, on the left, select New.</p><p>✔️ <b>Note</b>: Unlike other Azure resources, your tenants are not child resources of an Azure subscription. If your Azure subscription is canceled or expired, you can still access your tenant data using Azure PowerShell, the Microsoft Graph API, or the Microsoft 365 admin center. You can also associate another subscription with the tenant.</p><h3 class="da-h3" id="1191606">Demonstration - Users and Groups</h3><p>In this demonstration, we will explore Active Directory users and groups.</p><p><b>Note</b>: Depending on your subscription not all areas of the Active Directory blade will be available.</p><p><b>Determine domain information</b></p><ol class="number"><li><p>Access the Azure portal, and navigate to the <b>Azure Active Directory</b> blade.</p></li><li><p>Make a note of your available domain name. For example, usergmail.onmicrosoft.com.</p></li></ol><p><b>Explore user accounts</b></p><ol class="number"><li><p>Select the <b>Users</b> blade.</p></li><li><p>Select <b>New user</b>. Notice the selection to create a <b>New guest user</b>.</p></li><li><p>Add a new user reviewing the information: <b>User</b>. <b>User Name</b>, <b>Groups</b>, <b>Directory Role</b>, and <b>Job Info</b>.</p></li><li><p>After the user is created, review additional information about the user.</p></li></ol><p><b>Explore group accounts</b></p><ol class="number"><li><p>Select the <b>Groups</b> blade.</p></li><li><p>Add a <b>New group</b>.
</p><ul class="square"><li class="square"><p><b>Group type</b>: <i>Security</i></p></li><li class="square"><p><b>Group name</b>: <i>Managers</i></p></li><li class="square"><p><b>Membership type</b>: <i>Assigned</i></p></li><li class="square"><p><b>Members</b>: Add your new user to the group.</p></li></ul></li><li><p>After the group is created, review additional information about the group.</p></li></ol><p><b>Explore PowerShell for group management</b></p><ol class="number"><li><p>Create a new group called Developers.</p></li></ol><div class="code language-PowerShell"><p class="da-divtext"><code>New<span class="token operator">-</span>AzADGroup <span class="token operator">-</span>DisplayName Developers <span class="token operator">-</span>MailNickname Developers</code></p></div><ol class="number"><li value="2"><p>Retrieve the Developers group ObjectId.</p></li></ol><div class="code language-PowerShell"><p class="da-divtext"><code>Get<span class="token operator">-</span>AzADGroup</code></p></div><ol class="number"><li value="3"><p>Retrieve the user ObjectId for the member to add.</p></li></ol><div class="code language-PowerShell"><p class="da-divtext"><code>Get<span class="token operator">-</span>AzADUser</code></p></div><ol class="number"><li value="4"><p>Add the user to the group. Replace groupObjectId and userObjectId.</p></li></ol><div class="code language-PowerShell"><p class="da-divtext"><code>Add<span class="token operator">-</span>AzADGroupMember <span class="token operator">-</span>MemberUserPrincipalName <span class="token string">""</span>myemail@domain<span class="token punctuation">.</span>com<span class="token string">""</span> <span class="token operator">-</span>TargetGroupDisplayName <span class="token string">""</span>MyGroupDisplayName<span class="token string">""</span></code></p></div><ol class="number"><li value="5"><p>Verify the members of the group. Replace groupObjectId.</p></li></ol><div class="code language-PowerShell"><p class="da-divtext"><code>Get<span class="token operator">-</span>AzADGroupMember <span class="token operator">-</span>GroupDisplayName <span class="token string">"MyGroupDisplayName"</span></code></p></div><h3 class="da-h3" id="1191605">Azure B2B and B2C</h3><h4 class="da-h4">Azure AD B2B</h4><p>Azure Active Directory (Azure AD) business-to-business (B2B) collaboration lets you securely share your company's applications and services with guest users from any other organization, while maintaining control over your own corporate data. Work safely and securely with external partners, large or small, even if they don't have Azure AD or an IT department. A simple invitation and redemption process lets partners use their own credentials to access your company's resources. Developers can use Azure AD business-to-business APIs to customize the invitation process or write applications like self-service sign-up portals.</p><p><span><img alt="" src="../Images/1192023-490161.png" width="" height="" /></span></p><p>With Azure AD B2B:</p><ul class="square"><li class="square"><p>There is no external administrative overhead for your organization.</p></li><li class="square"><p>The partner uses their own identities and credentials; Azure AD is not required.</p></li><li class="square"><p>You don't need to manage external accounts or passwords.</p></li><li class="square"><p>You don't need to sync accounts or manage account lifecycles.</p></li></ul><h4 class="da-h4">Azure AD B2C</h4><p>Azure Active Directory B2C provides business-to-customer identity as a service. Your customers use their preferred social, enterprise, or local account identities to get single sign-on access to your applications and APIs. Azure Active Directory B2C (Azure AD B2C) is a customer identity access management (CIAM) solution capable of supporting millions of users and billions of authentications per day. It takes care of the scaling and safety of the authentication platform, monitoring and automatically handling threats like denial-of-service, password spray, or brute force attacks.</p><p><span><img alt="" src="../Images/1192024-490162.png" width="" height="" /></span></p><h4 class="da-h4">With Azure AD B2C:</h4><ul class="square"><li class="square"><p>You invite users from other social media Identity Tenants into your own organization tenant.</p></li><li class="square"><p>User provisioning is done by the invited party; you are in control to invite the other side’s users.</p></li><li class="square"><p>Standards-based authentication protocols are used including OpenID Connect, OAuth 2.0, and SAML. Integrates with most modern applications and commercial off-the-shelf software.</p></li><li class="square"><p>Provides a directory that can hold 100 custom attributes per user. However, you can also integrate with external systems. For example, use Azure AD B2C for authentication, but delegate to an external customer relationship management (CRM) or customer loyalty database as the source of truth for customer data</p></li><li class="square"><p>Facilitate identity verification and proofing by collecting user data, then passing it to a third party system to perform validation, trust scoring, and approval for user account creation.</p></li></ul><h3 class="da-h3" id="1191608">Domains and Custom Domains</h3><p><span><img alt="" src="../Images/1192413-490551.png" width="" height="" /></span></p><h4 class="da-h4">Initial domain name</h4><p>By default, when you create an Azure subscription an Azure AD domain is created for you. This instance of the domain has <i>initial domain name</i> in the form <i>domainname.onmicrosoft.com</i>. The initial domain name, while fully functional, is intended primarily to be used as a bootstrapping mechanism until a custom domain name is verified.</p><h4 class="da-h4">Custom domain name</h4><p>Although the initial domain name for a directory can't be changed or deleted, you can add any routable custom domain name you control. This simplifies the user sign-on experience by allowing user to logon with credentials they are familiar with. For example, a contosogold.onmicrosoft.com, could be assigned a simpler custom domain name of contosogold.com.</p><p><span><img alt="" src="../Images/1192305-490443.png" width="" height="" /></span></p><h4 class="da-h4">Practical information about domain names</h4><ul class="square"><li class="square"><p>Only a global administrator can perform domain management tasks in Azure AD, by default this is the user who created the subscription.</p></li><li class="square"><p>Domain names in Azure AD are globally unique. If one Azure AD directory has verified a domain name, then no other Azure AD directory can verify or use that same domain name.</p></li><li class="square"><p>Before a custom domain name can be used by Azure AD, the custom domain name must be added to your directory and verified. This is covered in the next topic.</p></li></ul><h3 class="da-h3" id="1191622">Reports for Azure Multi-Factor Authentication</h3><p>Azure Multi-Factor Authentication provides reports available in the Azure portal.</p><p>The reports are summarized in the following table:</p><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p>Report</p></td><td><p>Location</p></td><td><p>Description</p></td></tr></thead><tbody><tr><td><p><b>Blocked User History</b></p></td><td><p>Azure AD &gt; Security &gt; MFA &gt; Block/unblock users</p></td><td><p>Shows the history of requests to block or unblock users.</p></td></tr><tr><td><p><b>Usage and fraud alerts</b></p></td><td><p>Azure AD &gt; Sign-ins</p></td><td><p>Provides information on overall usage, user summary, and user details; as well as a history of fraud alerts submitted during the date range specified.</p></td></tr><tr><td><p><b>Usage for on-premises components</b></p></td><td><p>Azure AD &gt; Security &gt; MFA &gt; Activity Report</p></td><td><p>Provides information on overall usage for MFA through the NPS extension, ADFS, and MFA server.</p></td></tr><tr><td><p><b>Bypassed User History</b></p></td><td><p>Azure AD &gt; Security &gt; MFA &gt; One-time bypass</p></td><td><p>Provides a history of requests to bypass Multi-Factor Authentication for a user.</p></td></tr><tr><td><p><b>Server status</b></p></td><td><p>Azure AD &gt; Security &gt; MFA &gt; Server status</p></td><td><p>Displays the status of Multi-Factor Authentication Servers associated with your account.</p></td></tr></tbody></table><h4 class="da-h4">View the MFA Reports</h4><ol class="number"><li><p>Sign in to the <a href="https://portal.azure.com/" title="" target="_blank">Azure portal</a>.</p></li><li><p>Select <b>Azure Active Directory &gt; Security &gt; MFA</b>.</p></li><li><p>See <b>Reports</b>.</p></li></ol><p><span><img alt="" src="../Images/1192373-490511.png" width="" height="" /></span></p><h4 class="da-h4">Azure AD Sign-ins Report</h4><p>The Azure Sign-ins report provides information on managed applications and user sign-in activities, which includes information about MFA usage.</p><p>The MFA data provides insights into how MFA is working in your organization and answer questions like:</p><ul class="square"><li class="square"><p>Was the sign-in challenged with MFA?</p></li><li class="square"><p>How did the user complete MFA?</p></li><li class="square"><p>Why was the user unable to complete MFA?</p></li><li class="square"><p>How many users are challenged for MFA?</p></li><li class="square"><p>How many users are unable to complete the MFA challenge?</p></li><li class="square"><p>What are the common MFA issues end users are running into?</p></li></ul><p>This data is available through the Azure portal and the reporting API.</p><p><span><img alt="" src="../Images/1192374-490512.png" width="" height="" /></span></p><h3 class="da-h3" id="1191621">Configure Azure MFA Settings</h3><p>This topic describes where to manage Multi-Factor Authentication settings in the Azure portal.</p><p>You access to Azure Multi-Factor Authentication settings by browsing to <b>Azure Active Directory</b>, and Select <b>Security</b>.</p><p><span><img alt="" src="../Images/1192346-490484.png" width="" height="" /></span></p><p>Select <b>MFA</b>.</p><p><span><img alt="" src="../Images/1192347-490485.png" width="" height="" /></span></p><p>Configure <b>Settings</b>.</p><p><span><img alt="" src="../Images/1192348-490486.png" width="" height="" /></span></p><h4 class="da-h4">Settings</h4><p>The following settings apply to MFA Server, Azure MFA, or both.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Feature</p></td><td><p>Description</p></td></tr></thead><tbody><tr><td><p>Account lockout</p></td><td><p>Temporarily lock accounts in the multi-factor authentication service if there are too many denied authentication attempts in a row. This feature only applies to users who enter a PIN to authenticate. (MFA Server)</p></td></tr><tr><td><p>Block/unblock users</p></td><td><p>Used to block specific users from being able to receive Multi-Factor Authentication requests. Any authentication attempts for blocked users are automatically denied. Users remain blocked for 90 days from the time that they are blocked.</p></td></tr><tr><td><p>Fraud alert</p></td><td><p>Configure settings related to users ability to report fraudulent verification requests</p></td></tr><tr><td><p>Notifications</p></td><td><p>Enable notifications of events from MFA Server.</p></td></tr><tr><td><p>OATH tokens</p></td><td><p>Used in cloud-based Azure MFA environments to manage OATH tokens for users.</p></td></tr><tr><td><p>Phone call settings</p></td><td><p>Configure settings related to phone calls and greetings for cloud and on-premises environments.</p></td></tr><tr><td><p>Providers</p></td><td><p>This will show any existing authentication providers that you may have associated with your account.</p></td></tr></tbody></table><h3 class="da-h3" id="1191858">Module 11 Review Questions</h3><p><span><img alt="" src="../Images/1192029-490167.png" width="" height="" /></span></p><h4 class="problem">Review Question 1</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-d59ee9d3-a9b1-c3b5-57df-2d3048c64ef5"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You download an Azure Resource Manager template based on an existing virtual machine.<br /></p><ul class="square"><li class="square"><p>The template will be used to deploy 300 virtual machines.</p></li><li class="square"><p>You need to modify the template to reference an administrative password. You must prevent the password form being stored in plain text.</p></li></ul><p>
What should you create to store the password?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="qd59ee9d3-a9b1-c3b5-57df-2d3048c64ef5" value="1" />Azure AD Identity Protection and an Azure Policy<br /></label></li><li><label><input type="radio" name="qd59ee9d3-a9b1-c3b5-57df-2d3048c64ef5" value="2" />A Recovery Services vault and a backup policy<br /></label></li><li><label><input type="radio" name="qd59ee9d3-a9b1-c3b5-57df-2d3048c64ef5" value="3" />An Azure Key Vault and an access policy<br /></label></li><li><label><input type="radio" name="qd59ee9d3-a9b1-c3b5-57df-2d3048c64ef5" value="4" />An Azure Storage account and an access policy<br /></label></li></ul></div></div><div id="feedback-problem-d59ee9d3-a9b1-c3b5-57df-2d3048c64ef5" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct Answer: An Azure Key Vault and an access policy. Key Vault is a store for credential information that can be accessed from VM deployments. The relevant access policy must be set on the Vault that allows access for VM deployment.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 2</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-5fac3c66-74f0-8e55-40ec-9cc433c4a4da"><div class="card quizlib-question"><div class="quizlib-question-title"><p>A company has an Azure subscription that contains the Azure virtual machines shown below.
Name: TeamVM1<br /></p><ul class="square"><li class="square"><p>Operating System: Windows Server 2012 R2</p></li><li class="square"><p>Location: East US</p></li></ul><p>
Name: TeamVM2<br /></p><ul class="square"><li class="square"><p>Operating System: Windows Server 2016</p></li><li class="square"><p>Location: East US</p></li></ul><p>
Name: TeamVM3<br /></p><ul class="square"><li class="square"><p>Operating System: Windows Server 2019</p></li><li class="square"><p>Location: West US</p></li></ul><p>
Name: TeamVM4<br /></p><ul class="square"><li class="square"><p>Operating System: Ubuntu Server 18.04</p></li><li class="square"><p>Location: East US
They create and Azure Key Vault named Vault1 in East US location.</p></li></ul><p>
They need to identify which virtual machines can enable Azure Disk Encryption using Vault1.<br />
Which virtual machines would you identify?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q5fac3c66-74f0-8e55-40ec-9cc433c4a4da" value="1" />TeamVM3 only<br /></label></li><li><label><input type="radio" name="q5fac3c66-74f0-8e55-40ec-9cc433c4a4da" value="2" />TeamVM2 and TeamVM3 only<br /></label></li><li><label><input type="radio" name="q5fac3c66-74f0-8e55-40ec-9cc433c4a4da" value="3" />TeamVM1,  TeamVM2, and TeamVM4 only<br /></label></li><li><label><input type="radio" name="q5fac3c66-74f0-8e55-40ec-9cc433c4a4da" value="4" />TeamVM1,  TeamVM2, and TeamVM3 only<br /></label></li></ul></div></div><div id="feedback-problem-5fac3c66-74f0-8e55-40ec-9cc433c4a4da" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct Answer: TeamVM1,  TeamVM2, and TeamVM4 only. Azure Disk Encryption requires that your key vault and VMs reside in the same Azure region and subscription. Because Team_VM1  is in East US region, you can use Azure Disk Encryption for all virtual machines which are in the same region, which are Team_VM1,  Team_VM2, and Team_VM4. You can use Azure Disk Encryption with Windows and Linux virtual machines.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h3 class="da-h3" id="1191627">Location Condition Configuration</h3><p>When you configure the location condition, you have the option to distinguish between:</p><ul class="square"><li class="square"><p>Any location</p></li><li class="square"><p>All trusted locations</p></li><li class="square"><p>Selected locations</p></li></ul><p><span><img alt="" src="../Images/1192036-490174.png" width="" height="" /></span></p><h4 class="da-h4">Any location</h4><p>By default, selecting Any location causes a policy to be applied to all IP addresses, which means any address on the Internet. This setting is not limited to IP addresses you have configured as named location. When you select Any location, you can still exclude specific locations from a policy. For example, you can apply a policy to all locations except trusted locations to set the scope to all locations, except the corporate network.</p><h4 class="da-h4">All trusted locations</h4><p>This option applies to:</p><ul class="square"><li class="square"><p>All locations that have been marked as trusted location</p></li><li class="square"><p>MFA Trusted IPS (if configured)</p></li></ul><h4 class="da-h4">Selected locations</h4><p>With this option, you can select one or more named locations. For a policy with this setting to apply, a user needs to connect from any of the selected locations. When you click Select the named network selection control that shows the list of named networks opens. The list also shows if the network location has been marked as trusted. The named location called MFA Trusted IPs is used to include the IP settings that can be configured in the multi-factor authentication service setting page.</p><h3 class="da-h3" id="1191632">Accept the Guest User Invite</h3><p>Now sign in to the guest user email account to view the invitation.</p><ol class="number"><li><p>Sign in to your test guest user's email account.</p></li><li><p>In the inbox, find the “<i>You're invited</i>” email.</p></li><li><p>In the email body, select Get Started. A Review permissions page opens in the browser.</p></li></ol><p>4.Select <b>Accept Invitation</b>. The Access Panel opens, which lists the applications the guest user can access.</p><p><span><img alt="" src="../Images/1192301-490439.png" width="" height="" /></span></p><h3 class="da-h3" id="1191625">Named locations</h3><p>With named locations, you can create logical groupings of IP address ranges or countries and regions.</p><p>You can access your named locations in the Manage section of the Conditional Access page.</p><p><span><img alt="" src="../Images/1192297-490435.png" width="" height="" /></span></p><p>A named location has the following components:</p><p><span><img alt="" src="../Images/1192298-490436.png" width="" height="" /></span></p><ul class="square"><li class="square"><p><b>Name</b> - The display name of a named location.</p></li><li class="square"><p><b>IP ranges</b> - One or more IPv4 address ranges in CIDR format. Specifying an IPv6 address range is not supported.</p></li></ul><p>✔️<b>Note:</b>
IPv6 address ranges cannot currently be included in a named location. This means IPv6 ranges cannot be excluded from a Conditional Access policy. IPv6 ranges are only supported in the Named location (preview) interface.</p><ul class="square"><li class="square"><p><b>Mark as trusted location</b> - A flag you can set for a named location to indicate a trusted location. Typically, trusted locations are network areas that are controlled by your IT department. In addition to Conditional Access, trusted named locations are also used by Azure Identity Protection and Azure AD security reports to reduce <a href="https://docs.microsoft.com/en-us/azure/active-directory/reports-monitoring/concept-risk-events" title="" target="_blank">false positives</a>.</p></li><li class="square"><p><b>Countries/Regions</b> - This option enables you to select one or more country or region to define a named location.</p></li><li class="square"><p><b>Include unknown areas</b> - Some IP addresses are not mapped to a specific country or region. This option allows you to choose if these IP addresses should be included in the named location. Use this setting when the policy using the named location should apply to unknown locations.</p></li></ul><p>The number of named locations you can configure is constrained by the size of the related object in Azure AD. You can configure locations based on of the following limitations:</p><ul class="square"><li class="square"><p>One named location with up to 1200 IP ranges.</p></li><li class="square"><p>A maximum of 90 named locations with one IP range assigned to each of them.</p></li></ul><p>Conditional Access policy applies to IPv4 and IPv6 traffic. Currently named locations do not allow IPv6 ranges to be configured. This limitation causes the following situations:</p><ul class="square"><li class="square"><p>Conditional Access policy cannot be targeted to specific IPv6 ranges</p></li><li class="square"><p>Conditional Access policy cannot exclude specific IPV6 ranges (NOTE: IPv6 ranges are only supported in the Named location (preview) interface.)</p></li></ul><h3 class="da-h3" id="1191631">Assign an App to a Guest User</h3><p>Add the <i>Active Directory for GitHub Enterprise</i> app to your test tenant and assign the test guest user to the app.</p><ol class="number"><li><p>Sign in to the Azure portal as an Azure AD administrator.</p></li><li><p>In the left pane, select <b>Enterprise applications</b>.</p></li><li><p>Select <b>New application</b>.</p></li></ol><p><span><img alt="" src="../Images/1192255-490393.png" width="" height="" /></span></p><ol class="number"><li value="4"><p>Under <b>Add from the gallery</b>, search for <b>GitHub</b>, and then select <b>Active Directory for GitHub Enterprise</b>.</p></li></ol><p><span><img alt="" src="../Images/1192256-490394.png" width="" height="" /></span></p><ol class="number"><li value="5"><p>Select <b>Add</b>.</p></li><li><p>Under Manage, select Single <b>sign-on</b>, and under <b>Single Sign-on Mode</b>, select <b>Password-based Sign-on</b>, and click <b>Add</b>.</p></li></ol><p><span><img alt="" src="../Images/1192257-490395.png" width="" height="" /></span></p><ol class="number"><li value="7"><p>Under <b>Manage</b>, select <b>Users and groups &gt; Add user &gt; Users and groups</b>, click <b>Select</b>.</p></li></ol><p><span><img alt="" src="../Images/1192258-490396.png" width="" height="" /></span></p><ol class="number"><li value="8"><p>Select <b>Assign</b>.</p></li></ol><h3 class="da-h3" id="1191626">Trusted IPs</h3><p>You can also configure IP address ranges representing your organization's local intranet in the multi-factor authentication service settings. This feature enables you to configure up to 50 IP address ranges. The IP address ranges are in CIDR format.</p><p>If you have Trusted IPs configured, they show up as MFA Trusted IPS in the list of locations for the location condition.</p><h4 class="da-h4">Skipping multi-factor authentication</h4><p>On the multi-factor authentication service settings page, you can identify corporate intranet users by selecting Skip multi-factor authentication for requests from federated users on my intranet. This setting indicates that the inside corporate network claim, which is issued by AD FS, should be trusted and used to identify the user as being on the corporate network.</p><p>After checking this option, including the named location MFA Trusted IPS will apply to any policies with this option selected.</p><p>For mobile and desktop applications, which have long lived session lifetimes, Conditional Access is periodically reevaluated. The default is once an hour. When the inside corporate network claim is only issued at the time of the initial authentication, Azure AD may not have a list of trusted IP ranges. In this case, it is more difficult to determine if the user is still on the corporate network:</p><ol class="number"><li><p>Check if the user’s IP address is in one of the trusted IP ranges.</p></li><li><p>Check whether the first three octets of the user’s IP address match the first three octets of the IP address of the initial authentication. The IP address is compared with the initial authentication when the inside corporate network claim was originally issued and the user location was validated.</p></li></ol><p>If both steps fail, a user is no longer on a trusted IP.</p><h3 class="da-h3" id="1191661">Configure VNet Peering</h3><p>Here are the steps to configure VNet peering. Notice you will need two virtual networks. To test the peering, you will need a virtual machine in each network. Initially, the VMs will not be able to communicate, but after configuration the communication will work. The step that is new is configuring the peering of the virtual networks.</p><ol class="number"><li><p>Create two virtual networks.</p></li><li><p><b>Peer the virtual networks</b>.</p></li><li><p>Create virtual machines in each virtual network.</p></li><li><p>Test the communication between the virtual machines.</p></li></ol><p>To configure the peering use the <b>Add peering</b> page. There are only a few optional configuration parameters to consider.</p><p><span><img alt="" src="../Images/1192232-490370.png" width="" height="" /></span></p><p><b>Allow forwarded traffic.</b> Allows traffic not originating from within the peer virtual network into your virtual network.</p><p><b>Allow gateway transit.</b> Allows the peer virtual network to use your virtual network gateway. The peer cannot already have a gateway configured.</p><p>✔️ When you add a peering on one virtual network, the second virtual network configuration is automatically added.</p><p>✔️ If you select ‘Allow gateway transit’ on one virtual network; then you should select ‘Use remote gateways’ on the other virtual network.</p><h3 class="da-h3" id="1191634">Module 1 Review Questions</h3><p><span><img alt="" src="../Images/1192029-490167.png" width="" height="" /></span></p><h4 class="problem">Review Question 1</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-a0b631a0-a3de-b480-6ed7-d5d5f53c0818"><div class="card quizlib-question"><div class="quizlib-question-title"><p>An organization that you are advising has MFA enabled for all users.<br /></p><ul class="square"><li class="square"><p>They have MFA configured to send verification codes to their user’s cell phones.</p></li><li class="square"><p>You are asked to recommend how they should configure an additional MFA verification option for their users.</p></li><li class="square"><p>They have an Azure AD tenant.</p></li></ul><p>
What should you advise?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="qa0b631a0-a3de-b480-6ed7-d5d5f53c0818" value="1" />From the Security blade of Azure AD configure the Authentication settings<br /></label></li><li><label><input type="radio" name="qa0b631a0-a3de-b480-6ed7-d5d5f53c0818" value="2" />From the Security blade of Azure AD configure the phone call settings<br /></label></li><li><label><input type="radio" name="qa0b631a0-a3de-b480-6ed7-d5d5f53c0818" value="3" />From Multi-Factor Authentication, configure in the service settings<br /></label></li><li><label><input type="radio" name="qa0b631a0-a3de-b480-6ed7-d5d5f53c0818" value="4" />Azure Policy<br /></label></li></ul></div></div><div id="feedback-problem-a0b631a0-a3de-b480-6ed7-d5d5f53c0818" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct Answer: From Multi-Factor Authentication, configure in the service settings. You configure verification options that are used for MFA authentication in Multi-factor authentication portal, by configuring verification options on service settings tab. These settings are global and are used for all users who are authenticated by using MFA.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 2</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-83731a4c-03be-26e6-5bdb-7a059335195c"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You are advising a company that has enabled MFA for all its users.<br /></p><ul class="square"><li class="square"><p>The company’s support desk is seeing an increase in support tickets from users who are receiving MFA requests while working within the company’s main campus.</p></li><li class="square"><p>You are asked to provide a recommendation that prevents the users from receiving MFA requests while on the main campus. The company has an Azure subscription.</p></li></ul><p>
What do you advise?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q83731a4c-03be-26e6-5bdb-7a059335195c" value="1" />From the MFA service settings, create a trusted IP range.<br /></label></li><li><label><input type="radio" name="q83731a4c-03be-26e6-5bdb-7a059335195c" value="2" />From the conditional access in Azure AD, create a named location.<br /></label></li><li><label><input type="radio" name="q83731a4c-03be-26e6-5bdb-7a059335195c" value="3" />From the conditional access in Azure AD, create a custom control.<br /></label></li><li><label><input type="radio" name="q83731a4c-03be-26e6-5bdb-7a059335195c" value="4" />From the conditional access in Azure AD, configure organizational relationships.<br /></label></li></ul></div></div><div id="feedback-problem-83731a4c-03be-26e6-5bdb-7a059335195c" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct Answer: From the MFA service settings, create a trusted IP range. By creating a trusted IP range in the MFA service settings you provide users with the ability to avoid MFA requests while on company sites.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h3 class="da-h3" id="1191662">Service Chaining</h3><p>VNet Peering is nontransitive. This means that if you establish VNet Peering between VNet1 and VNet2 and between VNet2 and VNet3, VNet Peering capabilities do not apply between VNet1 and VNet3. However, you can leverage user-defined routes and service chaining to implement custom routing that will provide transitivity. This allows you to:</p><ul class="square"><li class="square"><p>Implement a multi-level hub and spoke architecture.</p></li><li class="square"><p>Overcome the limit on the number of VNet Peerings per virtual network.</p></li></ul><h4 class="da-h4">Hub and spoke architecture</h4><p>You can deploy hub-and-spoke networks, where the hub virtual network can host infrastructure components such as a network virtual appliance or VPN gateway. All the spoke virtual networks can then peer with the hub virtual network. Traffic can flow through network virtual appliances or VPN gateways in the hub virtual network.</p><p><span><img alt="" src="../Images/1192025-490163.png" width="" height="" /></span></p><h4 class="da-h4">User-defined routes and service chaining</h4><p>Virtual network peering enables the next hop in a user-defined route to be the IP address of a virtual machine in the peered virtual network, or a VPN gateway.</p><p>Service chaining enables you to direct traffic from one virtual network to a virtual appliance, or virtual network gateway, in a peered virtual network, through user-defined routes.</p><h4 class="da-h4">Checking connectivity</h4><p><span><img alt="" src="../Images/1192026-490164.png" width="" height="" /></span></p><p>You can check the status of the VNet peering. The peering is not successfully established until the peering status for both virtual network peerings shows <b>Updating</b>.</p><ul class="square"><li class="square"><p><b>Updating.</b> When you create the peering to the second virtual network from the first virtual network, the peering status is Initiated.</p></li><li class="square"><p><b>Connected.</b> When you create the peering from the second virtual network to the first virtual network, the status is changed from Initiated to Connected.</p></li></ul><h3 class="da-h3" id="1191852">Using Managed Identities with Azure Resources</h3><p>To set up a managed identity:</p><ol class="number"><li><p>In the Azure portal, go to the VM that hosts the app.</p></li><li><p>On the overview page, under <b>Settings</b>, select <b>Identity</b>.</p></li><li><p>Choose a system-assigned identity or a user-assigned identity. To do so, change the status to <b>On</b>.</p></li><li><p>Save the changes.</p></li></ol><p>Next, the system reminds you that the server will be registered with Azure AD and that you can grant permissions to resources there.</p><p>You can always see the current managed identities for the subscription in Azure AD, on the <b>Enterprise applications</b> page. On the overview page, you can assign users and change permissions.</p><p><span><img alt="" src="../Images/1192119-490257.png" width="" height="" /></span></p><h3 class="da-h3" id="1191630">Add Guest Users to Azure AD</h3><ol class="number"><li><p>Sign in to the <a href="https://portal.azure.com/" title="" target="_blank">Azure portal</a> as an Azure AD administrator.</p></li><li><p>In the left pane, select <b>Azure Active Directory</b>.</p></li><li><p>Under <b>Manage</b>, select <b>Users</b>.</p></li></ol><p><span><img alt="" src="../Images/1192159-490297.png" width="" height="" /></span></p><ol class="number"><li value="4"><p>Select <b>New guest user</b>.</p></li></ol><p><span><img alt="" src="../Images/1192160-490298.png" width="" height="" /></span></p><ol class="number"><li value="5"><p>On the <b>New user</b> page, select <b>Invite user</b> and  add the guest user's information.</p></li></ol><p><span><img alt="" src="../Images/1192161-490299.png" width="" height="" /></span></p><ul class="square"><li class="square"><p><b>Name</b> The first and last name of the guest user.</p></li><li class="square"><p><b>Email address (required)</b> The email address of the guest user.</p></li><li class="square"><p><b>Personal message (optional)</b> Include a personal welcome message to the guest user.</p></li><li class="square"><p><b>Groups</b> You can add the guest user to one or more existing groups, or you can do it later.</p></li><li class="square"><p><b>Directory role</b> If you require Azure AD administrative permissions for the user, you can add them to an Azure AD role.</p></li></ul><ol class="number"><li value="6"><p>Select <b>Invite</b> to automatically send the invitation to the guest user. A notification appears in the upper right with the message Successfully invited user.</p></li><li><p>After you send the invitation, the user account is automatically added to the directory as a guest.</p></li></ol><h3 class="da-h3" id="1191772">Import and Export Service</h3><p>Azure Import/Export service is used to securely import large amounts of data to Azure Blob storage and Azure Files by shipping disk drives to an Azure datacenter. This service can also be used to transfer data from Azure Blob storage to disk drives and ship to your on-premises sites. Data from one or more disk drives can be imported either to Azure Blob storage or Azure Files. With the Azure Import/Export service, you supply your own disk drives and transfer data yourself.</p><h4 class="da-h4">Usage Cases</h4><p>Consider using Azure Import/Export service when uploading or downloading data over the network is too slow or getting additional network bandwidth is cost-prohibitive. Scenarios where this would be useful include:</p><ul class="square"><li class="square"><p><b>Migrating data to the cloud</b>. Move large amounts of data to Azure quickly and cost effectively.</p></li><li class="square"><p><b>Content distribution</b>. Quickly send data to your customer sites.</p></li><li class="square"><p><b>Backup</b>. Take backups of your on-premises data to store in Azure blob storage.</p></li><li class="square"><p><b>Data recovery</b>. Recover large amount of data stored in blob storage and have it delivered to your on-premises location.</p></li></ul><h4 class="da-h4">Import Jobs</h4><p>An Import job securely transfers large amounts of data to Azure Blob storage (block and page blobs) and Azure Files by shipping disk drives to an Azure datacenter. In this case, you will be shipping hard drives containing your data.</p><p><span><img alt="" src="../Images/1192376-490514.png" width="" height="" /></span></p><p>In order to perform an import, follow these steps:</p><ul class="square"><li class="square"><p>Create an Azure Storage account.</p></li><li class="square"><p>Identify the number of disks that you will need to accommodate all the data that you want to transfer.</p></li><li class="square"><p>Identify a computer that you will use to perform the data copy, attach physical disks that you will ship to the target Azure datacenter, and install the WAImportExport tool.</p></li><li class="square"><p>Run the WAImportExport tool to copy the data, encrypt the drive with BitLocker, and generate journal files.</p></li><li class="square"><p>Use the Azure portal to create an import job referencing the Azure Storage account. As part of the job definition, specify the destination address representing the Azure region where the Azure Storage account resides.</p></li><li class="square"><p>Ship the disks to the destination that you specified when creating the import job and update the job by providing the shipment tracking number.</p></li><li class="square"><p>Once the disks arrive at the destination, the Azure datacenter staff will carry out data copy to the target Azure Storage account and ship the disks back to you.</p></li></ul><h4 class="da-h4">Export Jobs</h4><p>Export jobs transfer data from Azure storage to hard disk drives and ship to your on-premise sites.</p><p><span><img alt="" src="../Images/1192377-490515.png" width="" height="" /></span></p><p>In order to perform an export, follow these steps:</p><ul class="square"><li class="square"><p>Identify the data in the Azure Storage blobs that you intend to export.</p></li><li class="square"><p>Identify the number of disks that you will need to accommodate all the data you want to transfer.</p></li><li class="square"><p>Use the Azure portal to create an export job referencing the Azure Storage account. As part of the job definition, specify the blobs you want to export, the return address, and your carrier account number. Microsoft will ship your disks back to you after the export process is complete.</p></li><li class="square"><p>Ship the required number of disks to the Azure region hosting the storage account. Update the job by providing the shipment tracking number.</p></li><li class="square"><p>Once the disks arrive at the destination, Azure datacenter staff will carry out data copy from the storage account to the disks that you provided, encrypt the volumes on the disks by using BitLocker, and ship them back to you. The BitLocker keys will be available in the Azure portal, allowing you to decrypt the content of the disks and copy them to your on-premises storage.</p></li></ul><h4 class="da-h4">Import/Export Tool (WAImportExport)</h4><p>The <b>Azure Import/Export Tool</b> is the drive preparation and repair tool that you can use with the Microsoft Azure Import/Export service. You can use the tool for the following functions:</p><ul class="square"><li class="square"><p>Before creating an import job, you can use this tool to copy data to the hard drives you are going to ship to an Azure datacenter.</p></li><li class="square"><p>After an import job has completed, you can use this tool to repair any blobs that were corrupted, were missing, or conflicted with other blobs.</p></li><li class="square"><p>After you receive the drives from a completed export job, you can use this tool to repair any files that were corrupted or missing on the drives.</p></li></ul><p>Import/Export service requires the use of internal SATA II/III HDDs or SSDs. Each disk contains a single NTFS volume that you encrypt with BitLocker when preparing the drive. To prepare a drive, you must connect it to a computer running a 64-bit version of the Windows client or server operating system and run the WAImportExport tool from that computer. The WAImportExport tool handles data copy, volume encryption, and creation of journal files. Journal files are necessary to create an import/export job and help ensure the integrity of the data transfer.</p><p>✔️ You can create jobs directly from the Azure portal or you can accomplish this programmatically by using Azure Storage Import/Export REST API.</p><p>For more information, <a href="https://azure.microsoft.com/en-us/documentation/articles/storage-import-export-service/" title="" target="_blank">Azure Import and Export Service</a>.</p><h3 class="da-h3" id="1191774">Data Transfer Tool Selection</h3><p><span><img alt="" src="../Images/1192136-490274.png" width="" height="" /></span></p><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p>Dataset</p></td><td><p>Network Bandwidth</p></td><td><p>Solution to use</p></td></tr></thead><tbody><tr><td><p><b>Large Dataset</b></p></td><td><p>Low-bandwidth network or direct connectivity to on-premises storage is limited by organization policies</p></td><td><p>Azure Import/Export for export; Data Box Disk or Data Box for import where supported; otherwise use Azure Import/Export</p></td></tr><tr><td><p><b>Large Dataset</b></p></td><td><p>High-bandwidth network: 1 gigabit per second (Gbps) - 100 Gbps</p></td><td><p>AZCopy for online transfers; or to import data, Azure Stack Edge, or Azure Data Box Gateway</p></td></tr><tr><td><p><b>Large Dataset</b></p></td><td><p>Moderate-bandwidth network: 100 megabits per second (Mbps) - 1 Gbps</p></td><td><p>Azure Import/Export for export or Azure Stack Edge for import where supported</p></td></tr><tr><td><p><b>Small Dataset</b>: a few GBs to a few TBs</p></td><td><p>Low to moderate-bandwidth network: up to 1 Gbps</p></td><td><p>If transferring only a few files, use Azure Storage Explorer, Azure portal, AZCopy, or AZ CLI</p></td></tr></tbody></table><h3 class="da-h3" id="1191667">Module 3 Review Questions</h3><p><span><img alt="" src="../Images/1192029-490167.png" width="" height="" /></span></p><h4 class="problem">Review Question 1</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-e6d0e1fb-66ad-f546-35a7-269eca344b4e"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You have a VM with two NICs named NIC1 and NIC2. NIC1 is connected to the 10.10.8.0/24 subnet. NIC2 is connected to the 10.20.8.0/24 subnet. You plan to update the VM configuration to provide the following functionality:<br /></p><ul class="square"><li class="square"><p>Enable direct communication from the internet to TCP port 443.</p></li><li class="square"><p>Maintain existing communication across the 10.10.8.0/24 and 10.20.8.0/24 subnets.</p></li><li class="square"><p>Maintain a simple configuration whenever possible.</p></li></ul><p>
You need to update the VM configuration to support the new functionality. What should you do? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="qe6d0e1fb-66ad-f546-35a7-269eca344b4e" value="1" />Remove the private IP address from NIC2 and then assign a public IP address to it. Then, create an inbound security rule.<br /></label></li><li><label><input type="radio" name="qe6d0e1fb-66ad-f546-35a7-269eca344b4e" value="2" />Add a third NIC and associate a public IP address to it. Then, create an inbound security rule.<br /></label></li><li><label><input type="radio" name="qe6d0e1fb-66ad-f546-35a7-269eca344b4e" value="3" />Associate a public IP address to NIC2 and create an inbound security rule for TCP port 443.<br /></label></li><li><label><input type="radio" name="qe6d0e1fb-66ad-f546-35a7-269eca344b4e" value="4" />Create an inbound security rule for TCP port 443.<br /></label></li></ul></div></div><div id="feedback-problem-e6d0e1fb-66ad-f546-35a7-269eca344b4e" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Associate a public IP address to NIC2 and create an inbound security rule for TCP port 443. To enable direct communication from the internet to the VM, you must have a public IP address. You also need an inbound security rule. You can associate the public IP address with NIC1 or NIC2, although this scenario only presents an option to associate it with NIC2 so that is the correct answer.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 2</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-65191c4b-eda0-e7c1-953f-fcea602f501f"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You're currently using network security groups (NSGs) to control how your network traffic flows in and out of your virtual network subnets and network interfaces.<br /></p><ul class="square"><li class="square"><p>You want to customize how your NSGs work. For all incoming traffic, you need to apply your security rules to both the virtual machine and subnet level.</p></li></ul><p>
Which of the following options will let you accomplish this? (Choose two)<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="checkbox" name="q65191c4b-eda0-e7c1-953f-fcea602f501f" value="1" />Configure the AllowVNetInBound security rule for all new NSGs.<br /></label></li><li><label><input type="checkbox" name="q65191c4b-eda0-e7c1-953f-fcea602f501f" value="2" />Create rules for both NICs and subnets with an allow action.<br /></label></li><li><label><input type="checkbox" name="q65191c4b-eda0-e7c1-953f-fcea602f501f" value="3" />Delete the default rules.<br /></label></li><li><label><input type="checkbox" name="q65191c4b-eda0-e7c1-953f-fcea602f501f" value="4" />Add rules with a higher priority than the default rules.<br /></label></li></ul></div></div><div id="feedback-problem-65191c4b-eda0-e7c1-953f-fcea602f501f" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">You should add rules with a higher priority than the default rules if needed, as you cannot delete the default rules. Also, in order to meet the requirement to apply security rules to both VM and subnet level, you should create rules with an allow action for both. There is no need to configure the AllowVnetInBound rule as it as a default rule for any new security group you create.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h3 class="da-h3" id="1191773">AzCopy</h3><p>An alternative method for transferring data is <b>AzCopy</b>. AzCopy v10 is the next-generation command-line utility for copying data to/from Microsoft Azure Blob and File storage, which offers a redesigned command-line interface and new architecture for high-performance reliable data transfers. Using AzCopy, you can copy data between a file system and a storage account, or between storage accounts.</p><h4 class="da-h4">New features</h4><p>Synchronize a file system to Azure Blob or vice versa. Ideal for incremental copy scenarios.</p><ul class="square"><li class="square"><p>Supports Azure Data Lake Storage Gen2 APIs.</p></li><li class="square"><p>Supports copying an entire account (Blob service only) to another account.</p></li><li class="square"><p>Account to account copy is now using the new Put from URL APIs. No data transfer to the client is needed which makes the transfer faster.</p></li><li class="square"><p>List/Remove files and blobs in a given path.</p></li><li class="square"><p>Supports wildcard patterns in a path as well as –include and –exclude flags.</p></li><li class="square"><p>Improved resiliency: every AzCopy instance will create a job order and a related log file. You can view and restart previous jobs and resume failed jobs. AzCopy will also automatically retry a transfer after a failure.</p></li><li class="square"><p>General performance improvements.</p></li></ul><h4 class="da-h4">Authentication options</h4><ul class="square"><li class="square"><p><b>Azure Active Directory</b> (Supported for Blob and ADLS Gen2 services). Use .\azcopy login to sign in using Azure Active Directory. The user should have <i>Storage Blob Data Contributor</i> role assigned to write to Blob storage using Azure Active Directory authentication.</p></li><li class="square"><p><b>SAS tokens</b> (supported for Blob and File services). Append the SAS token to the blob path on the command line to use it.</p></li></ul><h4 class="da-h4">Getting started</h4><p>AzCopy has a simple self-documented syntax. Here's how you can get a list of available commands:</p><div class="code"><p class="da-divtext">AzCopy /?
</p></div><p>The basic syntax for AzCopy commands is:</p><div class="code"><p class="da-divtext">AzCopy /Source:&lt;source&gt; /Dest:&lt;destination&gt; [Options]
</p></div><p>✔️ AzCopy is available on Windows, Linux, and MacOS.</p><p>For more information, <a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy" title="" target="_blank">Get started with AZCopy</a>.</p><h3 class="da-h3" id="1191682">Availability Zones</h3><p>Availability zones expand the level of control you have to maintain the availability of the applications and data on your VMs. An Availability Zone is a physically separate zone, within an Azure region. There are three Availability Zones per supported Azure region.</p><p>Each Availability Zone has a distinct power source, network, and cooling. By architecting your solutions to use replicated VMs in zones, you can protect your apps and data from the loss of a datacenter. If one zone is compromised, then replicated apps and data are instantly available in another zone.</p><p><span><img alt="" src="../Images/1192218-490356.png" width="" height="" /></span></p><p><b>Fault domains</b></p><p>A fault domain is a logical group of underlying hardware that share a common power source and network switch, similar to a rack within an on-premises datacenter.</p><p><b>Update domains</b></p><p>An update domain is a logical group of underlying hardware that can undergo maintenance or be rebooted at the same time.</p><p>This approach ensures that at least one instance of your application always remains running as the Azure platform undergoes periodic maintenance. The order of update domains being rebooted may not proceed sequentially during maintenance, but only one update domain is rebooted at a time.</p><h3 class="da-h3" id="1191770">Demonstration - Securing Storage Endpoints</h3><p>In this demonstration, we will create a storage accounts, upload a file, and secure the file endpoint.</p><p><b>Create a storage account in the portal</b></p><ol class="number"><li><p>In the Azure portal, select <b>All services</b>. In the list of resources, type Storage Accounts. As you begin typing, the list filters based on your input. Select <b>Storage Accounts</b>.</p></li><li><p>On the Storage Accounts window that appears, choose <b>Add</b>.</p></li><li><p>Select the <b>subscription</b> in which to create the storage account.</p></li><li><p>Under the Resource group field, select <b>Create new</b>. Enter a name for your new resource group.</p></li><li><p>Enter a <b>name</b> for your storage account. The name you choose must be unique across Azure. The name also must be between 3 and 24 characters in length, and can include numbers and lowercase letters only.</p></li><li><p>Select a <b>location</b> for your storage account, or use the default location.</p></li><li><p>Leave these fields set to their default values:</p><ul class="square"><li class="square"><p>Deployment model:	<b>Resource Manager</b></p></li><li class="square"><p>Performance:	<b>Standard</b></p></li><li class="square"><p>Account kind:	<b>StorageV2 (general-purpose v2)</b></p></li><li class="square"><p>Replication:	<b>Locally redundant storage (LRS)</b></p></li><li class="square"><p>Access tier:	<b>Hot</b></p></li></ul></li><li><p>Select <b>Review + Create</b> to review your storage account settings and create the account.</p></li><li><p>Select <b>Create</b>.</p></li><li><p>If you have time, review the PowerShell and CLI code at the end of this demonstration.</p></li></ol><p><b>Upload a file to the storage account</b></p><ol class="number"><li><p>Within the Storage Account, create a <b>file share</b>, and <b>upload</b> a file.</p></li><li><p>For the Storage Account, use the <b>Shared Access Signature</b> blade to <b>Generate SAS and connection string</b>.</p></li><li><p>Use Storage Explorer and the connection string to access the file share.</p></li><li><p>Ensure you can view your uploaded file.</p></li></ol><p><b>Note</b>: This part of the demonstration requires a virtual network with a subnet.</p><p><b>Create a subnet service endpoint</b></p><ol class="number"><li><p>Select your virtual network, and then select a subnet in the virtual network.</p></li><li><p>Under <b>Service Endpoints</b>, view the <b>Services</b> drop-down and the different services that can be secured with an endpoint.</p></li><li><p>Check the <b>Microsoft.Storage</b> option.</p></li><li><p><b>Save</b> your changes.</p></li></ol><p><b>Secure the storage to the service endpoint</b></p><ol class="number"><li><p>Return to your <b>storage account</b>.</p></li><li><p>Select <b>Firewalls and virtual networks</b>.</p></li><li><p>Change to <b>Selected networks</b>.</p></li><li><p>Add existing virtual network, verify your subnet with the new service endpoint is listed.</p></li><li><p><b>Save</b> your changes.</p></li></ol><p><b>Test the storage endpoint</b></p><ol class="number"><li><p>Return to the Storage Explorer.</p></li><li><p><b>Refresh</b> the storage account.</p></li><li><p>You should now have an access error similar to this one:</p></li></ol><p><span><img alt="" src="../Images/1192191-490329.png" width="" height="" /></span></p><p><b>Create a storage account using PowerShell (optional)</b></p><p>Use the following code to create a storage account using PowerShell. Swap out the storage types and names to suit your requirements.</p><div class="code language-PowerShell"><p class="da-divtext"><code>Get<span class="token operator">-</span>AzLocation <span class="token punctuation">|</span> <span class="token function">select</span> Location
<span class="token variable">$location</span> = <span class="token string">"westus"</span>
<span class="token variable">$resourceGroup</span> = <span class="token string">"storage-demo-resource-group"</span>
New<span class="token operator">-</span>AzResourceGroup <span class="token operator">-</span>Name <span class="token variable">$resourceGroup</span> <span class="token operator">-</span>Location <span class="token variable">$location</span>
New<span class="token operator">-</span>AzStorageAccount <span class="token operator">-</span>ResourceGroupName <span class="token variable">$resourceGroup</span> <span class="token operator">-</span>Name <span class="token string">"storagedemo"</span> <span class="token operator">-</span>Location <span class="token variable">$location</span> <span class="token operator">-</span>SkuName Standard_LRS <span class="token operator">-</span>Kind StorageV2</code></p></div><p><b>Create a storage account using Azure CLI (optional)</b></p><p>Use the following code to create a storage account using Azure CLI. Change the storage types and names to suit your requirements.</p><div class="code language-CLI"><p class="da-divtext">az group create --name storage-resource-group --location westus 
az account list-locations --query "[].{Region:name}" --out table 
az storage account create --name storagedemo --resource-group storage-resource-group --location westus --sku Standard_LRS --kind StorageV2 
</p></div><p><b>Note</b>: If you plan to use the storage account in other scenarios be sure to return the account to <b>All networks</b> in the <b>Firewalls and virtual networks</b> blade.</p><h3 class="da-h3" id="1191775">Demonstration - AzCopy</h3><p>In this demonstration, we will explore AzCopy.</p><p><b>Install the AzCopy tool</b></p><ol class="number"><li><p>Download your version of AZCopy - <a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-use-azcopy-v10" title="" target="_blank">Get started with AZCopy</a></p></li><li><p>Install and launch the tool.</p></li></ol><p><b>Explore the help</b></p><ol class="number"><li><p>View the help.</p></li></ol><div class="code"><p class="da-divtext">azcopy /?
</p></div><ol class="number"><li value="2"><p>Scroll to the top of the Help information and read about the <b>Common options</b>, like: source, destination, source key, and destination key.</p></li><li><p>Scroll down the <b>Samples</b> section. We will be trying several of these examples. Are any of these examples particularly interesting to you?</p></li></ol><p><b>Download a blob from Blob storage to the file system</b></p><p><b>Note</b>: This example requires an Azure storage account with blob container and blob file. You will also need to capture parameters in a text editor like Notepad.</p><ol class="number"><li><p>Access the Azure portal.</p></li><li><p>Access your storage account with the blob you want to download.</p></li><li><p>Select <b>Access keys</b> and copy the <b>Key Key1</b> value. This will be the <i>sourcekey:</i> value.</p></li><li><p>Drill down to the blob of interest, and view the file <b>Properties</b>.</p></li><li><p>Copy the <b>URL</b> information. This will be the <i>source:</i> value.</p></li><li><p>Locate a local destination directory. This will be the <i>dest:</i> value. A filename is also required.</p></li><li><p>Construct the command using your values.</p></li></ol><div class="code"><p class="da-divtext">azcopy  /source:sourceURL /dest:destinationdirectoryandfilename /sourcekey:"key"
</p></div><ol class="number"><li value="8"><p>If you have errors, read them carefully and make corrections.</p></li><li><p>Verify the blob was downloaded to your local directory.</p></li></ol><p><b>Upload files to Azure blob storage</b></p><p>✔️<b>Note:</b> The example continues from the previous example and requires a local directory with files.</p><ol class="number"><li><p>The <i>source:</i> for the command will be a local directory with files.</p></li><li><p>The <i>dest:</i> will the blob URL used in the previous example. Be sure to remove the filename, just include the storage account and container.</p></li><li><p>The <i>destkey:</i> will the key used in the previous example.</p></li><li><p>Construct the command using your values.</p></li></ol><div class="code"><p class="da-divtext">azcopy /source:source /dest:destinationcontainer /destkey:key
</p></div><ol class="number"><li value="5"><p>If you have errors, read them carefully and make corrections.</p></li><li><p>Verify your local files were copied to the Azure container.</p></li><li><p>Notice there are switches to recurse subdirectories and pattern match.</p></li></ol><h3 class="da-h3" id="1191777">Lab - Implementing and Configuring Azure Storage File and Blob Services</h3><p>✔️ <b>Important:</b> To download the most recent version of this lab, please visit the AZ-303 <a href="https://github.com/MicrosoftLearning/AZ-303-Microsoft-Azure-Architect-Technologies" title="" target="_blank">GitHub repository</a>.</p><p>Direct link to the <a href="https://aka.ms/303_Module_06_Lab" title="" target="_blank">Lab: Implementing and Configuring Azure Storage File and Blob Services</a>.</p><h4 class="da-h4">Lab scenario</h4><p><span><img alt="" src="../Images/1192088-490226.png" width="" height="" /></span></p><p>
 
Adatum Corporation hosts large amounts of unstructured and semi-structured data in its on-premises storage. Its maintenance becomes increasingly complex and costly. Some of the data is preserved for extensive amount of time to address data retention requirements. The Adatum Enterprise Architecture team is looking for inexpensive alternatives that would support tiered storage, while, at the same time allow for secure access that minimizes the possibility of data exfiltration. While the team is aware of practically unlimited capacity offered by Azure Storage, it is concerned about the usage of account keys, which grant unlimited access to the entire content of the corresponding storage accounts. While keys can be rotated in an orderly manner, such operation needs to be carried out with proper planning. In addition, access keys constitute exclusively an authorization mechanism, which limits the ability to properly audit their usage.
</p><p>To address these shortcomings, the Architecture team decided to explore the use of shared access signatures. A shared access signature (SAS) provides secure delegated access to resources in a storage account while minimizing the possibility of unintended data exposure. SAS offers granular control over data access, including the ability to limit access to an individual storage object, such as a blob, restricting such access to a custom time window, as well as filtering network access to a designated IP address range. In addition, the Architecture team wants to evaluate the level of integration between Azure Storage and Azure Active Directory, hoping to address its audit requirements. The Architecture team also decided to determine suitability of Azure Files as an alternative to some of its on-premises file shares.</p><p>To accomplish these objectives, Adatum Corporation will test a range of authentication and authorization mechanisms for Azure Storage resources, including:</p><ul class="square"><li class="square"><p>Using shared access signatures on the account, container, and object-level</p></li><li class="square"><p>Configuring access level for blobs</p></li><li class="square"><p>Implementing Azure Active Directory based authorization</p></li><li class="square"><p>Using storage account access keys</p></li></ul><h4 class="da-h4">Objectives</h4><p>After completing this lab, you will be able to:</p><ul class="square"><li class="square"><p>Implement authorization of Azure Storage blobs by leveraging shared access signatures</p></li><li class="square"><p>Implement authorization of Azure Storage blobs by leveraging Azure Active Directory</p></li><li class="square"><p>Implement authorization of Azure Storage file shares by leveraging access keys</p></li></ul><h4 class="da-h4">Lab Environment</h4><p>Windows Server admin credentials</p><ul class="square"><li class="square"><p>User Name: <b>Student</b></p></li><li class="square"><p>Password: <b>Pa55w.rd1234</b></p></li></ul><p>Estimated Time: 60 minutes</p><h4 class="da-h4">Lab Files (Located in the GitHub repository listed above)</h4><ul class="square"><li class="square"><p>\\AZ303\AllFiles\Labs\02\azuredeploy30302suba.json</p></li><li class="square"><p>\\AZ303\AllFiles\Labs\02\azuredeploy30302rga.json</p></li><li class="square"><p>\\AZ303\AllFiles\Labs\02\azuredeploy30302rga.parameters.json</p></li></ul><h5 class="da-h5">Exercise 0: Prepare the lab environment</h5><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Deploy an Azure VM by using an Azure Resource Manager template</p></li></ol><h4 class="da-h4">Exercise 1: Configure Azure Storage account authorization by using shared access signature.</h4><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Create an Azure Storage account</p></li><li><p>Install Storage Explorer</p></li><li><p>Generate an account-level shared access signature</p></li><li><p>Create a blob container by using Azure Storage Explorer</p></li><li><p>Upload a file to a blob container by using AzCopy</p></li><li><p>Access a blob by using a blob-level shared access signature</p></li></ol><h5 class="da-h5">Exercise 2: Configure Azure Storage blob service authorization by using Azure Active Directory</h5><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Create an Azure AD user</p></li><li><p>Enable Azure Active Directory authorization for Azure Storage blob service</p></li><li><p>Upload a file to a blob container by using AzCopy</p></li></ol><h5 class="da-h5">Exercise 3: Implement Azure Files.</h5><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Create an Azure Storage file share</p></li><li><p>Map a drive to an Azure Storage file share from Windows</p></li><li><p>Remove Azure resources deployed in the lab</p></li></ol><h3 class="da-h3" id="1191681">Availability Sets</h3><p>Workloads are typically spread across different virtual machines to gain high throughput, performance, and to create redundancy in case a VM is impacted due to an update or other event.</p><p>There are few options that Azure provides to achieve High Availability.</p><p>An availability set is a logical grouping of VMs within a datacenter that allows Azure to understand how your application is built to provide for redundancy and availability.</p><p>It is recommended that two or more VMs are created within an availability set to provide for a highly available application and to meet the 99.95% Azure SLA. There is no cost for the Availability Set itself, you only pay for each VM instance that you create.</p><p>In an availability set, VMs are automatically distributed across these fault domains. This approach limits the impact of potential physical hardware failures, network outages, or power interruptions.</p><p>For VMs using Azure Managed Disks, VMs are aligned with managed disk fault domains when using a managed availability set. This alignment ensures that all the managed disks attached to a VM are within the same managed disk fault domain.</p><p>Only VMs with managed disks can be created in a managed availability set. The number of managed disk fault domains varies by region - either two or three managed disk fault domains per region.</p><p><span><img alt="" src="../Images/1192307-490445.png" width="" height="" /></span></p><p>VMs within an availability set are also automatically distributed across update domains.</p><p><span><img alt="" src="../Images/1192308-490446.png" width="" height="" /></span></p><h3 class="da-h3" id="1191841">Implement a New Custom Policy</h3><p><b>Scenario</b>: create a new custom policy to save costs by validating that VMs created in your environment can't be in the G series. This way, every time a user in your organization tries to create VM in the G series, the request is denied.</p><ol class="number"><li><p>Select <b>Definitions</b> under <b>Authoring</b> in the left side of the Azure Policy page.</p></li></ol><p><span><img alt="" src="../Images/1192189-490327.png" width="" height="" /></span></p><ol class="number"><li value="2"><p>Select <b>+ Policy definition</b> at the top of the page. This button opens to the <b>Policy definition</b> page.</p></li><li><p>Enter the following information:</p></li></ol><ul class="square"><li class="square"><p>The management group or subscription in which the policy definition is saved. Select by using the ellipsis on <b>Definition location</b>.</p></li><li class="square"><p>The name of the policy definition - *_<i>Require VM SKUs smaller than the G series</i>.</p></li><li class="square"><p>The description of what the policy definition is intended to do <i>– This policy definition enforces that all VMs created in this scope have SKUs smaller than the G series to reduce cost</i>.</p></li><li class="square"><p>Choose from existing options (such as <i>Compute)</i>, or create a new category for this policy definition.</p></li><li class="square"><p>Copy the following JSON code and then update it for your needs with:</p><ul class="square"><li class="square"><p>The policy parameters.</p></li><li class="square"><p>The policy rules/conditions, in this case – VM SKU size equal to G series</p></li><li class="square"><p>The policy effect, in this case – <b>Deny</b>.</p></li></ul></li></ul><p>Here's what the JSON should look like. Paste your revised code into the Azure portal.</p><div class="code language-JSON"><p class="da-divtext"><code><span class="token punctuation">{</span>
    <span class="token property">"policyRule"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"if"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"allOf"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
                    <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"type"</span><span class="token punctuation">,</span>
                    <span class="token property">"equals"</span><span class="token operator">:</span> <span class="token string">"Microsoft.Compute/virtualMachines"</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"Microsoft.Compute/virtualMachines/sku.name"</span><span class="token punctuation">,</span>
                    <span class="token property">"like"</span><span class="token operator">:</span> <span class="token string">"Standard_G*"</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"then"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"effect"</span><span class="token operator">:</span> <span class="token string">"deny"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></p></div><p>The <i>field</i> property in the policy rule must be a supported value. A full list of values is found on <b>policy definition structure</b> fields. An example of an alias might be <span class="code">Microsoft.Compute/VirtualMachines/Size</span>.</p><ol class="number"><li value="4"><p>Select <b>Save</b>.</p></li></ol><h3 class="da-h3" id="1191826">Module 9 Review Questions</h3><p><span><img alt="" src="../Images/1192029-490167.png" width="" height="" /></span></p><h4 class="problem">Review Question 1</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-9b768420-a4bc-60aa-cfb3-fd6168715704"><div class="card quizlib-question"><div class="quizlib-question-title"><p>Which of the following best describes the format of an Azure Resource Manager template? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q9b768420-a4bc-60aa-cfb3-fd6168715704" value="1" />A Markdown document with a pointer table<br /></label></li><li><label><input type="radio" name="q9b768420-a4bc-60aa-cfb3-fd6168715704" value="2" />A JSON document with key-value pairs<br /></label></li><li><label><input type="radio" name="q9b768420-a4bc-60aa-cfb3-fd6168715704" value="3" />A TXT document with key-value pairs<br /></label></li><li><label><input type="radio" name="q9b768420-a4bc-60aa-cfb3-fd6168715704" value="4" />An XML document with element-value pairs<br /></label></li></ul></div></div><div id="feedback-problem-9b768420-a4bc-60aa-cfb3-fd6168715704" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">A JSON document with key-value pairs. An Azure Resource Template is a JSON document with key-value pairs.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 2</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-e68a4a56-b125-671a-3f3f-12b952a6adc3"><div class="card quizlib-question"><div class="quizlib-question-title"><p>Your manager asks you to explain how Azure uses resource groups. You provide all of the following information, except? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="qe68a4a56-b125-671a-3f3f-12b952a6adc3" value="1" />Resources can be in only one resource group.<br /></label></li><li><label><input type="radio" name="qe68a4a56-b125-671a-3f3f-12b952a6adc3" value="2" />Resources can be moved from one resource group to another resource group.<br /></label></li><li><label><input type="radio" name="qe68a4a56-b125-671a-3f3f-12b952a6adc3" value="3" />Resource groups can be nested.<br /></label></li><li><label><input type="radio" name="qe68a4a56-b125-671a-3f3f-12b952a6adc3" value="4" />Role-based access control can be applied to the resource group.<br /></label></li></ul></div></div><div id="feedback-problem-e68a4a56-b125-671a-3f3f-12b952a6adc3" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Resource groups cannot be nested.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 3</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-f6913d48-dbe8-a338-22c8-cefec55dc135"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You are creating a new resource group to use for testing. Which two of the following parameters are required when you create a resource group with PowerShell or the CLI? Select two.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="checkbox" name="qf6913d48-dbe8-a338-22c8-cefec55dc135" value="1" />Location<br /></label></li><li><label><input type="checkbox" name="qf6913d48-dbe8-a338-22c8-cefec55dc135" value="2" />Name<br /></label></li><li><label><input type="checkbox" name="qf6913d48-dbe8-a338-22c8-cefec55dc135" value="3" />Region<br /></label></li><li><label><input type="checkbox" name="qf6913d48-dbe8-a338-22c8-cefec55dc135" value="4" />Subscription<br /></label></li><li><label><input type="checkbox" name="qf6913d48-dbe8-a338-22c8-cefec55dc135" value="5" />Tag<br /></label></li></ul></div></div><div id="feedback-problem-f6913d48-dbe8-a338-22c8-cefec55dc135" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Location and Name are required by PowerShell (New-AzResourceGroup) and the CLI (az group create).<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h3 class="da-h3" id="1191824">Demonstration-Create and run a workflow runbook</h3><p>This walkthrough will create a new PowerShell workflow runbook, test,  publish and then run the runbook.</p><h4 class="da-h4">Prerequisites</h4><p>✔️ Note: You require an Azure subscription to perform the following steps. If you don't have one you can create one by following the steps outlined on the <a href="https://azure.microsoft.com/en-us/free/?ref=microsoft.com&amp;utm_source=microsoft.com&amp;utm_medium=docs&amp;utm_campaign=visualstudio" target="_blank"><span>Create your Azure free account today</span></a> webpage.</p><h4 class="da-h4">Steps</h4><h5 class="da-h5">Create a new runbook</h5><ol class="number"><li><p>In the <b>Azure portal</b>, open your Automation account.</p></li><li><p>Under <b>Process Automation</b>, select <b>Runbooks</b> to open the list of runbooks.</p></li><li><p>Create a new runbook by selecting the <b>Create a new runbook</b>.</p></li><li><p>Give the runbook the name <b>MyFirstRunbook-Workflow</b>.</p></li><li><p>You're going to create a PowerShell Workflow runbook, so for <b>Runbook type</b>, select <b>Powershell Workflow</b>.</p></li><li><p>Select <b>Create</b> to create the runbook and open the text editor.</p></li></ol><h5 class="da-h5">Add code to a runbook</h5><p>You have two options when adding code to a runbook. You can type code directly into the runbook, or you can select cmdlets, runbooks, and assets from the Library control and have them added to the runbook, along with any related parameters.</p><p>For this walkthrough, you'll use the type directly into the runbook method, as detailed in the following steps:</p><ol class="number"><li><p>Type <b>Write-Output "Hello World."</b> between the braces, as per the below:</p></li></ol><div class="code language-Powershell"><p class="da-divtext"><code><span class="token keyword">Workflow</span> MyFirstRunbook<span class="token operator">-</span><span class="token keyword">Workflow</span>
<span class="token punctuation">{</span>
<span class="token function">Write-Output</span> <span class="token string">"Hello World"</span>
<span class="token punctuation">}</span></code></p></div><ol class="number"><li value="2"><p>Save the runbook by selecting <b>Save</b>.</p></li></ol><p><span><img alt="" src="../Images/1192174-490312.png" width="" height="" /></span></p><h5 class="da-h5">Test the runbook</h5><p>Before you publish the runbook to production, you want to test it to ensure that it works properly. When you test a runbook, you run the draft version and view its output interactively, as demonstrated in the following steps:</p><ol class="number"><li><p>Select the <b>Test</b> pane.</p></li></ol><p><span><img alt="" src="../Images/1192175-490313.png" width="" height="" /></span></p><ol class="number"><li value="2"><p>Select <b>Start</b> to start the test. This should be the only enabled option.</p></li></ol><p><span><img alt="" src="../Images/1192176-490314.png" width="" height="" /></span></p><p>A runbook job is created and its status displayed. The job status will start as Queued indicating that it is waiting for a runbook worker in the cloud to come available. It moves to Starting when a worker claims the job, and then Running when the runbook actually starts running. When the runbook job completes, its output displays. In your case, you should see Hello World.</p><ol class="number"><li value="3"><p>When the runbook job finishes, close the <b>Test pane</b>.</p></li></ol><p><span><img alt="" src="../Images/1192177-490315.png" width="" height="" /></span></p><h5 class="da-h5">Publish and run the runbook</h5><p>The runbook that you created is still in draft mode. You need to publish it before you can run it in production. When you publish a runbook, you overwrite the existing published version with the draft version. In your case, you don't have a published version yet because you just created the runbook.</p><p>Use the following steps to publish your runbook:</p><ol class="number"><li><p>In the runbook editor, select <b>Publish</b> to publish the runbook.</p></li><li><p>When prompted, select <b>Yes</b>.</p></li><li><p>Scroll left to view the runbook in the Runbooks pane, and ensure that it shows an <b>Authoring Status</b> of <b>Published</b>.</p></li><li><p>Scroll back to the right to view the pane for <b>MyFirstRunbook-Workflow</b>. Notice the options across the top:</p></li></ol><ul class="square"><li class="square"><p>Start</p></li><li class="square"><p>View</p></li><li class="square"><p>Edit</p></li><li class="square"><p>Link to schedule to start at some time in the future</p></li><li class="square"><p>Add a webhook</p></li><li class="square"><p>Delete</p></li><li class="square"><p>Export</p></li></ul><p><span><img alt="" src="../Images/1192178-490316.png" width="" height="" /></span></p><ol class="number"><li value="5"><p>You just want to start the runbook, so select <b>Start</b>, and then when prompted, select <b>Yes</b>.</p></li><li><p>When the job pane opens for the runbook job that you created, leave it open so you can watch the job's progress.</p></li><li><p>Verify that at when the job completes, the job statuses that display in <b>Job Summary</b> match the statuses that you saw when you tested the runbook.</p></li></ol><p><span><img alt="" src="../Images/1192179-490317.png" width="" height="" /></span></p><h3 class="da-h3" id="1191836">Azure AD Access Reviews</h3><p>Azure Active Directory (Azure AD) access reviews enable organizations to efficiently manage group memberships, access to enterprise applications, and role assignments.</p><p>User's access can be reviewed on a regular basis to make sure only the right people have continued access.</p><h4 class="da-h4">Why are access reviews important?</h4><p>Azure AD enables you to collaborate internally within your organization and with users from external organizations, such as partners.</p><ul class="square"><li class="square"><p>As new employees join, how do you ensure they have the right access to be productive?</p></li><li class="square"><p>As people move teams or leave the company, how do you ensure their old access is removed, especially when it involves guests?</p></li><li class="square"><p>Excessive access rights can lead to audit findings and compromises as they indicate a lack of control over access.</p></li><li class="square"><p>You must proactively engage with resource owners to ensure they regularly review who has access to their resources.</p></li></ul><h4 class="da-h4">When to use access reviews?</h4><ul class="square"><li class="square"><p>Too many users in privileged roles</p></li><li class="square"><p>When a group is used for a new purpose</p></li><li class="square"><p>Business critical data access</p></li><li class="square"><p>To maintain a policy's exception list</p></li><li class="square"><p>Ask group owners to confirm they still need guests in their groups</p></li></ul><h4 class="da-h4">Where do you create reviews?</h4><p>Depending on what you want to review, you will create your access review in Azure AD access reviews, Azure AD enterprise apps (in preview), or Azure AD PIM.</p><table style="width:100%" class=""><col width="25%" /><col width="25%" /><col width="25%" /><col width="25%" /><thead><tr><td><p><b>Access rights of users</b></p></td><td><p><b>Reviewers can be…</b></p></td><td><p><b>Review created in…</b></p></td><td><p><b>Reviewer experience</b></p></td></tr></thead><tbody><tr><td><p><b>Security group members Office group members</b></p></td><td><p>Specified reviewers Group owners Self-review</p></td><td><p>Azure AD access reviews Azure AD groups</p></td><td><p>Access panel</p></td></tr><tr><td><p><b>Assigned to a connected app</b></p></td><td><p>Specified reviewers Self-review</p></td><td><p>Azure AD access reviews Azure AD enterprise apps (in preview)</p></td><td><p>Access panel</p></td></tr><tr><td><p><b>Azure AD role</b></p></td><td><p>Specified reviewers Self-review</p></td><td><p>Azure AD PIM</p></td><td><p>Azure portal</p></td></tr><tr><td><p><b>Azure resource role</b></p></td><td><p>Specified reviewers Self-review</p></td><td><p>Azure AD PIM</p></td><td><p>Azure portal</p></td></tr></tbody></table><h3 class="da-h3" id="1191930">App Service Plan Scaling</h3><p>There are two workflows for Web App scaling, <b>scale up</b> and <b>scale out</b>. Apps can be scaled manually or automatically (autoscale).</p><p><span><img alt="" src="../Images/1192069-490207.png" width="" height="" /></span></p><p><b>Scale up</b>. Get more CPU, memory, disk space, and extra features like dedicated virtual machines (VMs), custom domains and certificates, staging slots, autoscaling, and more. You scale up by changing the pricing tier of the App Service plan that your app belongs to.</p><p><b>Scale out</b>: Increase the number of VM instances that run your app. You can scale out to as many as 30 instances, depending on your pricing tier. App Service Environments in Isolated tier further increases your scale-out count to 100 instances. The scale instance count can be configured manually or automatically (autoscale). Autoscale is based on predefined rules and schedules.</p><h4 class="da-h4">Changing your App Service plan (scale up)</h4><p>Your App Service plan can be scaled up and down at any time. It is as simple as changing the pricing tier of the plan. You can choose a lower pricing tier at first and scale up later when you need more App Service features.</p><p>For example, you can start testing your web app in a Free App Service plan and pay nothing. When you want to add your custom DNS name to the web app, just scale your plan up to the Shared tier. Later, when you want to create an SSL binding, scale your plan up to Basic tier. When you want to have staging environments, scale up to Standard tier. When you need more cores, memory, or storage, scale up to a bigger VM size in the same tier.</p><p>The same works in the reverse. When you feel you no longer need the capabilities or features of a higher tier, you can scale down to a lower tier, which saves you money.</p><h4 class="da-h4">Other considerations</h4><ul class="square"><li class="square"><p>The scale settings take only seconds to apply and affect all apps in your App Service plan. They don't require you to change your code or redeploy your application.</p></li><li class="square"><p>If your app depends on other services, such as Azure SQL Database or Azure Storage, you can scale up these resources separately. These resources aren't managed by the App Service plan.</p></li></ul><h3 class="da-h3" id="1191839">Azure Policy Overview</h3><p>Azure Policy is an Azure service you use to create, assign and, manage policies. These policies enforce different rules and effects over your resources so that those resources stay compliant with your corporate standards and service level agreements.</p><h4 class="da-h4">How are Azure Policy and RBAC different?</h4><p>At first glance, it might seem like Azure Policy is a way to restrict access to specific resource types similar to role-based access control (RBAC). However, they solve different problems. RBAC focuses on user actions at <i>different scopes</i>. You might be added to the contributor role for a resource group, allowing you to make changes to anything in that resource group. Azure Policy focuses on <i>resource properties during deployment</i> and for already-existing resources. Azure Policy controls properties such as the types or locations of resources. Unlike RBAC, Azure Policy is a <b>default-allow-and-explicit-deny system</b>.</p><h4 class="da-h4">Creating a policy</h4><p>The process of creating and implementing an Azure Policy begins with creating a <i>policy definition</i>. Every policy definition has conditions under which it is enforced. And, it has an accompanying effect that takes place if the conditions are met. To apply a policy, you will:</p><ol class="number"><li><p>Create a policy definition</p></li><li><p>Assign a definition to a scope of resources</p></li><li><p>View policy evaluation results</p></li></ol><h4 class="da-h4">What is a policy definition?</h4><p>A <i>policy definition</i> expresses what to evaluate and what action to take. For example, you could ensure all public websites are secured with HTTPS, prevent a storage type from being created, or force a specific version of SQL Server to be used.</p><p>Below are the most common policy definitions you can apply.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Policy definition</p></td><td><p>Description</p></td></tr></thead><tbody><tr><td><p><b>Allowed Storage Account SKUs</b></p></td><td><p>This policy definition has a set of conditions/rules that determine whether a storage account that is being deployed is within a set of SKU sizes. Its effect is to deny all storage accounts that do not adhere to the set of defined SKU sizes.</p></td></tr><tr><td><p><b>Allowed Resource Type</b></p></td><td><p>This policy definition has a set of conditions/rules to specify the resource types that your organization can deploy. Its effect is to deny all resources that are not part of this defined list.</p></td></tr><tr><td><p><b>Allowed Locations</b></p></td><td><p>This policy enables you to restrict the locations that your organization can specify when deploying resources. Its effect is used to enforce your geographic compliance requirements.</p></td></tr><tr><td><p><b>Allowed Virtual Machine SKUs</b></p></td><td><p>This policy enables you to specify a set of VM SKUs that your organization can deploy.</p></td></tr><tr><td><p><b>Not allowed resource types</b></p></td><td><p>Prevents a list of resource types from being deployed.</p></td></tr></tbody></table><p>The policy definition itself is represented as a JSON file - you can use one of the pre-defined definitions in the portal or create your own (either modifying an existing one or starting from scratch).</p><p>Below is an example of a Compute policy that only allows specific virtual machine sizes:</p><div class="code language-JSON"><p class="da-divtext"><code><span class="token punctuation">{</span>
  <span class="token property">"if"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"allOf"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"type"</span><span class="token punctuation">,</span>
        <span class="token property">"equals"</span><span class="token operator">:</span> <span class="token string">"Microsoft.Compute/virtualMachines"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token property">"not"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"Microsoft.Compute/virtualMachines/sku.name"</span><span class="token punctuation">,</span>
          <span class="token property">"in"</span><span class="token operator">:</span> <span class="token string">"[parameters('listOfAllowedSKUs')]"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"then"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"effect"</span><span class="token operator">:</span> <span class="token string">"Deny"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></p></div><p>Notice the <span class="code">[parameters('listofAllowedSKUs')]</span> value; this value is a <i>replacement token</i> that will be filled in when the policy definition is applied to a scope. When a parameter is defined, it's given a name and optionally given a value.</p><h4 class="da-h4">What is an initiative definition?</h4><p>An initiative definition is a collection of policy definitions that are tailored towards achieving a singular overarching goal. Initiative definitions simplify managing and assigning policy definitions. They simplify by grouping a set of policies as one single item.</p><h3 class="da-h3" id="1191834">Demonstration - Add an Azure Role Assignment</h3><h4 class="da-h4">Prerequisites</h4><p>To add or remove role assignments, you must have:</p><ul class="square"><li class="square"><p><span class="code">Microsoft.Authorization/roleAssignments/write</span> and <span class="code">Microsoft.Authorization/roleAssignments/delete</span> permissions, such as U<i>ser Access Administrator</i> or <i>Owner</i>.</p></li></ul><p><b>Access control (IAM)</b> is the blade that you use to assign roles to grant access to Azure resources. It's also known as identity and access management and appears in several locations in the Azure portal. The following shows an example of the Access control (IAM) blade for a subscription.</p><p><span><img alt="" src="../Images/1192192-490330.png" width="" height="" /></span></p><p>To be the most effective with the Access control (IAM) blade, it helps if you can answer the following three questions when you are trying to assign a role:</p><p><b>1. Who needs access?</b></p><p>Who refers to a user, group, service principal, or managed identity. This is also called a <i>security principal</i>.</p><p><b>2. What role do they need?</b></p><p>Permissions are grouped together into roles. You can select from a list of several built-in roles or you can use your own custom roles.</p><p><b>3. Where do they need access?</b></p><p>Where refers to the set of resources that the access applies to. Where it can be a management group, subscription, resource group, or a single resource such as a storage account. This is called the <i>scope</i>.</p><h4 class="da-h4">Add a role assignment</h4><p>In Azure RBAC, to grant access to an Azure resource, you add a role assignment. Follow these steps to assign a role.</p><ol class="number"><li><p>In the Azure portal, click <b>All services</b> and then select the scope that you want to grant access to.</p></li><li><p>Click the specific resource for that scope.</p></li><li><p>Click <b>Access control (IAM)</b>.</p></li><li><p>Click the <b>Role assignments</b> tab to view the role assignments at this scope.</p></li></ol><p><span><img alt="" src="../Images/1192193-490331.png" width="" height="" /></span></p><ol class="number"><li value="5"><p>Click <b>Add</b> &gt; <b>Add role assignment</b>.</p></li></ol><p>If you don't have permissions to assign roles, the <b>Add role assignment</b> option will be disabled.</p><p><span><img alt="" src="../Images/1192194-490332.png" width="" height="" /></span></p><p>The <b>Add role assignment</b> pane opens.</p><p><span><img alt="" src="../Images/1192195-490333.png" width="" height="" /></span></p><ol class="number"><li value="6"><p>In the <b>Role</b> drop-down list, select a role such as <b>Virtual Machine Contributor</b>.</p></li><li><p>In the <b>Select</b> list, select a user, group, service principal, or managed identity. If you don't see the security principal in the list, you can type in the <b>Select</b> box to search the directory for display names, email addresses, and object identifiers.</p></li><li><p>Click <b>Save</b> to assign the role.</p></li></ol><p>After a few moments, the security principal is assigned the role at the selected scope.</p><p><span><img alt="" src="../Images/1192196-490334.png" width="" height="" /></span></p><h3 class="da-h3" id="1191814">Deploy an Azure VM from a VHD</h3><p>This topic describes how to deploy a generalized VHD image to create a new Azure VM resource, using the supplied Azure Resource Manager template and Azure PowerShell script.</p><p><b>VHD deployment template</b></p><p>Use the Azure Resource Manager template for <a href="https://docs.microsoft.com/en-us/azure/marketplace/cloud-partner-portal/virtual-machine/cpp-deploy-json-template" title="" target="_blank">VHD deployment</a> seen in the subsequent topic to a local file named <i>VHDtoImage.json</i>. Edit the file to provide values for the following parameters.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p><b>Parameter</b></p></td><td><p><b>Description</b></p></td></tr></thead><tbody><tr><td><p><b>ResourceGroupName</b></p></td><td><p>Existing Azure resource group name.  Typically use the same RG associated with your key vault</p></td></tr><tr><td><p><b>TemplateFile</b></p></td><td><p>Full pathname to the file VHDtoImage.json</p></td></tr><tr><td><p><b>userStorageAccountName</b></p></td><td><p>Name of the storage account</p></td></tr><tr><td><p><b>sNameForPublicIP</b></p></td><td><p>DNS name for the public IP. Must be lowercase</p></td></tr><tr><td><p><b>subscriptionId</b></p></td><td><p>Azure subscription identifier</p></td></tr><tr><td><p><b>Location</b></p></td><td><p>Standard Azure geographic location of the resource group</p></td></tr><tr><td><p><b>vmName</b></p></td><td><p>Name of the virtual machine</p></td></tr><tr><td><p><b>vaultName</b></p></td><td><p>Name of the key vault</p></td></tr><tr><td><p><b>vaultResourceGroup</b></p></td><td><p>Resource group of the key vault</p></td></tr><tr><td><p><b>certificateUrl</b></p></td><td><p>Url of the certificate, including version stored in the key vault, for example:  https://testault.vault.azure.net/secrets/testcert/b621es1db241e56a72d037479xab1r7</p></td></tr><tr><td><p><b>vhdUrl</b></p></td><td><p>URL of the virtual hard disk</p></td></tr><tr><td><p><b>vmSize</b></p></td><td><p>Size of the virtual machine instance</p></td></tr><tr><td><p><b>publicIPAddressName</b></p></td><td><p>Name of the public IP address</p></td></tr><tr><td><p><b>virtualNetworkName</b></p></td><td><p>Name of the virtual network</p></td></tr><tr><td><p><b>nicName</b></p></td><td><p>Name of the network interface card for the virtual network</p></td></tr><tr><td><p><b>adminUserName</b></p></td><td><p>Username of the administrator account</p></td></tr><tr><td><p><b>adminPassword</b></p></td><td><p>Administrator password</p></td></tr></tbody></table><p><b>Powershell script</b></p><p>Copy and edit the following script to supply values for the <span class="code">$storageaccount</span> and <span class="code">$vhdUrl</span> variables. Execute it to create an Azure VM resource from your existing generalized VHD.</p><div class="code language-PowerShell"><p class="da-divtext"><code><span class="token comment"># storage account of existing generalized VHD</span>
<span class="token variable">$storageaccount</span> = <span class="token string">"testwinrm11815"</span>

<span class="token comment"># generalized VHD URL</span>
<span class="token variable">$vhdUrl</span> = <span class="token string">"https://testwinrm11815.blob.core.windows.net/vhds/testvm1234562016651857.vhd"</span>

<span class="token function">echo</span> <span class="token string">"New-AzResourceGroupDeployment -Name "</span>dplisvvm<span class="token variable">$postfix</span><span class="token string">" -ResourceGroupName "</span><span class="token variable">$rgName</span><span class="token string">" -TemplateFile "</span>C:\certLocation\VHDtoImage<span class="token punctuation">.</span>json<span class="token string">" -userStorageAccountName "</span><span class="token variable">$storageaccount</span><span class="token string">" -dnsNameForPublicIP "</span><span class="token variable">$vmName</span><span class="token string">" -subscriptionId "</span><span class="token variable">$mysubid</span><span class="token string">" -location "</span><span class="token variable">$location</span><span class="token string">" -vmName "</span><span class="token variable">$vmName</span><span class="token string">" -vaultName "</span><span class="token variable">$kvname</span><span class="token string">" -vaultResourceGroup "</span><span class="token variable">$rgName</span><span class="token string">" -certificateUrl <span class="token variable">$objAzureKeyVaultSecret</span>.Id  -vhdUrl "</span><span class="token variable">$vhdUrl</span><span class="token string">" -vmSize "</span>Standard_A2<span class="token string">" -publicIPAddressName "</span>myPublicIP1<span class="token string">" -virtualNetworkName "</span>myVNET1<span class="token string">" -nicName "</span>myNIC1<span class="token string">" -adminUserName "</span>isv<span class="token string">" -adminPassword <span class="token variable">$pwd</span>"</span>

<span class="token comment">#deploying VM with existing VHD</span>
New<span class="token operator">-</span>AzResourceGroupDeployment <span class="token operator">-</span>Name <span class="token string">"dplisvvm<span class="token variable">$postfix</span>"</span> <span class="token operator">-</span>ResourceGroupName <span class="token string">"<span class="token variable">$rgName</span>"</span> <span class="token operator">-</span>TemplateFile <span class="token string">"C:\certLocation\VHDtoImage.json"</span> <span class="token operator">-</span>userStorageAccountName <span class="token string">"<span class="token variable">$storageaccount</span>"</span> <span class="token operator">-</span>dnsNameForPublicIP <span class="token string">"<span class="token variable">$vmName</span>"</span> <span class="token operator">-</span>subscriptionId <span class="token string">"<span class="token variable">$mysubid</span>"</span> <span class="token operator">-</span>location <span class="token string">"<span class="token variable">$location</span>"</span> <span class="token operator">-</span>vmName <span class="token string">"<span class="token variable">$vmName</span>"</span> <span class="token operator">-</span>vaultName <span class="token string">"<span class="token variable">$kvname</span>"</span> <span class="token operator">-</span>vaultResourceGroup <span class="token string">"<span class="token variable">$rgName</span>"</span> <span class="token operator">-</span>certificateUrl <span class="token variable">$objAzureKeyVaultSecret</span><span class="token punctuation">.</span>Id  <span class="token operator">-</span>vhdUrl <span class="token string">"<span class="token variable">$vhdUrl</span>"</span> <span class="token operator">-</span>vmSize <span class="token string">"Standard_A2"</span> <span class="token operator">-</span>publicIPAddressName <span class="token string">"myPublicIP1"</span> <span class="token operator">-</span>virtualNetworkName <span class="token string">"myVNET1"</span> <span class="token operator">-</span>nicName <span class="token string">"myNIC1"</span> <span class="token operator">-</span>adminUserName <span class="token string">"isv"</span> <span class="token operator">-</span>adminPassword <span class="token variable">$pwd</span></code></p></div><h3 class="da-h3" id="1191947">Logic Apps Designer</h3><p>The Logic Apps Designer is a graphical tool for creating your workflows. It gives you a design canvas that you use to add a trigger and actions to your app. For example, the social-media monitor app uses the <i>When a new tweet is posted</i> trigger, a <i>Condition</i> to branch, and the <i>Detect Sentiment, Insert row</i>, and <i>Send an email</i> actions. The following screenshot shows the social-media monitor Logic App displayed in the Designer.</p><p><span><img alt="" src="../Images/1192077-490215.png" width="" height="" /></span></p><h3 class="da-h3" id="1191948">Demonstration - Create a Workflow using Azure Logic Apps</h3><p>In this demonstration, you build a logic app that regularly checks a website's RSS feed for new items. If new items exist, the logic app sends an email for each item. When you're done, your logic app looks like this workflow at a high level:</p><p><span><img alt="" src="../Images/1192318-490456.png" width="" height="" /></span></p><p>For this scenario, you need an Azure and an email account from a service that's supported by Azure Logic Apps, such as, Outlook.com, or Gmail.</p><h4 class="da-h4">Create your logic app</h4><p>Sign in to the <a href="https://portal.azure.com/" title="" target="_blank">Azure portal</a> with your Azure account credentials.</p><ol class="number"><li><p>From the Azure home page, in the search box, find and select <b>Logic Apps</b>.</p></li></ol><p><span><img alt="" src="../Images/1192319-490457.png" width="" height="" /></span></p><ol class="number"><li value="2"><p>On the <b>Logic Apps</b> page, select <b>Add</b>.</p></li></ol><p><span><img alt="" src="../Images/1192320-490458.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>On the <b>Logic App</b> pane, provide details about your logic app as shown below. After you're done, select <b>Create</b>.</p></li></ol><p><span><img alt="" src="../Images/1192321-490459.png" width="" height="" /></span></p><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p>Property</p></td><td><p>Value</p></td><td><p>Description</p></td></tr></thead><tbody><tr><td><p><b>Name</b></p></td><td><p><i>logic-app-name</i></p></td><td><p>Your logic app name, which can contain only letters, numbers, hyphens (-), underscores (_), parentheses ((, )), and periods (.). This example uses “My-First-Logic-App”.</p></td></tr><tr><td><p><b>Subscription</b></p></td><td><p><i>Azure-subscription-name</i></p></td><td><p>Your Azure subscription name</p></td></tr><tr><td><p><b>Resource group</b></p></td><td><p><i>Azure-resource-group-name</i></p></td><td><p>The name for the Azure resource group used to organize related resources. This example uses "My-First-LA-RG".</p></td></tr><tr><td><p><b>Location</b></p></td><td><p><i>Azure-region</i></p></td><td><p>The region where to store your logic app information. This example uses “West US”.</p></td></tr><tr><td><p><b>Log Analytics</b></p></td><td><p><b>Off</b></p></td><td><p>Keep the Off setting for diagnostic logging.</p></td></tr></tbody></table><ol class="number"><li value="4"><p>After Azure deploys your app, on the Azure toolbar, select <b>Notifications &gt; Go to resource</b> for your deployed logic app.</p></li></ol><p><span><img alt="" src="../Images/1192322-490460.png" width="" height="" /></span></p><p>The Logic Apps Designer opens and shows a page with an introduction video and commonly used triggers. Under <b>Templates</b>, select <b>Blank Logic App</b>.</p><p><span><img alt="" src="../Images/1192323-490461.png" width="" height="" /></span></p><h4 class="da-h4">Add the RSS trigger</h4><ol class="number"><li><p>In the <b>Logic App Designer</b>, under the search box, select <b>All</b>.</p></li><li><p>In the search box, enter <i>rss</i> to find the RSS connector. From the triggers list, select the <b>When a feed item is published</b> trigger.</p></li></ol><p><span><img alt="" src="../Images/1192324-490462.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>Provide this information for your trigger as shown and described here:</p></li></ol><p><span><img alt="" src="../Images/1192325-490463.png" width="" height="" /></span></p><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p>Property</p></td><td><p>Value</p></td><td><p>Description</p></td></tr></thead><tbody><tr><td><p><b>The RSS feed URL</b></p></td><td><p><i>http://feeds.reuters.com/reuters/topNews</i></p></td><td><p>The link for the RSS feed that you want to monitor</p></td></tr><tr><td><p><b>Interval</b></p></td><td><p><b>1</b></p></td><td><p>The number of intervals to wait between checks</p></td></tr><tr><td><p><b>Frequency</b></p></td><td><p>Minute</p></td><td><p>The unit of time for each interval between checks</p></td></tr></tbody></table><p>Together, the interval and frequency define the schedule for your logic app's trigger. This logic app checks the feed every minute.</p><ol class="number"><li value="4"><p>To collapse the trigger details for now, click inside the trigger's title bar.</p></li></ol><p><span><img alt="" src="../Images/1192326-490464.png" width="" height="" /></span></p><ol class="number"><li value="5"><p>Save your logic app. On the designer toolbar, select <b>Save</b>.</p></li></ol><h4 class="da-h4">Add the <i>send email</i> action</h4><p>Now add an action that sends an email when a new item appears in the RSS feed.</p><ol class="number"><li><p>Under the <b>When a feed item is published</b> trigger, select <b>New step</b>.</p></li></ol><p><span><img alt="" src="../Images/1192327-490465.png" width="" height="" /></span></p><ol class="number"><li value="2"><p>Under <b>Choose an action</b> and the search box, select <b>All</b>.</p></li><li><p>In the search box, enter send an email to find connectors that offer this action. From the actions list, select the “send an email” action for the email service that you want to use. This example uses the Office 365 Outlook connector, which has the <b>Send an email</b> action.</p></li></ol><p><span><img alt="" src="../Images/1192328-490466.png" width="" height="" /></span></p><p>To filter the actions list to a specific app or service, you can select that app or service first:</p><ul class="square"><li class="square"><p>For Azure work or school accounts, select Office 365 Outlook.</p></li><li class="square"><p>For personal Microsoft accounts, select Outlook.com.</p></li></ul><ol class="number"><li value="4"><p>If your selected email connector prompts you to authenticate your identity, complete that step now to create a connection between your logic app and your email service.</p></li><li><p>In the <b>Send an email</b> action, specify the data that you want the email to include.</p></li></ol><ul class="square"><li class="square"><p>In the <b>To</b> box, enter the recipient's email address. For testing purposes, you can use your email address.</p><ul class="square"><li class="square"><p>For now, ignore the <b>Add dynamic content</b> list that appears. When you click inside some edit boxes, this list appears and shows any available parameters from the previous step that you can include as inputs in your workflow.</p></li><li class="square"><p>In the <b>Subject</b> box, enter this text with a trailing blank space: <span class="code">New RSS item</span>:</p></li></ul></li></ul><p><span><img alt="" src="../Images/1192329-490467.png" width="" height="" /></span></p><ul class="square"><li class="square"><p>From the Add dynamic content list, select Feed title to include the RSS item title.</p></li></ul><p><span><img alt="" src="../Images/1192330-490468.png" width="" height="" /></span></p><p>When you're done, the email subject looks like this example:</p><p><span><img alt="" src="../Images/1192331-490469.png" width="" height="" /></span></p><p>If a “For each” loop appears on the designer, then you selected a token for an array, for example, the <b>categories-Item</b> token. For these kinds of tokens, the designer automatically adds this loop around the action that references that token. That way, your logic app performs the same action on each array item. To remove the loop, select the Vellipses (...)V on the loop's title bar, then select <b>Delete</b>.</p><p>In the <b>Body</b> box, enter this text, and select these tokens for the email body. To add blank lines in an edit box, press Shift + Enter.</p><p><span><img alt="" src="../Images/1192332-490470.png" width="" height="" /></span></p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Property</p></td><td><p>Description</p></td></tr></thead><tbody><tr><td><p><b>Feed title</b></p></td><td><p>The item's title</p></td></tr><tr><td><p><b>Feed published on</b></p></td><td><p>The item's publishing date and time</p></td></tr><tr><td><p><b>Primary feed link</b></p></td><td><p>The URL for the item</p></td></tr></tbody></table><ol class="number"><li value="6"><p>Save your logic app.</p></li></ol><h4 class="da-h4">Run the logic app</h4><p>To manually start your logic app, on the designer toolbar bar, select <b>Run</b>. Or, wait for your logic app to check the RSS feed based on your specified schedule (every minute). If the RSS feed has new items, your logic app sends an email for each new item. Otherwise, your logic app waits until the next interval before checking again. If you don't get any emails, check your junk email folder.</p><p>For example, here is a sample email that this logic app sends.</p><p><span><img alt="" src="../Images/1192333-490471.png" width="" height="" /></span></p><h3 class="da-h3" id="1191816">Create a VM from a VHD</h3><p>After you have generalized the virtual machine, you can create an image. The image will include all the disks associated with the virtual machine. You can create an image from the generalized virtual machine by using the Azure portal, the Azure CLI, or PowerShell.</p><p>To create an image in the Azure portal, go to the page for the virtual machine and select Capture:</p><p><span><img alt="" src="../Images/1192107-490245.png" width="" height="" /></span></p><p>On the <b>Create image</b> page that follows, give your image a name and specify a resource group in which to store the image. You can optionally remove the virtual machine after the image is created.</p><p><span><img alt="" src="../Images/1192108-490246.png" width="" height="" /></span></p><p>✔️ <b>Important</b>
When you create a virtual machine image in this way, the original virtual machine becomes unusable. You can't restart it. Instead, you must create a new virtual machine from the image, as described later in this unit.</p><p>If you're using PowerShell or the Azure CLI, you can create a virtual machine image from a generalized and deallocated virtual machine by using the following commands. In both examples, the image will be created in the same resource group as the original virtual machine:</p><div class="code language-PowerShell"><p class="da-divtext"><code><span class="token variable">$vm</span> = Get<span class="token operator">-</span>AzVM <span class="token operator">-</span>ResourceGroupName &lt;resource <span class="token function">group</span>&gt; `
    <span class="token operator">-</span>Name &lt;generalized virtual machine&gt;

<span class="token variable">$image</span> = New<span class="token operator">-</span>AzImageConfig <span class="token operator">-</span>SourceVirtualMachineId `
    <span class="token variable">$vm</span><span class="token punctuation">.</span>ID <span class="token operator">-</span>Location&lt;virtual machine location&gt;

New<span class="token operator">-</span>AzImage <span class="token operator">-</span>Image <span class="token variable">$image</span> `
    <span class="token operator">-</span>ImageName &lt;image name&gt; `
    <span class="token operator">-</span>ResourceGroupName &lt;resource <span class="token function">group</span>&gt;</code></p></div><div class="code language-Azure"><p class="da-divtext">az image create \
    --name &lt;image name&gt; \
    --resource-group &lt;resource group&gt; \
    --source &lt;generalized virtual machine&gt;
</p></div><p><b>Create a new virtual machine from a generalized image</b></p><p>You can build a new virtual machine by using your generalized image. The simplest way is to use the Azure portal. Go to the page for your image, and <b>select +</b> Create VM. You'll be prompted for the machine-specific details, such as the virtual machine name, user account, virtual machine size, and network ports to open.</p><p>Alternatively, you can use the PowerShell New-AzVm command, or the Azure CLI az vm create command. The following examples illustrate the syntax:</p><div class="code language-PowerShell"><p class="da-divtext"><code>New<span class="token operator">-</span>AzVm `
    <span class="token operator">-</span>ResourceGroupName &lt;resource <span class="token function">group</span>&gt; `
    <span class="token operator">-</span>Name &lt;new virtual machine name&gt; `
    <span class="token operator">-</span>ImageName &lt;image name&gt; `
    <span class="token operator">-</span>Location &lt;location of image&gt; `</code></p></div><div class="code language-Azure"><p class="da-divtext">az vm create \
    --resource-group &lt;resource group&gt; \
    --name &lt;new virtual machine name&gt; \
    --image &lt;image name&gt; \
    --location &lt;location of image&gt;
</p></div><p><b>Create a snapshot of a VHD</b></p><p>A virtual machine image contains an image of every VHD in the virtual machine. You can also create separate snapshot images of a VHD at any time.</p><p>Unlike creating an image of a virtual machine, capturing a snapshot of a VHD is a non-destructive process. You can continue running virtual machines by using the VHD afterward.</p><p><b>Create a virtual machine from VHD snapshots</b></p><p>Rebuilding a virtual machine from a set of VHD snapshots is a two-step process:</p><ol class="number"><li><p>For each snapshot, create a new managed disk. Specify the snapshot as the source of the managed disk. The simplest way is to use the Azure portal, as shown in the following image:</p></li></ol><p><span><img alt="" src="../Images/1192109-490247.png" width="" height="" /></span></p><ol class="number"><li value="2"><p>Create the new virtual machine by using the managed disk. You can do this through PowerShell, the Azure CLI, or the portal.</p></li></ol><h3 class="da-h3" id="1191717">Traffic Manager Routing Methods</h3><h4 class="da-h4">Priority routing</h4><p>When a Traffic Manager profile is configured for priority routing it contains a prioritized list of service endpoints. Traffic Manager sends all traffic to the primary (highest-priority) endpoint first. If the primary endpoint is not available, Traffic Manager routes the traffic to the second endpoint, and so on.</p><p>Availability of the endpoint is based on the configured status (enabled or disabled) and the ongoing endpoint monitoring. The Priority traffic routing method allows you to easily implement a failover pattern. You configure the endpoint priority explicitly or use the default priority based on the endpoint order.</p><p><span><img alt="" src="../Images/1192362-490500.png" width="" height="" /></span></p><h4 class="da-h4">Performance routing</h4><p>The Performance routing method is designed to improve the responsiveness by routing traffic to the location that is closest to the user. The closest endpoint is not necessarily measured by geographic distance. Instead Traffic Manager determines closeness by measuring network latency.</p><p>Traffic Manager maintains an Internet Latency Table to track the round-trip time between IP address ranges and each Azure datacenter. With this method Traffic Manager looks up the source IP address of the incoming DNS request in the Internet Latency Table. Traffic Manager chooses an available endpoint in the Azure datacenter that has the lowest latency for that IP address range, then returns that endpoint in the DNS response.</p><p><span><img alt="" src="../Images/1192363-490501.png" width="" height="" /></span></p><h4 class="da-h4">Geographic routing</h4><p>When a Traffic Manager profile is configured for Geographic routing, each endpoint associated with that profile needs will have a set of geographic locations assigned to it. Any requests from those regions gets routed only to that endpoint. Some planning is required when you create a geographical endpoint. A location cannot be in more than one endpoint.</p><p>You build the endpoint from a:</p><p><span><img alt="" src="../Images/1192364-490502.png" width="" height="" /></span></p><h4 class="da-h4">Weighted routing</h4><p>The Weighted traffic-routing method allows you to distribute traffic evenly or to use a pre-defined weighting. In the Weighted traffic-routing method, you assign a weight to each endpoint in the Traffic Manager profile configuration. The weight is an integer from 1 to 1000. This parameter is optional. If omitted, Traffic Manager uses a default weight of ‘1’. The higher weight, the higher the priority.</p><p><span><img alt="" src="../Images/1192365-490503.png" width="" height="" /></span></p><p>✔️ Additonally, MultiValue routing distributes traffic only to IPv4 and IPv6 endpoints​ and Subnet routing distributes traffic based on source IP ranges.</p><h3 class="da-h3" id="1191823">Start a Runbook in Azure Automation</h3><p>The following table helps you determine the method to start a runbook in Azure Automation that is most suitable to your scenario. This topic includes details on starting a runbook with the Azure portal and with Windows PowerShell.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Method</p></td><td><p>Characteristics</p></td></tr></thead><tbody><tr><td><p>Azure portal</p></td><td><p>Simplest method with interactive user interface.  Form to provide simple parameter values.  Easily track job state.  Access authenticated with Azure sign in.</p></td></tr><tr><td><p>Windows PowerShell</p></td><td><p>Call from command line with Windows PowerShell cmdlets.  Can be included in automated solution with multiple steps.  Request is authenticated with certificate or OAuth user principal / service principal.  Provide simple and complex parameter values.  Track job state.  Client required to support PowerShell cmdlets.</p></td></tr></tbody></table><p>The following image illustrates detailed step-by-step process in the life cycle of a runbook. It includes different ways a runbook starts in Azure Automation, which components required for Hybrid Runbook Worker to execute Azure Automation runbooks and interactions between different components.</p><p><span><img alt="" src="../Images/1192170-490308.png" width="" height="" /></span></p><p><b>Runbook parameters</b></p><p>When you start a runbook from the Azure portal or Windows PowerShell, the instruction is sent through the Azure Automation web service. This service doesn't support parameters with complex data types. If you need to provide a value for a complex parameter, then you must call it inline from another runbook as described in <a href="https://docs.microsoft.com/en-us/azure/automation/automation-child-runbooks" title="" target="_blank">Child runbooks in Azure Automation</a>.</p><p><b>Start a runbook with the Azure portal</b></p><ol class="number"><li><p>In the Azure portal, select <b>Automation</b> and then click the name of an Automation account.</p></li><li><p>On the Hub menu, select <b>Runbooks</b>.</p></li><li><p>On the <b>Runbooks</b> page, select a runbook, and then click <b>Start</b>.</p></li><li><p>If the runbook has parameters, you're prompted to provide values with a text box for each parameter. For more information on parameters, see <a href="https://docs.microsoft.com/en-us/azure/automation/start-runbooks?WT.mc_id=thomasmaurer-blog-thmaure" title="" target="_blank">Runbook Parameters</a>.</p></li><li><p>On the <b>Job</b> pane, you can view the status of the runbook job.</p></li></ol><p><b>Start a runbook with PowerShell</b></p><p>You can use the <span class="code">Start-AzAutomationRunbook</span> to start a runbook with Windows PowerShell. The following sample code starts a runbook called Test-Runbook.</p><div class="code language-Azure"><p class="da-divtext">Start-AzAutomationRunbook -AutomationAccountName "MyAutomationAccount" -Name "Test-Runbook" -ResourceGroupName "ResourceGroup01"
</p></div><p><span class="code">Start-AzAutomationRunbook</span> returns a job object that you can use to track status once the runbook is started. You can then use this job object with Get-AzAutomationJob to determine the status of the job and Get-AzAutomationJobOutput to retrieve its output. The following example starts a runbook called Test-Runbook, waits until it has completed, and then displays its output.</p><div class="code language-Azure"><p class="da-divtext">$runbookName = "Test-Runbook"
$ResourceGroup = "ResourceGroup01"
$AutomationAcct = "MyAutomationAccount"

$job = Start-AzAutomationRunbook –AutomationAccountName $AutomationAcct -Name $runbookName -ResourceGroupName $ResourceGroup

$doLoop = $true
While ($doLoop) {
   $job = Get-AzAutomationJob –AutomationAccountName $AutomationAcct -Id $job.JobId -ResourceGroupName $ResourceGroup
   $status = $job.Status
   $doLoop = (($status -ne "Completed") -and ($status -ne "Failed") -and ($status -ne "Suspended") -and ($status -ne "Stopped"))
}

Get-AzAutomationJobOutput –AutomationAccountName $AutomationAcct -Id $job.JobId -ResourceGroupName $ResourceGroup –Stream Output
</p></div><p>If the runbook requires parameters, then you must provide them as a hashtable. The key of the hashtable must match the parameter name and the value is the parameter value. The following example shows how to start a runbook with two string parameters named <b>FirstName</b> and <b>LastName</b>, an integer named <b>RepeatCount</b>, and a boolean parameter named <b>Show</b>.</p><div class="code language-Azure"><p class="da-divtext">$params = @{"FirstName"="Joe";"LastName"="Smith";"RepeatCount"=2;"Show"=$true}
Start-AzureRmAutomationRunbook –AutomationAccountName "MyAutomationAccount" –Name "Test-Runbook" -ResourceGroupName "ResourceGroup01" –Parameters $params
</p></div><h3 class="da-h3" id="1191933">Integrate an App with an Azure Virtual Network</h3><p>This lesson describes the Azure App Service VNet Integration feature and how to set it up with apps in Azure App Service. With Azure Virtual Network (VNets), you can place multiple Azure resources in a non-internet-routable network. VNet Integration enables apps to access resources in or through a VNet.</p><p>Azure App Service has two variations on Net Integration:</p><ul class="square"><li class="square"><p>The multitenant systems that support the full range of pricing plans except Isolated.</p></li><li class="square"><p>The App Service Environment, which deploys into your VNet and supports Isolated pricing plan apps.</p></li></ul><p>The VNet Integration feature is used in multitenant apps. If apps are in App Service Environment, then it's already in a VNet and doesn't require use of the VNet Integration feature to reach resources in the same VNet.</p><p>VNet Integration gives your app access to resources in a VNet, but it doesn't grant inbound private access to your app from the VNet. Private site access refers to making an app accessible only from a private network, such as from within an Azure virtual network. VNet Integration is used only to make outbound calls from your app into your VNet. The VNet Integration feature behaves differently when it's used with VNet in the same region and with VNet in other regions. The VNet Integration feature has two variations:</p><ul class="square"><li class="square"><p><b>Regional VNet Integration</b>: When you connect to Azure Resource Manager virtual networks in the same region, you must have a dedicated subnet in the VNet you're integrating with.</p></li><li class="square"><p><b>Gateway-required VNet Integration</b>: When you connect to VNet in other regions or to a classic virtual network in the same region, you need an Azure Virtual Network gateway provisioned in the target VNet.</p></li></ul><p>The VNet Integration features:</p><ul class="square"><li class="square"><p>Require a Standard, Premium, PremiumV2, PremiumV3, or Elastic Premium pricing plan.</p></li><li class="square"><p>Support TCP and UDP.</p></li><li class="square"><p>Work with Azure App Service apps and function apps.</p></li></ul><p>There are some things that VNet Integration doesn't support, like:</p><ul class="square"><li class="square"><p>Mounting a drive.</p></li><li class="square"><p>Active Directory integration.</p></li><li class="square"><p>NetBIOS.</p></li></ul><p>Gateway-required VNet Integration provides access to resources only in the target VNet or in networks connected to the target VNet with peering or VPNs.</p><h3 class="da-h3" id="1191815">Virtual Hard Disk Deployment Template</h3><p>The Azure Resource Manager template below defines a new Azure virtual machine (VM) instance, created from local virtual hard disk (VHD).</p><p>The template below is for reference only, and is used in the previous topic entitled <i>Deploy an Azure VM from a VHD</i>.</p><div class="code language-JSON"><p class="da-divtext"><code><span class="token punctuation">{</span>
    <span class="token property">"$schema"</span><span class="token operator">:</span> <span class="token string">"https://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json"</span><span class="token punctuation">,</span>
    <span class="token property">"contentVersion"</span><span class="token operator">:</span> <span class="token string">"1.0.0.0"</span><span class="token punctuation">,</span>
    <span class="token property">"parameters"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"userStorageAccountName"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"userStorageContainerName"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
            <span class="token property">"defaultValue"</span><span class="token operator">:</span> <span class="token string">"vhds"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"dnsNameForPublicIP"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"adminUserName"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"defaultValue"</span><span class="token operator">:</span> <span class="token string">"isv"</span><span class="token punctuation">,</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"adminPassword"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"securestring"</span><span class="token punctuation">,</span>
            <span class="token property">"defaultValue"</span><span class="token operator">:</span> <span class="token string">"Password@123"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"osType"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
            <span class="token property">"defaultValue"</span><span class="token operator">:</span> <span class="token string">"windows"</span><span class="token punctuation">,</span>
            <span class="token property">"allowedValues"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">"windows"</span><span class="token punctuation">,</span>
                <span class="token string">"linux"</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"subscriptionId"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"location"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"vmSize"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"publicIPAddressName"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"vmName"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"virtualNetworkName"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"nicName"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"vaultName"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
            <span class="token property">"metadata"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Name of the KeyVault"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"vaultResourceGroup"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
            <span class="token property">"metadata"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Resource Group of the KeyVault"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"certificateUrl"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
            <span class="token property">"metadata"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Url of the certificate with version in KeyVault e.g. https://testault.vault.azure.net/secrets/testcert/b621es1db241e56a72d037479xab1r7"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"vhdUrl"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
            <span class="token property">"metadata"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"VHD Url..."</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"variables"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"addressPrefix"</span><span class="token operator">:</span> <span class="token string">"10.0.0.0/16"</span><span class="token punctuation">,</span>
            <span class="token property">"subnet1Name"</span><span class="token operator">:</span> <span class="token string">"Subnet-1"</span><span class="token punctuation">,</span>
            <span class="token property">"subnet2Name"</span><span class="token operator">:</span> <span class="token string">"Subnet-2"</span><span class="token punctuation">,</span>
            <span class="token property">"subnet1Prefix"</span><span class="token operator">:</span> <span class="token string">"10.0.0.0/24"</span><span class="token punctuation">,</span>
            <span class="token property">"subnet2Prefix"</span><span class="token operator">:</span> <span class="token string">"10.0.1.0/24"</span><span class="token punctuation">,</span>
            <span class="token property">"publicIPAddressType"</span><span class="token operator">:</span> <span class="token string">"Dynamic"</span><span class="token punctuation">,</span>
            <span class="token property">"vnetID"</span><span class="token operator">:</span> <span class="token string">"[resourceId('Microsoft.Network/virtualNetworks',parameters('virtualNetworkName'))]"</span><span class="token punctuation">,</span>
            <span class="token property">"subnet1Ref"</span><span class="token operator">:</span> <span class="token string">"[concat(variables('vnetID'),'/subnets/',variables('subnet1Name'))]"</span><span class="token punctuation">,</span>
            <span class="token property">"osDiskVhdName"</span><span class="token operator">:</span> <span class="token string">"[concat('http://',parameters('userStorageAccountName'),'.blob.core.windows.net/',parameters('userStorageContainerName'),'/',parameters('vmName'),'osDisk.vhd')]"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"resources"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token property">"apiVersion"</span><span class="token operator">:</span> <span class="token string">"2015-05-01-preview"</span><span class="token punctuation">,</span>
                <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Microsoft.Network/publicIPAddresses"</span><span class="token punctuation">,</span>
                <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"[parameters('publicIPAddressName')]"</span><span class="token punctuation">,</span>
                <span class="token property">"location"</span><span class="token operator">:</span> <span class="token string">"[parameters('location')]"</span><span class="token punctuation">,</span>
                <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">"publicIPAllocationMethod"</span><span class="token operator">:</span> <span class="token string">"[variables('publicIPAddressType')]"</span><span class="token punctuation">,</span>
                    <span class="token property">"dnsSettings"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">"domainNameLabel"</span><span class="token operator">:</span> <span class="token string">"[parameters('dnsNameForPublicIP')]"</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token property">"apiVersion"</span><span class="token operator">:</span> <span class="token string">"2015-05-01-preview"</span><span class="token punctuation">,</span>
                <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Microsoft.Network/virtualNetworks"</span><span class="token punctuation">,</span>
                <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"[parameters('virtualNetworkName')]"</span><span class="token punctuation">,</span>
                <span class="token property">"location"</span><span class="token operator">:</span> <span class="token string">"[parameters('location')]"</span><span class="token punctuation">,</span>
                <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">"addressSpace"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">"addressPrefixes"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                            <span class="token string">"[variables('addressPrefix')]"</span>
                        <span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token property">"subnets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span>
                            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"[variables('subnet1Name')]"</span><span class="token punctuation">,</span>
                            <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">"addressPrefix"</span><span class="token operator">:</span> <span class="token string">"[variables('subnet1Prefix')]"</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">{</span>
                            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"[variables('subnet2Name')]"</span><span class="token punctuation">,</span>
                            <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">"addressPrefix"</span><span class="token operator">:</span> <span class="token string">"[variables('subnet2Prefix')]"</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token property">"apiVersion"</span><span class="token operator">:</span> <span class="token string">"2015-05-01-preview"</span><span class="token punctuation">,</span>
                <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Microsoft.Network/networkInterfaces"</span><span class="token punctuation">,</span>
                <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"[parameters('nicName')]"</span><span class="token punctuation">,</span>
                <span class="token property">"location"</span><span class="token operator">:</span> <span class="token string">"[parameters('location')]"</span><span class="token punctuation">,</span>
                <span class="token property">"dependsOn"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">"[concat('Microsoft.Network/publicIPAddresses/', parameters('publicIPAddressName'))]"</span><span class="token punctuation">,</span>
                    <span class="token string">"[concat('Microsoft.Network/virtualNetworks/', parameters('virtualNetworkName'))]"</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">"ipConfigurations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span>
                            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ipconfig1"</span><span class="token punctuation">,</span>
                            <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">"privateIPAllocationMethod"</span><span class="token operator">:</span> <span class="token string">"Dynamic"</span><span class="token punctuation">,</span>
                                <span class="token property">"publicIPAddress"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"[resourceId('Microsoft.Network/publicIPAddresses',parameters('publicIPAddressName'))]"</span>
                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token property">"subnet"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"[variables('subnet1Ref')]"</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                <span class="token property">"apiVersion"</span><span class="token operator">:</span> <span class="token string">"2015-06-15"</span><span class="token punctuation">,</span>
                <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Microsoft.Compute/virtualMachines"</span><span class="token punctuation">,</span>
                <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"[parameters('vmName')]"</span><span class="token punctuation">,</span>
                <span class="token property">"location"</span><span class="token operator">:</span> <span class="token string">"[parameters('location')]"</span><span class="token punctuation">,</span>
                <span class="token property">"dependsOn"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token string">"[concat('Microsoft.Network/networkInterfaces/', parameters('nicName'))]"</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">"hardwareProfile"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">"vmSize"</span><span class="token operator">:</span> <span class="token string">"[parameters('vmSize')]"</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token property">"osProfile"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">"computername"</span><span class="token operator">:</span> <span class="token string">"[parameters('vmName')]"</span><span class="token punctuation">,</span>
                        <span class="token property">"adminUsername"</span><span class="token operator">:</span> <span class="token string">"[parameters('adminUsername')]"</span><span class="token punctuation">,</span>
                        <span class="token property">"adminPassword"</span><span class="token operator">:</span> <span class="token string">"[parameters('adminPassword')]"</span><span class="token punctuation">,</span>
                        <span class="token property">"secrets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                            <span class="token punctuation">{</span>
                                <span class="token property">"sourceVault"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                    <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"[resourceId(parameters('vaultResourceGroup'), 'Microsoft.KeyVault/vaults', parameters('vaultName'))]"</span>
                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token property">"vaultCertificates"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token punctuation">{</span>
                                        <span class="token property">"certificateUrl"</span><span class="token operator">:</span> <span class="token string">"[parameters('certificateUrl')]"</span><span class="token punctuation">,</span>
                                        <span class="token property">"certificateStore"</span><span class="token operator">:</span> <span class="token string">"My"</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">]</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token property">"windowsConfiguration"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                            <span class="token property">"provisionVMAgent"</span><span class="token operator">:</span> <span class="token string">"true"</span><span class="token punctuation">,</span>
                            <span class="token property">"winRM"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">"listeners"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token punctuation">{</span>
                                        <span class="token property">"protocol"</span><span class="token operator">:</span> <span class="token string">"http"</span>
                                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                    <span class="token punctuation">{</span>
                                        <span class="token property">"protocol"</span><span class="token operator">:</span> <span class="token string">"https"</span><span class="token punctuation">,</span>
                                        <span class="token property">"certificateUrl"</span><span class="token operator">:</span> <span class="token string">"[parameters('certificateUrl')]"</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">]</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token property">"enableAutomaticUpdates"</span><span class="token operator">:</span> <span class="token string">"true"</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token property">"storageProfile"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">"osDisk"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"[concat(parameters('vmName'),'-osDisk')]"</span><span class="token punctuation">,</span>
                            <span class="token property">"osType"</span><span class="token operator">:</span> <span class="token string">"[parameters('osType')]"</span><span class="token punctuation">,</span>
                            <span class="token property">"caching"</span><span class="token operator">:</span> <span class="token string">"ReadWrite"</span><span class="token punctuation">,</span>
                            <span class="token property">"image"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">"uri"</span><span class="token operator">:</span> <span class="token string">"[parameters('vhdUrl')]"</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token property">"vhd"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">"uri"</span><span class="token operator">:</span> <span class="token string">"[variables('osDiskVhdName')]"</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token property">"createOption"</span><span class="token operator">:</span> <span class="token string">"FromImage"</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token property">"networkProfile"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">"networkInterfaces"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                            <span class="token punctuation">{</span>
                                <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"[resourceId('Microsoft.Network/networkInterfaces',parameters('nicName'))]"</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">]</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token property">"diagnosticsProfile"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">"bootDiagnostics"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                        <span class="token property">"enabled"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                        <span class="token property">"storageUri"</span><span class="token operator">:</span> <span class="token string">"[concat('http://', parameters('userStorageAccountName'), '.blob.core.windows.net')]"</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span></code></p></div><h3 class="da-h3" id="1191837">Create an Azure AD Access Review</h3><p>To create an access reviews, follow these steps:</p><ol class="number"><li><p>Go to the <a href="https://portal.azure.com/" title="" target="_blank">Azure portal</a> to manage access reviews and sign in as a Global administrator or User administrator.</p></li><li><p>Search for and select <b>Azure Active Directory</b>.</p></li></ol><p><span><img alt="" src="../Images/1192184-490322.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>Select <b>Identity Governance</b>.</p></li><li><p>On the <b>Getting started</b> page, click the <b>Create an access review</b> button.</p></li></ol><p><span><img alt="" src="../Images/1192185-490323.png" width="" height="" /></span></p><h3 class="da-h3" id="1191931">Demonstration - Create an App Service Plan</h3><p>In this demonstration, we will create and work with Azure App Service plans.</p><p><b>Create an App Service Plan</b></p><ol class="number"><li><p>Sign-in to the <a href="http://portal.azure.com/" title="" target="_blank">Azure portal</a>.</p></li><li><p>Search for and select <b>App Service Plans</b>.</p></li><li><p>Click <b>+ Add</b> to create a new App Service plan.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Setting</p></td><td><p>Value</p></td></tr></thead><tbody><tr><td><p>Subscription</p></td><td><p><b>Choose your subscription</b></p></td></tr><tr><td><p>Resource Group</p></td><td><p><b>myRGAppServices</b> (create new)</p></td></tr><tr><td><p>Name</p></td><td><p><b>AppServicePlan1</b></p></td></tr><tr><td><p>Operating System</p></td><td><p><b>Windows</b></p></td></tr><tr><td><p>Region</p></td><td><p><b>East US</b></p></td></tr></tbody></table></li><li><p>Click <b>Review + Create</b> and then <b>Create</b>.</p></li><li><p>Wait for your new App Service plan to deploy.</p></li></ol><p><b>Review Pricing Tiers</b></p><ol class="number"><li><p>Locate your new App Service plan.</p></li><li><p>Under <b>Settings</b>, click <b>Scale up (App Service Plan)</b>.</p></li><li><p>Notice there are three tiers: <b>Dev/Test</b>, <b>Production</b>, and <b>Isolated</b>.</p></li><li><p>Click each tier and review the included features and included hardware.</p></li><li><p>How do the tiers compare?</p></li></ol><p><b>Review autoscaling</b></p><ol class="number"><li><p>Under <b>Settings</b> click <b>Scale out (App Service Plan)</b>.</p></li><li><p>Notice the default is <b>Manual scale</b>.</p></li><li><p>Notice you can specify an <b>instance count</b> depending on your App Service plan selection.</p></li><li><p>Click <b>Custom autoscale</b>.</p></li><li><p>Notice two scale modes: <b>Scale based on a metric</b> and <b>Scale to a specific instance count</b>.</p></li><li><p>Click <b>Add a rule</b>.</p></li></ol><p>✔️ <b>Note</b>: This rule will add an instance when the CPU percentages is greater than 80% for 10 minutes.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Setting</p></td><td><p>Value</p></td></tr></thead><tbody><tr><td><p>Time aggregation</p></td><td><p><b>Average</b></p></td></tr><tr><td><p>Metric name</p></td><td><p><b>CPU percentage</b></p></td></tr><tr><td><p>Operator</p></td><td><p><b>Greater than</b></p></td></tr><tr><td><p>Threshold</p></td><td><p><b>80</b></p></td></tr><tr><td><p>Duration</p></td><td><p><b>10 minutes</b></p></td></tr><tr><td><p>Operation</p></td><td><p><b>Increase count by</b></p></td></tr><tr><td><p>Instance count</p></td><td><p><b>1</b></p></td></tr><tr><td><p>Cool down</p></td><td><p><b>5 minutes</b></p></td></tr></tbody></table><ol class="number"><li value="7"><p><b>Add</b> your rule changes.</p></li><li><p>Review the <b>Instance limits</b>: <b>Minimum</b>, <b>Maximum</b>, and <b>Default</b>.</p></li><li><p>Notice that you can add a <b>Schedule</b> and <b>Specify start/end dates</b> and <b>Repeat specific days</b>.</p></li><li><p>Do you see how you can create different App Service plans for your apps?</p></li></ol><h3 class="da-h3" id="1191822">Import a PowerShell Runbook from the Runbook Gallery</h3><ol class="number"><li><p>In the Azure portal, open your Automation account.</p></li><li><p>Select <b>Runbooks gallery</b> under P<b>rocess Automation</b>.</p></li><li><p>Select <b>Source: PowerShell Gallery</b>.</p></li><li><p>Locate the gallery item you want and select it to view its details. On the left, you can enter additional search parameters for the publisher and type.</p></li></ol><p><span><img alt="" src="../Images/1192092-490230.png" width="" height="" /></span></p><ol class="number"><li value="5"><p>Click on <b>View source project</b> to view the item in the <a href="https://gallery.technet.microsoft.com/" title="" target="_blank">TechNet Script Center</a>.</p></li><li><p>To import an item, click on it to view its details and then click <b>Import</b>.</p></li></ol><p><span><img alt="" src="../Images/1192093-490231.png" width="" height="" /></span></p><ol class="number"><li value="7"><p>Optionally, change the name of the runbook and then click <b>OK</b> to import the runbook.</p></li><li><p>The runbook appears on the <b>Runbooks</b> tab for the Automation account.</p></li></ol><p><b>Add a PowerShell runbook to the gallery</b></p><p>Microsoft encourages you to add runbooks to the PowerShell Gallery that you think would be useful to other customers. The PowerShell Gallery accepts PowerShell modules and PowerShell scripts. You can add a runbook by <a href="https://docs.microsoft.com/en-us/powershell/scripting/gallery/how-to/publishing-packages/publishing-a-package" title="" target="_blank">uploading it to the PowerShell Gallery</a>.</p><p><b>Import a module from the module gallery with the Azure portal</b></p><ol class="number"><li><p>In the Azure portal, open your Automation account.</p></li><li><p>Select <b>Modules</b> under <b>Shared Resources</b> to open the list of modules.</p></li><li><p>Click <b>Browse gallery</b> from the top of the page.</p></li></ol><p><span><img alt="" src="../Images/1192094-490232.png" width="" height="" /></span></p><ol class="number"><li value="4"><p>On the <b>Browse gallery</b> page, you can search by the following fields:</p></li></ol><ul class="square"><li class="square"><p>Module Name</p></li><li class="square"><p>Tags</p></li><li class="square"><p>Author</p></li><li class="square"><p>Cmdlet/DSC resource name</p></li></ul><ol class="number"><li value="5"><p>Locate a module that you're interested in and select it to view its details.</p></li></ol><p><span><img alt="" src="../Images/1192095-490233.png" width="" height="" /></span></p><ol class="number"><li value="6"><p>To install the module directly into Azure Automation, click <b>Import</b>.</p></li><li><p>On the <b>Import</b> pane, you can see the name of the module to import. If all the dependencies are installed, the <b>OK</b> button is activated.</p></li><li><p>On the <b>Import</b> pane, click <b>OK</b> to import the module. While Azure Automation imports a module to your account, it extracts metadata about the module and the cmdlets.</p></li><li><p>You receive an initial notification that the module is being deployed and another notification when it has completed.</p></li></ol><h3 class="da-h3" id="1191946">Build Logic Apps from Triggers and Actions</h3><p>You build a Logic App from triggers and actions. An app must begin with a trigger. After the trigger, you include as many actions as you need to implement your workflow. The following illustration shows the trigger and actions used in the social-media monitor app.</p><p><span><img alt="" src="../Images/1192042-490180.png" width="" height="" /></span></p><h4 class="da-h4">Triggers and Actions Working Together</h4><p>Triggers and actions are essentially function calls to an underlying API operation. Each operation has inputs and outputs. For example, the “When a new tweet is posted” Twitter trigger takes in a search string and returns the tweets that contain that string. The "Detect sentiment" action takes a string as input and returns the sentiment score as a floating-point number. The following illustration shows these two operations.</p><p><span><img alt="" src="../Images/1192043-490181.png" width="" height="" /></span></p><p>Logic Apps automatically makes the return values available throughout the rest of the operations. This feature lets you pass the results from one operation as input to the next operation. The following illustration shows the data flow for the first two operations in the social-media monitor app. Notice that the results from an operation are available in all of the following steps.</p><p><span><img alt="" src="../Images/1192044-490182.png" width="" height="" /></span></p><h4 class="da-h4">Control Actions</h4><p>Most workflows need to do different actions based on the data being processed. For example, an expense report might be routed to a different manager based on the amount. In the social-media monitor app, we need to branch based on the sentiment score of the tweet. The following illustration shows the flowchart for the social-media monitor app with the control logic highlighted.</p><p><span><img alt="" src="../Images/1192045-490183.png" width="" height="" /></span></p><p>Control <i>actions</i> are special actions built-in to Logic Apps that provides these control constructs:</p><ul class="square"><li class="square"><p><i>Condition</i> statements controlled by a Boolean expression</p></li><li class="square"><p><i>Switch</i> statements</p></li><li class="square"><p><i>For each</i> and <i>Until</i> loops</p></li><li class="square"><p>Unconditional <i>Branch</i> instructions.</p></li></ul><p>The following illustration shows the use of a *Conditionv statement in the social-media monitoring application.</p><p><span><img alt="" src="../Images/1192046-490184.png" width="" height="" /></span></p><h3 class="da-h3" id="1191691">High Availability Considerations</h3><p>For high availability, you should deploy multiple VMs, spread across multiple hosts (minimum of 2). With Azure Dedicated Hosts, you have several options to provision your infrastructure to shape your fault isolation boundaries.</p><p><b>Use Availability Zones for fault isolation</b></p><p>Availability zones are unique physical locations within an Azure region. Each zone is made up of one or more datacenters equipped with independent power, cooling, and networking. A host group is created in a single availability zone. Once created, all hosts will be placed within that zone.</p><p>To achieve high availability across zones, you need to create multiple host groups (one per zone) and spread your hosts accordingly.</p><p>If you assign a host group to an availability zone, all VMs created on that host must be created in the same zone.</p><p><b>Use Fault Domains for fault isolation</b></p><p>A host can be created in a specific fault domain. Just like VM in a scale set or availability set, hosts in different fault domains will be placed on different physical racks in the data center. When you create a host group, you are required to specify the fault domain count.</p><p>When creating hosts within the host group, you assign fault domain for each host. The VMs do not require any fault domain assignment.</p><p>VMs deployed to hosts with different fault domains, will have their underlying managed disks services on multiple storage stamps, to increase the fault isolation protection.</p><p><b>Using Availability Zones and Fault Domains</b></p><p>You can use both capabilities together to achieve even more fault isolation. In this case, you will specify the availability zone and fault domain count in for each host group, assign a fault domain to each of your hosts in the group, and assign an availability zone to each of your VMs</p><h3 class="da-h3" id="1191929">App Service Plan Pricing Tiers</h3><table style="width:100%" class=""><col width="14.285714285714284%" /><col width="14.285714285714284%" /><col width="14.285714285714284%" /><col width="14.285714285714284%" /><col width="14.285714285714284%" /><col width="14.285714285714284%" /><col width="14.285714285714284%" /><thead><tr><td><p /></td><td><p>Free                                  Try for free</p></td><td><p>Shared                                  Environment for dev/test</p></td><td><p>Basic                              Dedicated environment for dev/test</p></td><td><p>Standard                              Run production workloads</p></td><td><p>Premium                              Enhanced performance and scale</p></td><td><p>Isolated                              High-Performance, Security and Isolation</p></td></tr></thead><tbody><tr><td><p>Web, mobile, or API apps</p></td><td><p>10</p></td><td><p>100</p></td><td><p>Unlimited</p></td><td><p>Unlimited</p></td><td><p>Unlimited</p></td><td><p>Unlimited</p></td></tr><tr><td><p>Disk space</p></td><td><p>1 GB</p></td><td><p>1 GB</p></td><td><p>10 GB</p></td><td><p>50 GB</p></td><td><p>250 GB</p></td><td><p>1 TB</p></td></tr><tr><td><p>Maximum instances</p></td><td><p>–</p></td><td><p>–</p></td><td><p>Up to 3</p></td><td><p>Up to 10</p></td><td><p>Up to 30*</p></td><td><p>Up to 100</p></td></tr><tr><td><p>Custom domain</p></td><td><p>–</p></td><td><p>Supported</p></td><td><p>Supported</p></td><td><p>Supported</p></td><td><p>Supported</p></td><td><p>Supported</p></td></tr><tr><td><p>Auto Scale</p></td><td><p>–</p></td><td><p>–</p></td><td><p>–</p></td><td><p>Supported</p></td><td><p>Supported</p></td><td><p>Supported</p></td></tr><tr><td><p>Hybrid Connectivity</p></td><td><p>–</p></td><td><p>–</p></td><td><p>Supported</p></td><td><p>Supported</p></td><td><p>Supported</p></td><td><p>Supported</p></td></tr><tr><td><p>Virtual Network Connectivity</p></td><td><p>–</p></td><td><p>–</p></td><td><p>–</p></td><td><p>Supported</p></td><td><p>Supported</p></td><td><p>Supported</p></td></tr><tr><td><p>Private Endpoints</p></td><td><p>–</p></td><td><p>–</p></td><td><p>–</p></td><td><p>–</p></td><td><p>Supported</p></td><td><p>Supported</p></td></tr><tr><td><p>Compute Type</p></td><td><p>Shared</p></td><td><p>Shared</p></td><td><p>Dedicated</p></td><td><p>Dedicated</p></td><td><p>Dedicated</p></td><td><p>Isolated</p></td></tr><tr><td><p>Price</p></td><td><p>Free</p></td><td><p>$0.013/hour</p></td><td><p>$0.075/hour</p></td><td><p>$0.10/hour</p></td><td><p>$0.20/hour</p></td><td><p>$0.40/hour</p></td></tr></tbody></table><p>The pricing tier of an App Service plan determines what App Service features you get and how much you pay for the plan. There are a few categories of pricing tiers:</p><ul class="square"><li class="square"><p><b>Free and Shared</b>.  The Free and Shared service plans are base tiers that run on the same Azure VMs as other apps. Some apps may belong to other customers. These tiers are intended to be used only for development and testing purposes. There is no SLA provided for Free and Shared service plans. Free and Shared plans are metered on a per App basis.</p></li><li class="square"><p><b>Basic</b>. The Basic service plan is designed for apps that have lower traffic requirements, and don't need advanced auto scale and traffic management features. Pricing is based on the size and number of instances you run. Built-in network load balancing support automatically distributes traffic across instances.</p></li><li class="square"><p><b>Standard</b>. The Standard service plan is designed for running production workloads. Pricing is based on the size and number of instances you run. Built-in network load balancing support automatically distributes traffic across instances. The Standard plan includes auto scale that can automatically adjust the number of virtual machine instances running to match your traffic needs.</p></li><li class="square"><p><b>Premium</b>. The Premium service plan is designed to provide enhanced performance for production apps. The upgraded Premium plan, Premium v2, features Dv2-series VMs with faster processors, SSD storage, and double memory-to-core ratio compared to Standard.</p></li><li class="square"><p><b>Isolated</b>. The Isolated service plan is designed to run mission critical workloads, that are required to run in a virtual network. The Isolated plan allows customers to run their apps in a private, dedicated environment in an Azure datacenter using Dv2-series VMs with faster processors, SSD storage, and double the memory-to-core ratio compared to Standard.</p></li></ul><h3 class="da-h3" id="1191951">Lab: Configuring a Message-Based Integration Architecture</h3><p>✔️ <b>Important:</b> To download the most recent version of this lab, please visit the AZ-303 <a href="https://github.com/MicrosoftLearning/AZ-303-Microsoft-Azure-Architect-Technologies" title="" target="_blank">GitHub repository</a>.</p><p>Direct link to the <a href="https://aka.ms/303_Module_14b_Lab" title="" target="_blank">Lab: Configuring a Message-Based Integration Architecture</a>.</p><h4 class="da-h4">Lab scenario</h4><p><span><img alt="" src="../Images/1192088-490226.png" width="" height="" /></span></p><p>Adatum Corporation has several web applications that process files uploaded in regular intervals to their on-premises file servers. Files sizes vary, but they can reach up to 100 MB. Adatum is considering migrating the applications to Azure App Service or Azure Functions-based apps and using Azure Storage to host uploaded files. You plan to test two scenarios:</p><ul class="square"><li class="square"><p>using Azure Functions to automatically process new blobs uploaded to an Azure Storage container.</p></li><li class="square"><p>using Event Grid to generate Azure Storage queue messages that will reference new blobs uploaded to an Azure Storage container.</p></li></ul><p>These scenarios are intended to address a challenge common to a messaging-based architecture, when sending, receiving, and manipulating large messages. Sending large messages to a message queue directly is not recommended as they would require more resources to be used, result in more bandwidth to be consumed, and negatively impact the processing speed, since messaging platforms are usually fine-tuned to handle high volumes of small messages. In addition, messaging platforms usually limit the maximum message size they can process.</p><p>One potential solution is to store the message payload into an external service, like Azure Blob Store, Azure SQL or Azure Cosmos DB, get the reference to the stored payload and then send to the message bus only that reference. This architectural pattern is known as “claim check”. The clients interested in processing that specific message can use the obtained reference to retrieve the payload, if needed.</p><p>On Azure this pattern can be implemented in several ways and with different technologies, but it typically it relies on events to either automate the claim check generation and to push it into the message bus to be used by clients or to trigger payload processing directly. One of the common components included in such implementations is Event Grid, which is an event routing service responsible for delivery of events within a configurable period (up to 24 hours). After that, events are either discarded or dead lettered. If archival of event contents or replayability of event stream are needed, it is possible to facilitate this requirement by setting up an Event Grid subscription to the Event Hub or a queue in Azure Storage where messages can be retained for longer periods and archival of messages is supported.</p><p>In this lab, you will use Azure Storage Blob service to store files to be processed. A client just needs to drop the files to be shared into a designated Azure Blob container. In the first exercise, the files will be consumed directly by an Azure Function, leveraging its serverless nature. You will also take advantage of the Application Insights to provide instrumentation, facilitating monitoring and analyzing file processing. In the second exercise, you will use Event Grid to automatically generate a claim check message and send it to an Azure Storage queue. This allows a client application to poll the queue, get the message and then use the stored reference data to download the payload directly from Azure Blob Storage.</p><p>It is worth noting that the Azure Function in the first exercise relies on the Blob Storage trigger. You should opt for Event Grid trigger instead of the Blob storage trigger when dealing with the following requirements:</p><ul class="square"><li class="square"><p>blob-only storage accounts: blob storage accounts are supported for blob input and output bindings but not for blob triggers. Blob storage triggers require a general-purpose storage account.</p></li><li class="square"><p>high scale: high scale can be loosely defined as containers that have more than 100,000 blobs in them or storage accounts that have more than 100 blob updates per second.</p></li><li class="square"><p>reduced latency: if your function app is on the Consumption plan, there can be up to a 10-minute delay in processing new blobs if a function app has gone idle. To avoid this latency, you can use an Event Grid trigger or switch to an App Service plan with the Always On setting enabled.</p></li><li class="square"><p>processing of blob delete events: blob delete events are not supported by blob storage triggers.</p></li></ul><h4 class="da-h4">Objectives</h4><p>After completing this lab, you will be able to:</p><ul class="square"><li class="square"><p>Configure and validate an Azure Function App Storage Blob trigger</p></li><li class="square"><p>Configure and validate an Azure Event Grid subscription-based queue messaging</p></li></ul><h4 class="da-h4">Lab Environment</h4><p>Estimated Time: 60 minutes</p><h4 class="da-h4">Lab Files</h4><p>None</p><h5 class="da-h5">Exercise 1: Configure and validate an Azure Function App Storage Blob trigger</h5><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Configure an Azure Function App Storage Blob trigger</p></li><li><p>Validate an Azure Function App Storage Blob trigger</p></li></ol><h5 class="da-h5">Exercise 2: Configure and validate an Azure Event Grid subscription-based queue messaging</h5><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Configure an Azure Event Grid subscription-based queue messaging</p></li><li><p>Validate an Azure Event Grid subscription-based queue messaging</p></li><li><p>Remove Azure resources deployed in the lab</p></li></ol><h3 class="da-h3" id="1191610">Verifying Custom Domain Names</h3><p>When an administrator adds a custom domain name to an Azure AD, it is initially in an unverified state. Azure AD will not allow any directory resources to use an unverified domain name. This ensures that only one directory can use a domain name, and the organization using the domain name owns that domain name.</p><p>So, after adding the custom domain name, you must demonstrate ownership of the domain name. This is called verification. and is done by adding a DNS record (MX or TXT) that is provided by Azure into your company’s DNS zone. Once this record is added, Azure will query the DNS domain for the presence of the record. This could take several minutes or several hours. If Azure verifies the presence of the DNS record, it will then add the domain name to the subscription.</p><p><span><img alt="" src="../Images/1192282-490420.png" width="" height="" /></span></p><p>✔️ Notice you can use a TXT or MX record.</p><h3 class="da-h3" id="1191833">Administrator Roles, Azure Roles, and Azure AD Roles</h3><p>This topic explain the following roles and when you would use each:</p><ul class="square"><li class="square"><p>Classic subscription administrator roles</p></li><li class="square"><p>Azure roles</p></li><li class="square"><p>Azure Active Directory (Azure AD) roles</p></li></ul><h4 class="da-h4">How the roles are related</h4><p>The following diagram is a high-level view of how the classic subscription administrator roles, Azure roles, and Azure AD roles are related.</p><p><span><img alt="" src="../Images/1192113-490251.png" width="" height="" /></span></p><h4 class="da-h4">Classic subscription administrator roles</h4><p>Account Administrator, Service Administrator, and Co-Administrator are the three classic subscription administrator roles in Azure. Classic subscription administrators have full access to the Azure subscription. They can manage resources using the Azure portal.</p><p>The following table describes the differences between these three classic subscription administrative roles.</p><table style="width:100%" class=""><col width="25%" /><col width="25%" /><col width="25%" /><col width="25%" /><thead><tr><td><p>Classic subscription administrator</p></td><td><p>Limit</p></td><td><p>Permissions</p></td><td><p>Notes</p></td></tr></thead><tbody><tr><td><p><b>Account Administrator</b></p></td><td><p>1 per Azure account</p></td><td><p>Access the Azure Account CenterManage all subscriptions in an accountCreate new subscriptionsCancel subscriptionsChange the billing for a subscriptionChange the Service Administrator</p></td><td><p>Conceptually, the billing owner of the subscription. The Account Administrator has no access to the Azure portal.</p></td></tr><tr><td><p><b>Service Administrator</b></p></td><td><p>1 per Azure subscription</p></td><td><p>Manage services in the Azure portalCancel the subscriptionAssign users to the Co-Administrator role</p></td><td><p>By default, for a new subscription, the Account Administrator is also the Service Administrator. The Service Administrator has the equivalent access of a user who is assigned the Owner role at the subscription scope. The Service Administrator has full access to the Azure portal.</p></td></tr><tr><td><p><b>Co-Administrator</b></p></td><td><p>200 per subscription</p></td><td><p>Same access privileges as the Service Administrator, but can’t change the association of subscriptions to Azure directoriesAssign users to the Co-Administrator role, but cannot change the Service Administrator</p></td><td><p>The Co-Administrator has the equivalent access of a user who is assigned the Owner role at the subscription scope.</p></td></tr></tbody></table><p>In the Azure portal, you can manage Co-Administrators or view the Service Administrator by using the <b>Classic administrators</b> tab.</p><p><span><img alt="" src="../Images/1192114-490252.png" width="" height="" /></span></p><p>In the Azure portal, you can view or change the Service Administrator or view the Account Administrator on the properties blade of your subscription.</p><p><span><img alt="" src="../Images/1192115-490253.png" width="" height="" /></span></p><h4 class="da-h4">Azure roles</h4><p>Azure RBAC includes over 70 built-in roles. There are four fundamental Azure roles. The first three apply to all resource types:</p><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p>Azure role</p></td><td><p>Permissions</p></td><td><p>Notes</p></td></tr></thead><tbody><tr><td><p><b>Owner</b></p></td><td><p>Full access to all resourcesDelegate access to others</p></td><td><p>The Service Administrator and Co-Administrators are assigned the Owner role at the subscription scope Applies to all resource types.</p></td></tr><tr><td><p><b>Contributor</b></p></td><td><p>Create and manage all of types of Azure resourcesCreate a new tenant in Azure Active DirectoryCannot grant access to others</p></td><td><p>Applies to all resource types.</p></td></tr><tr><td><p><b>Reader</b></p></td><td><p>View Azure resources</p></td><td><p>Applies to all resource types.</p></td></tr><tr><td><p><b>User Access Administrator</b></p></td><td><p>Manage user access to Azure resources</p></td><td><p /></td></tr></tbody></table><p>In the Azure portal, role assignments using Azure RBAC appear on the <b>Access control (IAM) blade</b>. This blade can be found throughout the portal, such as management groups, subscriptions, resource groups, and various resources.</p><p><span><img alt="" src="../Images/1192116-490254.png" width="" height="" /></span></p><p>When you click the <b>Roles</b> tab, you will see the list of built-in and custom roles.</p><p><span><img alt="" src="../Images/1192117-490255.png" width="" height="" /></span></p><h4 class="da-h4">Azure AD roles</h4><p>Azure AD roles are used to manage Azure AD resources in a directory such as create or edit users, assign administrative roles to others, reset user passwords, manage user licenses, and manage domains. The following table describes a few of the more important Azure AD roles.</p><p><b>Global Administrator</b></p><p>The following permissions apply:</p><ul class="square"><li class="square"><p>Manage access to all administrative features in Azure Active Directory, as well as services that federate to Azure Active Directory</p></li><li class="square"><p>Assign administrator roles to others</p></li><li class="square"><p>Reset the password for any user and all other administrators</p></li></ul><p><b>User Administrator</b></p><p>The following permissions apply:</p><ul class="square"><li class="square"><p>Create and manage all aspects of users and groups</p></li><li class="square"><p>Manage support tickets</p></li><li class="square"><p>Monitor service health</p></li><li class="square"><p>Change passwords for users, Helpdesk administrators, and other User Administrators</p></li></ul><p><b>Billing Administrator</b></p><p>The following permissions apply:</p><ul class="square"><li class="square"><p>Make purchases</p></li><li class="square"><p>Manage subscriptions</p></li><li class="square"><p>Manage support tickets</p></li><li class="square"><p>Monitors service health</p></li></ul><p>In the Azure portal, you can see the list of Azure AD roles on the <b>Roles and administrators</b> blade.</p><p><span><img alt="" src="../Images/1192118-490256.png" width="" height="" /></span></p><h4 class="da-h4">Differences between Azure roles and Azure AD roles</h4><p>At a high level, Azure roles control permissions to manage Azure resources, while Azure AD roles control permissions to manage Azure Active Directory resources. The following table compares some of the differences.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Azure roles</p></td><td><p>Azure AD roles</p></td></tr></thead><tbody><tr><td><p><b>Manage access to Azure resources</b></p></td><td><p>Manage access to Azure Active Directory resources</p></td></tr><tr><td><p><b>Supports custom roles</b></p></td><td><p>Supports custom roles</p></td></tr><tr><td><p><b>Scope can be specified at multiple levels (management group, subscription, resource group, resource)</b></p></td><td><p>Scope is at the tenant level</p></td></tr><tr><td><p><b>Role information can be accessed in Azure portal, Azure CLI, Azure PowerShell, Azure Resource Manager templates, REST API</b></p></td><td><p>Role information can be accessed in Azure admin portal, Microsoft 365 admin center, Microsoft Graph, AzureAD PowerShell</p></td></tr></tbody></table><h3 class="da-h3" id="1191693">Deploy VMs to Dedicated Hosts</h3><p>This topic guides you through how to create and deploy an Azure dedicated host to virtual machines.</p><p><b>Limitations</b></p><ul class="square"><li class="square"><p>Virtual machine scale sets are not currently supported on dedicated hosts.</p></li><li class="square"><p>The sizes and hardware types available for dedicated hosts vary by region. Create a host group</p></li></ul><p>You can use one or both of the following options with your dedicated hosts:</p><ul class="square"><li class="square"><p>Span across multiple availability zones. In this case, you are required to have a host group in each of the zones you wish to use.</p></li><li class="square"><p>Span across multiple fault domains which are mapped to physical racks.</p></li></ul><p>Below is a procedure for creating a host group using 1 availability zone and 2 fault domains.</p><ol class="number"><li><p>Open the Azure <a href="https://portal.azure.com/" title="" target="_blank">portal</a>.</p></li><li><p>Select <b>Create a resource</b> in the upper left corner.</p></li><li><p>Search for Host group and then select <b>Host Groups</b> from the results.</p></li><li><p>In the <b>Host Groups</b> page, select <b>Create</b>.</p></li><li><p>Select the subscription you would like to use, and then select <b>Create new</b>.</p></li><li><p>Type <i>myDedicatedHostsRG</i> as the Name and then select <b>OK</b>.</p></li><li><p>For <b>Host group name</b>, type <i>myHostGroup</i>.</p></li><li><p>For <b>Location</b>, select <b>East US</b>.</p></li><li><p>For <b>Availability Zone</b>, select <b>1</b>.</p></li><li><p>For <b>Fault domain count</b>, select <b>2</b>.</p></li><li><p>Select <b>Review + create</b>.</p></li><li><p>Select <b>Create</b>.</p></li></ol><p><b>Create a dedicated host</b></p><ol class="number"><li><p>Select <b>Create a resource</b> in the upper left corner.</p></li><li><p>Search for <b>Dedicated host</b> and then select <b>Dedicated hosts</b> from the results.</p></li><li><p>In the <b>Dedicated Hosts</b> page, select <b>Create</b>.</p></li><li><p>Select the subscription you would like to use.</p></li><li><p>Select <b>myDedicatedHostsRG</b> as the Resource group.</p></li><li><p>In <b>Instance details</b>, type <i>myHost</i> for the <b>Name</b> and <b>select East US</b> for the location.</p></li><li><p>In <b>Hardware profile</b>, select <b>Standard Es3 family - Type 1</b> for the Size family, select <b>myHostGroup</b> for the Host group and then <b>select 1</b> for the Fault domain. Leave the defaults for the remaining fields.</p></li><li><p>Select <b>Review + create</b>.</p></li><li><p>Select <b>Create</b>.</p></li></ol><p><b>Create a VM</b></p><ol class="number"><li><p>Choose <b>Create a resource</b> in the upper left-hand corner of the Azure portal.</p></li><li><p>In the <b>New</b> page, under <b>Popular</b>, select <b>Windows Server 2016 Datacenter</b>.</p></li><li><p>In the <b>Basics</b> tab, under <b>Project details</b>, make sure the correct subscription is selected and then select <b>myDedicatedHostsRG</b> as the Resource group.</p></li><li><p>Under <b>Instance details</b>, type <i>myVM</i> for the Virtual machine name and choose <b>East US</b> for your Location.</p></li><li><p>In <b>Availability options</b> select <b>Availability zone</b>, select <b>1</b> from the drop-down.</p></li><li><p>For the size, select <b>Change size</b>. In the list of available sizes, choose one from the Esv3 series, like <b>Standard E2s v3</b>.</p></li><li><p>Under <b>Administrator</b> account, provide a username, such as <i>azureuser</i> and a password.</p></li><li><p>Under <b>Inbound port rules</b>, choose <b>Allow</b> selected ports and then select <b>RDP (3389)</b> from the drop-down.</p></li><li><p>At the top of the page, select the <b>Advanced tab</b> and in the <b>Host</b> section, select <i>myHostGroup</i> for <b>Host</b> group and <i>myHost</i> for the <b>Host</b>.</p></li></ol><p><span><img alt="" src="../Images/1192241-490379.png" width="" height="" /></span></p><ol class="number"><li value="10"><p>Select <b>Review + create</b>.</p></li><li><p>Select <b>Create</b>.</p></li></ol><h3 class="da-h3" id="1191707">Application Gateway Routing</h3><p>Clients send requests to your web apps to the IP address or DNS name of the gateway. The gateway routes requests to a selected web server in the back-end pool, using a set of rules configured for the gateway to determine where the request should go.</p><p>There are two primary methods of routing traffic, <b>path-based</b> routing and <b>multiple site</b> hosting.</p><h4 class="da-h4">Path-based routing</h4><p>Path-based routing enables you to send requests with different paths in the URL to a different pool of back-end servers.</p><p><span><img alt="" src="../Images/1192302-490440.png" width="" height="" /></span></p><h4 class="da-h4">Multiple site routing</h4><p>Multiple site hosting enables you to configure more than one web application on the same application gateway instance. In a multi-site configuration, you register multiple DNS names (CNAMEs) for the IP address of the Application Gateway, specifying the name of each site. Application Gateway uses separate listeners to wait for requests for each site. Each listener passes the request to a different rule, which can route the requests to servers in a different back-end pool.</p><p><span><img alt="" src="../Images/1192303-490441.png" width="" height="" /></span></p><p>Multi-site configurations are useful for supporting multi-tenant applications, where each tenant has its own set of virtual machines or other resources hosting a web application.</p><h4 class="da-h4">Additional features</h4><ul class="square"><li class="square"><p><b>Redirection</b>. Redirection can be used to another site, or from HTTP to HTTPS.</p></li><li class="square"><p><b>Rewrite HTTP headers</b>. HTTP headers allow the client and server to pass additional information with the request or the response.</p></li><li class="square"><p><b>Custom error pages</b>. Application Gateway allows you to create custom error pages instead of displaying default error pages. You can use your own branding and layout using a custom error page.</p></li></ul><h3 class="da-h3" id="1191617">Demonstration - Secure user sign-in events with Azure Multi-Factor Authentication</h3><p>Multi-factor authentication (MFA) is a process where a user is prompted during a sign-in event for additional forms of identification. This prompt could be to enter a code on their cellphone or to provide a fingerprint scan. When you require a second form of authentication, security is increased as this additional factor isn't something that's easy for an attacker to obtain or duplicate.</p><p>Azure Multi-Factor Authentication and Conditional Access policies give the flexibility to enable MFA for users during specific sign-in events.</p><p><b>Prerequisites</b></p><p>To perform this demonstration you need the following resources and privileges:</p><ul class="square"><li class="square"><p>A working Azure AD tenant with Azure AD Premium or trial license enabled.</p></li><li class="square"><p>An account with global administrator privileges.</p></li><li class="square"><p>A non-administrator user with a password you know, such as <i>testuser</i>. You test the end-user Azure Multi-Factor Authentication experience using this account in this demonstration.</p></li><li class="square"><p>A group that the non-administrator user is a member of, such as MFA-Test-Group. You enable Azure Multi-Factor Authentication for this group in this demonstration.</p></li></ul><h4 class="da-h4">Create a Conditional Access Policy</h4><p>The recommended way to enable and use Azure Multi-Factor Authentication is with Conditional Access policies. Conditional Access lets you create and define policies that react to sign in events and request additional actions before a user is granted access to an application or service.</p><p><span><img alt="" src="../Images/1192180-490318.png" width="" height="" /></span></p><p>In this demonstration you will create a basic Conditional Access policy to prompt for MFA when a user signs in to the Azure portal.</p><p>First, create a Conditional Access policy and assign your test group of users as follows:</p><ol class="number"><li><p>Sign in to the <a href="https://portal.azure.com/" title="" target="_blank">Azure portal</a> using an account with global administrator permissions.</p></li><li><p>Search for and select <b>Azure Active Directory</b>, then choose <b>Security</b>.</p></li><li><p>Select <b>Conditional Access</b>, then choose <b>+ New policy</b>.</p></li><li><p>Enter a name for the policy, such as <i>MFA Pilot</i>.</p></li><li><p>Under <b>Assignments</b>, choose <b>Users and groups</b>, then <b>Select users and groups</b>.</p></li><li><p>Check the box for <b>Users and groups</b>, then <b>Select</b>.</p></li><li><p>Browse for and select your Azure AD group, such as <i>MFA-Test-Group</i>, then choose <b>Select</b>.</p></li></ol><p><span><img alt="" src="../Images/1192181-490319.png" width="" height="" /></span></p><ol class="number"><li value="8"><p>To apply the Conditional Access policy for the group, select <b>Done</b>.</p></li></ol><h4 class="da-h4">Configure the conditions for Multi-Factor Authentication</h4><p>With the Conditional Access policy created and a test group of users assigned, now define the cloud apps or actions that trigger the policy. These cloud apps or actions are the scenarios you decide require additional processing, such as to prompt for MFA.</p><p>Configure the Conditional Access policy to require MFA when a user signs in to the Azure portal.</p><ol class="number"><li><p>Select <b>Cloud apps or actions</b>. You can choose to apply the Conditional Access policy to <i>All cloud apps</i> or <i>Select apps</i>.</p></li></ol><p>On the Include page, choose Select apps.</p><ol class="number"><li value="2"><p>Choose <b>Select</b>, then browse the list of available sign-in events that can be used.</p></li></ol><p>Choose <b>Microsoft Azure Management</b> so the policy applies to sign-in events to the Azure portal.</p><ol class="number"><li value="3"><p>To apply the select apps, choose <b>Select</b>, then <b>Done</b>.</p></li></ol><p><span><img alt="" src="../Images/1192182-490320.png" width="" height="" /></span></p><p>Access controls let you define the requirements for a user to be granted access, such as needing an approved client app or using a device that's Hybrid Azure AD joined. Configure the access controls to require MFA during a sign-in event to the Azure portal.</p><ol class="number"><li><p>Under <b>Access controls</b>, choose <b>Grant</b>, then make sure that <b>Grant access</b> is selected.</p></li><li><p>Check the box for <b>Require multi-factor authentication</b>, then choose <b>Select</b>.</p></li></ol><p>Conditional Access policies can be set to Report-only if you want to see how the configuration would impact users, or Off if you don't want to the use policy right now. As a test group of users was targeted for this demonstration, lets enable the policy and then test Azure Multi-Factor Authentication.</p><ol class="number"><li><p>Set the <i>Enable policy</i> to <b>On</b>.</p></li><li><p>To apply the <i>Conditional Access policy</i>, select <b>Create</b>.</p></li></ol><h4 class="da-h4">Test Azure Multi-Factor Authentication</h4><p>To view the Conditional Access policy and Azure Multi-Factor Authentication sign in to a resource that doesn't require MFA as follows:</p><ol class="number"><li><p>Open a new browser window in InPrivate or incognito mode and browse to <a href="https://account.activedirectory.windowsazure.com/" title="" target="_blank">https://account.activedirectory.windowsazure.com</a></p></li><li><p>Sign in with your non-administrator test user, such as testuser. There's no prompt for you to complete MFA.</p></li><li><p>Close the browser window.</p></li></ol><p>Now sign in to the Azure portal. As the Azure portal was configured in the Conditional Access policy to require additional verification, you get an Azure Multi-Factor Authentication prompt.</p><ol class="number"><li><p>Open a new browser window in InPrivate or incognito mode and browse to <a href="https://portal.azure.com/" title="" target="_blank">https://portal.azure.com</a>.</p></li><li><p>Sign in with your non-administrator test user, such as testuser. You're required to register for and use Azure Multi-Factor Authentication. Follow the prompts to complete the process and verify you successfully sign in to the Azure portal.</p></li></ol><p><span><img alt="" src="../Images/1192183-490321.png" width="" height="" /></span></p><h3 class="da-h3" id="1191658">Transitivity and Gateway Transit</h3><p>Virtual network peering is nontransitive. Only virtual networks that are directly peered can communicate with each other. The virtual networks can't communicate with the peers of their peers.</p><p>Suppose, for example, that your three virtual networks (A, B, C) are peered like this: A &lt;-&gt; B &lt;-&gt; C. Resources in A can't communicate with resources in C because that traffic can't transit through virtual network B. If you need communication between virtual network A and virtual network C, you must explicitly peer these two virtual networks.</p><p><b>Gateway Transit</b></p><p>You can configure transitive connections on-premises if you use virtual network gateways as transit points. Using gateway transit, you can enable on-premises connectivity without deploying virtual network gateways to all your virtual networks. This method might reduce cost and complexity. By using gateway peering, you can configure a single virtual network as a hub network. Connect this hub network to your on-premises datacenter and share its virtual network gateway with peers.</p><p>To enable gateway transit, configure the <b>Allow gateway transit</b> option in the hub virtual network where you deployed the gateway connection to your on-premises network. Also configure the Use remote gateways option in any spoke virtual networks.
.</p><p><b>Overlapping address spaces</b></p><p>IP address spaces of connected networks within Azure and between Azure and your on-premises system can't overlap. This is also true for peered virtual networks. Keep this rule in mind when you're planning your network design. In any networks you connect through virtual network peering, VPN, or ExpressRoute, assign different address spaces that don't overlap.</p><p><span><img alt="" src="../Images/1192284-490422.png" width="" height="" /></span></p><p><b>When to choose virtual network peering</b></p><p>Virtual network peering can be the best way to enable network connectivity between services that are in different virtual networks. Because it's easy to implement and deploy, and it works well across regions and subscriptions, virtual network peering should be your first choice when you need to integrate Azure virtual networks.</p><p>Peering might not be your best option if you have existing VPN or ExpressRoute connections or services behind Azure Basic Load Balancers that would be accessed from a peered virtual network. In these cases, you should research alternatives.</p><h3 class="da-h3" id="1191714">Demonstration - Create an Azure Front Door</h3><p>This practice exercise explains how to create a Front Door profile that delivers high availability and high performance for a global web application.</p><p>The scenario described in this exercise includes two instances of a web application running in different Azure regions. A Front Door configuration based on equal weighted and same priority backends is created that helps direct user traffic to the nearest set of site backends running the application. Front Door continuously monitors the web application and provides automatic failover to the next available backend when the nearest site is unavailable.</p><p>Sign in to the Azure portal at <a href="https://portal.azure.com" title="Azure Portal" target="_blank">https://portal.azure.com</a>.</p><p><b>Prerequisites</b></p><p>This exercise requires that you have deployed two instances of a web application running in different Azure regions (East US and West Europe). Both the web application instances run in Active/Active mode, that is, either of them can take traffic at any time unlike a Active/Stand-By configuration where one acts as a failover.</p><ol class="number"><li><p>On the top left-hand side of the screen, select <b>Create a resource &gt; Web &gt; Web App &gt; Create</b>.</p></li><li><p>In <b>Web App</b>, enter or select the following information and enter default settings where none are specified:</p></li></ol><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Setting</p></td><td><p>Value</p></td></tr></thead><tbody><tr><td><p><b>Name</b></p></td><td><p>Enter a unique name for your web app</p></td></tr><tr><td><p><b>Resource group</b></p></td><td><p>Select <b>New</b>, and then type <i>myResourceGroupFD1</i></p></td></tr><tr><td><p><b>App Service plan/Location</b></p></td><td><p>Select New. In the <b>App Service plan</b>, enter <i>myAppServicePlanEastUS</i>, and then select <b>OK</b>.</p></td></tr><tr><td><p><b>Location</b></p></td><td><p><b>East US</b></p></td></tr></tbody></table><ol class="number"><li value="3"><p>Select <b>Create</b>.</p></li><li><p>A default website is created when the Web App is successfully deployed.</p></li><li><p>Repeat steps 1-3 to create a second website in a different Azure region with the following settings:</p></li></ol><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Setting</p></td><td><p>Value</p></td></tr></thead><tbody><tr><td><p><b>Name</b></p></td><td><p>Enter a unique name for your web   app</p></td></tr><tr><td><p><b>Resource group</b></p></td><td><p>Select New, and then type myResourceGroupFD1</p></td></tr><tr><td><p><b>App Service plan/Location</b></p></td><td><p>Select <b>New</b>. In the <b>App Service plan</b>, enter <i>myAppServicePlanEastUS</i>, and then select <b>OK</b>.</p></td></tr><tr><td><p><b>Location</b></p></td><td><p><b>East US</b></p></td></tr></tbody></table><p><b>Create a Front Door for your application</b></p><p><b>A. Add a frontend host for Front Door</b></p><p>Create a Front Door configuration that directs user traffic based on lowest latency between the two backends.</p><ol class="number"><li><p>On the top left-hand side of the screen, select <b>Create a resource &gt; Networking &gt; Front Door &gt; Create</b>.</p></li><li><p>In the Create a Front Door, you start with adding the basic info and provide a subscription where you want the Front Door to be configured. Similarly, like any other Azure resource you also need to provide a ResourceGroup and a Resource Group region if you are creating a new one. Lastly, you need to provide a name for your Front Door.</p></li><li><p>Once the basic info is filled in, the first step you need to define is the frontend host for the configuration. The result should be a valid domain name like <i>myappfrontend.azurefd.net</i>. This <i>hostname</i> needs to be globally unique but Front Door will take care of that validation.</p></li></ol><p><b>B. Add application backend and backend pools</b></p><p>Next, you need to configure your application backend(s) in a backend pool for Front Door to know where your application resides.</p><ol class="number"><li><p>Click the <b>+</b> icon to add a backend pool and then specify a name for your backend pool, say <i>myBackendPool</i>.</p></li><li><p>Next, click on <b>Add Backends</b> to add your websites created earlier.</p></li><li><p>Select Target host type as <i>App Service</i>, select the subscription in which you created the web site and then choose the first web site from the Target host name, that is, <i>myAppServicePlanEastUS.azurewebsites.net</i>.</p></li><li><p>Leave the remaining fields as is for now and click <b>Add</b>.</p></li><li><p>Repeat steps 2 to 4 to add the other website, that is, <i>myAppServicePlanWestEurope.azurewebsites.net</i></p></li><li><p>You can optionally choose to update the Health Probes and Load Balancing settings for the backend pool, but the default values should also work. Click <b>Add</b>.</p></li></ol><p><b>C. Add a routing rule</b></p><p>Lastly, click the <b>+</b> icon on Routing rules to configure a routing rule. This is needed to map your frontend host to the backend pool, which basically is configuring that if a request comes to <b>myappfrontend.azurefd.net</b>, then forward it to the backend pool <i>myBackendPool</i>. Click <b>Add</b> to add the routing rule for your Front Door. You should now be good to creating the Front Door and so click on <b>Review and Create</b>.</p><p><b>View Front Door in action</b></p><p>Once you create a Front Door, it will take a few minutes for the configuration to be deployed globally everywhere. Once complete, access the frontend host you created, that is, go to a web browser and hit the URL <i>myappfrontend.azurefd.net</i>. Your request will automatically get routed to the nearest backend to you from the specified backends in the backend pool.</p><p><b>View Front Door handle application failover</b></p><p>If you want to test Front Door's instant global failover in action, you can go to one of the web sites you created and stop it. Based on the Health Probe setting defined for the backend pool, we will instantly fail over the traffic to the other web site deployment. You can also test behavior, by disabling the backend in the backend pool configuration for your Front Door.</p><h3 class="da-h3" id="1191743">Blob Containers</h3><p>A container provides a grouping of a set of blobs. All blobs must be in a container. An account can contain an unlimited number of containers. A container can store an unlimited number of blobs. You can create the container in the Azure Portal.</p><p><span><img alt="" src="../Images/1192190-490328.png" width="" height="" /></span></p><p><b>Name</b>: The name may only contain lowercase letters, numbers, and hyphens, and must begin with a letter or a number. The name must also be between 3 and 63 characters long.</p><p><b>Public access level</b>: Specifies whether data in the container may be accessed publicly. By default, container data is private to the account owner.</p><ul class="square"><li class="square"><p>Use <b>Private</b> to ensure there is no anonymous access to the container and blobs.</p></li><li class="square"><p>Use <b>Blob</b> to allow anonymous public read access for blobs only.</p></li><li class="square"><p>Use <b>Container</b> to allow anonymous public read and list access to the entire container, including the blobs.</p></li></ul><p>✔️ You can also create the Blob container with PowerShell using the <b>New-AzStorageContainer</b> command.</p><p>✔️ Have you thought about how you will organize your containers?</p><h3 class="da-h3" id="1191731">Module 5 Review Questions</h3><p><span><img alt="" src="../Images/1192029-490167.png" width="" height="" /></span></p><h4 class="problem">Review Question 1</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-5ae1bbe4-db36-2f46-0ea1-36deef798725"><div class="card quizlib-question"><div class="quizlib-question-title"><p>Your company provides customers a virtual network in the cloud. You have dozens of Linux virtual machines in another virtual network. You need to install an Azure load balancer to direct traffic between the virtual networks. What should you do? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q5ae1bbe4-db36-2f46-0ea1-36deef798725" value="1" />Install a private load balancer.<br /></label></li><li><label><input type="radio" name="q5ae1bbe4-db36-2f46-0ea1-36deef798725" value="2" />Install a public load balancer.<br /></label></li><li><label><input type="radio" name="q5ae1bbe4-db36-2f46-0ea1-36deef798725" value="3" />Install an external load balancer.<br /></label></li><li><label><input type="radio" name="q5ae1bbe4-db36-2f46-0ea1-36deef798725" value="4" />Install an internal load balancer.<br /></label></li><li><label><input type="radio" name="q5ae1bbe4-db36-2f46-0ea1-36deef798725" value="5" />Install a network load balancer.<br /></label></li></ul></div></div><div id="feedback-problem-5ae1bbe4-db36-2f46-0ea1-36deef798725" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Install an internal load balancer. Azure has two types of load balancers: public and internal. An internal load balancer directs traffic only to resources that are inside a virtual network or that use a VPN to access Azure infrastructure.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 2</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-0d6adb05-5df7-6002-9d80-06aca84ff67b"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You are advising a company that is planning to create a virtual network that has a scale set that contains ten VMs.<br />
They have a monitoring solution on a separate network that will need to access the VMs within the scale set.<br />
They want to define public access to the virtual machines.<br />
You recommend that they implement an Azure Load Balancer to for connecting the monitoring solution to the VMs. Does this recommendation fulfill the goal?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q0d6adb05-5df7-6002-9d80-06aca84ff67b" value="1" />Yes<br /></label></li><li><label><input type="radio" name="q0d6adb05-5df7-6002-9d80-06aca84ff67b" value="2" />No<br /></label></li></ul></div></div><div id="feedback-problem-0d6adb05-5df7-6002-9d80-06aca84ff67b" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct Answer: The technique of using a round-robin approach with an Azure Load Balancer allows access to a virtual machine within a scale set externally.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 3</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-c2fd2187-6652-94fe-ad77-952c93bfa5c1"><div class="card quizlib-question"><div class="quizlib-question-title"><p>Your organization has Azure VMs deployed to three Azure regions. Each region contains a single virtual network that has four VMs on the same subnet. Each virtual machine runs an application named OEM_APP_3.
OEM_APP_3 is accessible by using HTTPs.<br /></p><ul class="square"><li class="square"><p>The VMs are cannot be accessed from the Internet.</p></li><li class="square"><p>You are asked to use Azure Front Door to load balance requests from OEM_SQL_3 across all the VMs.</p></li><li class="square"><p>What other Azure service should you enable?</p></li></ul></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="qc2fd2187-6652-94fe-ad77-952c93bfa5c1" value="1" />An internal Azure Load Balancer<br /></label></li><li><label><input type="radio" name="qc2fd2187-6652-94fe-ad77-952c93bfa5c1" value="2" />Azure Private Link<br /></label></li><li><label><input type="radio" name="qc2fd2187-6652-94fe-ad77-952c93bfa5c1" value="3" />A public Azure Load Balancer<br /></label></li><li><label><input type="radio" name="qc2fd2187-6652-94fe-ad77-952c93bfa5c1" value="4" />Enable High Availability ports<br /></label></li></ul></div></div><div id="feedback-problem-c2fd2187-6652-94fe-ad77-952c93bfa5c1" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct answer: A public Azure Load Balancer.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h3 class="da-h3" id="1191692">Azure Dedicated Hosts Capacity</h3><p>Once a dedicated host is provisioned, Azure assigns it to physical server. This guarantees the availability of the capacity when you need to provision your VM. Azure uses the entire capacity in the region (or zone) to pick a physical server for your host.</p><p><b>Quotas</b></p><p>There is a default quota limit of 3000 vCPUs for dedicated hosts, per region. But, the number of hosts you can deploy is also limited by the quota for the VM size family used for the host. For example, a Pay-as-you-go subscription may only have a quota of 10 vCPUs available for the Dsv3 size series, in the East US region. In this case, you need to request a quota increase to at least 64 vCPUs before you can deploy a dedicated host. Select the <b>Request increase</b> button in the upper right corner to file a request if needed.</p><p><span><img alt="" src="../Images/1192414-490552.png" width="" height="" /></span></p><p><b>Pricing</b></p><p>Users are charged per dedicated host, regardless how many VMs are deployed. In your monthly statement you will see a new billable resource type of hosts. The VMs on a dedicated host will still be shown in your statement, but will carry a price of 0.</p><p>The host price is set based on VM family, type (hardware size), and region. A host price is relative to the largest VM size supported on the host.</p><p>Software licensing, storage and network usage are billed separately from the host and VMs. There is no change to those billable items.</p><h3 class="da-h3" id="1191754">Demonstration - SAS (Portal)</h3><p>In this demonstration, we will create a shared access signature.</p><p><b>Note</b>: This demonstration requires a storage account, with a blob container, and an uploaded file.</p><p><b>Create a SAS at the service level</b></p><ol class="number"><li><p>Sign into the Azure portal.</p></li><li><p>Locate the storage account you want to work with and open it. Drill down to your blob container.</p></li><li><p>Click the file you would like to provide access to.</p></li><li><p>Select the <b>Generate SAS</b> tab.</p></li><li><p>Configure the shared access signature using the following parameters:
</p><ul class="square"><li class="square"><p><b>Permissions</b>: Read</p></li><li class="square"><p><b>Start and expiry date/time</b>: Today's date to start, 1 year out for expiry</p></li><li class="square"><p><b>Allowed protocols</b>: HTTPS</p></li><li class="square"><p><b>Signing key</b>: Key1</p></li></ul></li><li><p>Copy the <b>Blob Server SAS URL</b> and paste the URL into a browser.</p></li><li><p>Verify the blob file displays.</p></li><li><p>Review the different URL parameters that you learned about in the lesson.</p></li></ol><p><b>Create a SAS at the account level</b></p><ol class="number"><li><p>Return to your storage account.</p></li><li><p>Click <b>Shared access signature</b>.</p></li><li><p>Notice you can configure a variety of services, resource types, and permissions.</p></li><li><p>Click <b>Generate SAS and connection string</b>.</p></li><li><p>Review the connection string, SAS token, and URL information that is provided.</p></li></ol><h3 class="da-h3" id="1191840">Demonstration - Create and Manage Policies to Enforce Compliance</h3><p>In this demonstration, you learn to use Azure Policy to do some of the more common tasks related to creating, assigning, and managing policies across your organization, such as:</p><ul class="square"><li class="square"><p>Assign a policy to enforce a condition for resources you create in the future</p></li><li class="square"><p>Create and assign an initiative definition to track compliance for multiple resources</p></li><li class="square"><p>Resolve a non-compliant or denied resource</p></li><li class="square"><p>Implement a new policy across an organization</p></li></ul><h4 class="da-h4">Assign a policy</h4><p>The first step in enforcing compliance with Azure Policy is to assign a policy definition. A policy definition defines under what condition a policy is enforced and what effect to take. In this example, assign the built-in policy definition called <i>Inherit a tag from the resource group if missing</i> to add the specified tag with its value from the parent resource group to new or updated resources missing the tag.</p><ol class="number"><li><p>Go to the Azure portal to assign policies. Search for and select <b>Policy</b>.</p></li></ol><p><span><img alt="" src="../Images/1192207-490345.png" width="" height="" /></span></p><ol class="number"><li value="2"><p>Select <b>Assignments</b> on the left side of the Azure Policy page. An assignment is a policy that has been assigned to take place within a specific scope.</p></li></ol><p><span><img alt="" src="../Images/1192208-490346.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>Select <b>Assign Policy</b> from the top of the <b>Policy - Assignments</b> page.</p></li></ol><p><span><img alt="" src="../Images/1192209-490347.png" width="" height="" /></span></p><ol class="number"><li value="4"><p>On the <b>Assign Policy</b> page and <b>Basics</b> tab, select the <b>Scope</b> by selecting the ellipsis and selecting either a management group or subscription. Optionally, select a resource group. A scope determines what resources or grouping of resources the policy assignment gets enforced on. Then select <b>Select</b> at the bottom of the <b>Scope</b> page.</p></li><li><p>Resources can be excluded based on the Scope. Exclusions start at one level lower than the level of the <b>Scope. Exclusions</b> are optional, so leave it blank for now.</p></li><li><p>Select the <b>Policy definition</b> ellipsis to open the list of available definitions. You can filter the policy definition <b>Type</b> to <i>Built-in</i> to view all and read their descriptions.</p></li><li><p>Select <b>Inherit a tag from the resource group if missing</b>. Select <b>Select</b> at the bottom of the <b>Available Definitions</b> page once you have found and selected the policy definition.</p></li></ol><p><span><img alt="" src="../Images/1192210-490348.png" width="" height="" /></span></p><ol class="number"><li value="8"><p>The <b>Assignment name</b> is automatically populated with the policy name you selected, but you can change it. For this example, leave <i>Inherit a tag from the resource group if missing</i>. You can also add an optional <b>Description</b>. The description provides details about this policy assignment.</p></li><li><p>Leave <b>Policy enforcement</b> as <i>Enabled</i>. When <i>Disabled</i>, this setting allows testing the outcome of the policy without triggering the effect.</p></li><li><p><b>Assigned by</b> is automatically filled based on who is logged in.</p></li><li><p>Select the <b>Parameters</b> tab at the top of the wizard.</p></li><li><p>For <b>Tag Name</b>, enter <i>Environment</i>.</p></li><li><p>Select the <b>Remediation</b> tab at the top of the wizard.</p></li><li><p>Leave <b>Create a remediation task</b> unchecked. This box allows you to create a task to alter existing resources in addition to new or updated resources.</p></li><li><p><b>Create a Managed Identity</b> is automatically checked since this policy definition uses the modify effect. <b>Permissions</b> is set to <i>Contributor</i> automatically based on the policy definition.</p></li><li><p>Select the <b>Review + create</b> tab at the top of the wizard.</p></li><li><p>Review your selections, then select <b>Create</b> at the bottom of the page.</p></li></ol><h3 class="da-h3" id="1191950">Lab: Implementing an Azure App Service Web App with a Staging Slot</h3><p>✔️ <b>Important:</b> To download the most recent version of this lab, please visit the AZ-303 <a href="https://github.com/MicrosoftLearning/AZ-303-Microsoft-Azure-Architect-Technologies" title="" target="_blank">GitHub repository</a>.</p><p>Direct link to the <a href="https://aka.ms/303_Module_14a_Lab" title="" target="_blank">Lab: Implementing an Azure App Service Web App with a Staging Slot</a>.</p><h4 class="da-h4">Lab scenario</h4><p><span><img alt="" src="../Images/1192088-490226.png" width="" height="" /></span></p><p>Adatum Corporation has a number of web apps that are updated on relatively frequent basis. While Adatum has not yet fully embraced DevOps principles, it relies on Git as its version control and is exploring the options to streamline the app updates. As Adatum is transitioning some of its workloads to Azure, the Adatum Enterprise Architecture team decided to evaluate the use of Azure App Service and its deployment slots to accomplish this objective.</p><p>Deployment slots are live apps with their own host names. App content and configurations elements can be swapped between two deployment slots, including the production slot. Deploying apps to a non-production slot has the following benefits:</p><ul class="square"><li class="square"><p>It is possible to validate app changes in a staging deployment slot before swapping it with the production slot.</p></li><li class="square"><p>Deploying an app to a slot first and swapping it into production makes sure that all instances of the slot are warmed up before being swapped into production. This eliminates downtime when during app deployment. The traffic redirection is seamless, and no requests are dropped because of swap operations. This workflow can be automated by configuring auto swap when pre-swap validation is not needed.</p></li><li class="square"><p>After a swap, the slot with previously staged app has the previous production app. If the changes swapped into the production slot need to be reversed, this simply involves another swap immediately to return to the last known good state.</p></li></ul><p>Deployment slots facilitate two common deployment patterns: blue/green and A/B testing. Blue-green deployment involves deploying an update into a production environment that is separate from the live application. After the deployment is validated, traffic routing is switched to the updated version. A/B testing involves gradually routing some of the traffic to a staging site in order to test a new version of an app.</p><p>The Adatum Architecture team wants to use Azure App Service web apps with deployment slots in order to test these two deployment patterns:</p><ul class="square"><li class="square"><p>Blue/Green deployments</p></li><li class="square"><p>A/B testing</p></li></ul><h4 class="da-h4">Objectives</h4><p>After completing this lab, you will be able to:</p><ul class="square"><li class="square"><p>Implement Blue/Green deployment pattern by using deployment slots of Azure App Service web apps</p></li><li class="square"><p>Perform A/B testing by using deployment slots of Azure App Service web apps</p></li></ul><h4 class="da-h4">Lab Environment</h4><p>Estimated Time: 60 minutes</p><h4 class="da-h4">Lab Files</h4><p>None</p><h5 class="da-h5">Exercise 1: Implement an Azure App Service web app</h5><ol class="number"><li><p>Deploy an Azure App Service web app</p></li><li><p>Create an App Service web app deployment slot</p></li></ol><h5 class="da-h5">Exercise 2: Manage App Service web app deployment slots</h5><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Deploy web content to an App Service web app staging slot</p></li><li><p>Swap App Service web app staging slots</p></li><li><p>Configure A/B testing</p></li><li><p>Remove Azure resources deployed in the lab</p></li></ol><h3 class="da-h3" id="1191742">Blob Storage</h3><p>Azure Blob storage is a service that stores unstructured data in the cloud as objects/blobs. Blob storage can store any type of text or binary data, such as a document, media file, or application installer. Blob storage is also referred to as object storage.</p><p>Common uses of Blob storage include:</p><ul class="square"><li class="square"><p>Serving images or documents directly to a browser.</p></li><li class="square"><p>Storing files for distributed access, such as installation.</p></li><li class="square"><p>Streaming video and audio.</p></li><li class="square"><p>Storing data for backup and restore, disaster recovery, and archiving.</p></li><li class="square"><p>Storing data for analysis by an on-premises or Azure-hosted service.</p></li></ul><h4 class="da-h4">Blob service resources</h4><p>Blob storage offers three types of resources:</p><ul class="square"><li class="square"><p>The storage account</p></li><li class="square"><p>Containers in the storage account</p></li><li class="square"><p>Blobs in a container</p></li></ul><p>The following diagram shows the relationship between these resources.</p><p><span><img alt="" src="../Images/1192039-490177.png" width="" height="" /></span></p><p>✔️ Within the storage account, you can group as many blobs as needed in a container.</p><p>For more information, <a href="https://azure.microsoft.com/en-us/services/storage/blobs/" title="" target="_blank">Azure Blob Storage</a>.</p><h3 class="da-h3" id="1191753">URI and SAS Parameters</h3><p>As you create your SAS a URI is created using parameters and tokens. The URI consists of your Storage Resource URI and the SAS token.</p><p><span><img alt="" src="../Images/1192245-490383.png" width="" height="" /></span></p><p>Here is an example URI. Each part is described in the table below.</p><div class="code"><p class="da-divtext">https://myaccount.blob.core.windows.net/?restype=service&amp;comp=properties&amp;sv=2015-04-05&amp;ss=bf&amp;srt=s&amp;st=2015-04-29T22%3A18%3A26Z&amp;se=2015-04-30T02%3A23%3A26Z&amp;sr=b&amp;sp=rw&amp;sip=168.1.5.60-168.1.5.70&amp;spr=https &amp;sig=F%6GRVAZ5Cdj2Pw4txxxxx
</p></div><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p>Name</p></td><td><p>SAS portion</p></td><td><p>Description</p></td></tr></thead><tbody><tr><td><p>Resource URI</p></td><td><p>https://myaccount.blob.core.windows.net/?restype=service&amp;comp=properties</p></td><td><p>The Blob service endpoint, with parameters for getting service properties (when called with GET) or setting service properties (when called with SET).</p></td></tr><tr><td><p>Storage services version</p></td><td><p>sv=2015-04-05</p></td><td><p>For storage services version 2012-02-12 and later, this parameter indicates the version to use.</p></td></tr><tr><td><p>Services</p></td><td><p>ss=bf</p></td><td><p>The SAS applies to the Blob and File services</p></td></tr><tr><td><p>Resource types</p></td><td><p>srt=s</p></td><td><p>The SAS applies to service-level operations.</p></td></tr><tr><td><p>Start time</p></td><td><p>st=2015-04-29T22%3A18%3A26Z</p></td><td><p>Specified in UTC time. If you want the SAS to be valid immediately, omit the start time.</p></td></tr><tr><td><p>Expiry time</p></td><td><p>se=2015-04-30T02%3A23%3A26Z</p></td><td><p>Specified in UTC time.</p></td></tr><tr><td><p>Resource</p></td><td><p>sr=b</p></td><td><p>The resource is a blob.</p></td></tr><tr><td><p>Permissions</p></td><td><p>sp=rw</p></td><td><p>The permissions grant access to read and write operations.</p></td></tr><tr><td><p>IP Range</p></td><td><p>sip=168.1.5.60-168.1.5.70</p></td><td><p>The range of IP addresses from which a request will be accepted.</p></td></tr><tr><td><p>Protocol</p></td><td><p>spr=https</p></td><td><p>Only requests using HTTPS are permitted.</p></td></tr><tr><td><p>Signature</p></td><td><p>sig=F%6GRVAZ5Cdj2Pw4tgU7IlSTkWgn7bUkkAg8P6HESXwmf%4B</p></td><td><p>Used to authenticate access to the blob. The signature is an HMAC computed over a string-to-sign and key using the SHA256 algorithm, and then encoded using Base64 encoding.</p></td></tr></tbody></table><p>For more information, <a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-dotnet-shared-access-signature-part-1?toc=%2fazure%2fstorage%2fblobs%2ftoc.json" title="" target="_blank">Shared access signature parameters</a>.</p><h3 class="da-h3" id="1191706">Application Gateway</h3><p>Application Gateway manages the requests that client applications can send to a web app. Application Gateway routes traffic to a pool of web servers based on the URL of a request. This is known as application layer routing. The pool of web servers can be Azure virtual machines, Azure virtual machine scale sets, Azure App Service, and even on-premises servers.</p><p><span><img alt="" src="../Images/1192037-490175.png" width="" height="" /></span></p><h4 class="da-h4">How an application gateway accepts a request</h4><ol class="number"><li><p>Before a client sends a request to an application gateway, it resolves the domain name of the application gateway by using a Domain Name System (DNS) server. Azure controls the DNS entry because all application gateways are in the azure.com domain.</p></li><li><p>The Azure DNS returns the IP address to the client, which is the frontend IP address of the application gateway.</p></li><li><p>The application gateway accepts incoming traffic on one or more listeners. A listener is a logical entity that checks for connection requests. It's configured with a frontend IP address, protocol, and port number for connections from clients to the application gateway.</p></li><li><p>If a web application firewall (WAF) is in use, the application gateway checks the request headers and the body, if present, against WAF rules. This action determines if the request is valid request or a security threat. If the request is valid, it's routed to the backend. If the request isn't valid and WAF is in Prevention mode, it's blocked as a security threat. If it's in Detection mode, the request is evaluated and logged, but still forwarded to the backend server.</p></li></ol><p>Azure Application Gateway can be used as an internal application load balancer or as an internet-facing application load balancer. An internet-facing application gateway uses public IP addresses. The DNS name of an internet-facing application gateway is publicly resolvable to its public IP address. As a result, internet-facing application gateways can route client requests to the internet.</p><h4 class="da-h4">Application Gateway components</h4><p>Application Gateway has several components. The main parts for encryption are the frontend port, the listener, and the backend pool.</p><p>The following image shows how incoming traffic from a client to Application Gateway over SSL is decrypted and then re-encrypted when it's sent to a server in the backend pool.</p><p><span><img alt="" src="../Images/1192038-490176.png" width="" height="" /></span></p><h4 class="da-h4">Frontend port and listener</h4><p>Traffic enters the gateway through a frontend port. You can open many ports, and Application Gateway can receive messages on any of these ports. A listener is the first thing that your traffic meets when entering the gateway through a port. It's set up to listen for a specific host name, and a specific port on a specific IP address. The listener can use an SSL certificate to decrypt the traffic that enters the gateway. The listener then uses a rule that you define to direct the incoming requests to a backend pool.</p><h4 class="da-h4">Backend pool</h4><p>The backend pool contains your application servers. These servers might be virtual machines, a virtual machine scale set, or applications running on Azure App Service. Incoming requests can be load balanced across the servers in this pool. The backend pool has an HTTP setting that references a certificate used to authenticate the backend servers. The gateway re-encrypts the traffic by using this certificate before sending it to one of your servers in the backend pool.</p><p>If you're using Azure App Service to host the backend application, you don't need to install any certificates in Application Gateway to connect to the backend pool. All communications are automatically encrypted. Application Gateway trusts the servers because Azure manages them.</p><h3 class="da-h3" id="1191766">Change the Default Network Access Rule</h3><p>By default, storage accounts accept connections from clients on any network. To limit access to selected networks, you must first change the default action.</p><p><b>Warning:</b> Making changes to network rules can impact your applications' ability to connect to Azure Storage. Setting the default network rule to deny blocks all access to the data unless specific network rules that grant access are also applied. Be sure to grant access to any allowed networks using network rules before you change the default rule to deny access.</p><p><b>Managing default network access rules</b></p><p>As seen below, you can manage default network access rules for storage accounts through the Azure portal or CLIv2.</p><p><b>Using the Azure portal</b></p><ol class="number"><li><p>Go to the storage account you want to secure.</p></li><li><p>Click on the settings menu called <b>Firewalls and virtual networks</b>.</p></li><li><p>To deny access by default, choose to allow access from Selected networks. To allow traffic from all networks, choose to allow access from All networks.</p></li><li><p>Click Save to apply your changes.</p></li></ol><p><b>Using CLIv2</b></p><ol class="number"><li><p>Install the <a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli" title="" target="_blank">Azure CLI</a> and <a href="https://docs.microsoft.com/en-us/cli/azure/authenticate-azure-cli" title="" target="_blank">sign in</a>.</p></li><li><p>Display the status of the default rule for the storage account.</p></li></ol><div class="code language-Azure"><p class="da-divtext">az storage account show --resource-group "myresourcegroup" --name "mystorageaccount" --query networkRuleSet.defaultAction
</p></div><ol class="number"><li value="3"><p>Set the default rule to deny network access by default.</p></li></ol><div class="code language-Azure"><p class="da-divtext">az storage account update --resource-group "myresourcegroup" --name "mystorageaccount" --default-action Deny
</p></div><ol class="number"><li value="4"><p>Set the default rule to allow network access by default.</p></li></ol><div class="code language-Azure"><p class="da-divtext">az storage account update --resource-group "myresourcegroup" --name "mystorageaccount" --default-action Allow
Grant access from a virtual network
</p></div><h3 class="da-h3" id="1191739">Azure Sorage Account Replication Features</h3><p>Below is a walk-through of how an Azure storage account is configured to allow for replication and high availability of data.</p><p><b>Azure storage accounts</b></p><p>As previously mentioned, Azure storage accounts are used to house data objects, such as files, blobs, tables, and disks for virtual machines. The data that you store in a storage account can be accessed from any location globally via HTTP or HTTPS and is highly available and secure.</p><p><span><img alt="" src="../Images/1192016-490154.png" width="" height="" /></span></p><p><b>Data redundancy</b></p><p>Data in Azure is replicated to ensure that it's always available, even if a datacenter or region becomes inaccessible or a specific piece of hardware fails. You have four replication options:</p><ul class="square"><li class="square"><p>Locally redundant storage (LRS)</p></li><li class="square"><p>Zone-redundant storage (ZRS)</p></li><li class="square"><p>Geographically redundant storage (GRS)</p></li><li class="square"><p>Read-access geo-redundant storage (RA-GRS)</p></li><li class="square"><p>Geo-zone-redundant storage (GZRS)</p></li><li class="square"><p>Read-access geo-zone-redundant storage (RA-GZRS)</p></li></ul><p>Each replication option provides a different level of redundancy and durability. The following sections describe these options in more detail.</p><p><b>What is locally redundant storage (LRS)?</b></p><p><span><img alt="" src="../Images/1192017-490155.png" width="" height="" /></span></p><p>Locally redundant storage replicates data and stores three copies across fault domains, or racks of hardware, within a single datacenter facility in one region. Data is replicated so that if there's a hardware fault or maintenance work, your data is still available and accessible.</p><p>LRS protects your data from hardware failures, but you aren't protected if there's a datacenter outage. For example, if Array 1 in UK South suffers a hardware failure, your data is still available on Array 2. If the entire datacenter suffers a failure, you would most likely lose your data.</p><p>LRS offers 99.999999999999 percent durability of data.</p><p>LRS is the least expensive replication option available. It also offers the least durability, because you can potentially lose all your data during a datacenter outage, depending on the severity of the outage.</p><p><b>What is zone-redundant storage (ZRS)?</b></p><p><span><img alt="" src="../Images/1192018-490156.png" width="" height="" /></span></p><p>Zone-redundant storage replicates your data across three storage clusters in a region. Each cluster is physically separated from the other two, which means that each cluster is supplied by separate utilities, such as power or networking.</p><p>If there's an outage in a datacenter, you can still access your data from another availability zone in that region. Data is normally replicated to two or three availability zones, depending on the region.</p><p>An availability zone (AZ) is a physical location that's made up of one or more datacenters in a region. There are typically two or three AZs per region, where each AZ is independent of the other AZs in the region.</p><p>ZRS offers 99.9999999999 percent durability of data. However, ZRS might not protect you from a regional outage, because all AZs reside in the same region. To migrate data to ZRS from either LRS or GRS requires some planning and manual migration. And it requires a tool such as AZCopy.</p><p><b>What is geographically redundant storage (GRS)?</b></p><p><span><img alt="" src="../Images/1192019-490157.png" width="" height="" /></span></p><p>Geographically redundant, or geo-redundant, storage provides multiple levels of replication. Your data is replicated three times within the primary region, and then this set is replicated to a secondary region.</p><p>GRS provides the highest level of durability, because you finish with six copies of your data. Such durability means that even if there's a datacenter failure or regional issues in the primary region, your data is always available. If the primary region fails, Azure storage is still available in the secondary region. The secondary region is automatically paired to the primary region based on the primary region you selected. This pairing configuration can't be changed.</p><p>Keep in mind that your data in the secondary region is inaccessible until the primary region has failed across to the secondary region. At this point, the secondary region becomes the active region (primary), and your data becomes accessible.</p><p><b>What is read-access geo-redundant storage (RA-GRS)?</b></p><p><span><img alt="" src="../Images/1192020-490158.png" width="" height="" /></span></p><p>Geo-redundant storage provides 99.99999999999999 percent durability, because it replicates data and objects to a secondary region. When failover starts, DNS entries that point to the primary region are updated to point to the secondary region. Microsoft currently controls the DNS failover process.</p><p>When you use RA-GRS, you need to ensure that your application knows which endpoint it's interacting with. The secondary region has “-secondary” appended to the name of the endpoint.</p><p>RA-GRS is ideal for applications, which require high availability.</p><p>A new feature allows you to start a failover between primary and secondary regions from the Azure portal, PowerShell, or the Azure CLI. When the primary endpoint becomes unavailable, you can fail over to the secondary endpoint. Account failover is supported for all public regions but is not available in sovereign or national clouds at this time.</p><p>After the failover and DNS endpoint updates are complete, the storage account is set back to LRS. You're responsible for reverting the replication settings from LRS to RA-GRS or GRS after the primary region becomes available again.</p><p><b>When to use each type of redundant storage</b></p><p>The most appropriate use of each type of redundant storage is summarized in the following table:</p><table style="width:100%" class=""><col width="20%" /><col width="20%" /><col width="20%" /><col width="20%" /><col width="20%" /><thead><tr><td><p /></td><td><p>LRS</p></td><td><p>ZRS</p></td><td><p>GRS</p></td><td><p>RA-GRS</p></td></tr></thead><tbody><tr><td><p>Overview</p></td><td><p>Replicates data in a single datacenter</p></td><td><p>Stores copies of data across multiple datacenters</p></td><td><p>Stores copies in a local datacenter, like LRS, but then stores three more copies in a datacenter in another region</p></td><td><p>Same as GRS, but offers read access in the secondary datacenter in the other region</p></td></tr><tr><td><p>Data copies</p></td><td><p>3</p></td><td><p>3</p></td><td><p>6</p></td><td><p>6</p></td></tr><tr><td><p>Use case</p></td><td><p>Ensures that your data is highly available but, for compliance reasons, must be kept local</p></td><td><p>A higher durability option for block storage, where data can stay in only one region</p></td><td><p>Where you need to ensure that your data and systems are always available despite datacenter or region outages</p></td><td><p>Where your applications (especially those with many read requests) can read data from other regions, but also to ensure that read operations are always available even if the primary region is down</p></td></tr></tbody></table><h3 class="da-h3" id="1191601">Create and Manage Users</h3><p>Every user who needs access to Azure resources needs an Azure user account. A user account contains all the information needed to authenticate the user during the sign-on process. Once authenticated, Azure AD builds an access token to authorize the user and determine what resources they can access and what they can do with those resources.</p><p>You use the <b>Azure Active Directory</b> dashboard in the Azure portal to work with user objects. Keep in mind that you can only work with a single directory at a time - but you can use the <b>Directory + Subscription</b> panel to switch directories. The dashboard also has a button in the toolbar which makes it easy to switch to another available directory.</p><h4 class="da-h4">Adding users</h4><p>You can add users to Azure AD in multiple ways:</p><p><b>Syncing an on-premises Windows Server Active Directory</b></p><p>Azure AD Connect is a separate service that allows you to synchronize a traditional Active Directory with your Azure AD instance. This is how most enterprise customers add users to the directory. The advantage to this approach is users can use single-sign-on (SSO) to access local and cloud-based resources.</p><p>You can manually add new users through the Azure portal. This is the easiest way to add a small set of users. You need to be in the <b>User Administrator</b> role to perform this function.</p><ol class="number"><li><p>To add a new user with the Azure portal, select the the <b>+ New user</b> button in the toolbar.</p></li></ol><p><span><img alt="" src="../Images/1192368-490506.png" width="" height="" /></span></p><ol class="number"><li value="2"><p>In addition to <b>Name</b> and <b>User name</b>, you can add profile information, like <b>Job Title</b> and <b>Department</b>.</p></li></ol><p><span><img alt="" src="../Images/1192369-490507.png" width="" height="" /></span></p><p>The default behavior is to create a new user in the organization. The user will have a username with the default domain name assigned to the directory such as alice@staracoustics.onmicrosoft.com.</p><ol class="number"><li value="3"><p>can also <i>invite</i> a user into the directory. In this case, an email is sent to a known email address and an account is created and associated with that email address if they accept the invitation.</p></li></ol><p><span><img alt="" src="../Images/1192370-490508.png" width="" height="" /></span></p><p>The invited user will need to create an associated Microsoft account (MSA) if that specific email address isn't associated with one and the account will be added to the Azure AD as a guest user.</p><h3 class="da-h3" id="1191751">Storage Account Keys</h3><p>As mentioned above, Azure Storage accounts can create authorized apps in Active Directory to control access to the data in blobs and queues. This authentication approach is the best solution if the app is using Blob or Queue storage.</p><p>For other storage models, clients can use a different approach: a <i>shared key</i> or shared secret. This authentication option supports blobs, files, queues, and tables. It's one of the more straightforward approaches to use: the client embeds the shared key in the HTTP <span class="code">Authorization</span> header of every request, and the Storage account validates it.</p><p>As an example, an application could issue a <span class="code">GET</span> request against a blob resource:</p><div class="code"><p class="da-divtext">GET http://myaccount.blob.core.windows.net/?restype=service&amp;comp=stats
</p></div><p>The following HTTP headers that control the version of the REST API, the date, and the encoded shared key.</p><div class="code"><p class="da-divtext">x-ms-version: 2018-03-28  
Date: Wed, 23 Oct 2018 21:00:44 GMT  
Authorization: SharedKey myaccount:CY1OP3O3jGFpYFbTCBimLn0Xov0vt0khH/E5Gy0fXvg=
</p></div><h4 class="da-h4">Account Keys</h4><p>Shared keys in Azure Storage accounts are called “Storage Account Access Keys”. Azure creates two of these keys (primary and secondary) for each storage account you create and they give access to <i>everything</i> in the account. You can view the created storage keys in the Azure portal view of the storage account under <b>Settings</b> &gt; <b>Access keys</b> as shown below.</p><p><span><img alt="" src="../Images/1192306-490444.png" width="" height="" /></span></p><h5 class="da-h5">Protecting shared keys</h5><p>Because there are only two keys, and they provide full access to the account, it's recommended to only use these keys with <i>trusted in-house applications</i> that you have complete control over. If the keys are compromised, you can change the key values in the Azure portal. There are several other reasons to regenerate your storage account keys.</p><ul class="square"><li class="square"><p>You might regenerate them on a regular basis for security reasons.</p></li><li class="square"><p>You must regenerate your storage account keys if someone managed to hack into an application and retrieve the key that was hardcoded or saved in a configuration file, giving them full access to your storage account.</p></li><li class="square"><p>Another case for key regeneration is if your team is using a Storage Explorer application that retains the storage account key, and one of the team members leaves. The application would continue to work, giving them access to your storage account after they're gone.</p></li></ul><p>The process to refresh keys is simple:</p><ol class="number"><li><p>Change each trusted app to use the <i>secondary</i> key.</p></li><li><p>Refresh the primary key in the Azure portal. You can consider it the new “secondary” key value.</p></li></ol><p>✔️ <b>IMPORTANT</b>
Any client attempting to use the old key value will be refused. You must make sure to identify all clients using the shared key and update them to keep them operational.</p><h3 class="da-h3" id="1191713">Azure Front Door</h3><p>Azure Front Door is a global, scalable entry-point that uses the Microsoft global edge network to create fast, secure, and widely scalable web applications. With Front Door, you can transform your global consumer and enterprise applications into robust, high-performing personalized modern applications with contents that reach a global audience through Azure.</p><p><span><img alt="" src="../Images/1192111-490249.png" width="" height="" /></span></p><p>Azure Front Door enables you to define, manage, and monitor the global routing for your web traffic by optimizing for best performance and instant global failover for high availability. With Front Door, you can transform your global (multi-region) consumer and enterprise applications into robust, high-performance personalized modern applications, APIs, and content that reaches a global audience with Azure.</p><p>Front Door works at Layer 7 or HTTP/HTTPS layer and uses anycast protocol with split TCP and Microsoft's global network for improving global connectivity. So, per your routing method selection in the configuration, you can ensure that Front Door is routing your client requests to the fastest and most available application backend. An application backend is any Internet-facing service hosted inside or outside of Azure.</p><p>The following features are included with Front Door:</p><h4 class="da-h4">Accelerate application performance</h4><p>Using split TCP-based anycast protocol, Front Door ensures that your end users promptly connect to the nearest Front Door POP (Point of Presence).</p><h4 class="da-h4">Increase application availability with smart health probes</h4><p>Front Door delivers high availability for your critical applications using its smart health probes, monitoring your backends for both latency and availability and providing instant automatic failover when a backend goes down.</p><h4 class="da-h4">URL-based routing</h4><p>URL Path Based Routing allows you to route traffic to backend pools based on URL paths of the request. One of the scenarios is to route requests for different content types to different backend pools.</p><h4 class="da-h4">Multiple-site hosting</h4><p>Multiple-site hosting enables you to configure more than one web site on the same Front Door configuration.</p><h4 class="da-h4">Session affinity</h4><p>The cookie-based session affinity feature is useful when you want to keep a user session on the same application backend. By using Front Door managed cookies, subsequent traffic from a user session gets directed to the same application backend for processing.</p><h4 class="da-h4">TLS termination</h4><p>Front Door supports TLS termination at the edge that is, individual users can set up a TLS connection with Front Door environments instead of establishing it over long haul connections with the application backend.</p><h4 class="da-h4">Custom domains and certificate management</h4><p>When you use Front Door to deliver content, a custom domain is necessary if you would like your own domain name to be visible in your Front Door URL.</p><h4 class="da-h4">URL redirection</h4><p>Web applications are expected to automatically redirect any HTTP traffic to HTTPS. This ensures that all communication between the users and the application occurs over an encrypted path.</p><h4 class="da-h4">URL rewrite</h4><p>Front Door supports <a href="https://docs.microsoft.com/en-us/azure/frontdoor/front-door-url-rewrite" title="" target="_blank">URL rewrite</a> by allowing you to configure an optional Custom Forwarding Path to use when constructing the request to forward to the backend.</p><h4 class="da-h4">Protocol support - IPv6 and HTTP/2 traffic</h4><p>Azure Front Door natively supports end-to-end IPv6 connectivity and also HTTP/2 protocol.</p><h3 class="da-h3" id="1191792">Module 7 Review Questions</h3><p><span><img alt="" src="../Images/1192029-490167.png" width="" height="" /></span></p><h4 class="problem">Review Question 1</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-b617266b-0e20-36a0-b4a7-f4c91741492d"><div class="card quizlib-question"><div class="quizlib-question-title"><p>A company you are advising wants to create the following Azure Cosmos DB databases for their dev team.<br />
OEM_Cosmos_Database_A:<br /></p><ul class="square"><li class="square"><p>1500 RU/sec throughput</p></li><li class="square"><p>Multiple write regions</p></li><li class="square"><p>Uses the Core (SQL) API</p></li></ul><p>
OEM_Cosmos_Database_B:<br /></p><ul class="square"><li class="square"><p>1100 RU/sec throughput</p></li><li class="square"><p>Use the MongoDB API</p></li></ul><p>
OEM_Cosmos_Database_C:<br /></p><ul class="square"><li class="square"><p>1500 RU/sec throughput</p></li><li class="square"><p>Single write region</p></li><li class="square"><p>Uses the Core (SQL) API</p></li></ul><p>
OEM_Cosmos_Database_D:<br /></p><ul class="square"><li class="square"><p>900 RU/sec throughput</p></li><li class="square"><p>Use the MongoDB API</p></li></ul><p>
As a part of the solution, they want to reduce costs.<br />
You advise they create the Azure Cosmos DBs with two of the following recommendations:<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="checkbox" name="qb617266b-0e20-36a0-b4a7-f4c91741492d" value="1" />Create three Azure Cosmos DB accounts, one for DBs that use MongoDB API, one for OEM_Cosmos_Database_A, and one for OEM_Cosmos_Database_C.<br /></label></li><li><label><input type="checkbox" name="qb617266b-0e20-36a0-b4a7-f4c91741492d" value="2" />Create a single Azure Cosmos DB that includes the OEM_Cosmos_Database_A, OEM_Cosmos_Database_B, OEM_Cosmos_Database_C, and OEM_Cosmos_Database_D.<br /></label></li><li><label><input type="checkbox" name="qb617266b-0e20-36a0-b4a7-f4c91741492d" value="3" />Create one Azure Cosmos DB account for each DBs listed above.<br /></label></li><li><label><input type="checkbox" name="qb617266b-0e20-36a0-b4a7-f4c91741492d" value="4" />Create two Azure Cosmos DB accounts, one for those that use the Core (SQL) API and one for those that use MongoDB API.<br /></label></li></ul></div></div><div id="feedback-problem-b617266b-0e20-36a0-b4a7-f4c91741492d" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct Answer: A and C.  Create three Azure Cosmos DB accounts, one for DBs that use MongoDB API, one for OEM_Cosmos_Database_A, and one for OEM_Cosmos_Database_C. And, Create one Azure Cosmos DB account for each of Azure Cosmos DB databases.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 2</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-45f757e8-ddc0-de92-c872-0113b96e3007"><div class="card quizlib-question"><div class="quizlib-question-title"><p>The same company also wants to create an app that uses a separate NoSQL DB that will be used to store transactions and supplier information using JSON files.<br />
You recommend their developers use which of the two Cosmos DB APIs for the app:<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="checkbox" name="q45f757e8-ddc0-de92-c872-0113b96e3007" value="1" />Core (SQL) API<br /></label></li><li><label><input type="checkbox" name="q45f757e8-ddc0-de92-c872-0113b96e3007" value="2" />Azure SQL Database REST API<br /></label></li><li><label><input type="checkbox" name="q45f757e8-ddc0-de92-c872-0113b96e3007" value="3" />MongoDB API<br /></label></li><li><label><input type="checkbox" name="q45f757e8-ddc0-de92-c872-0113b96e3007" value="4" />Cassandra<br /></label></li></ul></div></div><div id="feedback-problem-45f757e8-ddc0-de92-c872-0113b96e3007" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct Answer: A and C. Both Core (SQL) API and MongoDB API can be used for the NoSQL database.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h3 class="da-h3" id="1191718">Distributing Network Traffic</h3><p>This table compares the Azure Load Balancer, Application Gateway, Traffic Manager, and Front Door. These techonologies can be used in isolation or in combination.</p><table style="width:100%" class=""><col width="20%" /><col width="20%" /><col width="20%" /><col width="20%" /><col width="20%" /><thead><tr><td><p><b>Service</b></p></td><td><p><b>Azure Load Balancer</b></p></td><td><p><b>Application Gateway</b></p></td><td><p><b>Traffic Manager</b></p></td><td><p><b>Azure Front Door</b></p></td></tr></thead><tbody><tr><td><p><b>Technology</b></p></td><td><p>Transport Layer (level 4)</p></td><td><p>Transport Layer (level 7)</p></td><td><p>DNS Resolver</p></td><td><p>Layer 7 or HTTP/HTTPS</p></td></tr><tr><td><p><b>Protocols</b></p></td><td><p>Any TCP or UDP Protocol</p></td><td><p>HTTP, HTTPS, HTTP/2,   &amp; WebSockets</p></td><td><p>DNS Resolution</p></td><td><p>Split TCP-based anycast protocol</p></td></tr><tr><td><p><b>Backends and Endpoints</b></p></td><td><p>Azure VMs, and Azure VM Scale   Sets</p></td><td><p>Azure VMs, Azure VM Scale   Sets, Azure App Services, IP Addresses, and Hostnames</p></td><td><p>Azure Cloud Services, Azure App   Services, Azure App Service Slots, and Public IP Addresses</p></td><td><p>Internet-facing services hosted   inside or outside of Azure</p></td></tr><tr><td><p><b>Network connectivity</b></p></td><td><p>External and Internal</p></td><td><p>External and Internal</p></td><td><p>External</p></td><td><p>External and Internal</p></td></tr></tbody></table><h3 class="da-h3" id="1191704">Demonstration - Create a Load Balancer to Load Balance VMs</h3><p>Sign in to the Azure portal at <a href="https://portal.azure.com/" title="" target="_blank">https://portal.azure.com</a>.</p><h4 class="da-h4">Create a Load Balancer</h4><p>In this demonstration, you create a Load Balancer that helps load balance virtual machines. You can create a public Load Balancer or an internal Load Balancer. When you create a public Load Balancer, you must also create a new Public IP address that is configured as the frontend (named as LoadBalancerFrontend by default) for the Load Balancer.</p><ol class="number"><li><p>Select <b>+ Create a resource</b>, type <i>load balancer</i>.</p></li></ol><p><span><img alt="" src="../Images/1192390-490528.png" width="" height="" /></span>.</p><ol class="number"><li value="2"><p>Click <b>Create</b>.</p></li></ol><p><span><img alt="" src="../Images/1192391-490529.png" width="" height="" /></span>.</p><ol class="number"><li value="3"><p>In the <b>Basics</b> tab of the <b>Create load balancer</b> page, enter or select the following information, accept the defaults for the remaining settings, and then select <b>Review +</b> create:</p></li></ol><p><span><img alt="" src="../Images/1192392-490530.png" width="" height="" /></span>.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Setting</p></td><td><p>Value</p></td></tr></thead><tbody><tr><td><p>Subscription</p></td><td><p>Select your subscription.</p></td></tr><tr><td><p>Resource group</p></td><td><p>Select <b>Create new</b> and type <i>myResourceGroupSLB</i> in the text box.</p></td></tr><tr><td><p>Name</p></td><td><p><i>myLoadBalancer</i></p></td></tr><tr><td><p>Region</p></td><td><p>Select <b>West Europe</b>.</p></td></tr><tr><td><p>Type</p></td><td><p>Select <b>Public</b>.</p></td></tr><tr><td><p>SKU</p></td><td><p>Select <b>Standard</b> or <b>Basic</b>. Microsoft recommends Standard for production workloads.</p></td></tr><tr><td><p>Public IP address</p></td><td><p>Select <b>Create new</b>. If you have an existing Public IP you would like to use, select <b>Use existing</b></p></td></tr><tr><td><p>Public IP address name</p></td><td><p>Type <i>myPublicIP</i> in the text box.   Use <span class="code">-SKU Basic</span> to create a Basic Public IP. Basic Public IPs are not compatible with <b>Standard</b> load balancer. Microsoft recommends using <b>Standard</b> for production workloads.</p></td></tr><tr><td><p>Availability zone</p></td><td><p>Type <i>Zone-redundant</i> to create a resilient Load Balancer. To create a zonal Load Balancer, select a specific zone from 1, 2, or 3</p></td></tr></tbody></table><p>✔️ <b>Important</b>
This demonstration assumes that Standard SKU is chosen during the SKU selection process above.</p><h4 class="da-h4">Create Load Balancer resources</h4><p>In this section, you configure Load Balancer settings for a backend address pool, a health probe, and specify a balancer rule.</p><h4 class="da-h4">Create a Backend pool</h4><p>To distribute traffic to the VMs, a backend address pool contains the IP addresses of the virtual (NICs) connected to the Load Balancer. Create the backend address pool myBackendPool to include virtual machines for load-balancing internet traffic.</p><ol class="number"><li><p>Select <b>All services</b> in the left-hand menu, select <b>All resources</b>, and then select <b>myLoadBalancer</b> from the resources list.</p></li><li><p>Under <b>Settings</b>, select <b>Backend pools</b>, then select <b>Add</b>.</p></li><li><p>On the <b>Add a backend pool</b> page, for name, type <i>myBackendPool</i>, as the name for your backend pool, and then select <b>Add</b>.</p></li></ol><h4 class="da-h4">Create a health probe</h4><p>To allow the Load Balancer to monitor the status of your app, you use a health probe. The health probe dynamically adds or removes VMs from the Load Balancer rotation based on their response to health checks. Create a health probe myHealthProbe to monitor the health of the VMs.</p><ol class="number"><li><p>Select <b>All services</b> in the left-hand menu, select <b>All resources</b>, and then select <b>myLoadBalancer</b> from the resources list.</p></li><li><p>Under <b>Settings</b>, select <b>Health probes</b>, then select <b>Add</b>.</p></li></ol><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Setting</p></td><td><p>Value</p></td></tr></thead><tbody><tr><td><p>Name</p></td><td><p>Enter <i>myHealthProbe</i>.</p></td></tr><tr><td><p>Protocol</p></td><td><p>Select <b>HTTP</b>.</p></td></tr><tr><td><p>Port</p></td><td><p>Enter <i>80</i>.</p></td></tr><tr><td><p>Interval</p></td><td><p>Enter <i>15</i> for number of <b>Interval</b> in seconds between probe attempts.</p></td></tr><tr><td><p>Unhealthy threshold</p></td><td><p>Select <b>2</b> for number of <b>Unhealthy threshold</b> or consecutive probe failures that must occur before a VM is considered unhealthy.</p></td></tr></tbody></table><ol class="number"><li value="3"><p>Select <b>OK</b>.</p></li></ol><h4 class="da-h4">Create a Load Balancer rule</h4><p>A Load Balancer rule is used to define how traffic is distributed to the VMs. You define the frontend IP configuration for the incoming traffic and the backend IP pool to receive the traffic, along with the required source and destination port. Create a Load Balancer rule myLoadBalancerRuleWeb for listening to port 80 in the frontend FrontendLoadBalancer and sending load-balanced network traffic to the backend address pool myBackEndPool also using port 80.</p><ol class="number"><li><p>Select <b>All services</b> in the left-hand menu, select <b>All resources</b>, and then select <b>myLoadBalancer</b> from the resources list.</p></li><li><p>Under <b>Settings</b>, select <b>Load balancing rules</b>, then select <b>Add</b>.</p></li><li><p>Use these values to configure the load balancing rule:</p></li></ol><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Setting</p></td><td><p>Value</p></td></tr></thead><tbody><tr><td><p>Name</p></td><td><p>Enter <i>myHTTPRule</i>.</p></td></tr><tr><td><p>Protocol</p></td><td><p>Select <b>TCP</b>.</p></td></tr><tr><td><p>Port</p></td><td><p>Enter <i>80</i>.</p></td></tr><tr><td><p>Backend port</p></td><td><p>Enter <i>80</i>.</p></td></tr><tr><td><p>Backend pool</p></td><td><p>Select <b>myBackendPool</b>.</p></td></tr><tr><td><p>Health probe</p></td><td><p>Select <b>myHealthProbe</b>.</p></td></tr></tbody></table><ol class="number"><li value="4"><p>Leave the rest of the defaults and then select <b>OK</b>.</p></li></ol><h4 class="da-h4">Create backend servers</h4><p>In this section, you create a virtual network, create three virtual machines for the backend pool of the Load Balancer, and then install IIS on the virtual machines to help test the Load Balancer.</p><h4 class="da-h4">Virtual network and parameters</h4><p>In this section you'll need to replace the following parameters in the steps with the information below:</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Parameter</p></td><td><p>Value</p></td></tr></thead><tbody><tr><td><p><b>resource-group-name</b></p></td><td><p>myResourceGroupSLB</p></td></tr><tr><td><p><b>virtual-network-name</b></p></td><td><p>myVNet</p></td></tr><tr><td><p><b>region-name</b></p></td><td><p>West Europe</p></td></tr><tr><td><p><b>IPv4-address-space</b></p></td><td><p>10.1.0.0\16</p></td></tr><tr><td><p><b>subnet-name</b></p></td><td><p>myBackendSubnet</p></td></tr><tr><td><p><b>subnet-address-range</b></p></td><td><p>10.1.0.0\24</p></td></tr></tbody></table><h4 class="da-h4">Create the virtual network</h4><p>In this section, you'll create a virtual network and subnet.</p><ol class="number"><li><p>On the upper-left side of the screen, select <b>Create a resource &gt; Networking &gt; Virtual network</b> or search for <i>Virtual network</i> in the search box.</p></li><li><p>In <b>Create virtual network</b>, enter or select this information in the <b>Basics</b> tab:</p></li></ol><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Setting</p></td><td><p>Value</p></td></tr></thead><tbody><tr><td><p><b>Project Details</b></p></td><td><p /></td></tr><tr><td><p>Subscription</p></td><td><p>Select your Azure subscription</p></td></tr><tr><td><p>Resource Group</p></td><td><p>Select <b>Create new</b>, enter <b>resource-group-name</b>, then select <b>OK</b>, or select an existing <b>resource-group-name</b> based on parameters.</p></td></tr><tr><td><p><b>Instance details</b></p></td><td><p /></td></tr><tr><td><p>Name</p></td><td><p>Enter <b>virtual-network-name</b></p></td></tr><tr><td><p>Region</p></td><td><p>Select <b>region-name</b></p></td></tr></tbody></table><ol class="number"><li value="3"><p>Select the <b>IP Addresses</b> tab or select the <b>Next: IP Addresses</b> button at the bottom of the page.</p></li><li><p>In the <b>IP Addresses</b> tab, enter this information:</p></li></ol><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Setting</p></td><td><p>Value</p></td></tr></thead><tbody><tr><td><p>IPv4 address space</p></td><td><p>Enter <b>IPv4-address-space</b></p></td></tr></tbody></table><ol class="number"><li value="5"><p>Under <b>Subnet name</b>, select the word <b>default</b>.</p></li><li><p>In <b>Edit subnet</b>, enter this information:</p></li></ol><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Setting</p></td><td><p>Value</p></td></tr></thead><tbody><tr><td><p>Subnet name</p></td><td><p>Enter <b>subnet-name</b></p></td></tr><tr><td><p>Subnet address range</p></td><td><p>Enter <b>subnet-address-range</b></p></td></tr></tbody></table><ol class="number"><li value="7"><p>Select <b>Save</b>.</p></li><li><p>Select the <b>Review + create</b> tab or select the <b>Review + create</b> button.</p></li><li><p>Select <b>Create</b>.</p></li></ol><h4 class="da-h4">Create virtual machines</h4><p>Public IP SKUs and Load Balancer SKUs must match. For Standard Load Balancer , use VMs with Standard IP addresses in the backend pool. In this section, you will create three VMs (<i>myVM1, myVM2</i> and <i>myVM3</i>) with a Standard public IP address in three different zones (<i>Zone 1, Zone 2,</i> and <i>Zone 3</i>) that are later added to the backend pool of the Load Balancer that was created earlier. If you selected Basic, use VMs with Basic IP addresses.</p><ol class="number"><li><p>On the upper-left side of the portal, select <b>Create a resource &gt; Compute &gt; Windows Server 2019 Datacenter</b>.</p></li><li><p>In <b>Create a virtual machine</b>, type or select the following values in the <b>Basics</b> tab:</p></li></ol><ul class="square"><li class="square"><p><b>Subscription &gt; Resource Group</b>: Select <b>myResourceGroupSLB</b>.</p></li><li class="square"><p><b>Instance Details &gt; Virtual machine</b> name: Type <i>myVM1</i>.</p></li><li class="square"><p><b>Instance Details &gt; Region</b> &gt; select <b>West Europe</b>.</p></li><li class="square"><p><b>Instance Details &gt; Availability Options</b> &gt; Select <b>Availability zones</b>.</p></li><li class="square"><p><b>Instance Details &gt; Availability zone</b> &gt; Select <b>1</b>.</p></li><li class="square"><p><b>Administrator account</b>&gt; Enter the <b>Username, Password</b> and <b>Confirm password</b> information.</p></li><li class="square"><p>Select the <b>Networking</b> tab, or select <b>Next: Disks</b>, then N<b>ext: Networking</b>.</p></li></ul><ol class="number"><li value="3"><p>In the <b>Networking</b> tab make sure the following are selected:</p></li></ol><ul class="square"><li class="square"><p><b>Virtual network</b>: <i>myVnet</i></p></li><li class="square"><p><b>Subnet</b>: <i>myBackendSubnet</i></p></li><li class="square"><p><b>Public IP</b> &gt; select <b>Create new</b>, and in the <b>Create public IP address</b> window, for <b>SKU</b>, select <b>Standard</b>, and for <b>Availability zone</b>, select <b>Zone-redundant</b>, and then select <b>OK</b>. If you created a Basic Load Balancer, select Basic. Microsoft recommends using Standard SKU for production workloads.</p></li><li class="square"><p>To create a new network security group (NSG), a type of firewall, under <b>Network Security Group</b>, select <b>Advanced</b>.</p></li></ul><ol class="number"><li><p>In the <b>Configure network security group</b> field, select <b>Create new</b>.</p></li><li><p>Type <i>myNetworkSecurityGroup</i>, and select <b>OK</b>.</p><ul class="square"><li class="square"><p>To make the VM a part of the Load Balancer's backend pool, complete the following steps:</p></li><li class="square"><p>In <b>Load Balancing</b>, for <b>Place this virtual machine behind an existing load balancing solution?</b>, select <b>Yes</b>.</p></li><li class="square"><p>In <b>Load balancing settings</b>, for <b>Load balancing options</b>, select <b>Azure load balancer</b>.</p></li><li class="square"><p>For <b>Select a load balancer</b>, <i>myLoadBalancer</i>.</p></li><li class="square"><p>Select the <b>Management</b> tab, or select <b>Next &gt; Management</b>.</p></li></ul></li><li><p>In the <b>Management</b> tab, under <b>Monitoring</b>, set <b>Boot diagnostics</b> to <b>Off</b>.</p></li><li><p>Select <b>Review + create</b>.</p></li><li><p>Review the settings, and then select <b>Create</b>.</p></li><li><p>Follow the steps 2 to 6 to create two additional VMs with the following values and all the other settings the same as <i>myVM1</i>:</p></li></ol><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p>Setting</p></td><td><p>VM 2</p></td><td><p>VM 3</p></td></tr></thead><tbody><tr><td><p>Name</p></td><td><p><i>myVM2</i></p></td><td><p><i>myVM3</i></p></td></tr><tr><td><p>Availability zone</p></td><td><p>2</p></td><td><p>3</p></td></tr><tr><td><p>Public IP</p></td><td><p><b>Standard</b> SKU</p></td><td><p><b>Standard</b> SKU</p></td></tr><tr><td><p>Public IP - Availability zone</p></td><td><p><b>Zone redundant</b></p></td><td><p><b>Zone redundant</b></p></td></tr><tr><td><p>Network security group</p></td><td><p>Select the existing <i>myNetworkSecurity Group</i></p></td><td><p>Select the existing <i>myNetworkSecurity Group</i></p></td></tr><tr><td><p /></td><td><p /></td><td><p /></td></tr></tbody></table><h4 class="da-h4">Create NSG rule</h4><p>In this section, you create a network security group rule to allow inbound connections using HTTP.</p><ol class="number"><li><p>Select <b>All services</b> in the left-hand menu, select <b>All resources</b>, and then from the resources list select <b>myNetworkSecurityGroup</b> that is located in the <b>myResourceGroupSLB</b> resource group.</p></li><li><p>Under <b>Settings</b>, select <b>Inbound security rules</b>, and then select <b>Add</b>.</p></li><li><p>Enter these values for the inbound security rule named <b>myHTTPRule</b> to allow for an inbound HTTP connections using port <b>80</b>:</p></li></ol><ul class="square"><li class="square"><p><b>Source</b>: <i>Service Tag</i></p></li><li class="square"><p><b>Source service tag</b>: <i>Internet</i></p></li><li class="square"><p><b>Destination port ranges</b>: <i>80</i></p></li><li class="square"><p><b>Protocol</b>: <i>TCP</i></p></li><li class="square"><p><b>Action</b>: <i>Allow</i></p></li><li class="square"><p><b>Priority</b>: <i>100</i></p></li><li class="square"><p><b>Name</b>: <i>myHTTPRule</i></p></li><li class="square"><p><b>Description</b>: <i>Allow HTTP</i></p></li></ul><ol class="number"><li value="4"><p>Select <b>Add</b>.</p></li><li><p>Repeat the steps for the inbound RDP rule, if needed, with the following differing values:</p></li></ol><ul class="square"><li class="square"><p><b>Destination port ranges</b>: <i>Type 3389</i>.</p></li><li class="square"><p><b>Priority</b>: Type <i>200</i>.</p></li><li class="square"><p><b>Name</b>: Type <i>MyRDPRule</i>.</p></li><li class="square"><p><b>Description</b>: Type <i>Allow RDP</i>.</p></li></ul><h4 class="da-h4">Install IIS</h4><ol class="number"><li><p>Select <b>All services</b> in the left-hand menu, select <b>All resources</b>, and then from the resources list, select <b>myVM1</b> that is located in the <i>myResourceGroupSLB</i> resource group.</p></li><li><p>On the <b>Overview</b> page, select <b>Connect</b> to RDP into the VM.</p></li><li><p>Log into the VM with the credentials that you provided during the creation of this VM. This launches a remote desktop session with virtual machine <i>- myVM1</i>.</p></li><li><p>On the server desktop, navigate to<b>Windows Administrative Tools&gt;Windows PowerShell</b>.</p></li><li><p>In the PowerShell Window, run the following commands to install the IIS server, remove the default iisstart.htm file, and then add a new iisstart.htm file that displays the name of the VM:</p></li></ol><div class="code language-PowerShell"><p class="da-divtext"><code><span class="token comment"># install IIS server role</span>
 Install<span class="token operator">-</span>WindowsFeature <span class="token operator">-</span>name Web<span class="token operator">-</span>Server <span class="token operator">-</span>IncludeManagementTools

 <span class="token comment"># remove default htm file</span>
  <span class="token function">remove-item</span>  C:\inetpub\wwwroot\iisstart<span class="token punctuation">.</span>htm

 <span class="token comment"># Add a new htm file that displays server name</span>
  <span class="token function">Add-Content</span> <span class="token operator">-</span>Path <span class="token string">"C:\inetpub\wwwroot\iisstart.htm"</span> <span class="token operator">-</span>Value $<span class="token punctuation">(</span><span class="token string">"Hello World from "</span> <span class="token operator">+</span> <span class="token variable">$env</span>:computername<span class="token punctuation">)</span></code></p></div><ol class="number"><li value="6"><p>Close the RDP session with <i>myVM1</i>.</p></li><li><p>Repeat steps 1 to 6 to install IIS and the updated iisstart.htm file on <i>myVM2</i> and <i>myVM3</i>.</p></li></ol><h4 class="da-h4">Test the Load Balancer</h4><ol class="number"><li><p>Find the public IP address for the Load Balancer on the <b>Overview</b> screen. Select <b>All services</b> in the left-hand menu, select <b>All resources</b>, and then select <b>myPublicIP</b>.</p></li><li><p>Copy the public IP address, and then paste it into the address bar of your browser. The default page of IIS Web server is displayed on the browser.</p></li></ol><p><span><img alt="" src="../Images/1192393-490531.png" width="" height="" /></span></p><p>To see the Load Balancer distribute traffic across all three VMs, you can customize the default page of each VM's IIS Web server and then force-refresh your web browser from the client machine.</p><h3 class="da-h3" id="1191721">Implementing Azure Firewall</h3><p>Let's consider a simple example where we want to use Azure Firewall to route protect our workload server by controlling the network traffic.</p><p><span><img alt="" src="../Images/1192032-490170.png" width="" height="" /></span></p><ol class="number"><li><p><b>Create the network infrastructure</b>. In this case, we have one virtual network with three subnets.</p></li><li><p><b>Deploy the firewall</b>. The firewall is associated with the virtual network. In this case, it is in a separate subnet with a public and private IP address. The private IP address will be used in a new routing table.</p></li><li><p><b>Create a default route</b>. Create a routing table to direct network workload traffic to the firewall. The route will be associated with the workload subnet. All traffic from that subnet will be routed to the firewall's private IP address.</p></li><li><p><b>Configure an application rule</b>.</p></li></ol><p>In production deployments, a <a href="https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/hybrid-networking/hub-spoke" title="" target="_blank">Hub and Spoke model</a> is recommended, where the firewall is in its own VNET, and workload servers are in peered VNETs in the same region with one or more subnets.</p><h3 class="da-h3" id="1191756">Customer Managed keys</h3><p>If you prefer, you can use the Azure Key Vault to manage your encryption keys. With the Key Vault you can create your own encryption keys and store them in a key vault, or you can use Azure Key Vault's APIs to generate encryption keys.</p><p>Using custom keys give you more flexibility and control when creating, disabling, auditing, rotating, and defining access controls.</p><p><span><img alt="" src="../Images/1192371-490509.png" width="" height="" /></span></p><p>✔️ To use customer-managed keys with SSE, you can either create a new key vault and key or you can use an existing key vault and key. The storage account and the key vault must be in the same region, but they can be in different subscriptions.</p><h3 class="da-h3" id="1191748">Demonstration - Blob Storage</h3><p>In this demonstration, you will explore blob storage.</p><p><b>Note</b>: This demonstration requires a storage account.</p><p><b>Create a container</b></p><ol class="number"><li><p>Navigate to a storage account in the Azure portal.</p></li><li><p>In the left menu for the storage account, scroll to the <b>Blob service</b> section, then select <b>Blobs</b>.</p></li><li><p>Select the <b>+ Container</b> button.</p></li><li><p>Type a <b>Name</b> for your new container. The container name must be lowercase, must start with a letter or number, and can include only letters, numbers, and the dash (-) character.</p></li><li><p>Set the level of public access to the container. The default level is Private (no anonymous access).</p></li><li><p>Select <b>OK</b> to create the container.</p></li></ol><p><b>Upload a block blob</b></p><ol class="number"><li><p>In the Azure portal, navigate to the container you created in the previous section.</p></li><li><p>Select the container to show a list of blobs it contains. Since this container is new, it won't yet contain any blobs.</p></li><li><p>Select the <b>Upload</b> button to upload a blob to the container.</p></li><li><p>Expand the <b>Advanced</b> section.</p></li><li><p>Notice the <b>Authentication type</b>, <b>Blob type</b>, <b>Block size</b>, and the ability to <b>Upload to a folder</b>.</p></li><li><p>Notice the default <b>Authentication type</b> type is SAS.</p></li><li><p>Browse your local file system to find a file to upload as a block blob, and select <b>Upload</b>.</p></li><li><p>Upload as many blobs as you like in this way. You'll observe that the new blobs are now listed within the container.</p></li></ol><p><b>Download a block blob</b></p><p>You can download a block blob to display in the browser or save to your local file system.</p><ol class="number"><li><p>Navigate to the list of blobs that you uploaded in the previous section.</p></li><li><p>Right-click the blob you want to download, and select <b>Download</b>.</p></li></ol><h3 class="da-h3" id="1191690">Azure Dedicated Hosts</h3><p>Azure Dedicated Host is a service that provides physical servers - able to host one or more virtual machines - dedicated to one Azure subscription. Dedicated hosts are the same physical servers used in our data centers, provided as a resource. You can provision dedicated hosts within a region, availability zone, and fault domain. Then, you can place VMs directly into your provisioned hosts, in whatever configuration best meets your needs.</p><p>✔️<b>Note:</b> Virtual machine scale sets are not currently supported on dedicated hosts.</p><p><b>Benefits</b></p><p>Reserving the entire host provides the following benefits:</p><ul class="square"><li class="square"><p><b>Hardware isolation at the physical server level.</b> No other VMs will be placed on your hosts. Dedicated hosts are deployed in the same data centers and share the same network and underlying storage infrastructure as other, non-isolated hosts.</p></li><li class="square"><p><b>Control over maintenance events initiated by the Azure platform.</b> While the majority of maintenance events have little to no impact on your virtual machines, there are some sensitive workloads where each second of pause can have an impact. With dedicated hosts, you can opt-in to a maintenance window to reduce the impact to your service.</p></li></ul><p><b>Groups, hosts, and VMs</b></p><p><span><img alt="" src="../Images/1192261-490399.png" width="" height="" /></span></p><p>A host group is a resource that represents a collection of dedicated hosts. You create a host group in a region and an availability zone, and add hosts to it.</p><p>A host is a resource, mapped to a physical server in an Azure data center. The physical server is allocated when the host is created. A host is created within a host group. A host has a SKU describing which VM sizes can be created. Each host can host multiple VMs, of different sizes, as long as they are from the same size series.</p><h3 class="da-h3" id="1191750">Storage Security</h3><p>Azure Storage provides a comprehensive set of security capabilities that together enable developers to build secure applications. In this lesson, we focus on Shared Access Signatures, but also cover storage encryption and some best practices. Here are the high-level security capabilities for Azure storage:</p><ul class="square"><li class="square"><p><b>Encryption</b>. All data written to Azure Storage is automatically encrypted using Storage Service Encryption (SSE).</p></li><li class="square"><p><b>Authentication</b>. Azure Active Directory (Azure AD) and Role-Based Access Control (RBAC) are supported for Azure Storage for both resource management operations and data operations, as follows:</p><ul class="square"><li class="square"><p>You can assign RBAC roles scoped to the storage account to security principals and use Azure AD to authorize resource management operations such as key management.</p></li><li class="square"><p>Azure AD integration is supported for data operations on the Blob and Queue services.</p></li></ul></li><li class="square"><p><b>Data in transit</b>. Data can be secured in transit between an application and Azure by using Client-Side Encryption, HTTPS, or SMB 3.0.</p></li><li class="square"><p><b>Disk encryption</b>. OS and data disks used by Azure virtual machines can be encrypted using Azure Disk Encryption.</p></li><li class="square"><p><b>Shared Access Signatures</b>. Delegated access to the data objects in Azure Storage can be granted using Shared Access Signatures.</p></li></ul><h4 class="da-h4">Authorization options</h4><p>Every request made against a secured resource in the Blob, File, Queue, or Table service must be authorized. Authorization ensures that resources in your storage account are accessible only when you want them to be, and only to those users or applications to whom you grant access. Options for authorizing requests to Azure Storage include:</p><ul class="square"><li class="square"><p><b>Azure Active Directory (Azure AD)</b>. Azure AD is Microsoft's cloud-based identity and access management service. With Azure AD, you can assign fine-grained access to users, groups, or applications via role-based access control (RBAC).</p></li><li class="square"><p><b>Shared Key</b>. Shared Key authorization relies on your account access keys and other parameters to produce an encrypted signature string that is passed on the request in the Authorization header.</p></li><li class="square"><p><b>Shared access signatures</b>. Shared access signatures (SAS) delegate access to a particular resource in your account with specified permissions and over a specified time interval.</p></li><li class="square"><p><b>Anonymous access to containers and blobs</b>. You can optionally make blob resources public at the container or blob level. A public container or blob is accessible to any user for anonymous read access. Read requests to public containers and blobs do not require authorization.</p></li></ul><h3 class="da-h3" id="1191733">Lab - Implementing Highly Available Azure IaaS Compute Architecture</h3><p>✔️ <b>Important:</b> To download the most recent version of this lab, please visit the AZ-303 <a href="https://github.com/MicrosoftLearning/AZ-303-Microsoft-Azure-Architect-Technologies" title="" target="_blank">GitHub repository</a>.</p><p>Direct link to the <a href="https://aka.ms/303_Module_05_Lab" title="" target="_blank">Lab: Implementing Highly Available Azure IaaS Compute Architecture</a>.</p><h4 class="da-h4">Lab scenario</h4><p><span><img alt="" src="../Images/1192088-490226.png" width="" height="" /></span></p><p>
  
Adatum Corporation has several on-premises workloads running on a mix of physical servers and virtual machines. Most of the workloads require some level of resiliency, including a range of high availability SLAs. Most of the workloads leverage either Windows Server Failover Clustering or Linux Corosync clusters and Pacemaker resource manager, with synchronous replication between cluster nodes. Adatum is trying to determine how the equivalent functionality can be implemented in Azure. In particular, the Adatum Enterprise Architecture team is exploring the Azure platform capabilities that accommodate high availability requirements within the same data center and between data centers in the same region.
</p><p>In addition, the Adatum Enterprise Architecture team realizes that resiliency alone might not be sufficient to provide the level of availability expected by its business operations. Some of the workloads have highly dynamic usage patterns, which are currently addressed based on continuous monitoring and custom scripting solutions, automatically provisioning and deprovisioning additional cluster nodes. Usage patterns of others are more predictable, but also need to be occasionally adjusted to account for increase demand for disk space, memory, or processing resources.</p><p>To accomplish these objectives, the Architecture team wants to test a range of highly available IaaS compute deployments, including:</p><ul class="square"><li class="square"><p>Availability sets-based deployment of Azure VMs behind an Azure Load Balancer Basic</p></li><li class="square"><p>Zone-redundant deployment of Azure VMs behind an Azure Load Balancer Standard</p></li><li class="square"><p>Zone-redundant deployment of Azure VM scale sets behind an Azure Application Gateway</p></li><li class="square"><p>Automatic horizontal scaling of Azure VM scale sets (autoscaling)</p></li><li class="square"><p>Manual vertical scaling (compute and storage) of Azure VM scale sets</p></li></ul><p>An availability set represents a logical grouping of Azure VMs which controls their physical placement within the same Azure datacenter. Azure makes sure that the VMs within the same availability set run across multiple physical servers, compute racks, storage units, and network switches. If a hardware or software failure happens, only a subset of your VMs are impacted and your overall solution stays operational. Availability Sets are essential for building reliable cloud solutions. With availability sets, Azure offers 99.95% VM uptime SLA.</p><p>Availability zones represent unique physical locations within a single Azure region. Each zone is made up of one or more datacenters equipped with independent power, cooling, and networking. The physical separation of availability zones within a region protects applications and data from datacenter failures. Zone-redundant services replicate your applications and data across availability zones to protect from single-points-of-failure. With availability zones, Azure offers 99.99% VM uptime SLA.</p><p>Azure virtual machine scale sets let you create and manage a group of identical, load balanced VMs. The number of VM instances can automatically increase or decrease in response to demand or a defined schedule. Scale sets provide high availability to your applications, and allow you to centrally manage, configure, and update many VMs. With virtual machine scale sets, you can build large-scale services for areas such as compute, big data, and container workloads.</p><h4 class="da-h4">Objectives</h4><p>After completing this lab, you will be able to:</p><ul class="square"><li class="square"><p>Describe characteristics of highly available Azure VMs residing in the same availability set behind a Azure Load Balancer Basic</p></li><li class="square"><p>Describe characteristics of highly available Azure VMs residing in different availability zones behind an Azure Load Balancer Standard</p></li><li class="square"><p>Describe characteristics of automatic horizontal scaling of Azure VM Scale Sets</p></li><li class="square"><p>Describe characteristics of manual vertical scaling of Azure VM Scale Sets</p></li></ul><h4 class="da-h4">Lab Files</h4><ul class="square"><li class="square"><p>\AZ303\AllFiles\Labs\01\azuredeploy30301suba.json</p></li><li class="square"><p>\AZ303\AllFiles\Labs\01\azuredeploy30301rga.json</p></li><li class="square"><p>\AZ303\AllFiles\Labs\01\azuredeploy30301rga.parameters.json</p></li><li class="square"><p>\AZ303\AllFiles\Labs\01\azuredeploy30301rgb.json</p></li><li class="square"><p>\AZ303\AllFiles\Labs\01\azuredeploy30301rgb.parameters.json</p></li><li class="square"><p>\AZ303\AllFiles\Labs\01\azuredeploy30301rgc.json</p></li><li class="square"><p>\AZ303\AllFiles\Labs\01\azuredeploy30301rgc.parameters.json</p></li><li class="square"><p>\AZ303\AllFiles\Labs\01\az30301e-configure_VMSS_with_data_disk.ps1</p></li></ul><h5 class="da-h5">Exercise 1: Implement and analyze highly available Azure VM deployments using availability sets and Azure Load Balancer Basic</h5><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Deploy highly available Azure VMs into an availability set behind an Azure Load Balancer Basic by using Azure Resource Manager templates</p></li><li><p>Analyze highly available Azure VMs deployed into an availability set behind an Azure Load Balancer Basic</p></li><li><p>Remove Azure resources deployed in the exercise</p></li></ol><h5 class="da-h5">Exercise 2: Implement and analyze highly available Azure VM deployments using availability zones and Azure Load Balancer Standard</h5><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Deploy highly available Azure VMs into availability zones behind an Azure Load Balancer Standard by using Azure Resource Manager templates</p></li><li><p>Analyze highly available Azure VMs deployed across availability zones behind an Azure Load Balancer Standard</p></li><li><p>Remove Azure resources deployed in the exercise</p></li></ol><h5 class="da-h5">Exercise 3: Implement and analyze highly available Azure VM Scale Set deployments using availability zones and Azure Application Gateway.</h5><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Deploy a highly available Azure VM Scale Set into availability zones behind an Azure Application Gateway by using Azure Resource Manager templates</p></li><li><p>Analyze a highly available Azure VM Scale Set deployed across availability zones behind an Azure Application Gateway</p></li><li><p>Remove Azure resources deployed in the exercise</p></li></ol><h5 class="da-h5">Exercise 4: Implementing autoscaling of Azure VM Scale Sets using availability zones and Azure Application Gateway.</h5><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Configuring autoscaling of an Azure VM Scale Set</p></li><li><p>Testing autoscaling of an Azure VM Scale Set</p></li></ol><h5 class="da-h5">Exercise 5: Implementing vertical scaling of Azure VM Scale Sets</h5><p>The main tasks for this exercise are as follows:</p><ol class="number"><li><p>Scaling compute resources of Azure virtual machine scale set instances.</p></li><li><p>Scaling storage resources of Azure virtual machine scale sets instances.</p></li></ol><h3 class="da-h3" id="1191768">Grant Access from an Internet IP Range</h3><p>You can configure storage accounts to allow access from specific public internet IP address ranges. This configuration grants access to specific internet-based services and on-premises networks and blocks general internet traffic.</p><p>Provide allowed internet address ranges using <a href="https://tools.ietf.org/html/rfc4632" title="" target="_blank">CIDR notation</a> in the form 16.17.18.0/24 or as individual IP addresses like 16.17.18.19.</p><p>IP network rules are only allowed for public internet IP addresses. IP address ranges reserved for private networks (as defined in <a href="https://tools.ietf.org/html/rfc1918" title="" target="_blank">RFC 1918</a>) aren't allowed in IP rules. Private networks include addresses that start with 10.<i>, 172.16.</i> - 172.31.<i>, and 192.168.</i>.</p><p>✔️<b>Note:</b> IP network rules have no effect on requests originating from the same Azure region as the storage account. Use <a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-network-security?WT.mc_id=thomasmaurer-blog-thmaure" title="" target="_blank">Virtual network rules</a> to allow same-region requests.</p><p>✔️<b>Note:</b> Services deployed in the same region as the storage account use private Azure IP addresses for communication. Thus, you cannot restrict access to specific Azure services based on their public outbound IP address range.</p><p>Only IPV4 addresses are supported for configuration of storage firewall rules.</p><p>Each storage account supports up to 100 IP network rules.</p><p><b>Configuring access from on-premises networks</b></p><p>To grant access from your on-premises networks to your storage account with an IP network rule, you must identify the internet facing IP addresses used by your network. Contact your network administrator for help.</p><p>If you are using <a href="https://docs.microsoft.com/en-us/azure/expressroute/expressroute-introduction" title="" target="_blank">ExpressRoute</a> from your premises, for public peering or Microsoft peering, you will need to identify the NAT IP addresses that are used. For public peering, each ExpressRoute circuit by default uses two NAT IP addresses applied to Azure service traffic when the traffic enters the Microsoft Azure network backbone. For Microsoft peering, the NAT IP addresses used are either customer provided or are provided by the service provider. To allow access to your service resources, you must allow these public IP addresses in the resource IP firewall setting.</p><p><b>Managing IP network rules</b></p><p>You can manage IP network rules for storage accounts through the Azure portal.</p><ol class="number"><li><p>Go to the storage account you want to secure.</p></li><li><p>Click on the settings menu called <b>Firewalls and virtual networks</b>.</p></li><li><p>Check that you've selected to allow access from Selected networks.</p></li><li><p>To grant access to an internet IP range, enter the IP address or address range (in CIDR format) under Firewall &gt; Address Range.</p></li><li><p>To remove an IP network rule, click the trash can icon next to the address range.</p></li><li><p>Click <b>Save</b> to apply your changes.</p></li></ol><h3 class="da-h3" id="1191736">Azure Storage</h3><p><span><img alt="" src="../Images/1192358-490496.png" width="" height="" /></span></p><p>Azure Storage is Microsoft's cloud storage solution for modern data storage scenarios. Azure Storage offers a massively scalable object store for data objects, a file system service for the cloud, a messaging store for reliable messaging, and a NoSQL store. Azure Storage is:</p><ul class="square"><li class="square"><p><b>Durable and highly available</b>. Redundancy ensures that your data is safe in the event of transient hardware failures. You can also opt to replicate data across datacenters or geographical regions for additional protection from local catastrophe or natural disaster. Data replicated in this way remains highly available in the event of an unexpected outage.</p></li><li class="square"><p><b>Secure</b>. All data written to Azure Storage is encrypted by the service. Azure Storage provides you with fine-grained control over who has access to your data.</p></li><li class="square"><p><b>Scalable</b>. Azure Storage is designed to be massively scalable to meet the data storage and performance needs of today's applications.</p></li><li class="square"><p><b>Managed</b>. Microsoft Azure handles hardware maintenance, updates, and critical issues for you.</p></li><li class="square"><p><b>Accessible</b>. Data in Azure Storage is accessible from anywhere in the world over HTTP or HTTPS. Microsoft provides SDKs for Azure Storage in a variety of languages – .NET, Java, Node.js, Python, PHP, Ruby, Go, and others – as well as a mature REST API. Azure Storage supports scripting in Azure PowerShell or Azure CLI. And the Azure portal and Azure Storage Explorer offer easy visual solutions for working with your data.</p></li></ul><p>Azure Storage is a service that you can use to store files, messages, tables, and other types of information. You can use Azure storage on its own—for example as a file share—but it is often used by developers as a store for working data. Such stores can be used by websites, mobile apps, desktop applications, and many other types of custom solutions. Azure storage is also used by IaaS virtual machines, and PaaS cloud services. You can generally think of Azure storage in three categories.</p><ul class="square"><li class="square"><p><b>Storage for Virtual Machines</b>. This includes disks and files. Disks are persistent block storage for Azure IaaS virtual machines. Files are fully managed file shares in the cloud.</p></li><li class="square"><p><b>Unstructured Data</b>. This includes Blobs and Data Lake Store. Blobs are highly scaleable, REST based cloud object store. Data Lake Store is Hadoop Distributed File System (HDFS) as a service.</p></li><li class="square"><p><b>Structured Data</b>. This includes Tables. Tables are a key/value, auto-scaling NoSQL store.</p></li></ul><p>General purpose storage accounts have two tiers: <b>Standard</b> and <b>Premium</b>.</p><ul class="square"><li class="square"><p><b>Standard</b> storage accounts are backed by magnetic drives (HDD) and provide the lowest cost per GB. They are best for applications that require bulk storage or where data is accessed infrequently.</p></li><li class="square"><p><b>Premium</b> storage accounts are backed by solid state drives (SSD) and offer consistent low-latency performance. They can only be used with Azure virtual machine disks and are best for I/O-intensive applications, like databases.</p></li></ul><p><b>Note:</b> ✔️ It is not possible to convert a Standard storage account to Premium storage account or vice versa. You must create a new storage account with the desired type and copy data, if applicable, to a new storage account.</p><h3 class="da-h3" id="1191755">Storage Service Encryption</h3><p>Azure <b>Storage Service Encryption</b> (SSE) for data at rest helps you protect your data to meet your organizational security and compliance commitments. With this feature, the Azure storage platform automatically encrypts your data before persisting it to Azure Managed Disks, Azure Blob, Queue, Table storage, or Azure Files, and decrypts the data before retrieval.</p><p>The handling of encryption, encryption at rest, decryption, and key management in Storage Service Encryption is transparent to users. All data written to the Azure storage platform is encrypted through 256-bit AES encryption, one of the strongest block ciphers available.</p><p><span><img alt="" src="../Images/1192309-490447.png" width="" height="" /></span></p><p>✔️ SSE is enabled for all new and existing storage accounts and cannot be disabled. Because your data is secured by default, you don't need to modify your code or applications.</p><h3 class="da-h3" id="1191779">Module 6 Review Questions</h3><p><span><img alt="" src="../Images/1192029-490167.png" width="" height="" /></span></p><h4 class="problem">Review Question 1</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-b4967d78-90b5-7989-b326-b07c5c44d655"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You are the Solution Architect for your company. Your company has an Azure subscription that contains the following resource groups.<br />
Name: ResourceGroup_Red<br /></p><ul class="square"><li class="square"><p>Region: East US</p></li></ul><p>
Name: ResourceGroup_Blue<br /></p><ul class="square"><li class="square"><p>Region: West US</p></li></ul><p>
Also, the subscription contains the following storage accounts.<br />
Name: Team_Storage1<br /></p><ul class="square"><li class="square"><p>Resource Group: ResourceGroup_Red</p></li><li class="square"><p>Region: West US</p></li><li class="square"><p>Account Type: BlobStorage</p></li></ul><p>
Name: Team _Storage2<br /></p><ul class="square"><li class="square"><p>Group: ResourceGroup_Blue</p></li><li class="square"><p>Region: West US</p></li><li class="square"><p>Account Type: Storage - general purpose v1</p></li></ul><p>
Name: Team _Storage3<br /></p><ul class="square"><li class="square"><p>Resource Group: ResourceGroup_Red</p></li><li class="square"><p>Region: East US</p></li><li class="square"><p>Account Type: StorageV2 - general purpose v2</p></li></ul><p>
You advise that they create a Recovery Service vault named Vault1 in ResourceGroup_Red in the West US location.<br />
Diagnostics logs should be in same region as the monitored resources.<br />
They will need to identify which storage accounts can be used to generate the diagnostic logs for Vault1.<br />
Which storage account(s) should you identify?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="qb4967d78-90b5-7989-b326-b07c5c44d655" value="1" />Team_Storage1 only<br /></label></li><li><label><input type="radio" name="qb4967d78-90b5-7989-b326-b07c5c44d655" value="2" />Team_Storage2 only<br /></label></li><li><label><input type="radio" name="qb4967d78-90b5-7989-b326-b07c5c44d655" value="3" />Team_Storage3 only<br /></label></li><li><label><input type="radio" name="qb4967d78-90b5-7989-b326-b07c5c44d655" value="4" />Team_Storage1 and Team_Storage2<br /></label></li></ul></div></div><div id="feedback-problem-b4967d78-90b5-7989-b326-b07c5c44d655" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct Answer: Diagnostics settings can be archived to a storage account that resides in the same Azure region irrespective of the storage account type. Because Vault1 resides in West US, diagnostics settings  can be set for Team_Storage1 and Team_Storage2 only.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 2</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-3a72cbe0-af48-141d-1d67-fa6adc21ee61"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You are advising a company that has an Azure subscription containing two storage accounts named TailwindStorage1 and TailwindStorage2. Both storage accounts contains a queue service, table service, and a blob service.<br /></p><ul class="square"><li class="square"><p>You recommend they develop two separate applications named TaiwindApp_1 and TaiwindApp_2.</p></li><li class="square"><p>They will need to configure the applications to store different types of data to all the storage services on TailwindStorage1 and TailwindStorage2.</p></li></ul><p>
How many endpoints should you recommend they configure for each of the applications?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q3a72cbe0-af48-141d-1d67-fa6adc21ee61" value="1" />2<br /></label></li><li><label><input type="radio" name="q3a72cbe0-af48-141d-1d67-fa6adc21ee61" value="2" />3<br /></label></li><li><label><input type="radio" name="q3a72cbe0-af48-141d-1d67-fa6adc21ee61" value="3" />6<br /></label></li><li><label><input type="radio" name="q3a72cbe0-af48-141d-1d67-fa6adc21ee61" value="4" />12<br /></label></li></ul></div></div><div id="feedback-problem-3a72cbe0-af48-141d-1d67-fa6adc21ee61" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct Answer: 6 endpoints each. Each storage service in storage account, queue service, table service and blob service has its own endpoint. Because each app must write to three storage services in two different accounts, each of them has different endpoint, which means that you should configure six endpoints for each app.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 3</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-ece49866-0898-c1d5-b084-8d3e996f5991"><div class="card quizlib-question"><div class="quizlib-question-title"><p>Your organization has a SQL Server on an Azure virtual machine named OEM_SQL_3.<br />
You’ve been asked to provide a solution to automate backup of the databases on OEM_SQL_3 using Automated Backup V2 for the virtual machines.<br />
The requirements are as follows:<br /></p><ul class="square"><li class="square"><p>Meet the RPO of 15 minutes</p></li><li class="square"><p>Retain the backups for 30 days</p></li><li class="square"><p>Encrypt the backups at rest</p></li></ul><p>
As part the solution you will be providing, what should you include?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="qece49866-0898-c1d5-b084-8d3e996f5991" value="1" />An Azure Storage account<br /></label></li><li><label><input type="radio" name="qece49866-0898-c1d5-b084-8d3e996f5991" value="2" />A Key Vault<br /></label></li><li><label><input type="radio" name="qece49866-0898-c1d5-b084-8d3e996f5991" value="3" />An Azure SQL Managed Instance<br /></label></li><li><label><input type="radio" name="qece49866-0898-c1d5-b084-8d3e996f5991" value="4" />An Azure Logic App<br /></label></li></ul></div></div><div id="feedback-problem-ece49866-0898-c1d5-b084-8d3e996f5991" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct answer: An Azure Storage account. Azure Storage supports almost any type of data and provides security, redundancy, and scalable access to the stored data. A storage account provides access to objects in Azure Storage for a specific subscription. VMs always have one or more storage accounts to hold each attached virtual disk.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 4</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-87bf8ee9-c719-2646-87e9-9c21565b7f83"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You work for an open source development company. You use Microsoft Azure for a variety of storage needs. Up to now, all the storage was used for internal purposes only. It is organized in block blobs. Each block blob is in its own container. Each container is set to default settings. In total, you have 50 block blobs. The company has decided to provide read access to the data in the block blobs, as part of releasing more information about their open source development efforts. You need to reconfigure the storage to meet the following requirements:<br /></p><ul class="square"><li class="square"><p>All block blobs must be readable by anonymous internet users.</p></li></ul><p>
You need to configure the storage to meet the requirements. What should you do? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q87bf8ee9-c719-2646-87e9-9c21565b7f83" value="1" />Create a new container, move all the blobs to the new container, and then set the public access level to Blob.<br /></label></li><li><label><input type="radio" name="q87bf8ee9-c719-2646-87e9-9c21565b7f83" value="2" />Set the public access level to Blob on all the existing containers.<br /></label></li><li><label><input type="radio" name="q87bf8ee9-c719-2646-87e9-9c21565b7f83" value="3" />Create a new shared access signature for the storage account and then set the allowed permissions to Read, set the allowed resource types to Object, and set the allowed services to Blob.<br /></label></li><li><label><input type="radio" name="q87bf8ee9-c719-2646-87e9-9c21565b7f83" value="4" />Create a new access key for the storage account and then provide the connection string in the storage connectivity information to the public.<br /></label></li></ul></div></div><div id="feedback-problem-87bf8ee9-c719-2646-87e9-9c21565b7f83" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">In this scenario, you need to reconfigure 50 containers. A shared access signature could work here, but not with the settings outlined in the answer choice. An access key is meant for use by your apps when communicating internally in Azure to the storage. In this scenario, you should create a new container, move the existing blobs, and then set the public access level to Blob. In the future, when access changes are required, you can configure the single container (which would contain all blobs).<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 5</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-fb3b4b9c-6b91-0a09-cba9-0d06aeb6b294"><div class="card quizlib-question"><div class="quizlib-question-title"><p>Your company is planning to storage log data, crash dump files, and other diagnostic data for Azure VMs in Azure. The company has issued the following requirements for the storage:<br /></p><ul class="square"><li class="square"><p>Administrators must be able to browse to the data in File Explorer.</p></li><li class="square"><p>Access over SMB 3.0 must be supported.</p></li><li class="square"><p>The storage must support quotas.</p></li></ul><p>
You need to choose the storage type to meet the requirements. Which storage type should you use? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="qfb3b4b9c-6b91-0a09-cba9-0d06aeb6b294" value="1" />Azure Files<br /></label></li><li><label><input type="radio" name="qfb3b4b9c-6b91-0a09-cba9-0d06aeb6b294" value="2" />Table storage<br /></label></li><li><label><input type="radio" name="qfb3b4b9c-6b91-0a09-cba9-0d06aeb6b294" value="3" />Blob storage<br /></label></li><li><label><input type="radio" name="qfb3b4b9c-6b91-0a09-cba9-0d06aeb6b294" value="4" />Queue storage<br /></label></li></ul></div></div><div id="feedback-problem-fb3b4b9c-6b91-0a09-cba9-0d06aeb6b294" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Azure Files supports SMB 3.0, is reachable via File Explorer, and supports quotas. The other storage types do not support the requirements. While blob storage is good for unstructured data, it cannot be accessed over SMB 3.0.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 6</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-cfe6562c-1deb-0301-a5f6-3f9b3db9da14"><div class="card quizlib-question"><div class="quizlib-question-title"><p>Your company provides cloud software to audit administrative access in Microsoft Azure resources. The software logs all administrative actions (including all clicks and text input) to log files. The software is about to be released from beta and the company is concerned about storage performance. You need to deploy a storage solution for the log files to maximize performance. What should you do? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="qcfe6562c-1deb-0301-a5f6-3f9b3db9da14" value="1" />Deploy Azure Files using SMB 3.0.<br /></label></li><li><label><input type="radio" name="qcfe6562c-1deb-0301-a5f6-3f9b3db9da14" value="2" />Deploy Azure Table Storage.<br /></label></li><li><label><input type="radio" name="qcfe6562c-1deb-0301-a5f6-3f9b3db9da14" value="3" />Deploy Azure Queues Storage.<br /></label></li><li><label><input type="radio" name="qcfe6562c-1deb-0301-a5f6-3f9b3db9da14" value="4" />Deploy blob storage using block blobs.<br /></label></li><li><label><input type="radio" name="qcfe6562c-1deb-0301-a5f6-3f9b3db9da14" value="5" />Deploy blob storage using append blobs.<br /></label></li></ul></div></div><div id="feedback-problem-cfe6562c-1deb-0301-a5f6-3f9b3db9da14" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Append blobs optimize append operations (writes adding onto a log file, for example). In this scenario, the company needs to write data to log files, most often appending data (until a new log file is generated). Block blobs are cost efficient but not designed specifically for append operations, so performance isn't as high. Queue Storage is used for apps to communicate. Table Storage is a NoSQL database but not optimized for this scenario. Azure Files is geared for SMB storage, such as from Windows Servers but doesn't offer the optimized solution that append blobs do.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h3 class="da-h3" id="1191757">Storage Security Best Practices</h3><h4 class="da-h4">Risks</h4><p>When you use shared access signatures in your applications, you should to be aware of two potential risks.</p><ul class="square"><li class="square"><p>If a SAS is compromised, it can be used by anyone who obtains it.</p></li><li class="square"><p>If a SAS provided to a client application expires and the application is unable to retrieve a new SAS from your service, then the application's functionality may be hindered.</p></li></ul><h4 class="da-h4">Recommendations</h4><p>The following recommendations for using shared access signatures can help mitigate risks.</p><ul class="square"><li class="square"><p><b>Always use HTTPS to create or distribute a SAS</b>. If a SAS is passed over HTTP and intercepted, an attacker performing a man-in-the-middle attack is able to read the SAS and then use it just as the intended user could have, potentially compromising sensitive data or allowing for data corruption by the malicious user.</p></li><li class="square"><p><b>Reference stored access policies where possible</b>. Stored access policies give you the option to revoke permissions without having to regenerate the storage account keys. Set the expiration on these very far in the future (or infinite) and make sure it's regularly updated to move it farther into the future.</p></li><li class="square"><p><b>Use near-term expiration times on an ad hoc SAS</b>. In this way, even if a SAS is compromised, it's valid only for a short time. This practice is especially important if you cannot reference a stored access policy. Near-term expiration times also limit the amount of data that can be written to a blob by limiting the time available to upload to it.</p></li><li class="square"><p><b>Have clients automatically renew the SAS if necessary</b>. Clients should renew the SAS well before the expiration, in order to allow time for retries if the service providing the SAS is unavailable. If your SAS is meant to be used for a small number of immediate, short-lived operations that are expected to be completed within the expiration period, then this may be unnecessary as the SAS is not expected to be renewed. However, if you have a client that is routinely making requests via SAS, then the possibility of expiration comes into play. The key consideration is to balance the need for the SAS to be short-lived (as previously stated) with the need to ensure that the client is requesting renewal early enough (to avoid disruption due to the SAS expiring prior to successful renewal).</p></li><li class="square"><p><b>Be careful with SAS start time</b>. If you set the start time for a SAS to now, then due to clock skew (differences in current time according to different machines), failures may be observed intermittently for the first few minutes. In general, set the start time to be at least 15 minutes in the past. Or, don't set it at all, which will make it valid immediately in all cases. The same generally applies to expiry time as well - remember that you may observe up to 15 minutes of clock skew in either direction on any request. For clients using a REST version prior to 2012-02-12, the maximum duration for a SAS that does not reference a stored access policy is 1 hour, and any policies specifying longer term than that will fail.</p></li><li class="square"><p><b>Be specific with the resource to be accessed</b>. A security best practice is to provide a user with the minimum required privileges. If a user only needs read access to a single entity, then grant them read access to that single entity, and not read/write/delete access to all entities. This also helps lessen the damage if a SAS is compromised because the SAS has less power in the hands of an attacker</p></li><li class="square"><p><b>Understand that your account will be billed for any usage, including that done with SAS</b>. If you provide write access to a blob, a user may choose to upload a 200GB blob. If you've given them read access as well, they may choose to download it 10 times, incurring 2 TB in egress costs for you. Again, provide limited permissions to help mitigate the potential actions of malicious users. Use short-lived SAS to reduce this threat (but be mindful of clock skew on the end time).</p></li><li class="square"><p><b>Validate data written using SAS</b>. When a client application writes data to your storage account, keep in mind that there can be problems with that data. If your application requires that data be validated or authorized before it is ready to use, you should perform this validation after the data is written and before it is used by your application. This practice also protects against corrupt or malicious data being written to your account, either by a user who properly acquired the SAS, or by a user exploiting a leaked SAS.</p></li><li class="square"><p><b>Don't assume SAS is always the correct choice</b>. Sometimes the risks associated with a particular operation against your storage account outweigh the benefits of SAS. For such operations, create a middle-tier service that writes to your storage account after performing business rule validation, authentication, and auditing. Also, sometimes it's simpler to manage access in other ways. For example, if you want to make all blobs in a container publicly readable, you can make the container Public, rather than providing a SAS to every client for access.</p></li><li class="square"><p><b>Use Storage Analytics to monitor your application</b>. You can use logging and metrics to observe any spike in authentication failures due to an outage in your SAS provider service or to the inadvertent removal of a stored access policy.</p></li></ul><h3 class="da-h3" id="1191765">Azure Storage Firewalls and Virtual Networks</h3><p>Azure Storage provides a layered security model. This model enables you to secure and control the level of access to your storage accounts that your applications and enterprise environments demand, based on the type and subset of networks used. When network rules are configured, only applications requesting data over the specified set of networks can access a storage account. You can limit access to your storage account to requests originating from specified IP addresses, IP ranges or from a list of subnets in an Azure Virtual Network (VNet).</p><p>Storage accounts have a public endpoint that is accessible through the internet. You can also create Private Endpoints for your storage account, which assigns a private IP address from your VNet to the storage account, and secures all traffic between your VNet and the storage account over a private link. The Azure storage firewall provides access control access for the public endpoint of your storage account. You can also use the firewall to block all access through the public endpoint when using private endpoints. Your storage firewall configuration also enables select trusted Azure platform services to access the storage account securely.</p><p>An application that accesses a storage account when network rules are in effect still requires proper authorization for the request. Authorization is supported with Azure Active Directory (Azure AD) credentials for blobs and queues, with a valid account access key, or with an SAS token.</p><p><b>Scenarios</b></p><ul class="square"><li class="square"><p>To secure your storage account, you should first configure a rule to deny access to traffic from all networks (including internet traffic) on the public endpoint, by default. Then, you should configure rules that grant access to traffic from specific VNets. You can also configure rules to grant access to traffic from select public internet IP address ranges, enabling connections from specific internet or on-premises clients. This configuration enables you to build a secure network boundary for your applications.</p></li><li class="square"><p>You can combine firewall rules that allow access from specific virtual networks and from public IP address ranges on the same storage account. Storage firewall rules can be applied to existing storage accounts, or when creating new storage accounts.</p></li><li class="square"><p>Storage firewall rules apply to the public endpoint of a storage account. You don't need any firewall access rules to allow traffic for private endpoints of a storage account. The process of approving the creation of a private endpoint grants implicit access to traffic from the subnet that hosts the private endpoint.</p></li><li class="square"><p>Network rules are enforced on all network protocols to Azure storage, including REST and SMB. To access data using tools such as the Azure portal, Storage Explorer, and AZCopy, explicit network rules must be configured.</p></li><li class="square"><p>Once network rules are applied, they're enforced for all requests. SAS tokens that grant access to a specific IP address serve to limit the access of the token holder, but don't grant new access beyond configured network rules.</p></li><li class="square"><p>Virtual machine disk traffic (including mount and unmount operations, and disk IO) is not affected by network rules. REST access to page blobs is protected by network rules.</p></li><li class="square"><p>Classic storage accounts do not support firewalls and virtual networks.</p></li></ul><h3 class="da-h3" id="1191759">Authorize access to Blobs and Queues using AAD</h3><p>Azure Storage supports using Azure Active Directory (Azure AD) to authorize requests to Blob and Queue storage. With Azure AD, you can use role-based access control (RBAC) to grant permissions to a security principal, which may be a user, group, or application service principal. The security principal is authenticated by Azure AD to return an OAuth 2.0 token. The token can then be used to authorize a request against Blob or Queue storage.</p><p>Authorizing requests against Azure Storage with Azure AD provides superior security and ease of use over Shared Key authorization. Microsoft recommends using Azure AD authorization with your blob and queue applications when possible to minimize potential security vulnerabilities inherent in Shared Key.</p><p>Authorization with Azure AD is available for all general-purpose and Blob storage accounts in all public regions and national clouds. Only storage accounts created with the Azure Resource Manager deployment model support Azure AD authorization.</p><p>Authorization with Azure AD is not supported for Azure Table storage. Use Shared Key to authorize requests to Table storage.</p><h3 class="da-h3" id="1191760">Overview of Azure AD for Blobs and Queues</h3><p>When a security principal (a user, group, or application) attempts to access a blob or queue resource, the request must be authorized, unless it is a blob available for anonymous access. With Azure AD, access to a resource is a two-step process. First, the security principal's identity is authenticated and an OAuth 2.0 token is returned. Next, the token is passed as part of a request to the Blob or Queue service and used by the service to authorize access to the specified resource.</p><p>The authentication step requires that an application request an OAuth 2.0 access token at runtime. If an application is running from within an Azure entity such as an Azure VM, a virtual machine scale set, or an Azure Functions app, it can use a managed identity to access blobs or queues..</p><p>The authorization step requires that one or more RBAC roles be assigned to the security principal. Azure Storage provides RBAC roles that encompass common sets of permissions for blob and queue data. The roles that are assigned to a security principal determine the permissions that the principal will have.</p><p>Native applications and web applications that make requests to the Azure Blob or Queue service can also authorize access with Azure AD.</p><h3 class="da-h3" id="1191720">Azure Firewall</h3><p>Azure Firewall is a managed, cloud-based network security service that protects your Azure Virtual Network resources. It's a fully stateful firewall as a service with built-in high availability and unrestricted cloud scalability. You can centrally create, enforce, and log application and network connectivity policies across subscriptions and virtual networks. Azure Firewall uses a static public IP address for your virtual network resources allowing outside firewalls to identify traffic originating from your virtual network. The service is fully integrated with Azure Monitor for logging and analytics.</p><p><span><img alt="" src="../Images/1192158-490296.png" width="" height="" /></span></p><h4 class="da-h4">Azure Firewall features</h4><ul class="square"><li class="square"><p><b>Built-in high availability</b>. High availability is built in, so no additional load balancers are required and there's nothing you need to configure.</p></li><li class="square"><p><b>Availability Zones</b>. Azure Firewall can be configured during deployment to span multiple Availability Zones for increased availability.</p></li><li class="square"><p><b>Unrestricted cloud scalability</b>.  Azure Firewall can scale up as much as you need to accommodate changing network traffic flows, so you don't need to budget for your peak traffic.</p></li><li class="square"><p><b>Application FQDN filtering rules</b>. You can limit outbound HTTP/S traffic or Azure SQL traffic to a specified list of fully qualified domain names (FQDN) including wild cards.</p></li><li class="square"><p><b>Network traffic filtering rules</b>. You can centrally create allow or deny network filtering rules by source and destination IP address, port, and protocol. Azure Firewall is fully stateful, so it can distinguish legitimate packets for different types of connections. Rules are enforced and logged across multiple subscriptions and virtual networks.</p></li><li class="square"><p><b>Threat intelligence</b>. Threat intelligence-based filtering can be enabled for your firewall to alert and deny traffic from/to known malicious IP addresses and domains. The IP addresses and domains are sourced from the Microsoft Threat Intelligence feed.</p></li><li class="square"><p><b>Multiple public IP addresses</b>. You can associate multiple public IP addresses (up to 100) with your firewall.</p></li></ul><h3 class="da-h3" id="1191655">Comparison of Virtual Network Peering and VPN Gateway</h3><p>Virtual network peering and VPN gateways both support the following connection types:</p><ul class="square"><li class="square"><p>Virtual networks in different regions.</p></li><li class="square"><p>Virtual networks in different Azure Active Directory tenants.</p></li><li class="square"><p>Virtual networks in different Azure subscriptions.</p></li><li class="square"><p>Virtual networks that use a mix of Azure deployment models (Resource Manager and classic).</p></li></ul><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p><b>Item</b></p></td><td><p><b>Virtual network peering</b></p></td><td><p><b>VPN Gateway</b></p></td></tr></thead><tbody><tr><td><p><b>Limits</b></p></td><td><p>Up to 500 virtual network peerings per virtual network (see Networking limits).</p></td><td><p>One VPN gateway per virtual network. The maximum number of tunnels per gateway depends on the gateway SKU.</p></td></tr><tr><td><p><b>Pricing model</b></p></td><td><p>Ingress/Egress</p></td><td><p>Hourly + Egress</p></td></tr><tr><td><p><b>Encryption</b></p></td><td><p>Software-level encryption is recommended.</p></td><td><p>Custom IPsec/IKE policy can be applied to new or existing connections. See About cryptographic requirements and Azure VPN gateways.</p></td></tr><tr><td><p><b>Bandwidth limitations</b></p></td><td><p>No bandwidth limitations.</p></td><td><p>Varies based on SKU. See Gateway SKUs by tunnel, connection, and throughput.</p></td></tr><tr><td><p><b>Private?</b></p></td><td><p>Yes. Routed through Microsoft backbone and private. No public internet involved.</p></td><td><p>Public IP involved.</p></td></tr><tr><td><p><b>Transitive relationship</b></p></td><td><p>Peering connections are non-transitive. Transitive networking can be achieved using NVAs or gateways in the hub virtual network. See Hub-spoke network topology for an example.</p></td><td><p>If virtual networks are connected via VPN gateways and BGP is enabled in the virtual network connections, transitivity works.</p></td></tr><tr><td><p><b>Initial setup time</b></p></td><td><p>Fast</p></td><td><p>~30 minutes</p></td></tr><tr><td><p><b>Typical scenarios</b></p></td><td><p>Data replication, database failover, and other scenarios needing frequent backups of large data.</p></td><td><p>Encryption-specific scenarios that are not latency sensitive and do not need high throughout.</p></td></tr></tbody></table><h3 class="da-h3" id="1191657">Connect Services with Virtual Network Peering</h3><p>You can use virtual network peering to directly connect Azure virtual networks. When you use peering to connect virtual networks, virtual machines (VMs) in these networks can communicate with each other as if they were in the same network.</p><p>In peered virtual networks, traffic between virtual machines is routed through the Azure network. The traffic uses only private IP addresses. It doesn't rely on internet connectivity, gateways, or encrypted connections. The traffic is always private, and it takes advantage of the high bandwidth and low latency of the Azure backbone network.</p><p><span><img alt="" src="../Images/1192375-490513.png" width="" height="" /></span></p><p>The two types of peering connections are created in the same way:</p><ul class="square"><li class="square"><p><b>Virtual network peering</b> connects virtual networks in the same Azure region, such as two virtual networks in North Europe.</p></li><li class="square"><p><b>Global virtual network peering</b> connects virtual networks that are in different Azure regions, such as a virtual network in North Europe and a virtual network in West Europe.</p></li></ul><p>Virtual network peering doesn't affect or disrupt any resources that you've already deployed to the virtual networks. But when you use virtual network peering, consider the key features that the following sections define.</p><p><b>Reciprocal connections</b></p><p>When you create a virtual network peering connection in only one virtual network to connect to a peer in another network, you're not connecting the networks together. To connect the networks by using virtual network peering, you have to create connections in each virtual network.</p><p>Think of how you connect two network switches together. You connect a cable to each switch and maybe configure some settings so that the switches can communicate. Virtual network peering requires similar connections in each virtual network. Reciprocal connections provide this functionality.</p><p><b>Cross-subscription virtual network peering</b></p><p>You can use virtual network peering even when both virtual networks are in different subscriptions. This might be necessary for mergers and acquisitions or to connect virtual networks in subscriptions that different departments manage. Virtual networks can be in different subscriptions, and the subscriptions can use the same or different Azure Active Directory tenants.</p><p>When you use virtual network peering across subscriptions, you might find that an administrator of one subscription doesn't administer the peer network's subscription. The administrator might not be able to configure both ends of the connection. To peer the virtual networks when both subscriptions are in different Azure Active Directory tenants, the administrators of each subscription must grant the peer subscription's administrator the Network Contributor role on their virtual network.</p><h3 class="da-h3" id="1191654">Azure Virtual Networking</h3><p><span><img alt="" src="../Images/1192021-490159.png" width="" height="" /></span></p><p>The first thing you should think about isn't the virtual machine - it's the network.</p><p>Virtual networks (VNets) are used in Azure to provide private connectivity between Azure Virtual Machines and other Azure services. VMs and services that are part of the same virtual network can access one another. By default, services outside the virtual network cannot connect to services within the virtual network. You can, however, configure the network to allow access to the external service, including your on-premises servers.</p><p>This latter point is why you should spend some time thinking about your network configuration. Network addresses and subnets are not trivial to change once you have them set up, and if you plan to connect your private company network to the Azure services, you will want to make sure you consider the topology before putting any VMs into place.</p><p>Azure Virtual Network (VNet) is the fundamental building block for your private network in Azure. VNet enables many types of Azure resources, such as Azure Virtual Machines (VM), to securely communicate with each other, the internet, and on-premises networks. VNet is similar to a traditional network that you'd operate in your own data center, but brings with it additional benefits of Azure's infrastructure such as scale, availability, and isolation.</p><h4 class="da-h4">VNet concepts</h4><ul class="square"><li class="square"><p><b>Address space</b>: When creating a VNet, you must specify a custom private IP address space using public and private (RFC 1918) addresses. Azure assigns resources in a virtual network a private IP address from the address space that you assign. For example, if you deploy a VM in a VNet with address space, 10.0.0.0/16, the VM will be assigned a private IP like 10.0.0.4.</p></li><li class="square"><p><b>Subnets</b>: Subnets enable you to segment the virtual network into one or more sub-networks and allocate a portion of the virtual network's address space to each subnet. You can then deploy Azure resources in a specific subnet. Just like in a traditional network, subnets allow you to segment your VNet address space into segments that are appropriate for the organization's internal network. This also improves address allocation efficiency. You can secure resources within subnets using Network Security Groups.</p></li><li class="square"><p><b>Regions</b>: VNet is scoped to a single region/location; however, multiple virtual networks from different regions can be connected together using Virtual Network Peering. You can also use a VPN gateway to send traffic between VNets.</p></li></ul><p><span><img alt="" src="../Images/1192022-490160.png" width="" height="" /></span></p><ul class="square"><li class="square"><p><b>Subscription</b>: VNet is scoped to a subscription. You can implement multiple virtual networks within each Azure subscription and Azure region.</p></li></ul><h4 class="da-h4">Best practices</h4><p>As you build your network in Azure, it is important to keep in mind the following universal design principles:</p><ul class="square"><li class="square"><p>Ensure non-overlapping address spaces. Make sure your VNet address space (CIDR block) does not overlap with your organization's other network ranges.</p></li><li class="square"><p>Your subnets should not cover the entire address space of the VNet. Plan ahead and reserve some address space for the future.</p></li><li class="square"><p>It is recommended you have fewer large VNets than multiple small VNets. This will prevent management overhead.</p></li><li class="square"><p>Secure your VNet's by assigning Network Security Groups (NSGs) to the subnets beneath them.</p></li></ul><h4 class="da-h4">Communicate with the internet</h4><p>All resources in a VNet can communicate outbound to the internet, by default. You can communicate inbound to a resource by assigning a public IP address or a public Load Balancer. You can also use public IP or public Load Balancer to manage your outbound connections.</p><p>✔️  <b>Note:</b> When using only an internal Standard Load Balancer, outbound connectivity is not available until you define how you want outbound connections to work with an instance-level public IP or a public Load Balancer.</p><h4 class="da-h4">Communicate between Azure resources</h4><p>Azure resources communicate securely with each other in one of the following ways:</p><ul class="square"><li class="square"><p><b>Through a virtual network</b>: You can deploy VMs, and several other types of Azure resources to a virtual network, such as Azure App Service Environments, the Azure Kubernetes Service (AKS), and Azure Virtual Machine Scale Sets.</p></li><li class="square"><p><b>Through a virtual network service endpoint</b>: Extend your virtual network private address space and the identity of your virtual network to Azure service resources, such as Azure Storage accounts and Azure SQL databases, over a direct connection. Service endpoints allow you to secure your critical Azure service resources to only a virtual network.</p></li><li class="square"><p><b>Through VNet Peering</b>: You can connect virtual networks to each other, enabling resources in either virtual network to communicate with each other, using virtual network peering. The virtual networks you connect can be in the same, or different, Azure regions.</p></li><li class="square"><p><b>Through Private Link</b>: You can access Azure PaaS Services (for example, Azure Storage and SQL Database) and Azure hosted customer-owned/partner services over a private endpoint in a virtual network.</p></li></ul><h4 class="da-h4">Communicate with on-premises resources</h4><p>You can connect your on-premises computers and networks to a virtual network using any combination of the following options:</p><ul class="square"><li class="square"><p><b>Point-to-site virtual private network (P2S VPN)</b>: Established between a virtual network and a single computer in your network. Each computer that wants to establish connectivity with a virtual network must configure its connection. This connection type is great if you're just getting started with Azure, or for developers, because it requires little or no changes to your existing network. The communication between your computer and a virtual network is sent through an encrypted tunnel over the internet.</p></li><li class="square"><p><b>Site-to-site VPN (S2S VPN)</b>: Established between your on-premises VPN device and an Azure VPN Gateway that is deployed in a virtual network. This connection type enables any on-premises resource that you authorize to access a virtual network. The communication between your on-premises VPN device and an Azure VPN gateway is sent through an encrypted tunnel over the internet.</p></li><li class="square"><p><b>Azure ExpressRoute</b>: Established between your network and Azure, through an ExpressRoute partner. This connection is private. Traffic does not go over the internet.</p></li></ul><h4 class="da-h4">Filter network traffic</h4><p>You can filter network traffic between subnets using either or both of the following options:</p><ul class="square"><li class="square"><p><b>Network Security groups (NSGs)</b>: Network security groups and application security groups can contain multiple inbound and outbound security rules that enable you to filter traffic to and from resources by source and destination IP address, port, and protocol.</p></li><li class="square"><p><b>Network virtual appliances (NVA)</b>: A network virtual appliance (NVA) is a VM that performs a network function, such as a firewall, WAN optimization, or other network function.</p></li></ul><h4 class="da-h4">Route network traffic</h4><p>Azure routes traffic between subnets, connected virtual networks, on-premises networks, and the Internet, by default. You can implement either or both of the following options to override the default routes Azure creates:</p><ul class="square"><li class="square"><p><b>Route tables</b>: You can create custom route tables with routes that control where traffic is routed to for each subnet.</p></li><li class="square"><p><b>Border gateway protocol (BGP) routes</b>: If you connect your virtual network to your on-premises network using an Azure VPN Gateway or ExpressRoute connection, you can propagate your on-premises BGP routes to your virtual networks.</p></li></ul><h4 class="da-h4">Virtual network integration for Azure services</h4><p>Integrating Azure services to an Azure virtual network enables private access to the service from virtual machines or compute resources in the virtual network. You can integrate Azure services in your virtual network with the following options:</p><ul class="square"><li class="square"><p>Deploying <b>dedicated instances of the service</b> into a virtual network. The services can then be privately accessed within the virtual network and from on-premises networks.</p></li><li class="square"><p>Using <b>Private Link</b> to access privately a specific instance of the service from your virtual network and from on-premises networks.</p></li><li class="square"><p>You can also access the service using public endpoints by extending a virtual network to the service, through <b>service endpoints</b>. Service endpoints allow service resources to be secured to the virtual network.</p></li></ul><h3 class="da-h3" id="1191710">Web Application Firewall Overview</h3><p>Web Application Firewall (WAF) provides centralized protection of your web applications from common exploits and vulnerabilities. Web applications are increasingly targeted by malicious attacks that exploit commonly known vulnerabilities. SQL injection and cross-site scripting are among the most common attacks.</p><p><span><img alt="" src="../Images/1192342-490480.png" width="" height="" /></span></p><p>Preventing such attacks in application code is challenging. It can require rigorous maintenance, patching, and monitoring at multiple layers of the application topology. A centralized web application firewall helps make security management much simpler. A WAF also gives application administrators better assurance of protection against threats and intrusions.</p><p>A WAF solution can react to a security threat faster by centrally patching a known vulnerability, instead of securing each individual web application.</p><h4 class="da-h4">Supported service</h4><p>WAF can be deployed with Azure Application Gateway, Azure Front Door, and Azure Content Delivery Network (CDN) service from Microsoft. WAF on Azure CDN is currently under public preview.</p><h3 class="da-h3" id="1191744">Blob Access Tiers</h3><p>Azure Storage provides different options for accessing block blob data (as shown in the screenshot), based on usage patterns. Each access tier in Azure Storage is optimized for a particular pattern of data usage. By selecting the correct access tier for your needs, you can store your block blob data in the most cost-effective manner.</p><p><span><img alt="" src="../Images/1192300-490438.png" width="" height="" /></span></p><ul class="square"><li class="square"><p><b>Hot</b>. The Hot tier is optimized for frequent access of objects in the storage account. Accessing data in the Hot tier is most cost-effective, while storage costs are somewhat higher. New storage accounts are created in the Hot tier by default.</p></li><li class="square"><p><b>Cool</b>. The Cool tier is optimized for storing large amounts of data that is infrequently accessed and stored for at least 30 days. Storing data in the Cool tier is more cost-effective, but accessing that data may be somewhat more expensive than accessing data in the Hot tier.</p></li><li class="square"><p><b>Archive</b>. The Archive tier is optimized for data that can tolerate several hours of retrieval latency and will remain in the Archive tier for at least 180 days. The Archive tier is the most cost-effective option for storing data, but accessing that data is more expensive than accessing data in the Hot or Cool tiers.</p></li></ul><p>✔️ If there is a change in the usage pattern of your data, you can switch between these access tiers at any time.</p><h3 class="da-h3" id="1191806">Overview of Resource Manager Templates</h3><p>Azure Resource Manager is the interface for managing and organizing cloud resources. Think of Resource Manager as a way to deploy cloud resources.</p><p>If you're familiar with Azure resource groups, you know that they enable you to treat sets of related resources as a single unit. Resource Manager is what organizes the resource groups that let you deploy, manage, and delete all of the resources together in a single action.</p><p>With Resource Manager, you deploy  assets into the same resource group and manage and monitor them together. When you're done, you can delete all of the resources in a resource group in one operation.</p><p><b>What are Resource Manager templates?</b></p><p>A Resource Manager template precisely defines all the Resource Manager resources in a deployment. You can deploy a Resource Manager template into a resource group as a single operation.</p><p>A Resource Manager template is a JSON file, making it a form of declarative automation. Declarative automation means that you define what resources you need but not how to create them. Put another way, you define what you need, and it is Resource Manager's responsibility to ensure that resources are deployed correctly.</p><p>You can think of declarative automation similar to how web browsers display HTML files. The HTML file describes what elements appear on the page, but doesn't describe how to display them. The “how” is the web browser's responsibility.</p><p><b>Template design</b></p><p>How you define templates and resource groups is entirely up to you and how you want to manage your solution. For example, you can deploy your three-tier application through a single template to a single resource group.</p><p><span><img alt="" src="../Images/1192047-490185.png" width="" height="" /></span></p><p>But, you don't have to define your entire infrastructure in a single template. Often, it makes sense to divide your deployment requirements into a set of targeted, purpose-specific templates. You can easily reuse these templates for different solutions. To deploy a solution, you create a master template that links all the required templates. The following image shows how to deploy a three-tier solution through a parent template that includes three nested templates.</p><p><span><img alt="" src="../Images/1192048-490186.png" width="" height="" /></span></p><p>If you envision your tiers having separate lifecycles, you can deploy your three tiers to separate resource groups. Notice the resources can still be linked to resources in other resource groups.</p><p><span><img alt="" src="../Images/1192049-490187.png" width="" height="" /></span></p><h3 class="da-h3" id="1191799">Demonstration - Create an Azure SQL Database Managed Instance</h3><p>This demonstration walks you through how to create an Azure SQL Database managed instance in Azure portal.</p><p>Sign in to <a href="https://portal.azure.com/" title="" target="_blank">Azure portal</a>.</p><h4 class="da-h4">Create a managed instance</h4><p>The following steps show you how to create a managed instance:</p><ol class="number"><li><p>Select <b>Azure SQL</b> on the left menu of Azure portal. If <b>Azure SQL</b> is not in the list, select <b>All services</b>, and then enter <i>Azure SQL</i> in the search box.</p></li><li><p>Select <b>+Add</b> to open the <b>Select SQL deployment option</b> page. You can view additional information about an Azure SQL Database managed instance by selecting <b>Show details</b> on the <b>Managed instances</b> tile.</p></li><li><p>Select <b>Create</b>.</p></li></ol><p><span><img alt="" src="../Images/1192082-490220.png" width="" height="" /></span></p><ol class="number"><li value="4"><p>Use the tabs on the <b>Create Azure SQL Database Managed Instance</b> provisioning form to add required and optional information. The following sections describe these tabs.</p></li></ol><h4 class="da-h4">Basics</h4><ul class="square"><li class="square"><p>Fill out mandatory information required on the <b>Basics</b> tab.</p></li></ul><p><span><img alt="" src="../Images/1192083-490221.png" width="" height="" /></span></p><p>Use the table below as a reference for information required at this tab.</p><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p><b>Setting</b></p></td><td><p><b>Suggested value</b></p></td><td><p><b>Description</b> </p></td></tr></thead><tbody><tr><td><p><b>Virtual network</b></p></td><td><p>Select either Create new virtual network or a valid virtual network and subnet.</p></td><td><p>If a network or subnet is unavailable, it must be modified to satisfy the network requirements before you select it as a target for the new managed instance. For information about the requirements for configuring the network environment for a managed instance, see Configure a virtual network for a managed instance.</p></td></tr><tr><td><p><b>Connection type</b></p></td><td><p>Choose between a proxy and a redirect connection type.</p></td><td><p>For more information about connection types, see Azure SQL Database connection policy.</p></td></tr><tr><td><p><b>Public endpoint</b></p></td><td><p>Select Enable.</p></td><td><p>For a managed instance to be accessible through the public data endpoint, you need to enable this option.</p></td></tr><tr><td><p><b>Allow access from (if Public endpoint is enabled)</b></p></td><td><p>Select one of the options.</p></td><td><p>The portal experience enables configuring a security group with a public endpoint. <br /></p></td></tr></tbody></table><ul class="square"><li class="square"><p>Select <b>Configure Managed Instance</b> to size compute and storage resources and to review the pricing tiers. Use the sliders or text boxes to specify the amount of storage and the number of virtual cores. When you're finished, select <b>Apply</b> to save your selection.</p></li></ul><p><span><img alt="" src="../Images/1192084-490222.png" width="" height="" /></span></p><ul class="square"><li class="square"><p>To review your choices before you create a managed instance, you can select <b>Review + create</b>. Or, configure networking options by selecting <b>Next: Networking</b>.</p></li></ul><h4 class="da-h4">Networking</h4><ul class="square"><li class="square"><p>Fill out optional information on the <b>Networking</b> tab. If you omit this information, the portal will apply default settings.</p></li></ul><p><span><img alt="" src="../Images/1192085-490223.png" width="" height="" /></span></p><p>Use the table below as a reference for information required at this tab.</p><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p><b>Setting</b></p></td><td><p><b>Suggested value</b></p></td><td><p><b>Description</b> </p></td></tr></thead><tbody><tr><td><p><b>Virtual network</b></p></td><td><p>Select either Create new virtual network or a valid virtual network and subnet.</p></td><td><p>If a network or subnet is unavailable, it must be modified to satisfy the network requirements before you select it as a target for the new managed instance. For information about the requirements for configuring the network environment for a managed instance, see Configure a virtual network for a managed instance.</p></td></tr><tr><td><p><b>Connection type</b></p></td><td><p>Choose between a proxy and a redirect connection type.</p></td><td><p>For more information about connection types, see Azure SQL Database connection policy.</p></td></tr><tr><td><p><b>Public endpoint</b></p></td><td><p>Select Enable.</p></td><td><p>For a managed instance to be accessible through the public data endpoint, you need to enable this option.</p></td></tr><tr><td><p><b>Allow access from (if Public endpoint is enabled)</b></p></td><td><p>Select one of the options.</p></td><td><p>The portal experience enables configuring a security group with a public endpoint. <br /></p></td></tr></tbody></table><ul class="square"><li class="square"><p>Select <b>Review + create</b> to review your choices before you create a managed instance. Or, configure more custom settings by selecting <b>Next: Additional settings</b>.</p></li></ul><h4 class="da-h4">Additional settings</h4><ul class="square"><li class="square"><p>Fill out optional information on the <b>Additional settings</b> tab. If you omit this information, the portal will apply default settings.</p></li></ul><p><span><img alt="" src="../Images/1192086-490224.png" width="" height="" /></span></p><p>Use the table below as a reference for information required at this tab.</p><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p><b>Setting</b></p></td><td><p><b>Suggested value</b></p></td><td><p><b>Description</b> </p></td></tr></thead><tbody><tr><td><p><b>Collation</b></p></td><td><p>Choose the collation that you want to use for your managed instance. If you migrate databases from SQL Server, check the source collation by using SELECT SERVERPROPERTY(N'Collation') and use that value.</p></td><td><p>For information about collations, see Set or change the server collation.</p></td></tr><tr><td><p><b>Time zone</b></p></td><td><p>Select the time zone that your managed instance will observe.</p></td><td><p>For more information, see Time zones.</p></td></tr><tr><td><p><b>Use as failover secondary</b></p></td><td><p>Select Yes.</p></td><td><p>Enable this option to use the managed instance as a failover group secondary.</p></td></tr><tr><td><p><b>Primary managed instance (if Use as failover secondary is set to Yes)</b></p></td><td><p>Choose an existing primary managed instance that will be joined in the same DNS zone with the managed instance you're creating.</p></td><td><p>This step will enable post-creation configuration of the failover group.</p></td></tr></tbody></table><h4 class="da-h4">Review + create</h4><ol class="number"><li value="5"><p>Select <b>Review + create</b> tab to review your choices before you create the managed instance.</p></li></ol><p><span><img alt="" src="../Images/1192087-490225.png" width="" height="" /></span></p><ol class="number"><li value="6"><p>Select <b>Create</b> to start provisioning the managed instance.</p></li></ol><h3 class="da-h3" id="1191807">What's in a Resource Manager Template</h3><p>Below are code examples to give you a sense of how each section of the template is structured.</p><p>You use JSON to send data between servers and web applications. JSON is also a way to describe how applications and infrastructure are configured.</p><p>JSON allows us to express data stored as an object (such as a virtual machine) in text. A JSON document is essentially a collection of key-value pairs.</p><p>Each key is a string; its value can be a string, a number, a Boolean expression, a list of values, or an object (which is a collection of other key-value pairs).</p><p>A Resource Manager template can contain the following sections. These sections are expressed using JSON notation but are not related to the JSON language itself.</p><div class="code language-JSON"><p class="da-divtext"><code><span class="token punctuation">{</span>
    <span class="token property">"$schema"</span><span class="token operator">:</span> <span class="token string">"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"</span><span class="token punctuation">,</span>
    <span class="token property">"contentVersion"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
    <span class="token property">"parameters"</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"variables"</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"functions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"resources"</span><span class="token operator">:</span> <span class="token punctuation">[</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"outputs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></p></div><p><b>Parameters</b></p><p>Parameters specify which values are configurable when the template runs.</p><p>Below is an example that illustrates two parameters – one for a VM's username and one for its password.</p><div class="code language-JSON"><p class="da-divtext"><code><span class="token property">"parameters"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"adminUsername"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
    <span class="token property">"metadata"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Username for the Virtual Machine."</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"adminPassword"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"securestring"</span><span class="token punctuation">,</span>
    <span class="token property">"metadata"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Password for the Virtual Machine."</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></p></div><p><b>Variables</b></p><p>Variables define values used throughout the template. For example, you can define a storage account name one time as a variable and use that variable throughout the template. If the storage account name changes, you need to only update the variable.</p><p>Below is an example that illustrates a few variables that describe networking features for a VM.</p><div class="code language-JSON"><p class="da-divtext"><code><span class="token property">"variables"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"nicName"</span><span class="token operator">:</span> <span class="token string">"myVMNic"</span><span class="token punctuation">,</span>
  <span class="token property">"addressPrefix"</span><span class="token operator">:</span> <span class="token string">"10.0.0.0/16"</span><span class="token punctuation">,</span>
  <span class="token property">"subnetName"</span><span class="token operator">:</span> <span class="token string">"Subnet"</span><span class="token punctuation">,</span>
  <span class="token property">"subnetPrefix"</span><span class="token operator">:</span> <span class="token string">"10.0.0.0/24"</span><span class="token punctuation">,</span>
  <span class="token property">"publicIPAddressName"</span><span class="token operator">:</span> <span class="token string">"myPublicIP"</span><span class="token punctuation">,</span>
  <span class="token property">"virtualNetworkName"</span><span class="token operator">:</span> <span class="token string">"MyVNET"</span>
<span class="token punctuation">}</span></code></p></div><p><b>Functions</b></p><p>Functions define procedures that you don't want to repeat throughout the template. Below is an example that creates a function to create a unique name that could be used when creating resources that have globally unique naming requirements.</p><div class="code language-JSON"><p class="da-divtext"><code><span class="token property">"functions"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">"namespace"</span><span class="token operator">:</span> <span class="token string">"contoso"</span><span class="token punctuation">,</span>
    <span class="token property">"members"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"uniqueName"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"parameters"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"namePrefix"</span><span class="token punctuation">,</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"output"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
          <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"[concat(toLower(parameters('namePrefix')), uniqueString(resourceGroup().id))]"</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span></code></p></div><p><b>Resources</b></p><p>This section is where you define the Azure resources that make up your deployment.</p><p>Below is an example that creates a public IP address resource.</p><div class="code language-JSON"><p class="da-divtext"><code><span class="token property">"resources"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
<span class="token punctuation">{</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Microsoft.Network/publicIPAddresses"</span><span class="token punctuation">,</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"[variables('publicIPAddressName')]"</span><span class="token punctuation">,</span>
  <span class="token property">"location"</span><span class="token operator">:</span> <span class="token string">"[parameters('location')]"</span><span class="token punctuation">,</span>
  <span class="token property">"apiVersion"</span><span class="token operator">:</span> <span class="token string">"2018-08-01"</span><span class="token punctuation">,</span>
  <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"publicIPAllocationMethod"</span><span class="token operator">:</span> <span class="token string">"Dynamic"</span><span class="token punctuation">,</span>
    <span class="token property">"dnsSettings"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"domainNameLabel"</span><span class="token operator">:</span> <span class="token string">"[parameters('dnsLabelPrefix')]"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span></code></p></div><p>In the above sample, the type of resource is <span class="code">Microsoft.Network/publicIPAddresses</span>. Its name is read from the variables section and its location, or Azure region, is read from the parameters section.</p><p>Because resource types can change over time, <span class="code">apiVersion</span> refers to the version of the resource type you want to use. As resource types evolve and change, you can modify your templates to work with the latest features when you're ready.</p><p><b>Outputs</b></p><p>Outputs define any information you'd like to receive when the template runs.</p><p>Below is an example that illustrates an output named “hostname”. The FQDN value is read from the VM's public IP address settings.</p><div class="code language-JSON"><p class="da-divtext"><code><span class="token property">"outputs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"hostname"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
    <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"[reference(variables('publicIPAddressName')).dnsSettings.fqdn]"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></p></div><h3 class="da-h3" id="1191843">Azure Blueprints</h3><p>Azure Blueprints enables cloud architects and central information technology groups to define a repeatable set of Azure resources that implements and adheres to an organization's standards, patterns, and requirements.</p><p>Azure Blueprints makes it possible for development teams to rapidly build and deploy new environments with the trust they're building within organizational compliance using a set of built-in components, such as networking, to speed up development and delivery.</p><p><span><img alt="" src="../Images/1192418-490556.png" width="" height="" /></span></p><p>Azure Blueprints is a declarative way to orchestrate the deployment of various resource templates and other artifacts, such as:</p><ul class="square"><li class="square"><p>Role assignments</p></li><li class="square"><p>Policy assignments</p></li><li class="square"><p>Azure Resource Manager templates</p></li><li class="square"><p>Resource groups</p></li></ul><p>Azure Blueprints are also useful in Azure DevOps scenarios, where blueprints are associated with specific build artifacts and release pipelines and can be tracked more rigorously.</p><p>The process of implementing Azure Blueprint consists of the following high-level steps:</p><ol class="number"><li><p>Create an Azure Blueprint</p></li><li><p>Assign the blueprint</p></li><li><p>Track the blueprint assignments</p></li></ol><p>With Azure Blueprint, the relationship between the blueprint definition (what <i>should be</i> deployed) and the blueprint assignment (what <i>was</i> deployed) is preserved. This connection supports improved deployment tracking and auditing.</p><p>The Azure Blueprints service is backed by the globally distributed Azure Cosmos database. Blueprint objects are replicated to multiple Azure regions. This replication provides low latency, high availability, and consistent access to your blueprint objects, regardless of which region Blueprints deploys your resources to.</p><h4 class="da-h4">How is it different from Resource Manager templates?</h4><p>The Azure Blueprints service is designed to help with environment setup. This setup often consists of a set of resource groups, policies, role assignments, and Resource Manager template deployments. A blueprint is a package to bring each of these artifact types together and allow you to compose and version that package—including through a CI/CD pipeline. Ultimately, each setup is assigned to a subscription in a single operation that can be audited and tracked.</p><p>Nearly everything that you want to include for deployment in Blueprints can be accomplished with a Resource Manager template. However, a Resource Manager template is a document that doesn't exist natively in Azure. Resource Manager templates are stored either locally or in source control. The template gets used for deployments of one or more Azure resources, but once those resources deploy there's no active connection or relationship to the template.</p><p>With Blueprints, the relationship between the blueprint definition (what should be deployed) and the blueprint assignment (what was deployed) is preserved. This connection supports improved tracking and auditing of deployments. Blueprints can also upgrade several subscriptions at once that are governed by the same blueprint.</p><p>Each blueprint can consist of zero or more Resource Manager template artifacts. This support means that previous efforts to develop and maintain a library of Resource Manager templates are reusable in Blueprints.</p><h4 class="da-h4">How it's different from Azure Policy</h4><p>A blueprint is a package or container for composing focus-specific sets of standards, patterns, and requirements related to the implementation of Azure cloud services, security, and design that can be reused to maintain consistency and compliance.</p><p>A policy is a default-allow and explicit-deny system focused on resource properties during deployment and for already existing resources. It supports cloud governance by validating that resources within a subscription adhere to requirements and standards.</p><p>Including a policy in a blueprint enables the creation of the right pattern or design during assignment of the blueprint. The policy inclusion makes sure that only approved or expected changes can be made to the environment to protect ongoing compliance to the intent of the blueprint.</p><p>A policy can be included as one of many artifacts in a blueprint definition. Blueprints also support using parameters with policies and initiatives.</p><h3 class="da-h3" id="1191803">Module 8 Review Questions</h3><p><span><img alt="" src="../Images/1192029-490167.png" width="" height="" /></span></p><h4 class="problem">Review Question 1</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-040382dc-150e-1f49-cb7f-9ef6eb8c6711"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You are advising a auto parts company that has the following:<br /></p><ul class="square"><li class="square"><p>OEMDabaBase_1: Microsoft SQL Server</p></li><li class="square"><p>OEMDabaBase_2: Microsoft SQL Server</p></li><li class="square"><p>OEMApplication_1: Uses data from both databases listed above</p></li></ul><p>
The company wants to move both databases to Azure and they are asking for recommendations for services needed to host in Azure.<br />
Also, the recommendation must include support for server-side transactions between the two databases.<br />
You recommend they deploy both databases as Azure SQL Databases on the same Azure SQL Database server.<br />
Is this the right solution?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q040382dc-150e-1f49-cb7f-9ef6eb8c6711" value="1" />Yes<br /></label></li><li><label><input type="radio" name="q040382dc-150e-1f49-cb7f-9ef6eb8c6711" value="2" />No<br /></label></li></ul></div></div><div id="feedback-problem-040382dc-150e-1f49-cb7f-9ef6eb8c6711" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">No. You should deploy both databases (OEMDabaBase_1 and OEMDabaBase_2) to an Azure SQL managed instance.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 2</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-cf565057-ea62-93a7-ec29-f04ff35f670d"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You are advising a auto parts company that has the following:<br /></p><ul class="square"><li class="square"><p>OEMDabaBase_1: Microsoft SQL Server</p></li><li class="square"><p>OEMDabaBase_2: Microsoft SQL Server</p></li><li class="square"><p>OEMApplication_1: Uses data from both databases listed above</p></li></ul><p>
The company wants to move both databases to Azure and they are asking for recommendations for services needed to host in Azure.<br />
Also, the recommendation must include support for server-side transactions between the two databases.<br />
You recommend they deploy both databases (OEMDabaBase_1 and OEMDabaBase_2) to sQL Server on an Azure VM.<br />
Is this the right solution?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="qcf565057-ea62-93a7-ec29-f04ff35f670d" value="1" />Yes<br /></label></li><li><label><input type="radio" name="qcf565057-ea62-93a7-ec29-f04ff35f670d" value="2" />No<br /></label></li></ul></div></div><div id="feedback-problem-cf565057-ea62-93a7-ec29-f04ff35f670d" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Yes. You should deploy both databases (OEMDabaBase_1 and OEMDabaBase_2) to an Azure SQL managed instance.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 3</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-b341b2bd-64e4-41ae-3c07-f3f17f28f2b6"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You are advising an auto parts company that is running the following Azure SQL Database servers:<br />
OEM_SQLSvr_1:<br /></p><ul class="square"><li class="square"><p>Resource Group: Resource_Group_1</p></li><li class="square"><p>Location: East US</p></li></ul><p>
OEM_SQLSvr_2:<br /></p><ul class="square"><li class="square"><p>Resource Group: Resource_Group_1</p></li><li class="square"><p>Location: East US</p></li></ul><p>
OEM_SQLSvr_3:<br /></p><ul class="square"><li class="square"><p>Resource Group: Resource_Group_1</p></li><li class="square"><p>Location: North Europe</p></li></ul><p>
OEM_SQLSvr_4:<br /></p><ul class="square"><li class="square"><p>Resource Group: Resource_Group_2</p></li><li class="square"><p>Location: North Europe</p></li></ul><p>
The plan to make OEM_SQLSvr_1 as the primary server within a failover group.<br />
Which server should you recommend as the secondary server?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="qb341b2bd-64e4-41ae-3c07-f3f17f28f2b6" value="1" />OEM_SQLSvr_3 and OEM_SQLSvr_4<br /></label></li><li><label><input type="radio" name="qb341b2bd-64e4-41ae-3c07-f3f17f28f2b6" value="2" />OEM_SQLSvr_2 and OEM_SQLSvr_3<br /></label></li><li><label><input type="radio" name="qb341b2bd-64e4-41ae-3c07-f3f17f28f2b6" value="3" />OEM_SQLSvr_2 and OEM_SQLSvr_4<br /></label></li></ul></div></div><div id="feedback-problem-b341b2bd-64e4-41ae-3c07-f3f17f28f2b6" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct answer: OEM_SQLSvr_3 and OEM_SQLSvr_4. OEM_SQLSvr_1 is located in East US, and both OEM_SQLSvr_3 and OEM_SQLSvr_4 are located in North Europe.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h3 class="da-h3" id="1191798">Azure SQL Database Managed Instance</h3><p>Managed instance is a new deployment option of Azure SQL Database, providing near 100% compatibility with the latest SQL Server on-premises (Enterprise Edition) Database Engine, providing a native virtual network (VNet) implementation that addresses common security concerns, and a business model favorable for on-premises SQL Server customers. The managed instance deployment model allows existing SQL Server customers to lift and shift their on-premises applications to the cloud with minimal application and database changes.</p><p>The following diagram outlines key features of managed instances:</p><p><span><img alt="" src="../Images/1192389-490527.png" width="" height="" /></span></p><p>The managed instance deployment model is designed for customers looking to migrate a large number of apps from on-premises or IaaS, self-built, or ISV provided environment to fully managed PaaS cloud environment, with as low migration effort as possible. Using the fully automated Data Migration Service (DMS) in Azure, customers can lift and shift their on-premises SQL Server to a managed instance that offers compatibility with SQL Server on-premises and complete isolation of customer instances with native VNet support.</p><p>The managed instance deployment option aims delivers close to 100% surface area compatibility with the latest on-premises SQL Server version through a staged release plan.</p><h4 class="da-h4">Features and capabilities</h4><p>Managed instance combines the best features that are available both in Azure SQL Database and SQL Server Database Engine.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p><b>PaaS benefits</b></p></td><td><p><b>Business continuity</b></p></td></tr></thead><tbody><tr><td><p>No hardware purchasing and management <br />No management overhead for managing underlying infrastructure <br />Quick provisioning and service scaling <br />Automated patching and version upgrade <br />Integration with other PaaS data services</p></td><td><p>99.99% uptime SLA  <br />Built in high-availability <br />Data protected with automated backup. Customer configurable backup retention period <br />User-initiated backups <br />Point in time database restore capability</p></td></tr></tbody></table><p>The key features of managed instances are shown in the following table:</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Feature</p></td><td><p>Description</p></td></tr></thead><tbody><tr><td><p>SQL Server version / build</p></td><td><p>SQL Server Database Engine (latest stable)</p></td></tr><tr><td><p>Managed automated backups</p></td><td><p>Yes</p></td></tr><tr><td><p>Built-in instance and database monitoring and metrics</p></td><td><p>Yes</p></td></tr><tr><td><p>Automatic software patching</p></td><td><p>Yes</p></td></tr><tr><td><p>The latest Database Engine features</p></td><td><p>Yes</p></td></tr><tr><td><p>Number of data files (ROWS) per the database</p></td><td><p>Multiple</p></td></tr><tr><td><p>Number of log files (LOG) per database</p></td><td><p>1</p></td></tr><tr><td><p>VNet - Azure Resource Manager deployment</p></td><td><p>Yes</p></td></tr><tr><td><p>VNet - Classic deployment model</p></td><td><p>No</p></td></tr><tr><td><p>Portal support</p></td><td><p>Yes</p></td></tr><tr><td><p>Built-in Integration Service (SSIS)</p></td><td><p>No - SSIS is a part of Azure Data Factory PaaS</p></td></tr><tr><td><p>Built-in Analysis Service (SSAS)</p></td><td><p>No - SSAS is separate PaaS</p></td></tr><tr><td><p>Built-in Reporting Service (SSRS)</p></td><td><p>No - use Power BI paginated reports instead or host SSRS on Azure VM.</p></td></tr></tbody></table><h3 class="da-h3" id="1191821">Runbooks in Azure Automation</h3><p>Process automation in Azure Automation allows you to create and manage PowerShell, PowerShell Workflow, and graphical runbooks.</p><p>Automation executes your runbooks based on the logic defined inside them. If a runbook is interrupted, it restarts at the beginning. This behavior requires you to write runbooks that support being restarted if transient issues occur.</p><p>Starting a runbook in Azure Automation creates a job, which is a single execution instance of the runbook. Each job accesses Azure resources by making a connection to your Azure subscription. The job can only access resources in your data center if those resources are accessible from the public cloud.</p><p>Azure Automation assigns a worker to run each job during runbook execution. While workers are shared by many Azure accounts, jobs from different Automation accounts are isolated from one another. You can't control which worker services your job requests.</p><p>The following diagram shows the lifecycle of a runbook job for PowerShell runbooks, PowerShell Workflow runbooks, and graphical runbooks.</p><p><span><img alt="" src="../Images/1192372-490510.png" width="" height="" /></span></p><p><b>Where to run runbooks</b></p><p>Runbooks in Azure Automation can run on either an Azure sandbox or a Hybrid Runbook Worker. When runbooks are designed to authenticate and run against resources in Azure, they run in an Azure sandbox, which is a shared environment that multiple jobs can use. Jobs using the same sandbox are bound by the resource limitations of the sandbox.</p><p>You can use a Hybrid Runbook Worker to run runbooks directly on the computer that hosts the role and against local resources in the environment. Azure Automation stores and manages runbooks and then delivers them to one or more assigned computers.</p><p>The following table lists some runbook execution tasks with the recommended execution environment listed for each.</p><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p>Task</p></td><td><p>Recommendation</p></td><td><p>Notes</p></td></tr></thead><tbody><tr><td><p>Integrate with Azure resources</p></td><td><p>Azure Sandbox</p></td><td><p>Hosted in Azure, authentication is simpler. If you're using a Hybrid Runbook Worker on an Azure VM, you can use managed identities for Azure resources.</p></td></tr><tr><td><p>Obtain optimal performance to manage Azure resources</p></td><td><p>Azure Sandbox</p></td><td><p>Script is run in the same environment, which has less latency.</p></td></tr><tr><td><p>Minimize operational costs</p></td><td><p>Azure Sandbox</p></td><td><p>There is no compute overhead and no need for a VM.</p></td></tr><tr><td><p>Execute long-running script</p></td><td><p>Hybrid Runbook Worker</p></td><td><p>Azure sandboxes have resource limits.</p></td></tr><tr><td><p>Interact with local services</p></td><td><p>Hybrid Runbook Worker</p></td><td><p>Can directly access the host machine, or resources in other cloud environments, or in your on-premises environment.</p></td></tr><tr><td><p>Require third-party software and executables</p></td><td><p>Hybrid Runbook Worker</p></td><td><p>You manage the operating system and can install software.</p></td></tr><tr><td><p>Monitor a file or folder with a runbook</p></td><td><p>Hybrid Runbook Worker</p></td><td><p>Use a Watcher task on a Hybrid Runbook Worker.</p></td></tr><tr><td><p>Run a resource-intensive script</p></td><td><p>Hybrid Runbook Worker</p></td><td><p>Azure sandboxes have resource limits.</p></td></tr><tr><td><p>Use modules with specific requirements</p></td><td><p>Hybrid Runbook Worker</p></td><td><p>Some examples are:  WinSCP - dependency on winscp.exe   IIS administration - dependency on enabling or managing IIS.</p></td></tr><tr><td><p>Install a module with an installer</p></td><td><p>Hybrid Runbook Worker</p></td><td><p>Modules for sandbox must support copying.</p></td></tr><tr><td><p>Use runbooks or modules that require .NET Framework version different from 4.7.2</p></td><td><p>Hybrid Runbook Worker</p></td><td><p>Automation sandboxes support .NET Framework 4.7.2, and upgrading to a different version is not supported.</p></td></tr><tr><td><p>Run scripts that require elevation</p></td><td><p>Hybrid Runbook Worker</p></td><td><p>Sandboxes don't allow elevation. With a Hybrid Runbook Worker, you can turn off UAC and use Invoke-Command when running the command that requires elevation.</p></td></tr><tr><td><p>Run scripts that require access to Windows Management Instrumentation (WMI)</p></td><td><p>Hybrid Runbook Worker</p></td><td><p>Jobs running in sandboxes in the cloud can't access WMI provider.</p></td></tr></tbody></table><h3 class="da-h3" id="1191819">Deploy an Azure Resource Manager Template using CLI</h3><p>This topic is based upon the sample template for deploying an Azure Storage Account using CLI further below.</p><p>This topic and dives deeper into the underlying JSON demonstrated in the previous topic.</p><p><b>Create resource group</b></p><p>When you deploy a template, you specify a resource group that will contain the resources. Before running the deployment command, create the resource group with either Azure CLI or Azure PowerShell.</p><p>Use the following Azure CLI to specify a resource group.</p><div class="code language-Azure"><p class="da-divtext">echo "Enter a project name that is used to generate resource and resource group names:"
read projectName
resourceGroupName="${projectName}rg"

az group create \
  --name $resourceGroupName \
  --location "Central US"
</p></div><p><b>Deploy template</b></p><p>Use the following Azure CLI to deploy the template.</p><div class="code language-Azure"><p class="da-divtext">echo "Enter the same project name:"
read projectName
echo "Enter the template file path and file name:"
read templateFile
resourceGroupName="${projectName}rg"

az deployment group create \
  --name DeployLocalTemplate \
  --resource-group $resourceGroupName \
  --template-file $templateFile \
  --parameters projectName=$projectName \
  --verbose
</p></div><p><b>Sample deployment of an Azure storage account</b></p><p>Below is the JSON for demonstrating the creating a resource group and deploying a ARM template.</p><div class="code language-JSON"><p class="da-divtext"><code><span class="token punctuation">{</span>
 <span class="token property">"$schema"</span><span class="token operator">:</span> <span class="token string">"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"</span><span class="token punctuation">,</span>
 <span class="token property">"contentVersion"</span><span class="token operator">:</span> <span class="token string">"1.0.0.0"</span><span class="token punctuation">,</span>
 <span class="token property">"parameters"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token property">"projectName"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
     <span class="token property">"minLength"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
     <span class="token property">"maxLength"</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
     <span class="token property">"metadata"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Specify a project name that is used to generate resource names."</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token property">"location"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
     <span class="token property">"defaultValue"</span><span class="token operator">:</span> <span class="token string">"[resourceGroup().location]"</span><span class="token punctuation">,</span>
     <span class="token property">"metadata"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Specify a location for the resources."</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token property">"storageSKU"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
     <span class="token property">"defaultValue"</span><span class="token operator">:</span> <span class="token string">"Standard_LRS"</span><span class="token punctuation">,</span>
     <span class="token property">"allowedValues"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
       <span class="token string">"Standard_LRS"</span><span class="token punctuation">,</span>
       <span class="token string">"Standard_GRS"</span><span class="token punctuation">,</span>
       <span class="token string">"Standard_RAGRS"</span><span class="token punctuation">,</span>
       <span class="token string">"Standard_ZRS"</span><span class="token punctuation">,</span>
       <span class="token string">"Premium_LRS"</span><span class="token punctuation">,</span>
       <span class="token string">"Premium_ZRS"</span><span class="token punctuation">,</span>
       <span class="token string">"Standard_GZRS"</span><span class="token punctuation">,</span>
       <span class="token string">"Standard_RAGZRS"</span>
     <span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token property">"metadata"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Specify the storage account type."</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token property">"linuxFxVersion"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
     <span class="token property">"defaultValue"</span><span class="token operator">:</span> <span class="token string">"php|7.0"</span><span class="token punctuation">,</span>
     <span class="token property">"metadata"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Specify the Runtime stack of current web app"</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token property">"variables"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token property">"storageAccountName"</span><span class="token operator">:</span> <span class="token string">"[concat(parameters('projectName'), 'store')]"</span><span class="token punctuation">,</span>
   <span class="token property">"webAppName"</span><span class="token operator">:</span> <span class="token string">"[concat(parameters('projectName'), 'WebApp')]"</span><span class="token punctuation">,</span>
   <span class="token property">"appServicePlanName"</span><span class="token operator">:</span> <span class="token string">"[concat(parameters('projectName'), 'Plan')]"</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token property">"resources"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
   <span class="token punctuation">{</span>
     <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Microsoft.Storage/storageAccounts"</span><span class="token punctuation">,</span>
     <span class="token property">"apiVersion"</span><span class="token operator">:</span> <span class="token string">"2019-04-01"</span><span class="token punctuation">,</span>
     <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"[variables('storageAccountName')]"</span><span class="token punctuation">,</span>
     <span class="token property">"location"</span><span class="token operator">:</span> <span class="token string">"[parameters('location')]"</span><span class="token punctuation">,</span>
     <span class="token property">"sku"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"[parameters('storageSKU')]"</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"StorageV2"</span><span class="token punctuation">,</span>
     <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token property">"supportsHttpsTrafficOnly"</span><span class="token operator">:</span> <span class="token boolean">true</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span>
     <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Microsoft.Web/serverfarms"</span><span class="token punctuation">,</span>
     <span class="token property">"apiVersion"</span><span class="token operator">:</span> <span class="token string">"2016-09-01"</span><span class="token punctuation">,</span>
     <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"[variables('appServicePlanName')]"</span><span class="token punctuation">,</span>
     <span class="token property">"location"</span><span class="token operator">:</span> <span class="token string">"[parameters('location')]"</span><span class="token punctuation">,</span>
     <span class="token property">"sku"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"B1"</span><span class="token punctuation">,</span>
       <span class="token property">"tier"</span><span class="token operator">:</span> <span class="token string">"Basic"</span><span class="token punctuation">,</span>
       <span class="token property">"size"</span><span class="token operator">:</span> <span class="token string">"B1"</span><span class="token punctuation">,</span>
       <span class="token property">"family"</span><span class="token operator">:</span> <span class="token string">"B"</span><span class="token punctuation">,</span>
       <span class="token property">"capacity"</span><span class="token operator">:</span> <span class="token number">1</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"linux"</span><span class="token punctuation">,</span>
     <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token property">"perSiteScaling"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
       <span class="token property">"reserved"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
       <span class="token property">"targetWorkerCount"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
       <span class="token property">"targetWorkerSizeId"</span><span class="token operator">:</span> <span class="token number">0</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span>
     <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Microsoft.Web/sites"</span><span class="token punctuation">,</span>
     <span class="token property">"apiVersion"</span><span class="token operator">:</span> <span class="token string">"2018-11-01"</span><span class="token punctuation">,</span>
     <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"[variables('webAppName')]"</span><span class="token punctuation">,</span>
     <span class="token property">"location"</span><span class="token operator">:</span> <span class="token string">"[parameters('location')]"</span><span class="token punctuation">,</span>
     <span class="token property">"dependsOn"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
       <span class="token string">"[resourceId('Microsoft.Web/serverfarms', variables('appServicePlanName'))]"</span>
     <span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"app"</span><span class="token punctuation">,</span>
     <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token property">"serverFarmId"</span><span class="token operator">:</span> <span class="token string">"[resourceId('Microsoft.Web/serverfarms', variables('appServicePlanName'))]"</span><span class="token punctuation">,</span>
       <span class="token property">"siteConfig"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
         <span class="token property">"linuxFxVersion"</span><span class="token operator">:</span> <span class="token string">"[parameters('linuxFxVersion')]"</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">]</span><span class="token punctuation">,</span>
 <span class="token property">"outputs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
   <span class="token property">"storageEndpoint"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span>
     <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"[reference(variables('storageAccountName')).primaryEndpoints]"</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></p></div><h3 class="da-h3" id="1191769">Securing Storage Endpoints</h3><p>The steps necessary to restrict network access to Azure services varies across services. For accessing a storage account, you would use the <b>Firewalls and virtual networks</b> blade to add the virtual networks that will have access. Notice you can also configure to allow access to one or more public IP ranges.</p><p><span><img alt="" src="../Images/1192285-490423.png" width="" height="" /></span></p><ul class="square"><li class="square"><p>Firewalls and Virtual Networks allows for restricting access to the Storage Account from specific Subnets on Virtual Networks</p></li><li class="square"><p>Subnets and Virtual Networks must exist in the same Azure Region or Region Pair as the Storage Account</p></li></ul><p>✔️ It is important to test and ensure the service endpoint is limiting access as expected.</p><h3 class="da-h3" id="1191808">Azure Quickstart Templates</h3><p>Azure Quickstart templates are Resource Manager templates that are provided by the Azure community. Quickstart templates are available on GitHub.</p><p>To find a Resource Manager template that brings up a basic VM configuration, do the following.</p><ol class="number"><li><p>Browse the <a href="https://azure.microsoft.com/resources/templates?" title="" target="_blank">Quickstart template gallery </a>to see what's available.</p></li></ol><p><span><img alt="" src="../Images/1192213-490351.png" width="" height="" /></span></p><ol class="number"><li value="2"><p>Select a Deploy a simple Windows VM template.</p></li></ol><p><span><img alt="" src="../Images/1192214-490352.png" width="" height="" /></span></p><p>The Deploy to Azure button enables you to deploy the template directly through the Azure portal. Additionally, you can use the Azure CLI to deploy the template from Cloud Shell.</p><ol class="number"><li value="3"><p>Click <b>Browse</b> on GitHub to navigate to the template's source code on GitHub.</p></li></ol><p><span><img alt="" src="../Images/1192215-490353.png" width="" height="" /></span></p><ol class="number"><li value="4"><p>Click <b>Visualize</b> to navigate to the Azure Resource Manager Visualizer.</p></li></ol><p>You see the resources that make up the deployment, including a VM, a storage account, and network resources. You can use your mouse to arrange the resources.</p><p><span><img alt="" src="../Images/1192216-490354.png" width="" height="" /></span></p><ol class="number"><li value="5"><p>Click on the Virtual Machine resource labeled <b>SimpleWinVM</b>.</p></li></ol><p>Below is the JSON that defines the VM resource.</p><p><span><img alt="" src="../Images/1192217-490355.png" width="" height="" /></span></p><ul class="square"><li class="square"><p>The resource's type is <span class="code">Microsoft.Compute/virtualMachines</span>.</p></li><li class="square"><p>It's location, or Azure region, comes from the template parameter named location.</p></li><li class="square"><p>The VM's size is Standard_A2.</p></li><li class="square"><p>The computer name is read from a template variable and the username and password for the VM are read from template parameters.</p></li></ul><h3 class="da-h3" id="1191810">Download the Template for a VM</h3><p>When you create a VM in Azure using the portal or PowerShell, a Resource Manager template is automatically created for you. You can use this template to quickly duplicate a deployment.</p><p>The template contains information about all the resources in a resource group. For a virtual machine, this means the template contains everything that is created in support of the VM in that resource group, including the networking resources.</p><p><b>Download the template using the portal</b></p><ol class="number"><li><p>Log in to the <a href="https://portal.azure.com/" title="" target="_blank">Azure portal</a>.</p></li><li><p>One the left menu, select <b>Virtual Machines</b>.</p></li><li><p>Select the virtual machine from the list.</p></li><li><p>Select <b>Export template</b>.</p></li><li><p>Select <b>Download</b> from the menu at the top and save the .zip file to your local computer.</p></li><li><p>Open the .zip file and extract the files to a folder. The .zip file contains:</p></li></ol><ul class="square"><li class="square"><p>parameters.json</p></li><li class="square"><p>template.json</p></li></ul><p>The template.json file is the template.</p><h3 class="da-h3" id="1191701">Distribute Traffic with Azure Load Balancer</h3><p>With Azure Load Balancer, you can spread user requests across multiple virtual machines or other services. That way, you can scale the app to larger sizes than a single virtual machine can support, and you ensure that users get service, even when a virtual machine fails.</p><h4 class="da-h4">Distribute traffic with Azure Load Balancer</h4><p>Azure Load Balancer is a service you can use to distribute traffic across multiple virtual machines. Use Load Balancer to scale applications and create high availability for your virtual machines and services. Load balancers use a hash-based distribution algorithm. By default, a five-tuple hash is used to map traffic to available servers. The hash is made from the following elements:</p><ul class="square"><li class="square"><p><b>Source IP</b>: The IP address of the requesting client.</p></li><li class="square"><p><b>Source port</b>: The port of the requesting client.</p></li><li class="square"><p><b>Destination IP</b>: The destination IP of the request.</p></li><li class="square"><p><b>Destination port</b>: The destination port of the request.</p></li><li class="square"><p><b>Protocol type</b>: The specified protocol type, TCP or UDP.</p></li></ul><p><span><img alt="" src="../Images/1192139-490277.png" width="" height="" /></span></p><p>Load Balancer supports inbound and outbound scenarios, provides low latency and high throughput, and scales up to millions of flows for all TCP and UDP applications.</p><p>Load balancers aren't physical instances. Load balancer objects are used to express how Azure configures its infrastructure to meet your requirements.</p><p>To achieve high availability with Load Balancer, you can choose to use availability sets and availability zones to ensure that virtual machines are always available:</p><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p>Configuration</p></td><td><p>Service level agreement (SLA)</p></td><td><p>Information</p></td></tr></thead><tbody><tr><td><p>Availability set</p></td><td><p>99.95%</p></td><td><p>Protection from hardware failures within datacenters</p></td></tr><tr><td><p>Availability zone</p></td><td><p>99.99%</p></td><td><p>Protection from entire datacenter failure</p></td></tr></tbody></table><h4 class="da-h4">Availability sets</h4><p>Mentioned earlier in this course, an availability set is a logical grouping that you use to isolate virtual machine resources from each other when they're deployed. Azure ensures that the virtual machines you put in an availability set run across multiple physical servers, compute racks, storage units, and network switches. If there's a hardware or software failure, only a subset of your virtual machines is affected.</p><p><span><img alt="" src="../Images/1192416-490554.png" width="" height="" /></span></p><h4 class="da-h4">Availability zones</h4><p>Mentioned earlier in this course, an availability zone offers groups of one or more datacenters that have independent power, cooling, and networking. The virtual machines in an availability zone are placed in different physical locations within the same region. Use this architecture when you want to ensure that, when an entire datacenter fails, you can continue to serve users.</p><p>Availability zones don't support all virtual machine sizes and aren't available in all Azure regions. Check that they are supported in your region before you use them in your architecture.</p><p><span><img alt="" src="../Images/1192417-490555.png" width="" height="" /></span></p><h3 class="da-h3" id="1191708">Application Gateway Configuration</h3><p>Application Gateway has a series of components that combine to route requests to a pool of web servers and to check the health of these web servers.</p><p><span><img alt="" src="../Images/1192267-490405.png" width="" height="" /></span></p><h4 class="da-h4">Front-end IP address</h4><p>Client requests are received through a front-end IP address. You can configure Application Gateway to have a public IP address, a private IP address, or both. Application Gateway can't have more than one public and one private IP address.</p><h4 class="da-h4">Listeners</h4><p>Application Gateway uses one or more listeners to receive incoming requests. A listener accepts traffic arriving on a specified combination of protocol, port, host, and IP address. Each listener routes requests to a back-end pool of servers following routing rules that you specify. A listener can be Basic or Multi-site. A Basic listener only routes a request based on the path in the URL. A Multi-site listener can also route requests using the hostname element of the URL.</p><h4 class="da-h4">Routing rules</h4><p>A routing rule binds a listener to the back-end pools. A rule specifies how to interpret the hostname and path elements in the URL of a request, and direct the request to the appropriate back-end pool. A routing rule also has an associated set of HTTP settings. These settings indicate whether (and how) traffic is encrypted between Application Gateway and the back-end servers, and other configuration information such as: Protocol, Session stickiness, Connection draining, Request timeout period, and Health probes.</p><h4 class="da-h4">Back-end pools</h4><p>A back-end pool references a collection of web servers. You provide the IP address of each web server and the port on which it listens for requests when configuring the pool. Each pool can specify a fixed set of virtual machines, a virtual machine scale-set, an app hosted by Azure App Services, or a collection of on-premises servers. Each back-end pool has an associated load balancer that distributes work across the pool</p><h4 class="da-h4">Web application firewall</h4><p>The web application firewall (WAF) is an optional component that handles incoming requests before they reach a listener. The web application firewall checks each request for many common threats, based on the Open Web Application Security Project (OWASP). These include: SQL-injection, Cross-site scripting, Command injection, HTTP request smuggling, HTTP response splitting, Remote file inclusion, Bots, crawlers, and scanners, and HTTP protocol violations and anomalies.</p><p>WAF is enabled on your Application Gateway by selecting the WAF tier when you create a gateway.</p><h4 class="da-h4">Health probes</h4><p>Health probes are an important part in assisting the load balancer to determine which servers are available for load balancing in a back-end pool. Application Gateway uses a health probe to send a request to a server. If the server returns an HTTP response with a status code between 200 and 399, the server is deemed healthy.</p><p>If you don't configure a health probe, Application Gateway creates a default probe that waits for 30 seconds before deciding that a server is unavailable.</p><h3 class="da-h3" id="1191848">Module 10 Review Questions</h3><p><span><img alt="" src="../Images/1192029-490167.png" width="" height="" /></span></p><h4 class="problem">Review Question 1</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-0d2e4881-92be-f9ab-05ee-61d64e2fa8cf"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You are asked to make recommendation to a company whose network contains an on-premises Active Directory and an Azure AD tenant.<br /></p><ul class="square"><li class="square"><p>They have deployed Azure AD Connect and have configured pass-through authentication.</p></li><li class="square"><p>Their Azure subscription contains many web apps that are accessed from the Internet.</p></li><li class="square"><p>They plan to use Azure MFA with the Azure AD tenant.</p></li></ul><p>
You are asked to recommend a solution that prevents users from being prompted for Azure MFA while accessing apps from the on-premises network. What do you advise?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q0d2e4881-92be-f9ab-05ee-61d64e2fa8cf" value="1" />Trusted IPs<br /></label></li><li><label><input type="radio" name="q0d2e4881-92be-f9ab-05ee-61d64e2fa8cf" value="2" />A site-to-site VPN between the on-premises network and Azure<br /></label></li><li><label><input type="radio" name="q0d2e4881-92be-f9ab-05ee-61d64e2fa8cf" value="3" />Azure ExpressRoute<br /></label></li><li><label><input type="radio" name="q0d2e4881-92be-f9ab-05ee-61d64e2fa8cf" value="4" />Azure Policy<br /></label></li></ul></div></div><div id="feedback-problem-0d2e4881-92be-f9ab-05ee-61d64e2fa8cf" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct Answer: Trusted IPs. Trusted IPs are an multi-factor authentication feature that bypasses the two-step verification for users who signing in from IP addresses that are on the Trusted IP list.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 2</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-b968463c-635a-5b26-3cb8-f14bc55e5132"><div class="card quizlib-question"><div class="quizlib-question-title"><p>An organization has an Azure subscription named  Tailwind_Subcription_1 that contains an Azure VM named Tailwind_VM_1 within the resource group named Tailwind_RG_1.<br /></p><ul class="square"><li class="square"><p>Tailwind_VM_1 runs services that are used to deploy resources in Tailwind_RG_1.</p></li><li class="square"><p>They want to ensure that the service on running Tailwind_VM_1 can manage the resources in Tailwind_RG_1 by using the identity of Tailwind_VM_1.</p></li><li class="square"><p>Managed Identity has not been enabled on the VM.</p></li></ul><p>
What do you advise they do first?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="qb968463c-635a-5b26-3cb8-f14bc55e5132" value="1" />From the Azure portal, modify the Identity Access Control (IAM) settings for Tailwind_VM_1.<br /></label></li><li><label><input type="radio" name="qb968463c-635a-5b26-3cb8-f14bc55e5132" value="2" />From the Azure portal, modify the value of the Identity option for Tailwind_VM_1.<br /></label></li><li><label><input type="radio" name="qb968463c-635a-5b26-3cb8-f14bc55e5132" value="3" />From the Azure portal, modify the Policies settings for Tailwind_RG_1.<br /></label></li><li><label><input type="radio" name="qb968463c-635a-5b26-3cb8-f14bc55e5132" value="4" />From the Azure portal, modify the Access Control (IAM) settings or Tailwind_RG_1.<br /></label></li></ul></div></div><div id="feedback-problem-b968463c-635a-5b26-3cb8-f14bc55e5132" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct Answer: From the Azure portal, modify the value of the Identity option for Tailwind_VM_1  because you must first enable Managed Service Identity.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 3</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-ac7999e6-0432-61de-f5da-f9d76fdf58ae"><div class="card quizlib-question"><div class="quizlib-question-title"><p>Your company hires a new IT administrator. She needs to manage a resource group with first-tier web servers including assigning permissions . However, she should not have access to other resource groups inside the subscription. You need to configure role-based access. What should you do? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="qac7999e6-0432-61de-f5da-f9d76fdf58ae" value="1" />Assign her as a Subscription Owner.<br /></label></li><li><label><input type="radio" name="qac7999e6-0432-61de-f5da-f9d76fdf58ae" value="2" />Assign her as a Subscription Contributor.<br /></label></li><li><label><input type="radio" name="qac7999e6-0432-61de-f5da-f9d76fdf58ae" value="3" />Assign her as a Resource Group Owner.<br /></label></li><li><label><input type="radio" name="qac7999e6-0432-61de-f5da-f9d76fdf58ae" value="4" />Assign her as a Resource Group Contributor.<br /></label></li></ul></div></div><div id="feedback-problem-ac7999e6-0432-61de-f5da-f9d76fdf58ae" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Assign her as a Resource Group owner. The new IT administrator needs to be able to assign permissions.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 4</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-b7785a1a-4c73-a40c-d619-7a1bbed32956"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You have three virtual machines (VM1, VM2, and VM3) in a resource group. The Helpdesk hires a new employee. The new employee must be able to modify the settings on VM3, but not on VM1 and VM2. Your solution must minimize administrative overhead. What should you do? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="qb7785a1a-4c73-a40c-d619-7a1bbed32956" value="1" />Assign the user to the Contributor role on the resource group.<br /></label></li><li><label><input type="radio" name="qb7785a1a-4c73-a40c-d619-7a1bbed32956" value="2" />Assign the user to the Contributor role on VM3.<br /></label></li><li><label><input type="radio" name="qb7785a1a-4c73-a40c-d619-7a1bbed32956" value="3" />Move VM3 to a new resource group and assign the user to the Contributor role on VM3.<br /></label></li><li><label><input type="radio" name="qb7785a1a-4c73-a40c-d619-7a1bbed32956" value="4" />Assign the user to the Contributor role on the resource group, then assign the user to the Owner role on VM3.<br /></label></li></ul></div></div><div id="feedback-problem-b7785a1a-4c73-a40c-d619-7a1bbed32956" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Assign the user to the Contributor role on VM3. This means the user will not have access to VM1 or VM2. The Contributor role will allow the user to change the settings on VM1.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h3 class="da-h3" id="1191844">Demonstration - Create a Blueprint</h3><p>The first step in defining a standard pattern for compliance is to compose a blueprint from the available resources. In this demonstration, create a new blueprint named <b>MyBlueprint</b> to configure role and policy assignments for the subscription. Then add a new resource group, and create a Resource Manager template and role assignment on the new resource group.</p><ol class="number"><li><p>Select <b>All services</b> in the left pane. Search for and select <b>Blueprints</b>.</p></li><li><p>Select <b>Blueprint definitions</b> from the page on the left and select the <b>+ Create blueprint</b> button at the top of the page.</p></li></ol><p><span><img alt="" src="../Images/1192352-490490.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>Select <b>Start with blank blueprint</b> from the card at the top of the built-in blueprints list.</p></li><li><p>Provide a <b>Blueprint name</b> such as <b>MyBlueprint</b>. Leave <b>Blueprint description</b> blank for now.</p></li><li><p>In the <b>Definition location</b> box, select the ellipsis on the right, select the management group or subscription where you want to save the blueprint, and choose <b>Select</b>.</p></li><li><p>Verify that the information is correct. The <b>Blueprint name</b> and <b>Definition location</b> fields can't be changed later. Then select <b>Next : Artifacts</b> at the bottom of the page or the <b>Artifacts</b> tab at the top of the page.</p></li><li><p>Add a role assignment at the subscription level:</p></li></ol><ul class="square"><li class="square"><p>Select the <b>+ Add artifact</b> row under <b>Subscription</b>. The <b>Add artifact</b> window opens on the right side of the browser.</p></li><li class="square"><p>Select <b>Role assignment</b> for <b>Artifact type</b>.</p></li><li class="square"><p>Under <b>Role</b>, select <b>Contributor</b>. Leave the <b>Add user, app or group</b> box with the check box that indicates a dynamic parameter.</p></li><li class="square"><p>Select <b>Add</b> to add this artifact to the blueprint.</p></li></ul><p><span><img alt="" src="../Images/1192353-490491.png" width="" height="" /></span></p><ol class="number"><li value="8"><p>Add a policy assignment at the subscription level:</p></li></ol><ul class="square"><li class="square"><p>Select the <b>+ Add artifact</b> row under the role assignment artifact.</p></li><li class="square"><p>Select <b>Policy assignment</b> for <b>Artifact type</b>.</p></li><li class="square"><p>Change <b>Type</b> to <b>Built-in</b>. In <b>Search</b>, enter <b>tag</b>.</p></li><li class="square"><p>Click out of <b>Search</b> for the filtering to occur. Select <b>Append tag and its default value to resource groups</b>.</p></li><li class="square"><p>Select <b>Add</b> to add this artifact to the blueprint.</p></li></ul><ol class="number"><li value="9"><p>Select the row of the policy assignment <b>Append tag and its default value to resource groups</b>.</p></li><li><p>The window to provide parameters to the artifact as part of the blueprint definition opens and allows setting the parameters for all assignments (static parameters) based on this blueprint instead of during assignment (dynamic parameters). This example uses dynamic parameters during blueprint assignment, so leave the defaults and select <b>Cancel</b>.</p></li><li><p>Add a resource group at the subscription level:</p></li></ol><ul class="square"><li class="square"><p>Select the <b>+ Add artifact</b> row under <b>Subscription</b>.</p></li><li class="square"><p>Select <b>Resource group</b> for <b>Artifact type</b>.</p></li><li class="square"><p>Leave the **Artifact display name, Resource Group Name, ** and <b>Location</b> boxes blank, but make sure that the check box is checked for each parameter property to make them dynamic parameters.</p></li><li class="square"><p>Select <b>Add</b> to add this artifact to the blueprint.</p></li></ul><ol class="number"><li value="12"><p>Add a template under the resource group:</p></li></ol><ul class="square"><li class="square"><p>Select the <b>+ Add artifact</b> row under the <b>ResourceGroup</b> entry.</p></li><li class="square"><p>Select <b>Azure Resource Manager template</b> for <b>Artifact type</b>, set <b>Artifact display name</b> to <b>StorageAccount</b>, and leave <b>Description</b> blank.</p></li><li class="square"><p>On the <b>Template</b> tab in the editor box, paste the following Resource Manager template. After you paste the template, select the <b>Parameters</b> tab and note that the template parameters <b>storageAccountType</b> and <b>location</b> were detected. Each parameter was automatically detected and populated but configured as a dynamic parameter.</p></li></ul><div class="code language-JSON"><p class="da-divtext"><code><span class="token punctuation">{</span>
    <span class="token property">"$schema"</span><span class="token operator">:</span> <span class="token string">"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#"</span><span class="token punctuation">,</span>
    <span class="token property">"contentVersion"</span><span class="token operator">:</span> <span class="token string">"1.0.0.0"</span><span class="token punctuation">,</span>
    <span class="token property">"parameters"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"storageAccountType"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
            <span class="token property">"defaultValue"</span><span class="token operator">:</span> <span class="token string">"Standard_LRS"</span><span class="token punctuation">,</span>
            <span class="token property">"allowedValues"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">"Standard_LRS"</span><span class="token punctuation">,</span>
                <span class="token string">"Standard_GRS"</span><span class="token punctuation">,</span>
                <span class="token string">"Standard_ZRS"</span><span class="token punctuation">,</span>
                <span class="token string">"Premium_LRS"</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"metadata"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Storage Account type"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"location"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
            <span class="token property">"defaultValue"</span><span class="token operator">:</span> <span class="token string">"[resourceGroup().location]"</span><span class="token punctuation">,</span>
            <span class="token property">"metadata"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"Location for all resources."</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"variables"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"storageAccountName"</span><span class="token operator">:</span> <span class="token string">"[concat('store', uniquestring(resourceGroup().id))]"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"resources"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"Microsoft.Storage/storageAccounts"</span><span class="token punctuation">,</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"[variables('storageAccountName')]"</span><span class="token punctuation">,</span>
        <span class="token property">"location"</span><span class="token operator">:</span> <span class="token string">"[parameters('location')]"</span><span class="token punctuation">,</span>
        <span class="token property">"apiVersion"</span><span class="token operator">:</span> <span class="token string">"2018-07-01"</span><span class="token punctuation">,</span>
        <span class="token property">"sku"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"[parameters('storageAccountType')]"</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">"kind"</span><span class="token operator">:</span> <span class="token string">"StorageV2"</span><span class="token punctuation">,</span>
        <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"outputs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">"storageAccountName"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>
            <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"[variables('storageAccountName')]"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></p></div><ul class="square"><li class="square"><p>Clear the <b>storageAccountType</b> check box and note that the drop-down list contains only values included in the Resource Manager template under <b>allowedValues</b>. Select the box to set it back to a dynamic parameter.</p></li><li class="square"><p>Select <b>Add</b> to add this artifact to the blueprint.</p></li></ul><ol class="number"><li value="13"><p>Your completed blueprint should look like the following. Notice that each artifact has <b>x out of y parameters populated</b> in the <b>Parameters</b> column. The dynamic parameters are set during each assignment of the blueprint.</p></li></ol><p><span><img alt="" src="../Images/1192354-490492.png" width="" height="" /></span></p><ol class="number"><li value="14"><p>Now that all planned artifacts have been added, select <b>Save Draft</b> at the bottom of the page.</p></li></ol><h3 class="da-h3" id="1191855">Key Vault Uses</h3><p>With these three elements, an Azure Key Vault helps address the following issues:</p><ul class="square"><li class="square"><p><b>Secrets management</b>. Azure Key Vault can securely store (with HSMs) and tightly control access to tokens, passwords, certificates, API keys, and other secrets.</p></li><li class="square"><p><b>Key management</b>. Azure Key Vault is a cloud-based key management solution, making it easier to create and control the encryption keys used to encrypt your data. Azure services such as App Service integrate directly with Azure Key Vault and can decrypt secrets without knowledge of the encryption keys.</p></li><li class="square"><p><b>Certificate management</b>. Azure Key Vault is also a service that lets you easily provision, manage, and deploy public and private SSL/TLS certificates for use with Azure and your internal connected resources. It can also request and renew TLS certificates through partnerships with certificate authorities, providing a robust solution for certificate lifecycle management.</p></li></ul><p>✔️ <b>Important:</b><b>Key Vault is designed to store configuration secrets for server applications</b>. It's not intended for storing data belonging to your app's users, and it shouldn't be used in the client-side part of an app. This is reflected in its performance characteristics, API, and cost model.</p><p>User data should be stored elsewhere, such as in an Azure SQL database with Transparent Data Encryption, or a storage account with Storage Service Encryption. Secrets used by your application to access those data stores can be kept in Key Vault.</p><h4 class="da-h4">Best practices</h4><p>Below are security best practices for using Azure Key Vault.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p><b>Best practice</b></p></td><td><p><b>Solution</b></p></td></tr></thead><tbody><tr><td><p><b>Grant access to users, groups, and applications at a specific scope.</b></p></td><td><p>Use RBAC's predefined roles. For example, to grant access to a user to manage key vaults, you would assign the predefined role Key Vault Contributor to this user at a specific scope. The scope, in this case, would be a subscription, a resource group, or just a specific key vault. If the predefined roles don't fit your needs, you can define your own roles.</p></td></tr><tr><td><p><b>Control what users have access to.</b></p></td><td><p>Access to a key vault is controlled through two separate interfaces: management plane, and data plane. The management plane and data plane access controls work independently. Use RBAC to control what users have access to. For example, if you want to grant an application the rights to use keys in a key vault, you only need to grant data plane access permissions by using key vault access policies, and no management plane access is needed for this application. Conversely, if you want a user to be able to read vault properties and tags but not have any access to keys, secrets, or certificates, you can grant this user read access by using RBAC, and no access to the data plane is required.</p></td></tr><tr><td><p><b>Store certificates in your key vault.</b></p></td><td><p>Azure Resource Manager can securely deploy certificates stored in Azure Key Vault to Azure VMs when the VMs are deployed. By setting appropriate access policies for the key vault, you also control who gets access to your certificate. Another benefit is that you manage all your certificates in one place in Azure Key Vault.</p></td></tr><tr><td><p><b>Ensure that you can recover a deletion of key vaults or key vault objects.</b></p></td><td><p>Deletion of key vaults or key vault objects can be either inadvertent or malicious. Enable the soft delete and purge protection features of Key Vault, particularly for keys that are used to encrypt data at rest. Deletion of these keys is equivalent to data loss, so you can recover deleted vaults and vault objects if needed. Practice Key Vault recovery operations regularly.</p></td></tr></tbody></table><h3 class="da-h3" id="1191856">Demonstration - Configure Certificate Auto-Rotation in Key Vault</h3><p>Certificates can be public and private Secure Sockets Layer (SSL)/Transport Layer Security (TLS) certificates signed by a certificate authority (CA), or a self-signed certificate. Key Vault can also request and renew certificates through partnerships with CAs, providing a robust solution for certificate lifecycle management.</p><p>In this demonstration, you will update a certificate's validity period, auto-rotation frequency, and CA attributes.</p><ul class="square"><li class="square"><p>Manage a certificate by using the Azure portal.</p></li><li class="square"><p>Add a CA provider account.</p></li><li class="square"><p>Update the certificate's validity period.</p></li><li class="square"><p>Update the certificate's auto-rotation frequency.</p></li><li class="square"><p>Update the certificate's attributes by using Azure PowerShell.</p></li></ul><h4 class="da-h4">Sign in to Azure</h4><p>Sign in to the Azure portal at <a href="https://portal.azure.com/" title="" target="_blank">https://portal.azure.com</a>.</p><h4 class="da-h4">Create a vault</h4><p>Create a key vault or select your existing vault to perform operations (If needed, see <a href="https://docs.microsoft.com/en-us/azure/key-vault/quick-create-portal" title="" target="_blank">Steps to create a key vault</a>).</p><p>In this demonstraton, the key vault name is <b>Example-Vault</b>.</p><p><span><img alt="" src="../Images/1192262-490400.png" width="" height="" /></span></p><h4 class="da-h4">Create a certificate in Key Vault</h4><p>Create a certificate or import a certificate into the key vault (If needed, see <a href="https://docs.microsoft.com/en-us/azure/key-vault/quick-create-portal" title="" target="_blank">Steps to create a certificate in Key Vault</a>).</p><p>In this demo, you'll work on a certificate called <b>ExampleCertificate</b>.</p><h4 class="da-h4">Update certificate lifecycle attributes</h4><p>In Azure Key Vault, you can update a certificate's lifecycle attributes both before and after the time of certificate creation.</p><p>A certificate created in Key Vault can be:</p><ul class="square"><li class="square"><p>A self-signed certificate.</p></li><li class="square"><p>A certificate created with a CA that's partnered with Key Vault.</p></li><li class="square"><p>A certificate with a CA that isn't partnered with Key Vault.</p></li></ul><p>The following CAs are currently partnered providers with Key Vault:</p><ul class="square"><li class="square"><p><b>DigiCert</b>: Key Vault offers OV TLS/SSL certificates.</p></li><li class="square"><p><b>GlobalSign</b>: Key Vault offers OV TLS/SSL certificates.</p></li></ul><p>Key Vault auto-rotates certificates through established partnerships with CAs. Because Key Vault automatically requests and renews certificates through the partnership, auto-rotation capability is not applicable for certificates created with CAs that are not partnered with Key Vault.</p><p>✔️ <b>Note</b> An account admin for a CA provider creates credentials that Key Vault uses to create, renew, and use TLS/SSL certificates. <span><img alt="" src="../Images/1192263-490401.png" width="" height="" /></span></p><h4 class="da-h4">Update certificate lifecycle attributes at the time of creation</h4><ol class="number"><li><p>On the Key Vault properties pages, select <b>Certificates</b>.</p></li><li><p>Select <b>Generate/Import</b>.</p></li><li><p>On the <b>Create a certificate</b> screen, update the following values:</p></li></ol><ul class="square"><li class="square"><p><b>Validity Period</b>: Enter the value (in months). Creating short-lived certificates is a recommended security practice. By default, the validity value of a newly created certificate is 12 months.</p></li><li class="square"><p><b>Lifetime Action Type</b>: Select the certificate's auto-renewal and alerting action and then update <b>percentage lifetime</b> or <b>Number of days before expiry</b>. By default, a certificate's auto-renewal is set at 80 percent of its lifetime. From the drop-down menu, select one of the following options.</p></li></ul><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p><b>Automatically renew at a given time</b></p></td><td><p><b>Email all contacts at a given time</b></p></td></tr></thead><tbody><tr><td><p>Selecting this option will turn on autorotation.</p></td><td><p>Selecting this option will not auto-rotate but will only alert the contacts.</p></td></tr></tbody></table><ol class="number"><li value="4"><p>Select <b>Create</b>.</p></li></ol><p><span><img alt="" src="../Images/1192264-490402.png" width="" height="" /></span></p><h4 class="da-h4">Update lifecycle attributes of a stored certificate</h4><ol class="number"><li><p>Select the key vault.</p></li><li><p>On the Key Vault properties pages, select <b>Certificates</b>.</p></li><li><p>Select the certificate you want to update. In this case, you'll work on a certificate called <b>ExampleCertificate</b>.</p></li><li><p>Select <b>Issuance Policy</b> from the top menu bar.</p></li></ol><p><span><img alt="" src="../Images/1192265-490403.png" width="" height="" /></span></p><ol class="number"><li value="5"><p>On the <b>Issuance Policy</b> screen, update the following values:</p></li></ol><ul class="square"><li class="square"><p><b>Validity Period</b>: Update the value (in months).</p></li><li class="square"><p><b>Lifetime Action Type</b>: Select the certificate's auto-renewal and alerting action and then update the <b>percentage lifetime</b> or <b>Number of days before expiry</b>.</p></li></ul><p><span><img alt="" src="../Images/1192266-490404.png" width="" height="" /></span></p><ol class="number"><li value="6"><p>Select <b>Save</b>.</p></li></ol><p><b>Important</b> Changing the Lifetime Action Type for a certificate will record modifications for the existing certificates immediately.</p><h4 class="da-h4">Update certificate attributes by using PowerShell</h4><div class="code language-PowerShell"><p class="da-divtext"><code><span class="token function">Set</span><span class="token operator">-</span>AzureKeyVaultCertificatePolicy <span class="token operator">-</span>VaultName <span class="token variable">$vaultName</span>
                                   <span class="token operator">-</span>Name <span class="token variable">$certificateName</span>
                                   <span class="token operator">-</span>RenewAtNumberOfDaysBeforeExpiry <span class="token punctuation">[</span>276 or appropriate calculated value<span class="token punctuation">]</span></code></p></div><h3 class="da-h3" id="1191893">Recovery Services Vault Overview</h3><p>A Recovery Services vault is a storage entity in Azure that houses data. The data is typically copies of data, or configuration information for virtual machines (VMs), workloads, servers, or workstations. You can use Recovery Services vaults to hold backup data for various Azure services such as IaaS VMs (Linux or Windows) and Azure SQL databases. Recovery Services vaults support System Center DPM, Windows Server, Azure Backup Server, and more. Recovery Services vaults make it easy to organize your backup data, while minimizing management overhead.
<span><img alt="" src="../Images/1192415-490553.png" width="" height="" /></span>
Within an Azure subscription, you can create up to 500 Recovery Services vaults per subscription per region.</p><h4 class="da-h4">Comparing Recovery Services vaults and Backup vaults</h4><p>If you still have Backup vaults, they are being auto-upgraded to Recovery Services vaults. By November 2017, all Backup vaults have been upgraded to Recovery Services vaults.
Recovery Services vaults are based on the Azure Resource Manager model of Azure, whereas Backup vaults were based on the Azure Service Manager model. When you upgrade a Backup vault to a Recovery Services vault, the backup data remains intact during and after the upgrade process.</p><p>Recovery Services vaults provide features not available for Backup vaults, such as:</p><ul class="square"><li class="square"><p><b>Enhanced capabilities to help secure backup data</b>: With Recovery Services vaults, Azure Backup provides security capabilities to protect cloud backups. The security features ensure you can secure your backups, and safely recover data, even if production and backup servers are compromised. <a href="https://docs.microsoft.com/en-us/azure/backup/backup-azure-security-feature" title="" target="_blank">Learn more.</a></p></li><li class="square"><p><b>Central monitoring for your hybrid IT environment</b>: With Recovery Services vaults, you can monitor not only your <a href="https://docs.microsoft.com/en-us/azure/backup/backup-azure-manage-vms" title="" target="_blank">Azure IaaS VMs</a> but also your <a href="https://docs.microsoft.com/en-us/azure/backup/backup-azure-manage-windows-server" title="" target="_blank">on-premises assets</a> from a central portal. <a href="https://azure.microsoft.com/en-us/blog/alerting-and-monitoring-for-azure-backup/" title="" target="_blank">Learn more</a></p></li><li class="square"><p><b>Role-Based Access Control (RBAC)</b>: RBAC provides fine-grained access management control in Azure. <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles" title="" target="_blank">Azure provides various built-in roles</a>, and Azure Backup has three <a href="https://docs.microsoft.com/en-us/azure/backup/backup-rbac-rs-vault" title="" target="_blank">built-in roles to manage recovery points</a>. Recovery Services vaults are compatible with RBAC, which restricts backup and restore access to the defined set of user roles. <a href="https://docs.microsoft.com/en-us/azure/backup/backup-azure-security-feature" title="" target="_blank">Learn more</a></p></li><li class="square"><p><b>Protect all configurations of Azure Virtual Machines</b>: Recovery Services vaults protect Resource Manager-based VMs including Premium Disks, Managed Disks, and Encrypted VMs. Upgrading a Backup vault to a Recovery Services vault gives you the opportunity to upgrade your Service Manager-based VMs to Resource Manager-based VMs. While upgrading the vault, you can retain your Service Manager-based VM recovery points and configure protection for the upgraded (Resource Manager-enabled) VMs. <a href="https://azure.microsoft.com/en-us/blog/azure-backup-recovery-services-vault-ga/" title="" target="_blank">Learn more</a>.</p></li><li class="square"><p><b>Instant restore for IaaS VMs</b>: Using Recovery Services vaults, you can restore files and folders from an IaaS VM without restoring the entire VM, which enables faster restore times. Instant restore for IaaS VMs is available for both Windows and Linux VMs. <a href="https://azure.microsoft.com/en-us/blog/instant-file-recovery-from-azure-linux-vm-backup-using-azure-backup-preview/" title="" target="_blank">Learn more.</a></p></li></ul><h3 class="da-h3" id="1191864">Hyper-V Migration</h3><p>Azure Migrate Server Migration is a tool for migrating on-premises workloads, and cloud-based VMs, to Azure. Site Recovery is a disaster recovery tool. The tools share some common technology components used for data replication but serve different purposes.</p><p><span><img alt="" src="../Images/1192076-490214.png" width="" height="" /></span></p><p>The Azure Migrate Server Migration tool provides agentless replication for on-premises Hyper-V VMs, using a migration workflow that's optimized for Hyper-V. You install a software agent only on Hyper-V hosts or cluster nodes. Nothing needs to be installed on Hyper-V VMs.</p><p>•	<b>Replication provider</b>: The Microsoft Azure Site Recovery provider is installed on Hyper-V hosts, and registered with Azure Migration Server Migration.
The provider orchestrates replication for Hyper-V VMs.</p><p>•	<b>Recovery Services agent</b>: The Microsoft Azure Recovery Service agent handles data replication. It works with the provider to replicate data from Hyper-V VMs to Azure.
The replicated data is uploaded to a storage account in your Azure subscription. The Server Migration tool processes the replicated data and applies it to replica disks in the subscription. The replica disks are used to create the Azure VMs when you migrate.</p><h3 class="da-h3" id="1191865">Agent-based Migration Architecture</h3><p>The architecture for agent-based migration of VMware VMs to Azure is shown in the following diagram.</p><p><span><img alt="" src="../Images/1192145-490283.png" width="" height="" /></span></p><p>There are some core requirements for agent-based migration of VMware to Azure migration scenarios.</p><ol class="number"><li><p>An Azure subscription, Azure Storage account for cache, Managed Disk and Azure network.</p></li><li><p>A Configuration Server VM hosted on VMware. We recommend that you run it as a VMware VM that can be deployed from a downloaded OVF template.  The machine runs all on-premises Site Recovery components, which include the configuration server, process server, and master target server.</p><ul class="square"><li class="square"><p><b>Configuration server</b>: Coordinates communications between on-premises and Azure, and manages data replication.</p></li><li class="square"><p><b>Process server</b>: Installed by default on the configuration server. It receives replication data; optimizes it with caching, compression, and encryption; and sends it to Azure Storage. The process server also installs Azure Site Recovery Mobility Service on VMs you want to replicate, and performs automatic discovery of on-premises machines. As your deployment grows, you can add additional, separate process servers to handle larger volumes of replication traffic.</p></li></ul></li><li><p>ESXi and vCenter hosts</p><ul class="square"><li class="square"><p>During Site Recovery deployment, you add VMware servers to the Recovery Services vault.</p></li></ul></li><li><p>Mobility Service on all VMware VMs to replicate or migrate.</p><ul class="square"><li class="square"><p>We recommend that you allow automatic installation from the process server. Alternatively, you can install the service manually or use an automated deployment method, such as System Center Configuration Manager. An account with permissions to the VMware Hosts.</p></li><li class="square"><p>VMs must meet the requirements found listed here: <a href="https://docs.microsoft.com/en-us/azure/site-recovery/vmware-physical-azure-support-matrix#replicated-machines" title="" target="_blank">Replicated machines</a></p></li></ul></li><li><p>Azure Storage – The following are not supported: Cool Storage, Hot Storage, Block Blobs, Import/Export Service, General Purpose v2. For more information, go to <a href="https://docs.microsoft.com/en-us/azure/site-recovery/vmware-physical-azure-support-matrix#azure-storage" title="" target="_blank">Azure Storage</a>.</p></li></ol><h3 class="da-h3" id="1191868">Agentless migration-appliance requirements</h3><p>The following table lists the agentless migration-appliance requirements and prerequisites.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p><b>Support</b></p></td><td><p><b>Details</b></p></td></tr></thead><tbody><tr><td><p><b>ESXi</b></p></td><td><p>The appliance VM must be deployed on an ESXi host running version 5.5 or later.</p></td></tr><tr><td><p><b>Azure Migrate project</b></p></td><td><p>An appliance can be associated with a single project.</p></td></tr><tr><td><p><b>vCenter Server</b></p></td><td><p>An appliance can discover up to 10,000 VMware VMs on a vCenter Server. An appliance can connect to one vCenter Server.</p></td></tr><tr><td><p><b>VDDK</b></p></td><td><p>If you're running an agentless migration with Azure Migrate Server Migration, the VMware vSphere Virtual Disk Development Kit (VDDK) must be installed on the appliance VM.</p></td></tr></tbody></table><h4 class="da-h4">Agentless migration-URL access requirements</h4><p>The Azure Migrate appliance needs internet connectivity to the internet.</p><ul class="square"><li class="square"><p>When you deploy the appliance, Azure Migrate does a connectivity check to the URLs summarized in the table below.</p></li><li class="square"><p>If you're using a URL-based firewall.proxy, allow access to these URLs, making sure that the proxy resolves any CNAME records received while looking up the URLs.</p></li></ul><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p><b>URL</b></p></td><td><p><b>Details</b></p></td></tr></thead><tbody><tr><td><p>*.portal.azure.com</p></td><td><p>Navigate to the Azure Migrate in the Azure portal.</p></td></tr><tr><td><p>*.windows.net</p></td><td><p>Log into your Azure subscription.</p></td></tr><tr><td><p>*.microsoftonline.com</p></td><td><p>Create Active Directory apps for the appliance to communicate with the Azure Migrate service.</p></td></tr><tr><td><p>management.azure.com</p></td><td><p>Create Active Directory apps for the appliance to communicate with the Azure Migrate service.</p></td></tr><tr><td><p>dc.services.visualstudio.com</p></td><td><p>Upload app logs used for internal monitoring.</p></td></tr><tr><td><p>*.vault.azure.net</p></td><td><p>Manage secrets in the Azure Key Vault.</p></td></tr><tr><td><p>*.servicebus.windows.net</p></td><td><p>Communication between the appliance and the Azure Migrate service.</p></td></tr><tr><td><p>*.blob.core.windows.net</p></td><td><p>Upload data to storage accounts.</p></td></tr></tbody></table><p>Additionally, to connect to Azure Migrate service URLs, you will need to allow access to the following:</p><ul class="square"><li class="square"><p>*.discoverysrv.windowsazure.com</p></li><li class="square"><p>*.migration.windowsazure.com</p></li><li class="square"><p>*.hypervrecoverymanager.windowsazure.com</p></li></ul><h3 class="da-h3" id="1191867">Preparation for Agentless VMware Migration</h3><p>The following sections cover the prerequisites, requirements, and permissions tasks that need to be done prior to an agentless VMWare migration.</p><ol class="number"><li><p>Review <a href="https://docs.microsoft.com/en-us/azure/migrate/migrate-support-matrix-vmware#assessment-vmware-server-requirements" title="" target="_blank">VMware server requirements</a> for agentless migration.</p></li><li><p>Set up an account to access the vCenter Server with the <a href="https://docs.microsoft.com/en-us/azure/migrate/migrate-support-matrix-vmware#agentless-migration-vcenter-server-permissions" title="" target="_blank">required permissions</a> for agentless migration.</p></li><li><p>Note the <a href="https://docs.microsoft.com/en-us/azure/migrate/migrate-support-matrix-vmware#agentless-migration-vmware-vm-requirements" title="" target="_blank">requirements for VMware VMs</a> that you want to migrate to Azure using agentless migration.</p></li><li><p>Review <a href="https://docs.microsoft.com/en-us/azure/migrate/migrate-support-matrix-vmware#assessment-appliance-requirements" title="" target="_blank">appliance requirements</a> for agentless migration.</p></li><li><p>Note <a href="https://docs.microsoft.com/en-us/azure/migrate/migrate-support-matrix-vmware#assessment-url-access-requirements" title="" target="_blank">appliance URL access</a> and <a href="https://docs.microsoft.com/en-us/azure/migrate/migrate-support-matrix-vmware#assessment-port-requirements" title="" target="_blank">port access</a> requirements for agentless migration.</p></li></ol><h4 class="da-h4">Agentless migration-VMware server requirements</h4><p>This table summarizes assessment support and limitations for VMware visualization servers.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p><b>Support</b></p></td><td><p><b>Details</b></p></td></tr></thead><tbody><tr><td><p><b>vCenter server</b></p></td><td><p>VMware VMs you migrate using an agentless migration must be managed by one or more vCenter Servers running 5.5, 6.0, 6.5, or 6.7.</p></td></tr></tbody></table><h4 class="da-h4">Agentless migration-vCenter Server permissions</h4><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p><b>Permissions</b></p></td><td><p><b>Details</b></p></td></tr></thead><tbody><tr><td><p>Datastore.Browse</p></td><td><p>Allow browsing of VM log files to troubleshoot snapshot creation and deletion.</p></td></tr><tr><td><p>Datastore.LowLevelFileOperations</p></td><td><p>Allow read/write/delete/rename operations in the datastore browser, to troubleshoot snapshot creation and deletion.</p></td></tr><tr><td><p>VirtualMachine.Configuration.DiskChangeTracking</p></td><td><p>Allow enable or disable change tracking of VM disks, to pull changed blocks of data between snapshots.</p></td></tr><tr><td><p>VirtualMachine.Configuration.DiskLease</p></td><td><p>Allow disk lease operations for a VM, to read the disk using the VMware vSphere Virtual Disk Development Kit (VDDK).</p></td></tr><tr><td><p>VirtualMachine.Provisioning.AllowReadOnlyDiskAccess</p></td><td><p>Allow opening a disk on a VM, to read the disk using the VDDK.</p></td></tr><tr><td><p>VirtualMachine.Provisioning.AllowVirtualMachineDownload</p></td><td><p>Allows read operations on files associated with a VM, to download the logs and troubleshoot if failure occurs.</p></td></tr><tr><td><p>VirtualMachine.SnapshotManagement</p></td><td><p>Allow creation and management of VM snapshots for replication.</p></td></tr><tr><td><p>Virtual Machine.Interaction.Power Off</p></td><td><p>Allow the VM to be powered off during migration to Azure.</p></td></tr></tbody></table><h4 class="da-h4">Agentless migration-VMware VM requirements</h4><p>Windows and Linux operating systems are supported by Azure can be migrated using agentless migration. However, some VMs might require changes so that they can run in Azure. Azure Migrate makes these changes automatically for the following operating systems:</p><ul class="square"><li class="square"><p>Red Hat Enterprise Linux 6.5+, 7.0+</p></li><li class="square"><p>CentOS 6.5+, 7.0+</p></li><li class="square"><p>SUSE Linux Enterprise Server 12 SP1+</p></li><li class="square"><p>Ubuntu 14.04LTS, 16.04LTS, 18.04LTS</p></li><li class="square"><p>Debian 7,8</p></li></ul><p>The following table summarizes the remaining agentless migration-VMware requirements, support and limitations.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p><b>Support</b></p></td><td><p><b>Details</b></p></td></tr></thead><tbody><tr><td><p><b>Linux boot</b></p></td><td><p>If /boot is on a dedicated partition, it should reside on the OS disk, and not be spread across multiple disks. If /boot is part of the root (/) partition, then the ‘/’ partition should be on the OS disk, and not span other disks.</p></td></tr><tr><td><p><b>UEFI boot</b></p></td><td><p>VMs with UEFI boot aren't supported for migration.</p></td></tr><tr><td><p><b>Encrypted disks/volumes</b></p></td><td><p>VMs with encrypted disks/volumes aren't supported for migration.</p></td></tr><tr><td><p><b>RDM/passthrough disks</b></p></td><td><p>If VMs have RDM or passthrough disks, these disks won't be replicated to Azure.</p></td></tr><tr><td><p><b>NFS</b></p></td><td><p>NFS volumes mounted as volumes on the VMs won't be replicated.</p></td></tr><tr><td><p><b>Target disk</b></p></td><td><p>VMs can only be migrated to managed disks (standard HHD, premium SSD) in Azure.</p></td></tr></tbody></table><h3 class="da-h3" id="1191870">Adding the Azure Migrate Server Migration Tool</h3><p>Having assigned the required permissions, you next add the Azure Migrate Server Migration tool to the Azure Migrate project.</p><ol class="number"><li><p>In the Azure Migrate project, click <b>Overview</b>.</p></li><li><p>In Discover, assess, and migration servers, click <b>Assess and migrate servers</b>.</p></li></ol><p><span><img alt="" src="../Images/1192096-490234.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>In Migration tools, select <b>Click here to add a migration tool when you are ready to migrate</b>.</p></li></ol><p><span><img alt="" src="../Images/1192422-490560.png" width="" height="" /></span></p><ol class="number"><li value="4"><p>In the tools list, select <b>Azure Migrate: Server Migration &gt; Add tool</b>.</p></li></ol><p><span><img alt="" src="../Images/1192423-490561.png" width="" height="" /></span></p><p>Azure Migrate Server Migration runs a lightweight VMware VM appliance. The appliance performs VM discovery and sends VM metadata and performance data to Azure Migrate Server Migration. The same appliance is also used by the Azure Migrate Server Assessment tool.</p><p>To do this:</p><p>•	Download an OVA template file and import it to vCenter Server.
•	Create the appliance, and check that it can connect to Azure Migrate Server Assessment.
•	Configure the appliance for the first time and register it with the Azure Migrate project.</p><p>✔️ These steps were introduced in Module 1.</p><h3 class="da-h3" id="1191869">Preparing Azure for Migration</h3><p>In preparing to migrate, you will need to ensure you have permissions to perform the following tasks in Azure</p><h4 class="da-h4">Assign permissions to create project</h4><ol class="number"><li><p>In the Azure portal, open the subscription, and select <b>Access control (IAM)</b>.</p></li><li><p>In <b>Check access</b>, find the relevant account, and click it to view permissions.</p></li></ol><p>You should have <b>Contributor</b> or <b>Owner</b> permissions. If you just created a free Azure account, you're the owner of your subscription. If you're not the subscription owner, work with the owner to assign the role.</p><h4 class="da-h4">Assign permissions to register the appliance</h4><p>If you're deploying the Azure Migrate appliance to assess or run an agentless migration of VMs, you need to register it. During appliance registration, Azure Migrate creates two Azure Active Directory (Azure AD) apps that uniquely identify the appliance.</p><ul class="square"><li class="square"><p>The first app communicates with Azure Migrate service endpoints.</p></li><li class="square"><p>The second app accesses an Azure Key Vault created during registration to store Azure AD app info and appliance configuration settings.</p></li></ul><h4 class="da-h4">Assign permissions to create the Azure AD apps</h4><p>You can assign permissions for Azure Migrate to create these Azure AD apps using one of the following methods:</p><ol class="number"><li><p>A tenant/global admin can grant permissions to users in the tenant, to create and register Azure AD apps.</p></li><li><p>A tenant/global admin can assign the Application Developer role (that has the permissions) to the account.</p></li></ol><p>✔️ It's worth noting that the apps don't have any other access permissions on the subscription other than those described above. Additionally, you only need these permissions when you register a new appliance. You can remove the permissions after the appliance is set up.</p><h5 class="da-h5">Prepare Azure - grant permissions</h5><p>The tenant/global admin can grant permissions as follows:</p><p>In Azure AD, the tenant/global admin should navigate to <b>Azure Active Directory &gt; Users &gt; User Settings</b>.
The admin should set App registrations to <b>Yes</b>.</p><p><span><img alt="" src="../Images/1192345-490483.png" width="" height="" /></span></p><h5 class="da-h5">Assign Application Developer role</h5><p>The tenant/global admin can assign the Application Developer role to an account.</p><h5 class="da-h5">Assign permissions to create the Key Vault</h5><p>Assign role assignment permissions on the resource group in which the Azure Migrate project resides, as follows:</p><ol class="number"><li><p>In the resource group in the Azure portal, select <b>Access control (IAM)</b>.</p></li><li><p>In <b>Check access</b>, find the relevant account, and click it to view permissions. You need <b>Owner</b> (or <b>Contributor and User Access Administrator</b>) permissions.</p></li></ol><p>✔️ If you don't have the required permissions, request them from the resource group owner.</p><h3 class="da-h3" id="1191872">Replicating VMs</h3><p>This section walks through the process of setting up replication of VMs in the Azure portal. The instructor may demonstrate this section at this point.</p><ol class="number"><li><p>In the Azure Migrate project <b>&gt; Servers, Azure Migrate: Server Migration</b>, click <b>Replicate</b>.</p></li></ol><p><span><img alt="" src="../Images/1192123-490261.png" width="" height="" /></span></p><ol class="number"><li value="2"><p>In <b>Replicate, &gt; Source settings &gt; Are your machines virtualized?</b>, select <b>Yes, with VMware vSphere</b>.</p></li><li><p>In <b>On-premises appliance</b>, select the name of the Azure Migrate appliance that you set up and click <b>OK</b>.</p></li></ol><p><span><img alt="" src="../Images/1192124-490262.png" width="" height="" /></span></p><ol class="number"><li value="4"><p>In <b>Virtual machines</b>, select the machines you want to replicate.</p></li></ol><p><span><img alt="" src="../Images/1192073-490211.png" width="" height="" /></span></p><ol class="number"><li value="5"><p>If you've run an assessment for the VMs, you can apply VM sizing and disk type (premium/standard) recommendations from the assessment results. To do this, in <b>Import migration settings from an Azure Migrate assessment?</b>, select the <b>Yes</b> option.</p><p>If you didn't run an assessment, or you don't want to use the assessment settings, select the <b>No</b> option.</p><p>If you selected to use the assessment, select the VM group, and assessment name.</p></li><li><p>In <b>Virtual machines</b>, search for VMs as needed, and check each VM you want to migrate. Then click <b>Next: Target settings</b>.</p></li></ol><p><span><img alt="" src="../Images/1192074-490212.png" width="" height="" /></span></p><h3 class="da-h3" id="1191873">Target, Compute, and Disk Settings</h3><p>This section completes the process of setting up replication of VMs in the Azure portal by showing how to configure target, compute, and disk settings.</p><h4 class="da-h4">Target settings</h4><ol class="number"><li><p>In <b>Target settings</b>, select the subscription, and target region to which you'll migrate, and specify the resource group in which the Azure VMs will reside after migration.</p></li><li><p>In <b>Virtual Network</b>, select the Azure VNet/subnet to which the Azure VMs will be joined after migration.</p></li><li><p>In <b>Azure Hybrid Benefit</b>:</p><p>Select <b>No</b> if you don't want to apply Azure Hybrid Benefit. Then click <b>Next</b>.</p><p>Select <b>Yes</b> if you have Windows Server machines that are covered with active Software Assurance or Windows Server subscriptions, and you want to apply the benefit to the machines you're migrating. Then click <b>Next</b>.</p></li></ol><p><span><img alt="" src="../Images/1192120-490258.png" width="" height="" /></span></p><h4 class="da-h4">Compute settings</h4><ol class="number"><li value="4"><p>In <b>Compute</b>, review the VM name, size, OS disk type, and availability set. VMs must conform with <a href="https://docs.microsoft.com/en-us/azure/migrate/migrate-support-matrix-vmware" title="" target="_blank">Azure requirements</a>.</p><ul class="square"><li class="square"><p><b>VM size</b>: If you're using assessment recommendations, the VM size dropdown will contain the recommended size. Otherwise Azure Migrate picks a size based on the closest match in the Azure subscription. Alternatively, pick a manual size in <b>Azure VM size</b>.</p></li><li class="square"><p><b>OS disk</b>: Specify the OS (boot) disk for the VM. The OS disk is the disk that has the operating system bootloader and installer.</p></li><li class="square"><p><b>Availability set</b>: If the VM should be in an Azure availability set after migration, specify the set. The set must be in the target resource group you specify for the migration.</p></li></ul></li></ol><p><span><img alt="" src="../Images/1192121-490259.png" width="" height="" /></span></p><h4 class="da-h4">Disk settings</h4><ol class="number"><li value="5"><p>In <b>Disks</b>, specify whether the VM disks should be replicated to Azure, and select the disk type (standard SSD/HDD or premium-managed disks) in Azure. Then click <b>Next</b>.
You can exclude disks from replication.
If you exclude disks, they won't be present on the Azure VM after migration.</p></li></ol><p><span><img alt="" src="../Images/1192122-490260.png" width="" height="" /></span></p><ol class="number"><li value="6"><p>In <b>Review and start replication</b>, review the settings, and click <b>Replicate</b> to start the initial replication for the servers.</p></li></ol><h3 class="da-h3" id="1191876">Migrating Virtual Machines</h3><p>After you've verified that the test migration works as expected, you can migrate the on-premises machines.</p><ol class="number"><li><p>In the Azure Migrate project <b>&gt; Servers &gt; Azure Migrate: Server Migration</b>, click <b>Replicating servers</b>.</p></li><li><p>In <b>Replicating machines</b>, right-click the VM <b>&gt;Migrate</b>.</p></li></ol><p><span><img alt="" src="../Images/1192317-490455.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>In <b>Migrate &gt; Shut down virtual machines and perform a planned migration with no data loss</b>, select <b>Yes &gt; OK</b>.</p><ul class="square"><li class="square"><p>By default Azure Migrate shuts down the on-premises VM and runs an on-demand replication to synchronize any VM changes that occurred since the last replication occurred. This ensures no data loss.</p></li><li class="square"><p>If you don't want to shut down the VM, select <b>No</b>.</p></li></ul></li><li><p>A migration job starts for the VM. Track the job in Azure notifications.</p></li><li><p>After the job finishes, you can view and manage the VM from the <b>Virtual Machines</b> page.</p></li></ol><h4 class="da-h4">Complete the migration</h4><ol class="number"><li><p>After the migration is done, right-click the VM <b>&gt; Stop migration</b>. This stops replication for the on-premises machine, and cleans up replication state information for the VM.</p></li><li><p>Install the Azure VM <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/agent-windows" title="" target="_blank">Windows</a> or <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/extensions/agent-linux" title="" target="_blank">Linux</a> agent on the migrated machines.</p></li><li><p>Perform any post-migration app tweaks, such as updating database connection strings, and web server configurations.</p></li><li><p>Perform final application and migration acceptance testing on the migrated application now running in Azure.</p></li><li><p>Cut over traffic to the migrated Azure VM instance.</p></li><li><p>Remove the on-premises VMs from your local VM inventory.</p></li><li><p>Remove the on-premises VMs from local backups.</p></li><li><p>Update any internal documentation to show the new location and IP address of the Azure VMs.</p></li></ol><h3 class="da-h3" id="1191874">Tracking and Monitoring Replication</h3><p>When you click <b>Replicate</b> a Start Replication job begins. When the Start Replication job finishes successfully, the machines begin their initial replication to Azure.
During initial replication, a VM snapshot is created. Disk data from the snapshot is replicated to replica managed disks in Azure.
After initial replication finishes, delta replication begins. Incremental changes to on-premises disks are periodically replicated to the replica disks in Azure.</p><p>You can track job status in the portal notifications. You can monitor replication status by clicking on <b>Replicating servers</b> in <b>Azure Migrate: Server Migration</b>.</p><p><span><img alt="" src="../Images/1192143-490281.png" width="" height="" /></span></p><h4 class="da-h4">Provisioning for the first time</h4><p>If this is the first VM you're replicating in the Azure Migrate project, Azure Migrate Server Migration automatically provisions these resources in same resource group as the project.</p><ul class="square"><li class="square"><p><b>Service bus</b>: Azure Migrate Server Migration uses the service bus to send replication orchestration messages to the appliance.</p></li><li class="square"><p><b>Gateway storage account</b>: Server Migration uses the gateway storage account to store state information about the VMs being replicated.</p></li><li class="square"><p><b>Log storage account</b>: The Azure Migrate appliance uploads replication logs for VMs to a log storage account. Azure Migrate applies the replication information to the replica managed disks.</p></li><li class="square"><p><b>Key vault</b>: The Azure Migrate appliance uses the key vault to manage connection strings for the service bus, and access keys for the storage accounts used in replication. You should have set up the permissions that the key vault needs to access the storage account when you prepared. <a href="https://docs.microsoft.com/en-us/azure/migrate/tutorial-prepare-vmware" title="" target="_blank">Review these permissions</a>.</p></li></ul><h3 class="da-h3" id="1191879">Preparing the On-premises VMware Environment</h3><p>As part of the preparation of the VMware environment, you must prepare an account for automatic discovery of the virtual machines on the VMware hosts. Azure Migrate Server Migration needs access to VMware servers to:</p><ul class="square"><li class="square"><p>Automatically discover VMs. At least a read-only account is required.</p></li><li class="square"><p>Orchestrate replication, failover, and failback.</p></li></ul><p>You need an account that can run operations such as creating and removing disks and powering on VMs. Use a dedicated account, create a role at the vCenter level. In addition, you must install the Mobility service on machines you want to replicate.</p><h4 class="da-h4">Roles and permissions required for the VMware account</h4><p>The following lists provide details on roles and permissions for the VMware account:</p><h5 class="da-h5">VM discovery</h5><ul class="square"><li class="square"><p>At least a read-only user
</p><ul class="square"><li class="square"><p>User assigned at datacenter level, and has access to all the objects in the datacenter.</p></li></ul></li><li class="square"><p>Data Center object –&gt; Propagate to Child Object, role=Read-only
</p><ul class="square"><li class="square"><p>To restrict access, assign the <b>No access</b> role with the <b>Propagate to child</b> object, to the child objects (vSphere hosts, datastores, VMs and networks).</p></li></ul></li></ul><h5 class="da-h5">Full replication, failover, failback</h5><ul class="square"><li class="square"><p>Create a role (Azure_Site_Recovery) with the required permissions, and then assign the role to a VMware user or group
</p><ul class="square"><li class="square"><p>User assigned at datacenter level, and has access to all the objects in the datacenter.</p></li></ul></li><li class="square"><p>Data Center object –&gt; Propagate to Child Object, role=Azure_Site_Recovery
</p><ul class="square"><li class="square"><p>To restrict access, assign the <b>No access</b> role with the <b>Propagate to child</b> object, to the child objects (vSphere hosts, datastores, VMs and networks).</p></li></ul></li><li class="square"><p>Datastore -&gt; Allocate space, browse datastore, low-level file operations, remove file, update virtual machine files</p></li><li class="square"><p>Network -&gt; Network assign</p></li><li class="square"><p>Resource -&gt; Assign VM to resource pool, migrate powered off VM, migrate powered on VM</p></li><li class="square"><p>Tasks -&gt; Create task, update task</p></li><li class="square"><p>Virtual machine -&gt; Configuration</p></li><li class="square"><p>Virtual machine -&gt; Interact -&gt; answer question, device connection, configure CD media, configure floppy media, power off, power on, VMware tools install</p></li><li class="square"><p>Virtual machine -&gt; Inventory -&gt; Create, register, unregister</p></li><li class="square"><p>Virtual machine -&gt; Provisioning -&gt; Allow virtual machine download, allow virtual machine files upload</p></li><li class="square"><p>Virtual machine -&gt; Snapshots -&gt; Remove snapshots</p></li></ul><h4 class="da-h4">Prepare an account for Mobility service installation</h4><p>The Mobility service must be installed on machines you want to replicate. The Azure Migrate replication appliance can do a push installation of this service when you enable replication for a machine, or you can install it manually, or using installation tools.</p><p>✔️ In this topic, we will look at installing the Mobility service with the push installation.</p><p>For this push installation, you need to prepare an account that Azure Migrate Server Migration can use to access the VM.</p><p>Prepare the account as follows:</p><p>Prepare a domain or local account with permissions to install on the VM.</p><ul class="square"><li class="square"><p><b>Windows VMs</b>: To install on Windows VMs if you're not using a domain account, disable Remote User Access control on the local machine. To do this, in the registry <b>&gt; HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System</b>, add the DWORD entry <b>LocalAccountTokenFilterPolicy</b>, with a value of 1.</p></li><li class="square"><p><b>Linux VMs</b>: To install on Linux VMs, prepare a root account on the source Linux server.</p></li></ul><h3 class="da-h3" id="1191881">Replication Appliance</h3><p>As introduced in the previous lesson, the replication appliance is a single, highly available, on-premises VMware VM that hosts these components:</p><ul class="square"><li class="square"><p><b>Configuration server</b>: The configuration server coordinates communications between on-premises and Azure and manages data replication.</p></li><li class="square"><p><b>Process server</b>: The process server acts as a replication gateway. It receives replication data; optimizes it with caching, compression, and encryption, and sends it to a cache storage account in Azure.</p><p>The Process server also installs the Mobility Service agent on VMs you want to replicate and performs automatic discovery of on-premises VMware VMs.</p></li></ul><h4 class="da-h4">Download the appliance template</h4><ol class="number"><li><p>In the Azure Migrate project click <b>Servers</b> under <b>Migration Goals</b>.</p></li><li><p>In <b>Azure Migrate - Servers &gt; Azure Migrate: Server Migration</b>, click <b>Discover</b>.</p></li></ol><p><span><img alt="" src="../Images/1192057-490195.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>In <b>Discover machines &gt; Are your machines virtualized?</b>, click <b>Yes, with VMWare vSphere hypervisor</b>.</p></li><li><p>In <b>How do you want to migrate?</b>, select <b>Using agent-based replication</b>.</p></li><li><p>In <b>Target region</b>, select the Azure region to which you want to migrate the machines.</p></li><li><p>Select <b>Confirm that the target region for migration is region-name</b>.</p></li><li><p>Click <b>Create resources</b>. This creates an Azure Site Recovery vault in the background.</p><p>You can't change the target region for this project after clicking this button. All subsequent migrations are to this region.</p></li></ol><p><span><img alt="" src="../Images/1192058-490196.png" width="" height="" /></span></p><h4 class="da-h4">Download the appliance</h4><ol class="number"><li><p>In <b>Do you want to install a new replication appliance?</b>, select <b>Install a replication appliance</b>.</p></li><li><p>Click <b>Download</b>, to download the replication appliance. This downloads an OVF template that you use to create a new VMware VM that runs the appliance.</p></li><li><p>Note the name of the resource group and the Recovery Services vault. You need these during appliance deployment.</p></li></ol><p><span><img alt="" src="../Images/1192059-490197.png" width="" height="" /></span></p><h4 class="da-h4">Import appliance to VMware</h4><p>After downloading the OVF template, you import it into VMware to create the replication application on a VMware VM running Windows Server 2016.</p><ol class="number"><li><p>Sign into the VMware vCenter server or vSphere ESXi host with the VMWare vSphere Client.</p></li><li><p>On the <b>File</b> menu, select <b>Deploy OVF Template</b> to start the <b>Deploy OVF Template Wizard</b>.</p></li><li><p>In <b>Select source</b>, enter the location of the downloaded OVF.</p></li><li><p>In <b>Review details</b>, select <b>Next</b>.</p></li><li><p>In <b>Select name and folder</b> and <b>Select configuration</b>, accept the default settings.</p></li><li><p>In <b>Select storage &gt; Select virtual disk format</b>, for best performance select <b>Thick Provision Eager Zeroed</b>.</p></li><li><p>On the rest of the wizard pages, accept the default settings.</p></li><li><p>In <b>Ready to complete</b>, to set up the VM with the default settings, select <b>Power on after deployment &gt; Finish</b>.</p></li></ol><p><span><img alt="" src="../Images/1192060-490198.png" width="" height="" /></span></p><h3 class="da-h3" id="1191880">Adding the Azure Migrate Server Migration Tool</h3><p>As explained in the previous lesson, If you have not yet done so, you need to set up an Azure Migrate project, and then add the Azure Migrate Server Migration tool.</p><ol class="number"><li><p>In the Azure portal, select <b>All services</b>, and search for <b>Azure Migrate</b>.</p></li><li><p>Under Services, select <b>Azure Migrate</b>.</p></li><li><p>In the Azure Migrate project, click <b>Overview</b>.</p></li><li><p>In <b>Windows and Linux servers</b>, click <b>Assess and migrate servers</b>.</p></li></ol><p><span><img alt="" src="../Images/1192096-490234.png" width="" height="" /></span></p><ol class="number"><li value="5"><p>In <b>Discover, assess and migrate servers</b>, click <b>Add tools</b>.</p></li><li><p>In <b>Migrate project</b>, select your Azure subscription, and create a resource group if you don't have one.</p></li><li><p>In <b>Project Details</b>, specify the project name, and geography in which you want to create the project, and click <b>Next</b>.</p></li><li><p>In <b>Select assessment tool</b>, select <b>Skip adding an assessment tool for now &gt; Next</b>.</p></li><li><p>In <b>Select migration tool</b>, select <b>Azure Migrate: Server Migration &gt; Next</b>.</p></li><li><p>In <b>Review + add tools</b>, review the settings and click <b>Add tools</b>.</p><p>After adding the tool, it appears in the Azure Migrate project <b>&gt; Servers &gt; Migration tools</b>.</p></li></ol><p><span><img alt="" src="../Images/1192097-490235.png" width="" height="" /></span></p><h3 class="da-h3" id="1191875">Testing the Migration</h3><p>When delta replication begins, you can run a test migration for the VMs, before running a full migration to Azure. We highly recommend that you do this at least once for each machine, before you migrate it.</p><p>Running a test migration checks that migration will work as expected, without impacting the on-premises machines, which remain operational, and continue replicating. Test migration simulates the migration by creating an Azure VM using replicated data (usually migrating to a non-production VNet in your Azure subscription).</p><p>You can use the replicated test Azure VM to validate the migration, perform app testing, and address any issues before full migration.</p><ol class="number"><li><p>In <b>Migration goals &gt; Servers &gt; Azure Migrate: Server Migration</b>, click <b>Test migrated servers</b>.</p></li></ol><p><span><img alt="" src="../Images/1192066-490204.png" width="" height="" /></span></p><p>In <b>Test Migration</b>, select the Azure VNet in which the Azure VM will be located after the migration. We recommend you use a non-production VNet. The <b>Test migration</b> job starts. Monitor the job in the portal notifications. After the migration finishes, view the migrated Azure VM in <b>Virtual Machines</b> in the Azure portal. The machine name has a suffix <b>-Test</b>.</p><ol class="number"><li value="2"><p>Right-click the VM to test, and click <b>Test migrate</b>.</p></li></ol><p><span><img alt="" src="../Images/1192067-490205.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>After the test is done, right-click the Azure VM in <b>Replicating machines</b>, and click <b>Clean up test migration</b>.</p></li></ol><p><span><img alt="" src="../Images/1192068-490206.png" width="" height="" /></span></p><h3 class="da-h3" id="1191882">Appliance Setup and Registration</h3><p>Having obtained the required permissions to register the replication appliance, continue the appliance set up and register the appliance prior to replicating VMs.</p><h4 class="da-h4">Replication appliance setup</h4><ol class="number"><li><p>From the VMWare vSphere Client console, turn on the VM.</p></li><li><p>The VM boots up into a Windows Server 2016 installation experience. Accept the license agreement and enter an administrator password.</p></li><li><p>After the installation finishes, sign in to the VM as the administrator, using the admin password.</p></li><li><p>The first time you sign in, the replication appliance setup tool (Azure Site Recovery Configuration Tool) starts within a few seconds.</p></li><li><p>Enter a name to use for registering the appliance with Azure Migrate Server Migration. Then click <b>Next</b>.</p></li><li><p>The tool checks that the VM can connect to Azure. After the connection is established, select <b>Sign in</b> to sign in to your Azure subscription.</p></li><li><p>Wait for the tool to finish registering an Azure AD app to identify the appliance. The appliance reboots.</p></li><li><p>Sign in to the machine again. In a few seconds, the Configuration Server Management Wizard starts automatically.</p></li></ol><h4 class="da-h4">Register the replication appliance</h4><p>Finish setting up and registering the replication appliance.</p><ol class="number"><li><p>In the Configuration Server Management Wizard, select <b>Setup connectivity</b>.</p></li><li><p>Select the NIC (by default there's only one NIC) that the replication appliance uses for VM discovery, and to do a push installation of the Mobility service on source machines.</p></li><li><p>Select the NIC that the replication appliance uses for connectivity with Azure. Then select <b>Save</b>. You cannot change this setting after it's configured.</p></li><li><p>If the appliance is located behind a proxy server, you need to specify proxy settings.</p><p>Specify the proxy name as <b>http://ip-address</b>, or <b>http://FQDN</b>. HTTPS proxy servers aren't supported.</p></li><li><p>When prompted for the subscription, resource groups, and vault details, add the details that you noted when you downloaded the appliance template.</p></li><li><p>In <b>Install third-party software</b>, accept the license agreement. Select <b>Download and Install</b> to install MySQL Server.</p></li><li><p>Select <b>Install VMware PowerCLI</b>. Make sure all browser windows are closed before you do this. Then select <b>Continue</b>.</p></li><li><p>In <b>Validate appliance configuration</b>, prerequisites are verified before you continue.</p></li><li><p>In <b>Configure vCenter Server/vSphere ESXi server</b>, enter the FQDN or IP address of the vCenter server, or vSphere host, where the VMs you want to replicate are located. Enter the port on which the server is listening. Enter a friendly name to be used for the VMware server in the vault.</p></li><li><p>Enter the credentials for the account you created for <a href="https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-vmware-agent" title="" target="_blank">VMware discovery</a>. Select <b>Add &gt; Continue</b>.</p></li><li><p>In <b>Configure virtual machine credentials</b>, <a href="https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-vmware-agent#register-the-replication-appliance" title="" target="_blank">enter the credentials</a> you created for push installation of the Mobility service, when you enable replication for VMs.</p><p>For Windows machines, the account needs local administrator privileges on the machines you want to replicate.</p><p>For Linux, provide details for the root account.</p></li><li><p>Select <b>Finalize configuration</b> to complete registration.</p></li></ol><p>After the replication appliance is registered, Azure Migrate Server Assessment connects to VMware servers using the specified settings and discovers VMs. You can view discovered VMs in <b>Manage &gt; Discovered items</b>, in the <b>Other</b> tab.</p><h3 class="da-h3" id="1191886">Tracking and Monitoring Replication</h3><p>When you click <b>Replicate</b> a Start Replication job begins. When the Start Replication job finishes successfully, the machines begin their initial replication to Azure.
During initial replication, a VM snapshot is created. Disk data from the snapshot is replicated to replica managed disks in Azure.
After initial replication finishes, delta replication begins. Incremental changes to on-premises disks are periodically replicated to the replica disks in Azure.</p><p>You can track job status in the portal notifications. You can monitor replication status by clicking on <b>Replicating servers</b> in <b>Azure Migrate: Server Migration</b>.</p><p><span><img alt="" src="../Images/1192143-490281.png" width="" height="" /></span></p><p>✔️ The process of tracking and monitoring is the same whether replicating VMs using agentless migration or agent-based migration.</p><h3 class="da-h3" id="1191883">Replicating VMs</h3><p>This section walks through the process of setting up replication of VMs in the Azure portal. The instructor may demonstrate this section at this point.</p><ol class="number"><li><p>In the Azure Migrate project <b>&gt; Servers, Azure Migrate: Server Migration</b>, click <b>Replicate</b>.</p></li></ol><p><span><img alt="" src="../Images/1192123-490261.png" width="" height="" /></span></p><ol class="number"><li value="2"><p>In <b>Replicate, &gt; Source settings &gt; Are your machines virtualized?</b>, select <b>Yes, with VMware vSphere</b>.</p></li><li><p>In <b>On-premises appliance</b>, select the name of the Azure Migrate appliance that you set up and click <b>OK</b>.</p></li><li><p>In <b>vCenter server</b>, specify the name of the vCenter server managing the VMs, or the vSphere server on which the VMs are hosted.</p></li><li><p>In <b>Process Server</b>, select the name of the replication appliance.</p></li><li><p>In <b>Guest credentials</b>, specify the VM admin account that will be used for push installation of the Mobility service. Then click <b>Next: Virtual machines</b>.</p></li></ol><p><span><img alt="" src="../Images/1192283-490421.png" width="" height="" /></span></p><p>✔️ The next topic <i>Replication - Selecting the VMs to Replicate</i> is a continuation of this topic.</p><h3 class="da-h3" id="1191885">Replication - Target, Compute, and Disk Settings</h3><p>This section completes  the process of setting up replication of VMs in the Azure portal.<br />
It covers how to configure target, compute, and disk settings.</p><h4 class="da-h4">Target settings</h4><ol class="number"><li><p>In <b>Target settings</b>, select the subscription, and target region to which you'll migrate, and specify the resource group in which the Azure VMs will reside after migration.</p></li><li><p>In <b>Virtual Network</b>, select the Azure VNet/subnet to which the Azure VMs will be joined after migration.</p></li><li><p>In <b>Azure Hybrid Benefit</b>:</p><p>Select <b>No</b> if you don't want to apply Azure Hybrid Benefit. Then click <b>Next</b>.</p><p>Select <b>Yes</b> if you have Windows Server machines that are covered with active Software Assurance or Windows Server subscriptions, and you want to apply the benefit to the machines you're migrating. Then click <b>Next</b>.</p></li></ol><p><span><img alt="" src="../Images/1192120-490258.png" width="" height="" /></span></p><h4 class="da-h4">Compute settings</h4><ol class="number"><li value="4"><p>In <b>Compute</b>, review the VM name, size, OS disk type, and availability set. VMs must conform with <a href="https://docs.microsoft.com/en-us/azure/migrate/migrate-support-matrix-vmware" title="" target="_blank">Azure requirements</a>.</p><ul class="square"><li class="square"><p><b>VM size</b>: If you're using assessment recommendations, the VM size dropdown will contain the recommended size. Otherwise Azure Migrate picks a size based on the closest match in the Azure subscription. Alternatively, pick a manual size in <b>Azure VM size</b>.</p></li><li class="square"><p><b>OS disk</b>: Specify the OS (boot) disk for the VM. The OS disk is the disk that has the operating system bootloader and installer.</p></li><li class="square"><p><b>Availability set</b>: If the VM should be in an Azure availability set after migration, specify the set. The set must be in the target resource group you specify for the migration.</p></li></ul></li></ol><p><span><img alt="" src="../Images/1192121-490259.png" width="" height="" /></span></p><h4 class="da-h4">Disk settings</h4><ol class="number"><li value="5"><p>In <b>Disks</b>, specify whether the VM disks should be replicated to Azure, and select the disk type (standard SSD/HDD or premium-managed disks) in Azure. Then click <b>Next</b>.
You can exclude disks from replication.
If you exclude disks, they won't be present on the Azure VM after migration.</p></li></ol><p><span><img alt="" src="../Images/1192122-490260.png" width="" height="" /></span></p><ol class="number"><li value="6"><p>In <b>Review and start replication</b>, review the settings, and click <b>Replicate</b> to start the initial replication for the servers.</p></li></ol><h3 class="da-h3" id="1191887">Testing the Migration</h3><p>When delta replication begins, you can run a test migration for the VMs, before running a full migration to Azure. We highly recommend that you do this at least once for each machine, before you migrate it.</p><p>Running a test migration checks that migration will work as expected, without impacting the on-premises machines, which remain operational, and continue replicating. Test migration simulates the migration by creating an Azure VM using replicated data (usually migrating to a non-production VNet in your Azure subscription).</p><p>You can use the replicated test Azure VM to validate the migration, perform app testing, and address any issues before full migration.</p><ol class="number"><li><p>In <b>Migration goals &gt; Servers &gt; Azure Migrate: Server Migration</b>, click <b>Test migrated servers</b>.</p></li></ol><p><span><img alt="" src="../Images/1192066-490204.png" width="" height="" /></span></p><p>In <b>Test Migration</b>, select the Azure VNet in which the Azure VM will be located after the migration. We recommend you use a non-production VNet. The <b>Test migration</b> job starts. Monitor the job in the portal notifications. After the migration finishes, view the migrated Azure VM in <b>Virtual Machines</b> in the Azure portal. The machine name has a suffix <b>-Test</b>.</p><ol class="number"><li value="2"><p>Right-click the VM to test, and click <b>Test migrate</b>.</p></li></ol><p><span><img alt="" src="../Images/1192067-490205.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>After the test is done, right-click the Azure VM in <b>Replicating machines</b>, and click <b>Clean up test migration</b>.</p></li></ol><p><span><img alt="" src="../Images/1192068-490206.png" width="" height="" /></span></p><p>✔️ The process for testing the migration is the same whether replicating VMs using agentless migration or agent-based migration.</p><h3 class="da-h3" id="1191889">Azure VM Backup Architecture</h3><p>Let’s look at the Azure Virtual Machine Architecture.</p><p><span><img alt="" src="../Images/1192099-490237.png" width="" height="" /></span></p><ul class="square"><li class="square"><p>Microsoft has an extension inside of every Azure VM</p><ul class="square"><li class="square"><p>When you configure Backup, it communicates with the Azure Backup Service and associates itself to a policy.</p></li><li class="square"><p>It identifies itself to the Azure Backup Service as a VM, and that the service should back it up accordingly.</p></li></ul></li><li class="square"><p>When it’s time for backup per the backup policy, Microsoft sends a command to the Azure Backup extension and then Azure Backup orchestrates a VSS snapshot.</p></li><li class="square"><p>Once the snapshot is available it goes to your local VM storage as an instant recovery snapshot which you can quickly recover from as it is in your VM storage.</p></li><li class="square"><p>In the background, the snapshot is compared to a snapshot of a previous recovery point and moves only the incremental blocks via HTTPs into the recovery services vault.</p></li><li class="square"><p>The recovery services vault has encryption enabled via server-side encryption (SSE), so the backup is encrypted at rest and is protected while in transit.</p></li><li class="square"><p>When you secure your data via Azure Disk Encryption you are given keys, key encryption key (KEK) and BitLocker encryption key (BEK), which go to an Azure key vault, and are also backed up via Azure Backup.</p><p>This is important because when you recover, you don’t have to worry about what keys you had when the backup was taken and the keys are restored for you to apply these keys on the recovered data.</p></li></ul><h3 class="da-h3" id="1191890">Microsoft Azure Backup Overview</h3><p>Microsoft Azure Backup Service offers IT administrators the option to back up and protect critical data in an easily recoverable way from any location.
<span><img alt="" src="../Images/1192157-490295.png" width="" height="" /></span>
The Microsoft Azure Backup Service provides a new way to deliver business continuity benefits to Windows Server 2012 customers by providing a backup solution that requires no upfront hardware cost.</p><p>System Center 2012 SP1 Data Protection Manager customers get the added option to select online backup as a short-term recovery goal.</p><p>Microsoft Azure Backup is a cloud-hosted backup solution that provides file and folder backup capabilities for Windows Server 2012, Windows Server 2012 R2 and Windows Server 2008 R2 computers.</p><p>The Microsoft Azure Backup Agent can back up either files or folders. Customers can use system Center 2012 SP1 Data Protection Manager to back up File/volume, SQL Server and Hyper-V workloads to Azure online storage. Adding Update Rollup 6 to System Center Data Protection Manager will enable customers to do System State backups and Bare Metal Restores.</p><p>The fundamental workflow when you backup and restore files and folders to and from Microsoft Azure Backup using the Microsoft Azure Backup Agent are similar workflows that you would experience using any other type of backup.</p><p>Much like Windows Server Backup, you identify the items to backup and then the items are copied to a storage where they can be accessed later if they are needed.  The difference is that with Azure Backup, the data is compressed and encrypted and the final destination is in the cloud.</p><h3 class="da-h3" id="1191898">Azure to Azure VM Protection</h3><p>Establish a recovery services vault in a different location other than where your VMs reside.</p><p><span><img alt="" src="../Images/1192334-490472.png" width="" height="" /></span></p><h3 class="da-h3" id="1191899">Configuration</h3><p>Because Azure to Azure ASR is managed as a SaaS-like service, there is no infrastructure to create – and no agents or providers to install. You begin with the first step, which in this case is to replicate the application.</p><p>The system will automatically install the ASR Mobility Service on each protected VM in the background.</p><p><span><img alt="" src="../Images/1192355-490493.png" width="" height="" /></span></p><h3 class="da-h3" id="1191900">Enable Replication</h3><p>This procedure assumes that the primary Azure region is East Asia, and the secondary region is South East Asia.</p><ol class="number"><li><p>In the vault, click <b>+Replicate</b>.
<span><img alt="" src="../Images/1192349-490487.png" width="" height="" /></span>
Note the following fields:</p><ul class="square"><li class="square"><p><b>Source</b>: The point of origin of the VMs, which in this case is Azure.</p></li><li class="square"><p><b>Source location</b>: The Azure region from where you want to protect your virtual machines. For this illustration, the source location is <i>East Asia</i></p></li><li class="square"><p><b>Deployment model</b>: Azure deployment model of the source machines.</p></li><li class="square"><p><b>Source subscription</b>: The subscription to which your source virtual machines belong. This can be any subscription within the same Azure Active Directory tenant where your recovery services vault exists.</p></li><li class="square"><p><b>Resource Group</b>: The resource group to which your source virtual machines belong. All the VMs under the selected resource group are listed for protection in the next step.</p></li></ul></li><li><p>In <b>Virtual Machines &gt; Select virtual machines</b>, click and select each VM that you want to replicate. You can only select machines for which replication can be enabled. Then, click <b>OK</b>.</p></li></ol><h3 class="da-h3" id="1191902">Customize Target Resources</h3><p>You can modify the default target settings used by Site Recovery.
<span><img alt="" src="../Images/1192061-490199.png" width="" height="" /></span></p><ol class="number"><li><p>Click Customize: next to ‘Target subscription’ to modify the default target subscription. Select the subscription from the list of all the subscriptions available in the same Azure Active Directory (AAD) tenant.</p></li><li><p>Click <b>Customize</b>: to modify default settings:</p></li><li><p>In <b>Target resource group</b>, select the resource group from the list of all the resource groups in the target location of the subscription.</p></li><li><p>In <b>Target virtual network</b>, select the network from a list of all the virtual network in the target location.</p></li><li><p>In <b>Availability set</b>, you can add availability set settings to the VM, if they're part of an availability set in the source region.</p></li><li><p>In <b>Target Storage accounts</b>, select the account you want to use.</p></li></ol><h3 class="da-h3" id="1191943">Demonstration - Create a Function App</h3><p>Functions are hosted in an execution context called a function app. You define function apps to logically group and structure your functions and a compute resource in Azure.</p><h4 class="da-h4">Create a function app</h4><p>Do the following to create a function app in the Azure portal.</p><ol class="number"><li><p>Sign into the <a href="https://portal.azure.com/learn.docs.microsoft.com" title="" target="_blank">Azure portal </a>.</p></li><li><p>From the portal menu, select <b>Create a resource</b>.</p></li></ol><p><span><img alt="" src="../Images/1192163-490301.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>Select <b>Compute &gt; Function App</b>.</p></li></ol><p><span><img alt="" src="../Images/1192164-490302.png" width="" height="" /></span></p><ol class="number"><li value="4"><p>Select an Azure subscription.</p></li><li><p>Select a resource group or create a new on.</p></li><li><p>Type an app name.</p></li><li><p>Select <b>Code</b>.</p></li><li><p>For <b>Runtime stack</b>, select <b>.NET Core</b>.</p></li><li><p>For <b>Version</b> select <b>3.1</b>.</p></li><li><p>Select <b>Review + create</b>.</p></li></ol><p><span><img alt="" src="../Images/1192165-490303.png" width="" height="" /></span></p><ol class="number"><li value="11"><p>Review the <b>Function App</b> details and select <b>Create</b>.</p></li></ol><p><span><img alt="" src="../Images/1192166-490304.png" width="" height="" /></span></p><h4 class="da-h4">Verify your Azure function app</h4><ol class="number"><li><p>After the deployment is complete, select <b>Your deployment is complete</b>.</p></li></ol><p><span><img alt="" src="../Images/1192167-490305.png" width="" height="" /></span></p><ol class="number"><li value="2"><p>From the information page for you function app, underneath <b>URL</b>, click the link for your function app.</p></li></ol><p><span><img alt="" src="../Images/1192168-490306.png" width="" height="" /></span></p><p>The item with the lightning bolt Function icon, listed as an App Service, is your new function app. You can click on it to open the details about the new function - it has a public URL assigned to it, if you open that in a browser, you should get a default web page that indicates your Function App is running.</p><p><span><img alt="" src="../Images/1192169-490307.png" width="" height="" /></span></p><h3 class="da-h3" id="1191904">Recovery Plans</h3><p>A recovery plan helps you to define a systematic recovery process, by creating small independent units that you can fail over. A unit typically represents an app in your environment. A recovery plan defines how machines fail over, and the sequence in which they start after failover.</p><p><span><img alt="" src="../Images/1192223-490361.png" width="" height="" /></span></p><p>Use recovery plans to:</p><ul class="square"><li class="square"><p>Model an app around its dependencies.</p></li><li class="square"><p>Automate recovery tasks to reduce RTO.</p></li><li class="square"><p>Verify that you're prepared for migration or disaster recovery by ensuring that your apps are part of a recovery plan.</p></li><li class="square"><p>Run test failover on recovery plans, to ensure disaster recovery or migration is working as expected.</p></li></ul><h4 class="da-h4">Model apps</h4><p>You can plan and create a recovery group to capture app-specific properties. As an example, let's consider a typical three-tier application with a SQL server backend, middleware, and a web frontend. Typically, you customize the recovery plan so that machines in each tier start in the correct order after failover.</p><ul class="square"><li class="square"><p>The SQL backend should start first, the middleware next, and finally the web frontend.</p></li><li class="square"><p>This start order ensures that the app is working by the time the last machine starts.</p></li><li class="square"><p>This order ensures that when the middleware starts and tries to connect to the SQL Server tier, the SQL Server tier is already running.
</p><ul class="square"><li class="square"><p>This order also helps ensure that the front-end server starts last, so that end users don't connect to the app URL before all the components are up and running, and the app is ready to accept requests.</p></li></ul></li></ul><p>To create this order, you add groups to the recovery group, and add machines into the groups. Where order is specified, sequencing is used. Actions run in parallel where appropriate, to improve application recovery RTO.
Machines in a single group fail over in parallel, while machines in different groups fail over in group order, so that Group 2 machines start their failover only after all the machines in Group 1 have failed over and started.</p><p>With this customization in place, here's what happens when you run a failover on the recovery plan:</p><ul class="square"><li class="square"><p>A shutdown step attempts to turn off the on-premises machines. The exception is if you run a test failover, in which case the primary site continues to run.</p></li><li class="square"><p>The shutdown triggers a parallel failover of all the machines in the recovery plan.</p></li><li class="square"><p>The failover prepares virtual machine disks using replicated data.</p></li><li class="square"><p>The startup groups run in order and start the machines in each group. First, Group 1 runs, then Group 2, and finally, Group 3. If there's more than one machine in any group, then all the machines start in parallel.</p></li></ul><h4 class="da-h4">Automate tasks</h4><p>Recovering large applications can be a complex task. Manual steps make the process prone to error, and the person running the failover might not be aware of all app intricacies. You can use a recovery plan to impose order, and automate the actions needed at each step, using Azure Automation runbooks for failover to Azure, or scripts. For tasks that can't be automated, you can insert pauses for manual actions into recovery plans. There are a couple of types of tasks you can configure:</p><ul class="square"><li class="square"><p><b>Tasks on the Azure VM after failover</b>: When you're failing over to Azure, you typically need to perform actions so that you can connect to the VM after failover. For example:</p><ul class="square"><li class="square"><p>Create a public IP address on the Azure VM.</p></li><li class="square"><p>Assign a network security group to the network adapter of the Azure VM.</p></li><li class="square"><p>Add a load balancer to an availability set.</p></li></ul></li><li class="square"><p><b>Tasks inside the VM after failover</b>: These tasks typically reconfigure the app running on the machine, so that it continues to work correctly in the new environment. For example:</p><ul class="square"><li class="square"><p>Modify the database connection string inside the machine.</p></li><li class="square"><p>Change the web server configuration or rules.</p></li></ul></li></ul><h3 class="da-h3" id="1191940">Access a Deployment Slot</h3><p>The new slot's host name is derived from the web app name and the name of the slot. You see this host name when you select the slot on the <b>Deployment Slots</b> page:</p><p><span><img alt="" src="../Images/1192343-490481.png" width="" height="" /></span></p><p>You can deploy your code to the new slot the same way you deploy it for the production slot. Just substitute the new slot's name or URL in the configuration of the deployment tool you use. If you use FTP to deploy, you'll see the FTP host name and username just under the slot's URL.</p><p>The new slot is effectively a separate web app with a different host name. That's why anyone on the internet can access it if they know that host name. Unless you register the slot with a search engine or link to it from a crawled page, the slot won't appear in search engine indexes. It will remain obscure to the general internet user.</p><p>You can control access to a slot by using IP address restrictions. Create a list of IP address ranges that you'll allow to access the slot or a list of ranges that you'll deny access to the slot. These lists are like the allow ranges and deny ranges that you can set up on a firewall. Use this list to permit access only to computers that belong to your company or development team.</p><h3 class="da-h3" id="1191924">Azure Container Registry</h3><p><span><img alt="" src="../Images/1192211-490349.png" width="" height="" /></span></p><p>Azure Container Registry enables you to store Docker images in the cloud, in an Azure storage account.</p><p>Container Registry is an Azure service that you can use to create your own private Docker registries. Like Docker Hub, Container Registry is organized around repositories that contain one or more images. Container Registry also lets you automate tasks such as redeploying an app when an image is rebuilt.</p><p>Security is an important reason to choose Container Registry instead of Docker Hub:</p><ul class="square"><li class="square"><p>You have much more control over who can see and use your images.</p></li><li class="square"><p>You can sign images to increase trust and reduce the chances of an image becoming accidentally (or intentionally) corrupted or otherwise infected.</p></li><li class="square"><p>All images stored in a container registry are encrypted at rest.</p></li></ul><h4 class="da-h4">Using Container Registry</h4><p>You create a registry by using either the Azure portal or the Azure CLI <b>acr create</b> command. In the following code example, the name of the new registry is myregistry:</p><div class="code language-Bash"><p class="da-divtext"><code>az acr create --name myregistry --resource-group mygroup --sku standard --admin-enabled <span class="token boolean">true</span></code></p></div><p>In addition to storing and hosting images, you can also use Container Registry to build images. Instead of building an image yourself and pushing it to Container Registry, use the CLI to upload the Docker file and other files that make up your image. Container Registry will then build the image for you. Use the <b>acr build</b> command to run a build:</p><div class="code language-Bash"><p class="da-divtext"><code>az acr build --file Dockerfile --registry myregistry --image myimage <span class="token builtin class-name">.</span></code></p></div><h3 class="da-h3" id="1191916">Demonstration - Run Azure Container Instances</h3><p>In this demonstration you create a container in Azure and expose it to the Internet with a fully qualified domain name (FQDN).</p><p>Azure Container Instances is useful for scenarios that can operate in isolated containers, including simple applications, task automation, and build jobs. Here are some of the benefits:</p><ul class="square"><li class="square"><p><b>Fast startup</b>: Launch containers in seconds.</p></li><li class="square"><p><b>Per second billing</b>: Incur costs only while the container is running.</p></li><li class="square"><p><b>Hypervisor-level security</b>: Isolate your application as completely as it would be in a VM.</p></li><li class="square"><p><b>Custom sizes</b>: Specify exact values for CPU cores and memory.</p></li><li class="square"><p>Persistent storage: Mount Azure Files shares directly to a container to retrieve and persist state.</p></li><li class="square"><p>Linux and Windows: Schedule both Windows and Linux containers using the same API.</p></li></ul><p>For scenarios where you need full container orchestration, including service discovery across multiple containers, automatic scaling, and coordinated application upgrades, we recommend Azure Kubernetes Service (AKS).</p><h4 class="da-h4">Create a container</h4><ol class="number"><li><p>Sign into the <a href="https://portal.azure.com/" title="" target="_blank">Azure portal </a> with your Azure subscription.</p></li><li><p>Open the Azure Cloud Shell from the Azure portal using the Cloud Shell icon.</p></li></ol><p><span><img alt="" src="../Images/1192137-490275.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>Create a new resource group with the name <b>learn-deploy-aci-rg</b> so that it will be easier to clean up these resources when you are finished with the module. If you choose a different resource group name, remember it for the rest of the exercises in this module. You also need to choose a region in which you want to create the resource group, for example <b>East US</b>.</p></li></ol><div class="code language-Azure"><p class="da-divtext">az group create --name learn-deploy-aci-rg --location eastus
</p></div><p>You create a container by providing a name, a Docker image, and an Azure resource group to the <span class="code">az container create</span> command. You can optionally expose the container to the Internet by specifying a DNS name label. In this example, you deploy a container that hosts a small web app. You can also select the location to place the image - you'll use the <b>East US</b> region, but you can change it to a location close to you.</p><ol class="number"><li value="4"><p>You provide a DNS name to expose your container to the Internet. Your DNS name must be unique. For learning purposes, run this command from Cloud Shell to create a Bash variable that holds a unique name.</p></li></ol><div class="code language-Azure"><p class="da-divtext">DNS_NAME_LABEL=aci-demo-$RANDOM
</p></div><ol class="number"><li value="5"><p>Run the following <span class="code">az container create</span> command to start a container instance.</p></li></ol><div class="code language-Azure"><p class="da-divtext">az container create \
  --resource-group learn-deploy-aci-rg \
  --name mycontainer \
  --image microsoft/aci-helloworld \
  --ports 80 \
  --dns-name-label $DNS_NAME_LABEL \
  --location eastus
</p></div><p><span class="code">$DNS_NAME_LABEL</span> specifies your DNS name. The image name, <b>microsoft/aci-helloworld</b>, refers to a Docker image hosted on Docker Hub that runs a basic Node.js web application.</p><ol class="number"><li value="6"><p>When the <span class="code">az container create</span> command completes, run <span class="code">az container show</span> to check its status.</p></li></ol><div class="code language-Azure"><p class="da-divtext">az container show \
  --resource-group learn-deploy-aci-rg \
  --name mycontainer \
  --query "{FQDN:ipAddress.fqdn,ProvisioningState:provisioningState}" \
  --out table
</p></div><p>You see your container's fully qualified domain name (FQDN) and its provisioning state. Here's an example.</p><div class="code language-Output"><p class="da-divtext">FQDN ProvisioningState

-------------------------------------- -------------------

aci-demo.eastus.azurecontainer.io Succeeded
</p></div><p>If your container is in the <b>Creating</b> state, wait a few moments and run the command again until you see the <b>Succeeded</b> state.</p><ol class="number"><li value="7"><p>From a browser, navigate to your container's FQDN to see it running. You see this.</p></li></ol><p><span><img alt="" src="../Images/1192138-490276.png" width="" height="" /></span></p><h3 class="da-h3" id="1191903">Replication Settings</h3><ol class="number"><li><p>Click <b>Customize</b>: to modify replication settings.
<span><img alt="" src="../Images/1192071-490209.png" width="" height="" /></span></p></li><li><p>In <b>Multi-VM consistency</b>, select the VMs which you want to replicate together</p><ul class="square"><li class="square"><p>All the machines in a replication group will have shared crash consistent and app-consistent recovery points when failed over. Enabling multi-VM consistency can impact workload performance (as it is CPU intensive) and should be used only if machines are running the same workload and you need consistency across multiple machines.</p></li><li class="square"><p>For example, if an application has 2 sql virtual machines and 2 web servers then you should add only sql virtual machines as a part of replication group.</p></li><li class="square"><p>You can choose to have at max 16 virtual machines in a replication group.</p></li><li class="square"><p>If you enable multi-VM consistency, machines in the replication group communicate with each other over port 20004. Ensure that there is no firewall appliance blocking the internal communication between the VMs over port 20004. If you want Linux VMs to be part of a replication group, ensure the outbound traffic on port 20004 is manually opened as per the guidance of the specific Linux version.</p></li></ul></li><li><p>Click <b>Create target resource &gt; Enable Replication</b>.</p></li><li><p>After the VMs are enabled for replication, you can check the status of VM health under <b>Replicated items</b>.</p></li></ol><h3 class="da-h3" id="1191603">Azure Service Principals</h3><p>Think of an Azure service principal as a proxy account, or identity, that represents your app or service. This account is managed by Azure Active Directory (Azure AD). You grant the service principal access to the Azure resources that you need. Use the service principal instead of embedding credentials or creating a dummy account for your app.</p><p>Service principals exist at the tenant level in Azure. They're used to grant access to resources in that tenant.</p><p>In the Azure portal, you create an Azure AD application to represent your app. You then associate this application object with a service principal.</p><p>If all of the resources are in the same tenant, then you need to associate only one service principal. If your app needs access to Azure resources in a different tenant, then you need a service principal for each tenant.</p><p><span><img alt="" src="../Images/1192366-490504.png" width="" height="" /></span></p><p>You create your service principal:
•	Through the portal
•	By using PowerShell
•	Through CLI commands
•	By using API calls</p><h3 class="da-h3" id="1191901">Settings</h3><p>In Settings, you can optionally configure target site settings:
<span><img alt="" src="../Images/1192246-490384.png" width="" height="" /></span></p><ul class="square"><li class="square"><p><b>Target Location</b>: The location where your source virtual machine data will be replicated. Depending upon your selected machines location, Site Recovery will provide you the list of suitable target regions. We recommend that you keep the target location the same as the Recovery Services vault location.</p></li><li class="square"><p><b>Target subscription</b>: The target subscription used for disaster recovery. By default, the target subscription will be same as the source subscription.</p></li><li class="square"><p><b>Target resource group</b>: The resource group to which all your replicated virtual machines belong. By default Azure Site Recovery creates a new resource group in the target region with name having “asr” suffix. In case resource group created by Azure Site Recovery already exists, it is reused. You can also choose to customize it as shown in the section below. The location of the target resource group can be any Azure region except the region in which the source virtual machines are hosted.</p></li><li class="square"><p><b>Target Virtual Network</b>: By default, Site Recovery creates a new virtual network in the target region with name having “asr” suffix. This is mapped to your source network, and used for any future protection. Learn more about network mapping.</p></li><li class="square"><p><b>Target Storage accounts (If your source VM does not use managed disks)</b>: By default, Site Recovery creates a new target storage account mimicking your source VM storage configuration. In case storage account already exists, it is reused.</p></li><li class="square"><p><b>Replica managed disks (If your source VM uses managed disks)</b>: Site Recovery creates new replica managed disks in the target region to mirror the source VM's managed disks with the same storage type (Standard or premium) as the source VM's managed disk.</p></li><li class="square"><p><b>Cache Storage accounts</b>: Site Recovery needs extra storage account called cache storage in the source region. All the changes happening on the source VMs are tracked and sent to cache storage account before replicating those to the target location.</p></li><li class="square"><p><b>Target availability sets</b>: By default, Azure Site Recovery creates a new availability set in the target region with name having “asr” suffix for the VMs part of an availability set in source region. In case availability set created by Azure Site Recovery already exists, it is reused.</p></li><li class="square"><p><b>Target availability zones</b>: By default, Site Recovery assigns the same zone number as the source region in target region if the target region supports availability zones.
If the target region does not support availability zones, the target VMs are configured as single instances by default. If required, you can configure such VMs to be part of availability sets in target region by clicking <b>Customize</b>.</p></li></ul><p>✔️ <b>Note</b>: You cannot change the availability type - single instance, availability set or availability zone, after you enable replication. You need to disable and enable replication to change the availability type.</p><ul class="square"><li class="square"><p><b>Replication Policy</b>: It defines the settings for recovery point retention history and app consistent snapshot frequency. By default, Azure Site Recovery creates a new replication policy with default settings of ‘24 hours’ for recovery point retention and ’60 minutes’ for app consistent snapshot frequency.</p></li></ul><h3 class="da-h3" id="1191620">Self-Service Password Reset</h3><p>The large majority of helpdesk calls in most companies are requests to reset passwords for users. Enabling <b>Self-service password reset</b> (SSPR) gives the users the ability to bypass the helpdesk and reset their own passwords.</p><p>To configure Self-Service Password Reset, you first determine who will be enabled to use self-service password reset. From your existing Azure AD tenant, on the Azure Portal under <b>Azure Active Directory</b> select <b>Password reset.</b></p><p>In the Password reset properties there are three options: <b>None</b>, <b>Selected</b>, and <b>All</b>.</p><p><span><img alt="" src="../Images/1192027-490165.png" width="" height="" /></span></p><h4 class="da-h4">Authentication methods</h4><p>After enabling password reset for user and groups, you pick the number of authentication methods required to reset a password and the number of authentication methods available to users.</p><p>At least one authentication method is required to reset a password, but it is a good idea to have additional methods available. You can choose from email notification, a text or code sent to user’s mobile or office phone, or a set of security questions.</p><p><span><img alt="" src="../Images/1192028-490166.png" width="" height="" /></span></p><p>Regarding the security questions, these can be configured to require a certain number of questions to be registered for the users in your AD tenant. In addition, you must configure the number of correctly answered security question that are required for a successful password reset. There are a large number of security questions. Note that security questions can be less secure than other methods because some people might know the answers to another user's questions.</p><p>✔️  Azure Administrator accounts will always be able to reset their passwords no matter what this option is set to.</p><h3 class="da-h3" id="1191726">Application Security Groups</h3><p>Use application security groups within a network security group to apply a security rule to a group of resources. It's easier to deploy and scale up specific application workloads. You just add a new virtual machine deployment to one or more application security groups, and that virtual machine automatically picks up your security rules for that workload.</p><p>An application security group allows you to group network interfaces together. You can then use that application security group as a source or destination rule within a network security group.</p><p>For example, your company has a number of front-end servers in a virtual network. The web servers must be accessible over ports 80 and 8080. Database servers must be accessible over port 1433. You assign the network interfaces for the web servers to one application security group, and the network interfaces for the database servers to another application security group. You then create two inbound rules in your network security group. One rule allows HTTP traffic to all servers in the web server application security group. The other rule allows SQL traffic to all servers in the database server application security group.</p><p><span><img alt="" src="../Images/1192350-490488.png" width="" height="" /></span></p><p>Without application security groups, you'd need to create a separate rule for each virtual machine.</p><h3 class="da-h3" id="1191624">Azure AD Conditional Access Location Condition</h3><p>With Azure Active Directory (Azure AD) Conditional Access, you can control how authorized users can access your cloud apps. The location condition of a Conditional Access policy enables you to tie access controls settings to the network locations of your users.</p><p>This lesson provides you with the information you need to configure the location condition.</p><h4 class="da-h4">Locations</h4><p>Azure AD enables single sign-on to devices, apps, and services from anywhere on the public internet. With the location condition, you can control access to your cloud apps based on the network location of a user. Common use cases for the location condition are:</p><ul class="square"><li class="square"><p>Requiring multi-factor authentication for users accessing a service when they are off the corporate network.</p></li><li class="square"><p>Blocking access for users accessing a service from specific countries or regions.</p></li></ul><p>A location is a label for a network location that either represents a named location or multi-factor authentication Trusted IPs.</p><h3 class="da-h3" id="1191915">Azure Container Instances</h3><p>Azure Container Instances offers the fastest and simplest way to run a container in Azure, without having to manage any virtual machines and without having to adopt a higher-level service.</p><p>Azure Container Instances is a great solution for any scenario that can operate in isolated containers, including simple applications, task automation, and build jobs.</p><h4 class="da-h4">Fast startup times</h4><p>Containers offer significant startup benefits over virtual machines (VMs). Azure Container Instances can start containers in Azure in seconds, without the need to provision and manage VMs.</p><h4 class="da-h4">Container access</h4><p>Azure Container Instances enables exposing your container groups directly to the internet with an IP address and a fully qualified domain name (FQDN). When you create a container instance, you can specify a custom DNS name label so your application is reachable at customlabel.azureregion.azurecontainer.io.</p><p>Azure Container Instances also supports executing a command in a running container by providing an interactive shell to help with application development and troubleshooting. Access takes places over HTTPS, using TLS to secure client connections.</p><h4 class="da-h4">Hypervisor-level security</h4><p>Historically, containers have offered application dependency isolation and resource governance but have not been considered sufficiently hardened for hostile multi-tenant usage. Azure Container Instances guarantees your application is as isolated in a container as it would be in a VM.</p><h4 class="da-h4">Custom sizes</h4><p>Containers are typically optimized to run just a single application, but the exact needs of those applications can differ greatly. Azure Container Instances provides optimum utilization by allowing exact specifications of CPU cores and memory. You pay based on what you need and get billed by the second, so you can fine-tune your spending based on actual need.</p><h4 class="da-h4">Linux and Windows containers</h4><p>Azure Container Instances can schedule both Windows and Linux containers with the same API. Simply specify the OS type when you create your container groups.</p><h3 class="da-h3" id="1191665">Requirements and Constraints</h3><ul class="square"><li class="square"><p>You can peer virtual networks in the same region, or different regions. Peering virtual networks in different regions is also referred to as Global VNet Peering.</p></li><li class="square"><p>When creating a global peering, the peered virtual networks can exist in any Azure public cloud region or China cloud regions or Government cloud regions. You cannot peer across clouds. For example, a VNet in Azure public cloud cannot be peered to a VNet in Azure China cloud.</p></li><li class="square"><p>Resources in one virtual network cannot communicate with the front-end IP address of a Basic internal load balancer in a globally peered virtual network. Support for Basic Load Balancer only exists within the same region. Support for Standard Load Balancer exists for both, VNet Peering and Global VNet Peering.</p></li><li class="square"><p>You can use remote gateways or allow gateway transit in globally peered virtual networks and locally peered virtual networks.</p></li><li class="square"><p>The virtual networks can be in the same, or different subscriptions. When you peer virtual networks in different subscriptions, both subscriptions can be associated to the same or different Azure Active Directory tenant. If you don't already have an AD tenant, you can create one. Support for peering across virtual networks from subscriptions associated to different Azure Active Directory tenants is not available in Portal. You can use CLI, PowerShell, or Templates.</p></li><li class="square"><p>The virtual networks you peer must have non-overlapping IP address spaces.</p></li><li class="square"><p>You can't add address ranges to, or delete address ranges from a virtual network's address space once a virtual network is peered with another virtual network. To add or remove address ranges, delete the peering, add or remove the address ranges, then re-create the peering.</p></li><li class="square"><p>You can peer two virtual networks deployed through Resource Manager or a virtual network deployed through Resource Manager with a virtual network deployed through the classic deployment model. You cannot peer two virtual networks created through the classic deployment model</p></li><li class="square"><p>When peering two virtual networks created through Resource Manager, a peering must be configured for each virtual network in the peering. You see one of the following types for peering status:</p><ul class="square"><li class="square"><p><i>Initiated</i>: When you create the peering to the second virtual network from the first virtual network, the peering status is Initiated.</p></li><li class="square"><p><i>Connected</i>: When you create the peering from the second virtual network to the first virtual network, its peering status is Connected. If you view the peering status for the first virtual network, you see its status changed from Initiated to Connected. The peering is not successfully established until the peering status for both virtual network peerings is Connected.</p></li></ul></li><li class="square"><p>When peering a virtual network created through Resource Manager with a virtual network created through the classic deployment model, you only configure a peering for the virtual network deployed through Resource Manager. You cannot configure peering for a virtual network (classic), or between two virtual networks deployed through the classic deployment model. When you create the peering from the virtual network (Resource Manager) to the virtual network (Classic), the peering status is <i>Updating</i>, then shortly changes to Connected.</p></li><li class="square"><p>A peering is established between two virtual networks. Peerings are not transitive. If you create peerings between:</p><ul class="square"><li class="square"><p>VirtualNetwork1 &amp; VirtualNetwork2</p></li><li class="square"><p>VirtualNetwork2 &amp; VirtualNetwork3</p></li></ul></li></ul><p>There is no peering between VirtualNetwork1 and VirtualNetwork3 through VirtualNetwork2. If you want to create a virtual network peering between VirtualNetwork1 and VirtualNetwork3, you have to create a peering between VirtualNetwork1 and VirtualNetwork3.</p><ul class="square"><li class="square"><p>You can't resolve names in peered virtual networks using default Azure name resolution. To resolve names in other virtual networks, you must use <a href="https://docs.microsoft.com/en-us/azure/dns/private-dns-overview?toc=/azure/virtual-network/toc.json" title="" target="_blank">Azure DNS for private domains</a> or a custom DNS server</p></li><li class="square"><p>Resources in peered virtual networks in the same region can communicate with each other with the same bandwidth and latency as if they were in the same virtual network. Each virtual machine size has its own maximum network bandwidth however.</p></li><li class="square"><p>A virtual network can be peered to another virtual network, and also be connected to another virtual network with an Azure virtual network gateway. When virtual networks are connected through both peering and a gateway, traffic between the virtual networks flows through the peering configuration, rather than the gateway.</p></li><li class="square"><p>Point-to-Site VPN clients must be downloaded again after virtual network peering has been successfully configured to ensure the new routes are downloaded to the client.</p></li></ul><h3 class="da-h3" id="1191663">Demonstration - VNet Peering</h3><p><b>✔️ Note</b>: For this demonstration you will need two virtual networks.</p><p><b>✔️ Note</b>: For managing the timing of this demonstration, you do not need to wait for the gateway to finish being creating.</p><p><b>Configure VNet peering on the first virtual network</b></p><ol class="number"><li><p>In the <b>Azure portal</b>, select the first virtual network.</p></li><li><p>Under <b>SETTINGS</b>, select <b>Peerings</b>.</p></li><li><p>Select <b>+ Add</b>.</p><ul class="square"><li class="square"><p>Provide a <b>name</b> for the first virtual network peering. For example, VNet1toVNet2.</p></li><li class="square"><p>In the <b>Virtual network</b> drop-down, select the second virtual network you would like to peer with.</p></li><li class="square"><p>Note the region, this will be needed when you configure the VPN gateway.</p></li><li class="square"><p>Provide a name for the second virtual network peering. For example, VNet2toVNet1.</p></li><li class="square"><p>Use the informational icons to review the network access, forwarded traffic, and gateway transit settings.</p></li><li class="square"><p>Check the box for <b>Allow gateway transit</b>. Note the error that the virtual network does not have a gateway.</p></li><li class="square"><p>Make sure the <b>Allow gateway transit</b> check box is not selected.</p></li><li class="square"><p>Click <b>OK</b> to save your settings.</p></li></ul></li></ol><p><b>Configure a VPN gateway</b></p><ol class="number"><li><p>In the <b>Azure portal</b>, search for <b>virtual network gateways</b>.</p></li><li><p>Select <b>+ Add</b>.</p><ul class="square"><li class="square"><p>Provide a <b>name</b> for your virtual network gateway. For example, VNet1Gateway.</p></li><li class="square"><p>Ensure the gateway is in the same region as the first virtual network.</p></li><li class="square"><p>In the <b>virtual network</b> drop-down select the first virtual network.</p></li><li class="square"><p>In the <b>Public IP address</b> area, <b>Create new</b> and give the IP address a name.</p></li><li class="square"><p>Click <b>Create and review</b>. Address any validation errors.</p></li><li class="square"><p>Click <b>Create</b>.</p></li></ul></li><li><p>Monitor the notifications to ensure the gateway is successfully created.</p></li></ol><p><b>Allow gateway transit</b></p><ol class="number"><li><p>In the <b>Azure portal</b>, return to your first virtual network.</p></li><li><p>On the <b>Overview</b> blade, notice the new <b>Connected device</b> for your VPN gateway.</p></li><li><p>Select the gateway and notice you can perform a health check and review access statistics.</p></li><li><p>Return to the previous page and under <b>SETTINGS</b>, select <b>Peerings</b>.</p><ul class="square"><li class="square"><p>Select the peering and enable <b>Allow gateway transit</b>. Notice the previous error has been resolved.</p></li><li class="square"><p>Notice after making this selection, <b>Use remote gateways</b> is disabled.</p></li></ul></li><li><p><b>Save</b> your changes.</p></li></ol><p><b>Confirm VNet peering on the second virtual network</b></p><ol class="number"><li><p>In the <b>Azure portal</b>, select the second virtual network.</p></li><li><p>Under <b>SETTINGS</b>, select <b>Peerings</b>.</p></li><li><p>Notice that a peering has automatically been created. The name is what you provided when the first virtual network peering was configured.</p></li><li><p>Notice that the <b>Peering Status</b> is <b>Connected</b>.</p></li><li><p>Click the peering.</p><ul class="square"><li class="square"><p>Notice that <b>Allow gateway transit</b> cannot be selected.</p></li><li class="square"><p>Use the informational icon to review the <b>Use remote gateways</b> setting.</p></li></ul></li><li><p><b>Discard</b> your changes.</p></li></ol><h3 class="da-h3" id="1191746">Uploading Blobs</h3><p>A blob can be any type and size file. Azure Storage offers three types of blobs: <i>block</i> blobs, <i>page</i> blobs, and <i>append</i> blobs. You specify the blob type and access tier when you create the blob.</p><p><span><img alt="" src="../Images/1192162-490300.png" width="" height="" /></span></p><ul class="square"><li class="square"><p><b>Block blobs (default)</b> consist of blocks of data assembled to make a blob. Most scenarios using Blob storage employ block blobs. Block blobs are ideal for storing text and binary data in the cloud, like files, images, and videos.</p></li><li class="square"><p><b>Append blobs</b> are like block blobs in that they are made up of blocks, but they are optimized for append operations, so they are useful for logging scenarios.</p></li><li class="square"><p><b>Page blobs</b> can be up to 8 TB in size and are more efficient for frequent read/write operations. Azure virtual machines use page blobs as OS and data disks.</p></li></ul><p>✔️ Once the blob has been created, its type cannot be changed.</p><h4 class="da-h4">Blob upload tools</h4><p>There are multiple methods to upload data to blob storage, including the following methods:</p><ul class="square"><li class="square"><p><b>AzCopy</b> is an easy-to-use command-line tool for Windows and Linux that copies data to and from Blob storage, across containers, or across storage accounts.</p></li><li class="square"><p>The <b>Azure Storage Data Movement library</b> is a .NET library for moving data between Azure Storage services. The AzCopy utility is built with the Data Movement library.</p></li><li class="square"><p><b>Azure Data Factory</b> supports copying data to and from Blob storage by using the account key, shared access signature, service principal, or managed identities for Azure resources authentications.</p></li><li class="square"><p><b>Blobfuse</b> is a virtual file system driver for Azure Blob storage. You can use blobfuse to access your existing block blob data in your Storage account through the Linux file system.</p></li><li class="square"><p><b>Azure Data Box Disk</b> is a service for transferring on-premises data to Blob storage when large datasets or network constraints make uploading data over the wire unrealistic. You can use Azure Data Box Disk to request solid-state disks (SSDs) from Microsoft. You can then copy your data to those disks and ship them back to Microsoft to be uploaded into Blob storage.</p></li><li class="square"><p>The <b>Azure Import/Export</b> service provides a way to export large amounts of data from your storage account to hard drives that you provide and that Microsoft then ships back to you with your data.</p></li></ul><p>✔️ Of course, you can always use Azure Storage Explorer.</p><h3 class="da-h3" id="1191918">Module 13 Review Questions</h3><p><span><img alt="" src="../Images/1192029-490167.png" width="" height="" /></span></p><h4 class="problem">Review Question 1</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-7452680c-dc8e-9451-6d3d-8e864dfd15b7"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You decide to move all your services to Azure Kubernetes service. Which of the following components will contribute to your monthly Azure charge? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q7452680c-dc8e-9451-6d3d-8e864dfd15b7" value="1" />Master node<br /></label></li><li><label><input type="radio" name="q7452680c-dc8e-9451-6d3d-8e864dfd15b7" value="2" />Pods<br /></label></li><li><label><input type="radio" name="q7452680c-dc8e-9451-6d3d-8e864dfd15b7" value="3" />Node virtual machines<br /></label></li><li><label><input type="radio" name="q7452680c-dc8e-9451-6d3d-8e864dfd15b7" value="4" />Tables<br /></label></li></ul></div></div><div id="feedback-problem-7452680c-dc8e-9451-6d3d-8e864dfd15b7" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Node virtual machines. You only pay for the virtual machines instances, storage, and networking resources consumed by your Kubernetes cluster.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 2</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-7e3e2473-a0fa-c6fe-0178-ca9d03a0ba47"><div class="card quizlib-question"><div class="quizlib-question-title"><p>Which of the following is not true about container groups? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q7e3e2473-a0fa-c6fe-0178-ca9d03a0ba47" value="1" />Is scheduled on a multiple host machines.<br /></label></li><li><label><input type="radio" name="q7e3e2473-a0fa-c6fe-0178-ca9d03a0ba47" value="2" />Is assigned a DNS name label.<br /></label></li><li><label><input type="radio" name="q7e3e2473-a0fa-c6fe-0178-ca9d03a0ba47" value="3" />Exposes a single public IP address, with one exposed port.<br /></label></li><li><label><input type="radio" name="q7e3e2473-a0fa-c6fe-0178-ca9d03a0ba47" value="4" />Consists of two containers.<br /></label></li><li><label><input type="radio" name="q7e3e2473-a0fa-c6fe-0178-ca9d03a0ba47" value="5" />Includes two Azure file shares as volume mounts.<br /></label></li></ul></div></div><div id="feedback-problem-7e3e2473-a0fa-c6fe-0178-ca9d03a0ba47" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Is scheduled on a multiple host machines. A container group is scheduled on a single host machine.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 3</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-8bf2caec-f2f2-d500-cd13-466d16b62122"><div class="card quizlib-question"><div class="quizlib-question-title"><p>Which of the following is the Kubernetes agent that processes the orchestration requests from the cluster master, and schedules running the requested containers? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q8bf2caec-f2f2-d500-cd13-466d16b62122" value="1" />controller master<br /></label></li><li><label><input type="radio" name="q8bf2caec-f2f2-d500-cd13-466d16b62122" value="2" />container runtime<br /></label></li><li><label><input type="radio" name="q8bf2caec-f2f2-d500-cd13-466d16b62122" value="3" />kube-proxy<br /></label></li><li><label><input type="radio" name="q8bf2caec-f2f2-d500-cd13-466d16b62122" value="4" />kubelet<br /></label></li></ul></div></div><div id="feedback-problem-8bf2caec-f2f2-d500-cd13-466d16b62122" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">kubelet. The kubelet process the orchestration requests from the cluster master, and schedules the running the requested containers.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 4</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-72bf67ee-edb2-bff5-a40f-f374d0f0abb2"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You are configuring networking for the Azure Kubernetes service. Which of the following maps incoming direct traffic to the pods? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q72bf67ee-edb2-bff5-a40f-f374d0f0abb2" value="1" />AKS node<br /></label></li><li><label><input type="radio" name="q72bf67ee-edb2-bff5-a40f-f374d0f0abb2" value="2" />ClusterIP<br /></label></li><li><label><input type="radio" name="q72bf67ee-edb2-bff5-a40f-f374d0f0abb2" value="3" />Load Balancer<br /></label></li><li><label><input type="radio" name="q72bf67ee-edb2-bff5-a40f-f374d0f0abb2" value="4" />NodePort<br /></label></li></ul></div></div><div id="feedback-problem-72bf67ee-edb2-bff5-a40f-f374d0f0abb2" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">NodePort. NodePort maps incoming direct traffic to the pods.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h3 class="da-h3" id="1191685">Scaling Concepts</h3><p>Generally, there are two types of scaling: vertical scaling and horizontal scaling.</p><h4 class="da-h4">Vertical scaling</h4><p><span><img alt="" src="../Images/1192132-490270.png" width="" height="" /></span></p><p>Vertical scaling, also known as scale up and scale down, means increasing or decreasing virtual machine sizes in response to a workload. Vertical scaling makes the virtual machines more (scale up) or less (scale down) powerful. Vertical scaling can be useful when:</p><ul class="square"><li class="square"><p>A service built on virtual machines is under-utilized (for example at weekends). Reducing the virtual machine size can reduce monthly costs.</p></li><li class="square"><p>Increasing virtual machine size to cope with larger demand without creating additional virtual machines.</p></li></ul><h4 class="da-h4">Horizontal Scaling</h4><p><span><img alt="" src="../Images/1192133-490271.png" width="" height="" /></span></p><p>Horizontal scaling, also referred to as scale out and scale in, where the number of VMs is altered depending on the workload. In this case, there is a increase (scale out) or decrease (scale in) in the number of virtual machine instances.</p><h4 class="da-h4">Considerations</h4><ul class="square"><li class="square"><p>Vertical scaling generally has more limitations. It's dependent on the availability of larger hardware, which quickly hits an upper limit and can vary by region. Vertical scaling also usually requires a virtual machine to stop and restart.</p></li><li class="square"><p>Horizontal scaling is generally more flexible in a cloud situation as it allows you to run potentially thousands of virtual machines to handle load.</p></li><li class="square"><p>Reprovisioning means removing an existing virtual machine and replacing it with a new one. Do you need to retain your data?</p></li></ul><h3 class="da-h3" id="1191619">Azure Multi-Factor Authentication</h3><p>Multi-factor authentication is a process where a user is prompted during the sign-in process for an additional form of identification, such as to enter a code on their cellphone or to provide a fingerprint scan.</p><p>If you only use a password to authenticate a user, it leaves an insecure vector for attack. If the password is weak or has been exposed elsewhere, is it really the user signing in with the username and password, or is it an attacker? When you require a second form of authentication, security is increased as this additional factor isn't something that's easy for an attacker to obtain or duplicate.</p><p><span><img alt="" src="../Images/1192090-490228.png" width="" height="" /></span></p><p>Azure Multi-Factor Authentication works by requiring two or more of the following authentication methods:</p><ul class="square"><li class="square"><p>Something you know, typically a password.</p></li><li class="square"><p>Something you have, such as a trusted device that is not easily duplicated, like a phone or hardware key.</p></li><li class="square"><p>Something you are - biometrics like a fingerprint or face scan.</p></li></ul><p>Users can register themselves for both self-service password reset and Azure Multi-Factor Authentication in one step to simplify the on-boarding experience. Administrators can define what forms of secondary authentication can be used. Azure Multi-Factor Authentication can also be required when users perform a self-service password reset to further secure that process.</p><p><span><img alt="" src="../Images/1192091-490229.png" width="" height="" /></span></p><p>Azure Multi-Factor Authentication provides additional security by requiring a second form of authentication and delivers strong authentication using a range of use authentication methods.</p><p>Users may or may not be challenged for MFA based on configuration decisions that an administrator makes.</p><p>Applications or services don't need to make any changes to use Azure Multi-Factor Authentication. The verification prompts are part of the Azure AD sign-in event, which automatically requests and processes the MFA challenge when required.</p><h4 class="da-h4">Available verification methods</h4><p>When a user signs in to an application or service and receive an MFA prompt, they can choose from one of their registered forms of additional verification. An administrator could require registration of these Azure Multi-Factor Authentication verification methods, or the user can access their own My Profile to edit or add verification methods.</p><p>The following additional forms of verification can be used with Azure Multi-Factor Authentication:</p><ul class="square"><li class="square"><p>Microsoft Authenticator app</p></li><li class="square"><p>OATH Hardware token</p></li><li class="square"><p>SMS</p></li></ul><h4 class="da-h4">Authentication Methods</h4><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Method</p></td><td><p>Description</p></td></tr></thead><tbody><tr><td><p>Call to phone</p></td><td><p>Places an automated voice call. The user answers the call and presses # in the phone keypad to authenticate. The phone number is not synchronized to on-premises Active Directory. A voice call to phone is important because it persists through a phone handset upgrade, allowing the user to register the mobile app on the new device.</p></td></tr><tr><td><p>Text message to phone</p></td><td><p>Sends a text message that contains a verification code. The user is prompted to enter the verification code into the sign-in interface. This process is called one-way SMS. Two-way SMS means that the user must text back a particular code. Two-way SMS is deprecated and not supported after November 14, 2018. Users who are configured for two-way SMS are automatically switched to call to phone verification at that time.</p></td></tr><tr><td><p>Notification through mobile app</p></td><td><p>Sends a push notification to your phone or registered device. The user views the notification and selects Approve to complete verification. The Microsoft Authenticator app is available for Windows Phone, Android, and iOS.  Push notifications through the mobile app provide the best user experience.</p></td></tr><tr><td><p>Verification code from mobile app</p></td><td><p>The Microsoft Authenticator app generates a new OATH verification code every 30 seconds. The user enters the verification code into the sign-in interface. The Microsoft Authenticator app is available for Windows Phone, Android, and iOS. Verification code from mobile app can be used when the phone has no data connection or cellular signal.</p></td></tr></tbody></table><p>✔️ There is also a selection to cache passwords so that users do not have to authenticate on trusted devices. The number of days before a user must re-authenticate on trusted devices can also be configured with the value from 1 to 60 days. The default is 14 days.</p><h3 class="da-h3" id="1191725">Security Rules</h3><p>A network security group contains one or more security rules. Configure security rules to either allow or deny traffic.</p><p>Rules have several properties:</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Property</p></td><td><p>Explanation</p></td></tr></thead><tbody><tr><td><p><b>Name</b></p></td><td><p>A unique name within the network security group.</p></td></tr><tr><td><p><b>Priority</b></p></td><td><p>A number between 100 and 4096.</p></td></tr><tr><td><p><b>Source or destination</b></p></td><td><p>Any, or an individual IP address, classless inter-domain routing (CIDR) block (10.0.0.0/24, for example), service tag, or application security group.</p></td></tr><tr><td><p><b>Protocol</b></p></td><td><p>TCP, UDP, or Any.</p></td></tr><tr><td><p><b>Direction</b></p></td><td><p>Whether the rule applies to inbound, or outbound traffic.</p></td></tr><tr><td><p><b>Port rang</b>e</p></td><td><p>An individual port or range of ports.</p></td></tr><tr><td><p><b>Action</b></p></td><td><p>Allow or deny the traffic.</p></td></tr></tbody></table><p>Network security group security rules are evaluated by priority, using the 5-tuple information (source, source port, destination, destination port, and protocol) to allow or deny the traffic. When the conditions for a rule match the device configuration, rule processing stops.</p><p>With network security groups, the connections are stateful. Return traffic is automatically allowed for the same TCP/UDP session.</p><h4 class="da-h4">Augmented security rules</h4><p>You use augmented security rules for network security groups to simplify the management of large numbers of rules. Augmented security rules also help when you need to implement more complex network sets of rules.</p><p>Augmented rules let you add the following options into a single security rule:</p><ul class="square"><li class="square"><p>multiple IP addresses</p></li><li class="square"><p>multiple ports</p></li><li class="square"><p>service tags</p></li><li class="square"><p>application security groups</p></li></ul><h4 class="da-h4">Service tags</h4><p>You use service tags to simplify network security group security even further. You can allow or deny traffic to a specific Azure service, either globally or per region.</p><p>Service tags simplify security for virtual machines and Azure virtual networks, by allowing you to restrict access by resources or services. Service tags represent a group of IP addresses, and help simplify the configuration of your security rules. For resources that you can specify by using a tag, you don't need to know the IP address or port details.</p><p>You can restrict access to many services. Microsoft manages the service tags (you can't create your own). Some examples of the tags are:</p><ul class="square"><li class="square"><p><b>VirtualNetwork</b> - This tag represents all virtual network addresses anywhere in Azure, and in your on-premises network if you're using hybrid connectivity.</p></li><li class="square"><p><b>AzureLoadBalancer</b> - This tag denotes Azure's infrastructure load balancer. The tag translates to the virtual IP address of the host (168.63.129.16) where Azure health probes originate.</p></li><li class="square"><p><b>Internet</b> - This tag represents anything outside the virtual network address that is publicly reachable, including resources that have public IP addresses. One such resource is the Web Apps feature of Azure App Service.</p></li><li class="square"><p><b>AzureTrafficManager</b> - This tag represents the IP address for Azure Traffic Manager.</p></li><li class="square"><p><b>Storage</b> - This tag represents the IP address space for Azure Storage. You can specify whether traffic is allowed or denied. You can also specify if access is allowed only to a specific region, but you can't select individual storage accounts.</p></li><li class="square"><p><b>SQL</b> - This tag represents the address for Azure SQL Database, Azure Database for MySQL, Azure Database for PostgreSQL, and Azure SQL Data Warehouse services. You can specify whether traffic is allowed or denied, and you can limit to a specific region.</p></li><li class="square"><p><b>AppService</b> - This tag represents address prefixes for Azure App Service.</p></li></ul><h3 class="da-h3" id="1191913">Demonstration - Deploy Kubernetes with AKS</h3><p>In this demonstration, you will:</p><ul class="square"><li class="square"><p>Create a new resource group.</p></li><li class="square"><p>Configure cluster networking.</p></li><li class="square"><p>Create an Azure Kubernetes Service cluster.</p></li><li class="square"><p>Connect to the Kubernetes cluster by using kubectl.</p></li><li class="square"><p>Create a Kubernetes namespace.</p></li></ul><h4 class="da-h4">Create a new resource group</h4><p>You'll first need to create a resource group for your resources to deploy into.</p><ol class="number"><li><p>Sign in to Azure Cloud Shell with your Azure account. Select the Bash version of Cloud Shell.</p></li></ol><p><a href="https://shell.azure.com/" title="" target="_blank">Azure Cloud Shell</a></p><ol class="number"><li value="2"><p>You need to choose a region where you want to create a resource group, for example, <b>East US</b>. If you select a different value, remember it for the rest of the exercises in this module. You may need to redefine the value between Cloud Shell sessions. Run the following commands to record these values in Bash variables.</p></li></ol><div class="code language-Azure"><p class="da-divtext">REGION_NAME=eastus
RESOURCE_GROUP=aksworkshop
SUBNET_NAME=aks-subnet
VNET_NAME=aks-vnet
</p></div><p>You can check each value using the echo command, for example, echo <span class="code">$REGION_NAME</span>.</p><ol class="number"><li value="3"><p>Create a new resource group with the name **aksworkshop. Deploy all resources created in these exercises in this resource group. A single resource group makes it easier to clean up the resources after you finish the module.</p></li></ol><div class="code language-Azure"><p class="da-divtext">az group create \
    --name $RESOURCE_GROUP \
    --location $REGION_NAME
</p></div><h4 class="da-h4">Configure networking</h4><p>We have two network models to choose from when deploying an AKS cluster. The first model is <i>Kubenet networking</i>, and the second is <i>Azure Container Networking Interface (CNI) networking</i>.</p><h4 class="da-h4">Kubenet networking</h4><p>Kubenet networking is the default networking model in Kubernetes. With Kubenet networking, nodes get assigned an IP address from the Azure virtual network subnet. Pods receive an IP address from a logically different address space to the Azure virtual network subnet of the nodes.</p><p>Network address translation (NAT) is then configured so that the pods can reach resources on the Azure virtual network. The source IP address of the traffic is translated to the node's primary IP address and then configured on the nodes. Note, that pods receive an IP address that's “hidden” behind the node IP.</p><h4 class="da-h4">Azure Container Networking Interface (CNI) networking</h4><p>With Azure Container Networking Interface (CNI), the AKS cluster is connected to existing virtual network resources and configurations. In this networking model, every pod gets an IP address from the subnet and can be accessed directly. These IP addresses must be unique across your network space and calculated in advance.</p><p>Some of the features you'll use require you to deploy the AKS cluster by using the <i>Azure Container Networking Interface networking</i> configuration.</p><p>Below we create the virtual network for your AKS cluster. We will use this virtual network and specify the networking model when we deploy the cluster.</p><ol class="number"><li><p>First, create a virtual network and subnet. Pods deployed in your cluster will be assigned an IP from this subnet. Run the following command to create the virtual network.</p></li></ol><div class="code language-Azure"><p class="da-divtext">az network vnet create \
    --resource-group $RESOURCE_GROUP \
    --location $REGION_NAME \
    --name $VNET_NAME \
    --address-prefixes 10.0.0.0/8 \
    --subnet-name $SUBNET_NAME \
    --subnet-prefix 10.240.0.0/16
</p></div><p>2.Next, retrieve, and store the subnet ID in a Bash variable by running the command below.</p><div class="code language-Azure"><p class="da-divtext">SUBNET_ID=$(az network vnet subnet show \
    --resource-group $RESOURCE_GROUP \
    --vnet-name $VNET_NAME \
    --name $SUBNET_NAME \
    --query id -o tsv)
</p></div><h4 class="da-h4">Create the AKS cluster</h4><p>With the new virtual network in place, you can go ahead and create your new cluster. There are two values you need to know before running the <span class="code">az aks create</span> command. The first is the version of the latest, non-preview, Kubernetes version available in your selected region, and the second is a unique name for your cluster.</p><ol class="number"><li><p>To get the latest, non-preview, Kubernetes version you use the <span class="code">az aks get-versions</span> command. Store the value that returns from the command in a Bash variable named <span class="code">VERSION</span>. Run the command below the retrieve and store the version number.</p></li></ol><div class="code language-Azure"><p class="da-divtext">SUBNET_ID=$(az network vnet subnet show \
    --resource-group $RESOURCE_GROUP \
    --vnet-name $VNET_NAME \
    --name $SUBNET_NAME \
    --query id -o tsv)
</p></div><ol class="number"><li value="2"><p>The AKS cluster name must be unique. Run the following command to create a Bash variable that holds a unique name.</p></li></ol><div class="code language-Bash"><p class="da-divtext"><code><span class="token assign-left variable">AKS_CLUSTER_NAME</span><span class="token operator">=</span>aksworkshop-<span class="token environment constant">$RANDOM</span></code></p></div><ol class="number"><li value="3"><p>Run the following command to output the value stored in <span class="code">$AKS_CLUSTER_NAME</span>. Note this for later use. You'll need it to reconfigure the variable in the future, if necessary.</p></li></ol><div class="code language-Bash"><p class="da-divtext"><code><span class="token builtin class-name">echo</span> <span class="token variable">$AKS_CLUSTER_NAME</span></code></p></div><ol class="number"><li value="4"><p>Run the following <span class="code">az aks create</span> command to create the AKS cluster running the latest Kubernetes version. This command can take a few minutes to complete.</p></li></ol><div class="code language-Azure"><p class="da-divtext">az aks create \
--resource-group $RESOURCE_GROUP \
--name $AKS_CLUSTER_NAME \
--vm-set-type VirtualMachineScaleSets \
--load-balancer-sku standard \
--location $REGION_NAME \
--kubernetes-version $VERSION \
--network-plugin azure \
--vnet-subnet-id $SUBNET_ID \
--service-cidr 10.2.0.0/24 \
--dns-service-ip 10.2.0.10 \
--docker-bridge-address 172.17.0.1/16 \
--generate-ssh-keys
</p></div><h4 class="da-h4">Test cluster connectivity by using kubectl</h4><p><span class="code">kubectl</span> is the main Kubernetes command-line client you use to interact with your cluster and is available in Cloud Shell. A cluster context is required to allow <span class="code">kubectl</span> to connect to a cluster. The context contains the cluster's address, a user, and a namespace. Use the az aks get-credentials command to configure your instance of <span class="code">kubectl</span>.</p><ol class="number"><li><p>Retrieve the cluster credentials by running the command below.</p></li></ol><div class="code language-Azure"><p class="da-divtext">az aks get-credentials \
    --resource-group $RESOURCE_GROUP \
    --name $AKS_CLUSTER_NAME
</p></div><ol class="number"><li value="2"><p>Let's take a look at what was deployed by listing all the nodes in your cluster. Use the <span class="code">kubectl</span> get nodes command to list all the nodes.</p></li></ol><div class="code language-Bash"><p class="da-divtext"><code>kubectl get nodes</code></p></div><p>You'll see a list of your cluster's nodes. Here's an example.</p><div class="code language-Ouput"><p class="da-divtext">NAME                                STATUS   ROLES   AGE  VERSION
aks-nodepool1-24503160-vmss000000   Ready    agent   1m   v1.15.7
aks-nodepool1-24503160-vmss000001   Ready    agent   1m   v1.15.7
aks-nodepool1-24503160-vmss000002   Ready    agent   1m   v1.15.7
</p></div><h4 class="da-h4">Create a Kubernetes namespace for the application</h4><p>A namespace in Kubernetes creates a logical isolation boundary. Names of resources must be unique within a namespace but not across namespaces. If you don't specify the namespace when you work with Kubernetes resources, the default namespace is implied.</p><p>Let's create a namespace for your ratings application.</p><ol class="number"><li><p>List the current namespaces in the cluster.</p></li></ol><div class="code language-Bash"><p class="da-divtext"><code>kubectl get namespace</code></p></div><p>You'll see a list of namespaces similar to this output.</p><div class="code language-Ouput"><p class="da-divtext">NAME              STATUS   AGE
default           Active   1h
kube-node-lease   Active   1h
kube-public       Active   1h
kube-system       Active   1h
</p></div><ol class="number"><li value="2"><p>Use the <span class="code">kubectl</span> create namespace command to create a namespace for the application called <b>ratingsapp</b>.</p></li></ol><div class="code language-Bash"><p class="da-divtext"><code>kubectl create namespace ratingsapp</code></p></div><p>You'll see a confirmation that the namespace was created.</p><div class="code language-Output"><p class="da-divtext">namespace/ratingsapp created
</p></div><h3 class="da-h3" id="1191767">Grant Access from a Virtual Network</h3><p>You can configure storage accounts to allow access only from specific subnets. The allowed subnets may belong to a VNet in the same subscription, or those in a different subscription, including subscriptions belonging to a different Azure Active Directory tenant.</p><p>Enable a Service endpoint for Azure Storage within the VNet. The service endpoint routes traffic from the VNet through an optimal path to the Azure Storage service. The identities of the subnet and the virtual network are also transmitted with each request. Administrators can then configure network rules for the storage account that allow requests to be received from specific subnets in a VNet. Clients granted access via these network rules must continue to meet the authorization requirements of the storage account to access the data.</p><p><b>Available virtual network regions</b></p><p>In general, service endpoints work between virtual networks and service instances in the same Azure region. When using service endpoints with Azure Storage, this scope grows to include the paired region. Service endpoints allow continuity during a regional failover and access to read-only geo-redundant storage (RA-GRS) instances. Network rules that grant access from a virtual network to a storage account also grant access to any RA-GRS instance.</p><p>When planning for disaster recovery during a regional outage, you should create the VNets in the paired region in advance. Enable service endpoints for Azure Storage, with network rules granting access from these alternative virtual networks. Then apply these rules to your geo-redundant storage accounts.</p><p>✔️<b>Note:</b>
Service endpoints don't apply to traffic outside the region of the virtual network and the designated region pair. You can only apply network rules granting access from virtual networks to storage accounts in the primary region of a storage account or in the designated paired region.</p><p><b>Required permissions</b></p><p>To apply a virtual network rule to a storage account, the user must have the appropriate permissions for the subnets being added. The permission needed is Join Service to a Subnet and is included in the Storage Account Contributor built-in role. It can also be added to custom role definitions.</p><p>Storage account and the virtual networks granted access may be in different subscriptions, including subscriptions that are a part of a different Azure AD tenant.</p><p>✔️<b>Note:</b>
Configuration of rules that grant access to subnets in virtual networks that are a part of a different Azure Active Directory tenant are currently only supported through Powershell, CLI and REST APIs. Such rules cannot be configured through the Azure portal, though they may be viewed in the portal.</p><p><b>Managing virtual network rules</b></p><p>You can manage virtual network rules for storage accounts through the Azure portal.</p><ol class="number"><li><p>Go to the storage account you want to secure.</p></li><li><p>Click on the settings menu called <b>Firewalls and virtual networks</b>.</p></li><li><p>Check that you've selected to allow access from <b>Selected networks</b>.</p></li><li><p>To grant access to a virtual network with a new network rule, under <b>Virtual networks</b>, click <b>Add existing virtual network,</b> select <b>Virtual networks and Subnets</b> options, and then click <b>Add</b>. To create a new virtual network and grant it access, click <b>Add new virtual network</b>. Provide the information necessary to create the new virtual network, and then click <b>Create</b>.</p></li></ol><p>✔️<b>Note:</b>
If a service endpoint for Azure Storage wasn't previously configured for the selected virtual network and subnets, you can configure it as part of this operation.</p><ol class="number"><li value="5"><p>To remove a virtual network or subnet rule, click <b>...</b> to open the context menu for the virtual network or subnet, and click <b>Remove</b>.</p></li><li><p>Click <b>Save</b> to apply your changes.</p></li></ol><h3 class="da-h3" id="1191789">Azure Cosmos DB Gremlin API</h3><p>Azure Cosmos DB is a multi-model database and supports document, key-value, graph, and column-family data models. The Azure Cosmos DB Gremlin API is used to store and operate with graph data on a fully managed database service designed for any scale.</p><p><span><img alt="" src="../Images/1192051-490189.png" width="" height="" /></span></p><p>This topic provides an overview of the Azure Cosmos DB Gremlin API and explains how you can use it to store massive graphs with billions of vertices and edges. You can query the graphs with millisecond latency and evolve the graph structure easily. Azure Cosmos DB's Gremlin API is based on the Apache TinkerPop graph database standard, and uses the Gremlin query language.</p><p>Azure Cosmos DB's Gremlin API combines the power of graph database algorithms with highly scalable, managed infrastructure to provide a unique, flexible solution to most common data problems associated with lack of flexibility and relational approaches.</p><h4 class="da-h4">Features of Azure Cosmos DB graph database</h4><p>Azure Cosmos DB is a fully managed graph database that offers global distribution, elastic scaling of storage and throughput, automatic indexing and query, tunable consistency levels, and support for the TinkerPop standard.</p><p>The following are the differentiated features that Azure Cosmos DB Gremlin API offers:</p><p><b>Elastically scalable throughput and storage</b></p><p>Graphs in the real world need to scale beyond the capacity of a single server. Azure Cosmos DB supports horizontally scalable graph databases that can have a virtually unlimited size in terms of storage and provisioned throughput. As the graph database scale grows, the data will be automatically distributed using graph partitioning.</p><p><b>Multi-region replication</b></p><p>Azure Cosmos DB can automatically replicate your graph data to any Azure region worldwide. Global replication simplifies the development of applications that require global access to data. In addition to minimizing read and write latency anywhere around the world, Azure Cosmos DB provides automatic regional failover mechanism that can ensure the continuity of your application in the rare case of a service interruption in a region.</p><p><b>Fast queries and traversals with the most widely adopted graph query standard</b></p><p>Store heterogeneous vertices and edges and query them through a familiar Gremlin syntax. Gremlin is an imperative, functional query language that provides a rich interface to implement common graph algorithms.</p><p><b>Fully managed graph database</b></p><p>Azure Cosmos DB eliminates the need to manage database and machine resources. Most existing graph database platforms are bound to the limitations of their infrastructure and often require a high degree of maintenance to ensure its operation.</p><p>As a fully managed service, Cosmos DB removes the need to manage virtual machines, update runtime software, manage sharding or replication, or deal with complex data-tier upgrades. Every graph is automatically backed up and protected against regional failures. These guarantees allow developers to focus on delivering application value instead of operating and managing their graph databases.</p><p><b>Automatic indexing</b></p><p>By default, Azure Cosmos DB automatically indexes all the properties within nodes and edges in the graph and doesn't expect or require any schema or creation of secondary indices.</p><p><b>Tunable consistency levels</b></p><p>Azure Cosmos DB provides five well-defined consistency levels to achieve the right tradeoff between consistency and performance for your application. For queries and read operations, Azure Cosmos DB offers five distinct consistency levels: strong, bounded-staleness, session, consistent prefix, and eventual. These granular, well-defined consistency levels allow you to make sound tradeoffs among consistency, availability, and latency.</p><h4 class="da-h4">Graph databases</h4><p>Data as it appears in the real world is naturally connected. Traditional data modeling focuses on defining entities separately and computing their relationships at runtime. While this model has its advantages, highly connected data can be challenging to manage under its constraints.</p><p>A graph database approach relies on persisting relationships in the storage layer instead, which leads to highly efficient graph retrieval operations. Azure Cosmos DB's Gremlin API supports the property graph model.</p><h4 class="da-h4">Property graph objects</h4><p>A property graph is a structure that's composed of vertices and edges. Both objects can have an arbitrary number of key-value pairs as properties.</p><ul class="square"><li class="square"><p><b>Vertices</b> - Vertices denote discrete entities, such as a person, a place, or an event.</p></li><li class="square"><p><b>Edges</b> - Edges denote relationships between vertices. For example, a person might know another person, be involved in an event, and recently been at a location.</p></li><li class="square"><p><b>Properties</b> - Properties express information about the vertices and edges. There can be any number of properties in either vertices or edges, and they can be used to describe and filter the objects in a query. Example properties include a vertex that has name and age, or an edge, which can have a time stamp and/or a weight.</p></li></ul><p>Graph databases are often included within the NoSQL or non-relational database category, since there is no dependency on a schema or constrained data model. This lack of schema allows for modeling and storing connected structures naturally and efficiently.</p><h5 class="da-h5">Gremlin example</h5><p>Below is sample graph to help understand how queries can be expressed in Gremlin. The following figure shows a business application that manages data about users, interests, and devices in the form of a graph.</p><p><span><img alt="" src="../Images/1192052-490190.png" width="" height="" /></span></p><p>This graph has the following vertex types (called “label” in Gremlin):</p><ul class="square"><li class="square"><p><b>People</b>: The graph has three people, Robin, Thomas, and Ben</p></li><li class="square"><p><b>Interests</b>: Their interests, in this example, the game of Football</p></li><li class="square"><p><b>Devices</b>: The devices that people use</p></li><li class="square"><p><b>Operating Systems</b>: The operating systems that the devices run on</p></li></ul><p>We represent the relationships between these entities via the following edge types/labels:</p><ul class="square"><li class="square"><p><b>Knows</b>: For example, “Thomas knows Robin”</p></li><li class="square"><p><b>Interested</b>: To represent the interests of the people in our graph, for example, “Ben is interested in Football”</p></li><li class="square"><p><b>RunsOS</b>: Laptop runs the Windows OS</p></li><li class="square"><p><b>Uses</b>: To represent which device a person uses. For example, Robin uses a Motorola phone with serial number 77</p></li></ul><h3 class="da-h3" id="1191790">Azure Cosmos DB Table API</h3><p>Azure Cosmos DB provides the Table API for applications that are written for Azure Table storage and that need premium capabilities like:</p><ul class="square"><li class="square"><p>Turnkey global distribution.</p></li><li class="square"><p>Dedicated throughput worldwide.</p></li><li class="square"><p>Single-digit millisecond latencies at the 99th percentile.</p></li><li class="square"><p>Guaranteed high availability.</p></li><li class="square"><p>Automatic secondary indexing.</p></li></ul><p>Applications written for Azure Table storage can migrate to Azure Cosmos DB by using the Table API with no code changes and take advantage of premium capabilities. The Table API has client SDKs available for .NET, Java, Python, and Node.js.</p><p><b>Important:</b> The .NET Framework SDK Microsoft.Azure.CosmosDB.Table is in maintenance mode and it will be deprecated soon. Please upgrade to the new .NET Standard library Microsoft.Azure.Cosmos.Table to continue to get the latest features supported by the Table API.</p><h4 class="da-h4">Table offerings</h4><p>If you currently use Azure Table Storage, you gain the following benefits by moving to the Azure Cosmos DB Table API:</p><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p /></td><td><p><b>Azure Table storage</b></p></td><td><p><b>Azure Cosmos DB Table API</b></p></td></tr></thead><tbody><tr><td><p><b>Latency</b></p></td><td><p>Fast, but no upper bounds on latency.</p></td><td><p>Single-digit millisecond latency for reads and writes, backed with &lt;10 ms latency for reads and writes at the 99th percentile, at any scale, anywhere in the world.</p></td></tr><tr><td><p><b>Throughput</b></p></td><td><p>Variable throughput model. Tables have a scalability limit of 20,000 operations/s.</p></td><td><p>Highly scalable with dedicated reserved throughput per table that's backed by SLAs. Accounts have no upper limit on throughput and support &gt;10 million operations/s per table.</p></td></tr><tr><td><p><b>Global distribution</b></p></td><td><p>Single region with one optional readable secondary read region for high availability. You can't initiate failover.</p></td><td><p>Turnkey global distribution from one to any number of regions. Support for automatic and manual failovers at any time, anywhere in the world. Multi-master capability to let any region accept write operations.</p></td></tr><tr><td><p><b>Indexing</b></p></td><td><p>Only primary index on PartitionKey and RowKey. No secondary indexes.</p></td><td><p>Automatic and complete indexing on all properties by default, with no index management.</p></td></tr><tr><td><p><b>Query</b></p></td><td><p>Query execution uses index for primary key, and scans otherwise.</p></td><td><p>Queries can take advantage of automatic indexing on properties for fast query times.</p></td></tr><tr><td><p><b>Consistency</b></p></td><td><p>Strong within primary region. Eventual within secondary region.</p></td><td><p>Five well-defined consistency levels to trade off availability, latency, throughput, and consistency based on your application needs.</p></td></tr><tr><td><p><b>Pricing</b></p></td><td><p>Storage-optimized.</p></td><td><p>Throughput-optimized.</p></td></tr><tr><td><p><b>SLAs</b></p></td><td><p>99.9% to 99.99% availability, depending on the replication strategy.</p></td><td><p>99.999% read availability, 99.99% write availability on a single-region account and 99.999% write availability on multi-region accounts. Comprehensive SLAs covering availability, latency, throughput and consistency.</p></td></tr></tbody></table><h3 class="da-h3" id="1191664">Modify or Delete VNet Peering</h3><p>Before changing a peering, familiarize yourself with the requirements and constraints and <a href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-manage-peering?WT.mc_id=thomasmaurer-blog-thmaure" title="" target="_blank">necessary permissions</a>.</p><ol class="number"><li><p>In the search box at the top of the portal, enter <i>virtual networks</i> in the search box. When Virtual networks appear in the search results, select it. Do not select Virtual networks (classic) if it appears in the list, as you cannot create a peering from a virtual network deployed through the classic deployment model.</p></li><li><p>Select the virtual network in the list that you want to change peering settings for.</p></li><li><p>Under <b>SETTINGS</b>, select <b>Peerings</b>.</p></li><li><p>Select the peering you want to view or change settings for.</p></li><li><p>Change the appropriate setting. Read about the options for each setting in <a href="https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-manage-peering?WT.mc_id=thomasmaurer-blog-thmaure" title="" target="_blank">step 5</a> of Create a peering.</p></li><li><p>Select <b>Save</b>.</p></li></ol><p><b>Delete a peering</b></p><p>When a peering is deleted, traffic from a virtual network no longer flows to the peered virtual network. When virtual networks deployed through Resource Manager are peered, each virtual network has a peering to the other virtual network. Though deleting the peering from one virtual network disables the communication between the virtual networks, it does not delete the peering from the other virtual network. The peering status for the peering that exists in the other virtual network is Disconnected. You cannot recreate the peering until you re-create the peering in the first virtual network and the peering status for both virtual networks changes to Connected.</p><p>If you want virtual networks to communicate sometimes, but not always, rather than deleting a peering, you can set the Allow virtual network access setting to Disabled instead.</p><ol class="number"><li><p>In the search box at the top of the portal, enter <i>virtual networks</i> in the search box. When Virtual networks appear in the search results, select it. Do not select Virtual networks (classic) if it appears in the list, as you cannot create a peering from a virtual network deployed through the classic deployment model.</p></li><li><p>Select the virtual network in the list that you want to delete a peering for.</p></li><li><p>Under <b>SETTINGS</b>, select <b>Peerings</b>.</p></li><li><p>On the right side of the peering you want to delete, select <b>...</b>, select <b>Delete</b>, then select Yes to delete the peering from the first virtual network.</p></li><li><p>Complete the previous steps to delete the peering from the other virtual network in the peering.</p></li></ol><h3 class="da-h3" id="1191871">Preparing VMs for Migration</h3><p>Azure Migrate requires some VM changes to ensure that VMs can be migrated to Azure. For some <a href="https://docs.microsoft.com/en-us/azure/migrate/server-migrate-overview" title="" target="_blank">operating systems</a>, Azure Migrate makes these changes automatically. For other operating systems, you need to make adjustments manually before migration. The <a href="https://docs.microsoft.com/en-us/azure/migrate/tutorial-migrate-vmware" title="" target="_blank">migrate tutorial</a> explains how to do this.</p><p>It's important to make these changes before you begin migration. If you migrate the VM before you make the change, the VM might not boot up in Azure.</p><p>Configuration changes you make to on-premises VMs are replicated to Azure after replication for the VM is enabled. To ensure that changes are replicated, make sure that the recovery point you migrate to is later than the time at which the configuration changes were made on-premises.</p><h4 class="da-h4">Windows Server VMs</h4><p>As you prepare Windows Server VMs for migration, you should first ensure you have done the actions in the following table.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p><b>Actions</b></p></td><td><p><b>Details</b></p></td></tr></thead><tbody><tr><td><p>Ensure that Windows volumes in Azure VM use the same drive letter assignments as the on-premises VM</p></td><td><p>Configure the SAN policy as Online All</p></td></tr><tr><td><p>Enable Azure screen access console for the Azure VM</p></td><td><p>This helps with troubleshooting. You don’t need to reboot the VM. The Azure VM will boot using the disk image, and this is equivalent to a reboot for the new VM.</p></td></tr><tr><td><p>Install Hyper-V Guest Integration</p></td><td><p>If you’re migrating machines running Windows Server 2003, install Hyper-V Integration Services on the VM operating system.</p></td></tr><tr><td><p>Remote Desktop</p></td><td><p>Enable Remote Desktop on the VM, and check that the Windows Firewall isn’t blocking Remote Desktop access on any network profiles.</p></td></tr></tbody></table><p>To configure the  SAN policy:</p><ol class="number"><li><p>Sign in to the VM with an admin account and open a command window.</p></li><li><p>Type <b>diskpart</b> to run the Diskpart utility.</p></li><li><p>Type <b>SAN POLICY=OnlineAll</b></p></li><li><p>Type <b>Exit</b> to leave Diskpart, and close the command prompt.</p></li></ol><h4 class="da-h4">Linux VMs</h4><p>Likewise, as you prepare Linux VMs for Migrate, ensure first that you have done the actions in the following table.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p><b>Actions</b></p></td><td><p><b>Details</b></p></td></tr></thead><tbody><tr><td><p>Install Hyper-V Linux Integration Services</p></td><td><p>Most new versions of Linux distributions have this included by default.</p></td></tr><tr><td><p>Rebuild the Linux init image to contain the necessary Hyper-V drivers</p></td><td><p>This ensures that the VM will boot in Azure, and is only required on some distributions.</p></td></tr><tr><td><p>Enable Azure serial console logging</p></td><td><p>This helps with troubleshooting. You don’t need to reboot the VM. The Azure VM will reboot using the disk image, and this is equivalent to a reboot for the new VM.</p></td></tr><tr><td><p>Update device map file</p></td><td><p>Update the device map file that has the device name to volume associations, to persistent identifiers.</p></td></tr><tr><td><p>Update fstab entries</p></td><td><p>Update entries to use persistent volume identifiers.</p></td></tr><tr><td><p>Remove udev rule</p></td><td><p>Remove any udev rules that reserve interface names based on mac address, etc.</p></td></tr><tr><td><p>Update network interfaces</p></td><td><p>Update network interfaces to receive IP addresses based on DHCP.</p></td></tr><tr><td><p>Enable ssh</p></td><td><p>Ensure ssh is enabled and the sshd service is set to start automatically on reboot. Ensure that incoming ssh connection requests are not blocked by the OSS firewall or scriptable rules.</p></td></tr></tbody></table><h3 class="da-h3" id="1191728">Azure Bastion</h3><p>The Azure Bastion service is a  fully platform-managed PaaS service that you provision inside your virtual network. It provides secure and seamless RDP/SSH connectivity to your virtual machines directly in the Azure portal over TLS. When you connect using Azure Bastion, your virtual machines do not need a public IP address.</p><p>Bastion provides secure RDP and SSH connectivity to all the VMs in the virtual network in which it is provisioned. Using Azure Bastion protects your virtual machines from exposing RDP/SSH ports to the outside world, while still providing secure access using RDP/SSH. With Azure Bastion, you connect to the virtual machine directly from the Azure portal.</p><h4 class="da-h4">Architecture</h4><p>Azure Bastion deployment is per virtual network, not per subscription/account or virtual machine. Once you provision an Azure Bastion service in your virtual network, the RDP/SSH experience is available to all your VMs in the same virtual network.</p><p>Exposing RDP/SSH ports over the Internet isn't desired and is seen as a significant threat surface. This is often due to protocol vulnerabilities. To contain this threat surface, you can deploy bastion hosts (also known as jump-servers) at the public side of your perimeter network. Bastion host servers are designed and configured to withstand attacks. Bastion servers also provide RDP and SSH connectivity to the workloads sitting behind the bastion, as well as further inside the network.</p><p>This figure below shows the architecture of an Azure Bastion deployment. In this diagram:</p><ul class="square"><li class="square"><p>The Bastion host is deployed in the virtual network.</p></li><li class="square"><p>The user connects to the Azure portal using any HTML5 browser.</p></li><li class="square"><p>The user selects the virtual machine to connect to.</p></li><li class="square"><p>With a single click, the RDP/SSH session opens in the browser.</p></li><li class="square"><p>No public IP is required on the Azure VM.</p></li></ul><p><span><img alt="" src="../Images/1192040-490178.png" width="" height="" /></span></p><h4 class="da-h4">Key features</h4><p>The following features are available:</p><ul class="square"><li class="square"><p><b>RDP and SSH directly in Azure portal</b>: You can directly get to the RDP and SSH session directly in the Azure portal using a single click seamless experience.</p></li><li class="square"><p><b>Remote Session over TLS and firewall traversal for RDP/SSH</b>: Azure Bastion uses an HTML5 based web client that is automatically streamed to your local device, so that you get your RDP/SSH session over TLS on port 443 enabling you to traverse corporate firewalls securely.</p></li><li class="square"><p><b>No Public IP required on the Azure VM</b>: Azure Bastion opens the RDP/SSH connection to your Azure virtual machine using private IP on your VM. You don't need a public IP on your virtual machine.</p></li><li class="square"><p><b>No hassle of managing NSGs</b>: Azure Bastion is a fully managed platform PaaS service from Azure that is hardened internally to provide you secure RDP/SSH connectivity. You don't need to apply any NSGs on Azure Bastion subnet. Because Azure Bastion connects to your virtual machines over private IP, you can configure your NSGs to allow RDP/SSH from Azure Bastion only.</p></li><li class="square"><p><b>Protection against port scanning</b>: Because you do not need to expose your virtual machines to public Internet, your VMs are protected against port scanning by rogue and malicious users located outside your virtual network.</p></li><li class="square"><p><b>Protect against zero-day exploits</b>. Hardening in one place only: Azure Bastion is a fully platform-managed PaaS service. Because it sits at the perimeter of your virtual network, you don’t need to worry about hardening each of the virtual machines in your virtual network.</p></li></ul><h3 class="da-h3" id="1191818">Create and Deploy from a ARM Template</h3><p>This topic demonstrates to how to create a simple ARM template and deploy it to Azure using Azure CLI.</p><p>✔️<b>Note</b>:
It is recommended you use Visual Studio Code with the Resource Manager Tools extension. If you need to install these tools, see <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/use-vs-code-to-create-template" title="" target="_blank">Use Visual Studio Code to create ARM templates</a>.</p><p><b>Command-line deployment</b></p><p>You need Azure CLI to deploy the template. For the installation instructions, see:</p><ul class="square"><li class="square"><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli-windows" title="" target="_blank">Install Azure CLI on Windows</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli-linux" title="" target="_blank">Install Azure CLI on Linux</a></p></li></ul><p><b>Create the ARM template</b></p><ol class="number"><li><p>Open Visual Studio Code with the Resource Manager Tools extension installed.</p></li><li><p>From the <b>File</b> menu, select <b>New File</b> to create a new file.</p></li><li><p>From the <b>File</b> menu, select <b>Save as</b>.</p></li><li><p>Name the file <i>azuredeploy</i> and select the JSON file extension. The complete name of the file is <i>azuredeploy.json</i>.</p></li><li><p>Save the file to your workstation.</p></li><li><p>Copy and paste the following JSON into the file:</p></li></ol><div class="code language-JSON"><p class="da-divtext"><code><span class="token punctuation">{</span>
  <span class="token property">"$schema"</span><span class="token operator">:</span> <span class="token string">"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"</span><span class="token punctuation">,</span>
  <span class="token property">"contentVersion"</span><span class="token operator">:</span> <span class="token string">"1.0.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"resources"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></p></div><p>Below is a sample of what the VS Code environment looks like:</p><p><span><img alt="" src="../Images/1192292-490430.png" width="" height="" /></span></p><p>Notice that this template doesn't deploy any resources. We're starting with a blank template so you can get familiar with the steps to deploy a template.</p><p>The JSON file has the following elements:</p><ul class="square"><li class="square"><p><span class="code">$schema</span>: Specifies the location of the JSON schema file. The schema file describes the properties that are available within a template. For example, the schema defines resources as one of the valid properties for a template.</p></li><li class="square"><p><span class="code">contentVersion</span>: Specifies the version of the template (such as 1.0.0.0). You can provide any value for this element. Use this value to document significant changes in your template. When deploying resources using the template, this value can be used to make sure that the right template is being used.</p></li><li class="square"><p><span class="code">resources</span>: Contains the resources you want to deploy or update. Currently, it's empty, but you'll add resources later.</p></li></ul><ol class="number"><li value="7"><p>Save the file.</p></li></ol><p><b>Sign in to Azure using Azure CLI</b></p><div class="code language-Azure"><p class="da-divtext">az login
</p></div><p><b>Create resource group</b></p><p>When you deploy a template, you specify a resource group that will contain the resources. Before running the deployment command, create the resource group with Azure CLI.</p><div class="code language-Azure"><p class="da-divtext">az group create \
  --name myResourceGroup \
  --location "Central US"
</p></div><p><b>Deploy template</b></p><p>To deploy the template you use Azure CLI. Use the resource group you created. Give a name to the deployment so you can easily identify it in the deployment history. For convenience, also create a variable that stores the path to the template file. This variable makes it easier for you to run the deployment commands because you don't have to retype the path every time you deploy.</p><div class="code language-Azure"><p class="da-divtext">templateFile="{provide-the-path-to-the-template-file}"
az deployment group create \
  --name blanktemplate \
  --resource-group myResourceGroup \
  --template-file $templateFile
</p></div><p>Look for <span class="code">ProvisioningState</span> to see whether the deployment succeeded.</p><p><span><img alt="" src="../Images/1192293-490431.png" width="" height="" /></span></p><p><b>Verify deployment</b></p><p>You can verify the deployment by exploring the resource group from the Azure portal.</p><ol class="number"><li><p>Sign in to the <a href="https://portal.azure.com/" title="" target="_blank">Azure portal</a>.</p></li><li><p>From the left menu, select <b>Resource groups</b>.</p></li><li><p>Select the resource group deploy in the last procedure. The default name is ```myResourceGroup``. You should see no resources deployed within the resource group.</p></li><li><p>Notice in the upper right of the overview, the status of the deployment is displayed. Select <b>1 Succeeded</b>.</p></li></ol><p><span><img alt="" src="../Images/1192294-490432.png" width="" height="" /></span></p><ol class="number"><li value="5"><p>You see a history of deployment for the resource group. Select <span class="code">blanktemplate</span>.</p></li></ol><p><span><img alt="" src="../Images/1192295-490433.png" width="" height="" /></span></p><ol class="number"><li value="6"><p>You see a summary of the deployment. Notice on the left you can view inputs, outputs, and the template used during deployment.</p></li></ol><p><span><img alt="" src="../Images/1192296-490434.png" width="" height="" /></span></p><p><b>Clean up resources</b></p><ol class="number"><li><p>From the Azure portal, select <b>Resource group</b> from the left menu.</p></li><li><p>Enter the resource group name in the Filter by name field.</p></li><li><p>Select the resource group name.</p></li><li><p>Select <b>Delete resource group</b> from the top menu.</p></li></ol><h3 class="da-h3" id="1191878">Preparing Azure for Migration</h3><p>Just like agentless migration, agent-based migration requires that you prepare Azure and ensure you have the appropriate permissions to perform the following tasks:</p><ul class="square"><li class="square"><p>Create an Azure Migrate project</p></li><li class="square"><p>Register the Azure Migrate replication appliance</p></li><li class="square"><p>Create a Key Vault</p></li></ul><h4 class="da-h4">Assign permissions to create project</h4><ol class="number"><li><p>In the Azure portal, open the subscription, and select <b>Access control (IAM)</b>.</p></li><li><p>In <b>Check access</b>, find the relevant account, and click it to view permissions.</p></li></ol><p>You should have <b>Contributor</b> or <b>Owner</b> permissions. If you just created a free Azure account, you're the owner of your subscription. If you're not the subscription owner, work with the owner to assign the role.</p><h4 class="da-h4">Assign permissions to register the appliance</h4><p>If you're deploying the Azure Migrate appliance to assess or run an agentless migration of VMs, you need to register it. During appliance registration, Azure Migrate creates two Azure Active Directory (Azure AD) apps that uniquely identify the appliance.</p><ul class="square"><li class="square"><p>The first app communicates with Azure Migrate service endpoints.</p></li><li class="square"><p>The second app accesses an Azure Key Vault created during registration to store Azure AD app info and appliance configuration settings.</p></li></ul><h4 class="da-h4">Assign permissions to create the Azure AD apps</h4><p>You can assign permissions for Azure Migrate to create these Azure AD apps using one of the following methods:</p><ol class="number"><li><p>A tenant/global admin can grant permissions to users in the tenant, to create and register Azure AD apps.</p></li><li><p>A tenant/global admin can assign the Application Developer role (that has the permissions) to the account.</p></li></ol><p>✔️ It's worth noting that the apps don't have any other access permissions on the subscription other than those described above. Additionally, you only need these permissions when you register a new appliance. You can remove the permissions after the appliance is set up.</p><h5 class="da-h5">Prepare Azure - grant permissions</h5><p>The tenant/global admin can grant permissions as follows:</p><p>In Azure AD, the tenant/global admin should navigate to <b>Azure Active Directory &gt; Users &gt; User Settings</b>.
The admin should set App registrations to <b>Yes</b>.</p><p><span><img alt="" src="../Images/1192268-490406.png" width="" height="" /></span></p><h5 class="da-h5">Assign Application Developer role</h5><p>The tenant/global admin can assign the Application Developer role to an account.</p><h5 class="da-h5">Assign permissions to create the Key Vault</h5><p>Assign role assignment permissions on the resource group in which the Azure Migrate project resides, as follows:</p><ol class="number"><li><p>In the resource group in the Azure portal, select <b>Access control (IAM)</b>.</p></li><li><p>In <b>Check access</b>, find the relevant account, and click it to view permissions. You need <b>Owner</b> (or <b>Contributor and User Access Administrator</b>) permissions.</p></li></ol><p>✔️ If you don't have the required permissions, request them from the resource group owner.</p><h3 class="da-h3" id="1191912">Azure Kubernetes Service</h3><p>Azure Kubernetes Service (AKS) manages your hosted Kubernetes environment and makes it simple to deploy and manage containerized applications in Azure. Your AKS environment is enabled with features such as automated updates, self-healing, and easy scaling. The Kubernetes cluster master is managed by Azure and is free. You manage the agent nodes in the cluster and only pay for the VMs on which your nodes run.</p><p>You can either create your cluster in the Azure portal or use the Azure CLI. When you create the cluster, you can use Resource Manager templates to automate cluster creation. With these templates, you specify features such as advanced networking, Azure Active Directory (AD) integration, and monitoring. This information is then used to automate the cluster deployment on your behalf.</p><p>At its core, an AKS cluster is a cloud hosted Kubernetes cluster. Unlike a custom Kubernetes installation, AKS streamlines the installation process and takes care of most of the underlying cluster management tasks.</p><p>You have two options when you create an AKS cluster. You either use the Azure portal or Azure CLI.</p><h4 class="da-h4">How workloads are developed and deployed to AKS</h4><p><span><img alt="" src="../Images/1192351-490489.png" width="" height="" /></span></p><p>AKS supports the Docker image format that means that you can use any development environment to create a workload, package the workload as a container and deploy the container as a Kubernetes pod.</p><p>Here you use the standard Kubernetes command-line tools or the Azure CLI to manage your deployments. The support for the standard Kubernetes tools ensures that you don't need to change your current workflow to support an existing Kubernetes migration to AKS.</p><p>AKS also supports all the popular development and management tools such as Helm, Draft, Kubernetes extension for Visual Studio Code and Visual Studio Kubernetes Tools.</p><h4 class="da-h4">Deployment Center</h4><p>Deployment center simplifies setting up a DevOps pipeline for your application. You can use this configured DevOps pipeline to set up a continuous integration (CI) and continuous delivery (CD) pipeline to your AKS Kubernetes cluster.</p><p>With Azure DevOps Projects you can:</p><ul class="square"><li class="square"><p>Automatically create Azure resources, such as an AKS cluster</p></li><li class="square"><p>Create an Azure Application Insights resource for monitoring an AKS cluster</p></li><li class="square"><p>Enable Azure Monitor for containers to monitor performance for the container workloads on an AKS cluster</p></li></ul><h4 class="da-h4">Azure Service Integration</h4><p>AKS allows us to integrate any Azure service offering and use it as part of an AKS cluster solution.</p><h3 class="da-h3" id="1191905">Test Failover</h3><p>You can use a recovery plan to trigger a test failover. Use the following best practices:</p><ul class="square"><li class="square"><p>Always complete a test failover on an app, before running a full failover. Test failovers help you to check whether the app comes up on the recovery site.</p></li><li class="square"><p>If you find you've missed something, trigger a clean-up, and then rerun the test failover.</p></li><li class="square"><p>Run a test failover multiple times, until you're sure that the app recovers smoothly.</p></li><li class="square"><p>Because each app is unique, you need to build recovery plans that are customized for each application and run a test failover on each.</p></li><li class="square"><p>Apps and their dependencies change frequently. To ensure recovery plans are up-to-date, run a test failover for each app every quarter.
<span><img alt="" src="../Images/1192035-490173.png" width="" height="" /></span></p></li></ul><h3 class="da-h3" id="1191934">Enable VNet Integration</h3><ol class="number"><li><p>Go to the Networking UI in the App Service portal. Under <b>VNet Integration</b>, select <b>Click here</b> to configure.</p></li><li><p>Select <b>Add VNet</b>.</p></li></ol><p><span><img alt="" src="../Images/1192242-490380.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>The drop-down list contains all of the Azure Resource Manager virtual networks in your subscription in the same region. Underneath that is a list of the Resource Manager virtual networks in all other regions. Select the VNet you want to integrate with.</p></li></ol><p><span><img alt="" src="../Images/1192243-490381.png" width="" height="" /></span></p><ul class="square"><li class="square"><p>If the VNet is in the same region, either create a new subnet or select an empty preexisting subnet.</p></li><li class="square"><p>To select a VNet in another region, you must have a VNet gateway provisioned with point to site enabled.</p></li><li class="square"><p>To integrate with a classic VNet, instead of selecting the Virtual Network drop-down list, select Click here to connect to a Classic VNet. Select the classic virtual network you want. The target VNet must already have a Virtual Network gateway provisioned with point-to-site enabled.</p></li></ul><p><span><img alt="" src="../Images/1192244-490382.png" width="" height="" /></span></p><p>During the integration, the app is restarted. When integration is finished, you'll see details on the VNet you're integrated with.</p><h3 class="da-h3" id="1191684">Virtual Machines Scale Sets</h3><p>Azure virtual machine scale sets let you create and manage a group of load balanced VMs. The number of VM instances can automatically increase or decrease in response to demand or a defined schedule. Scale sets provide high availability to your applications, and allow you to centrally manage, configure, and update many VMs. We recommended that two or more VMs are created within a scale set to provide for a highly available application and to meet the 99.95% Azure SLA.</p><p>There is no cost for the scale set itself, you only pay for each VM instance that you create. When a single VM is using Azure premium SSDs, the Azure SLA applies for unplanned maintenance events. Virtual machines in a scale set can be deployed across multiple update domains and fault domains to maximize availability and resilience to outages due to data center outages, and planned or unplanned maintenance events.</p><p><b>Fault domains and update domains</b></p><p>Virtual machine scale sets simplify designing for high availability by aligning fault domains and update domains. You will only have to define fault domains count for the scale set. The number of fault domains available to the scale sets may vary by region.</p><h3 class="da-h3" id="1191703">Configure a Public Load Balancer</h3><p>A public load balancer maps the public IP address and port number of incoming traffic to the private IP address and port number of a virtual machine in the back-end pool. The responses are then returned to the client. By applying load-balancing rules, you distribute specific types of traffic across multiple virtual machines or services.</p><h4 class="da-h4">Distribution modes</h4><p>By default, Azure Load Balancer distributes network traffic equally among virtual machine instances. The following distribution modes are also possible if a different behavior is required:</p><p><b>Five-tuple hash</b>. The default distribution mode for Load Balancer is a five-tuple hash. The tuple is composed of the source IP, source port, destination IP, destination port, and protocol type. Because the source port is included in the hash and the source port changes for each session, clients might be directed to a different virtual machine for each session.</p><p><span><img alt="" src="../Images/1192139-490277.png" width="" height="" /></span></p><p><b>Source IP affinity</b>. This distribution mode is also known as session affinity or client IP affinity. To map traffic to the available servers, the mode uses a two-tuple hash (from the source IP address and destination IP address) or three-tuple hash (from the source IP address, destination IP address, and protocol type). The hash ensures that requests from a specific client are always sent to the same virtual machine behind the load balancer.</p><p><span><img alt="" src="../Images/1192140-490278.png" width="" height="" /></span></p><h4 class="da-h4">Choose a distribution mode</h4><p>Imagine a scenario where the requirement of the presentation tier is to use in-memory sessions to store the logged user's profile as the user interacts with the portal.</p><p>In this scenario, the load balancer must provide source IP affinity to maintain a user's session. The profile is stored only on the virtual machine that the client first connects to because that IP address is directed to the same server. When you create the load balancer endpoint, you must specify the distribution mode by using the following PowerShell example:</p><div class="code language-PowerShell"><p class="da-divtext"><code><span class="token variable">$lb</span> = Get<span class="token operator">-</span>AzLoadBalancer <span class="token operator">-</span>Name MyLb <span class="token operator">-</span>ResourceGroupName MyResourceGroup
<span class="token variable">$lb</span><span class="token punctuation">.</span>LoadBalancingRules<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">.</span>LoadDistribution = <span class="token string">'sourceIp'</span>
<span class="token function">Set</span><span class="token operator">-</span>AzLoadBalancer <span class="token operator">-</span>LoadBalancer <span class="token variable">$lb</span></code></p></div><p>To add session persistence through the Azure portal:</p><ol class="number"><li><p>In the Azure portal, open the load balancer resource.</p></li><li><p>Edit the relevant line of the <b>Load-balancing rules</b>.</p></li><li><p>Change the value for <b>Session persistence</b> to <b>Client IP</b>.</p></li></ol><p><span><img alt="" src="../Images/1192141-490279.png" width="" height="" /></span></p><h4 class="da-h4">Load Balancer and Remote Desktop Gateway</h4><p>Remote Desktop Gateway is a Windows service that you can use to enable clients on the internet to make Remote Desktop Protocol (RDP) connections through firewalls to Remote Desktop servers on your private network. The default five-tuple hash in Load Balancer is incompatible with this service. If you want to use Load Balancer with your Remote Desktop servers, use source IP affinity.</p><h3 class="da-h3" id="1191763">Access Data with an Azure AD Account</h3><p>Access to blob or queue data via the Azure portal, PowerShell, or Azure CLI can be authorized either by using the user's Azure AD account or by using the account access keys (Shared Key authorization).</p><p><b>Data access from the Azure portal</b></p><p>The Azure portal can use either your Azure AD account or the account access keys to access blob and queue data in an Azure storage account. Which authorization scheme the Azure portal uses depends on the RBAC roles that are assigned to you.</p><p>When you attempt to access blob or queue data, the Azure portal first checks whether you have been assigned an RBAC role with <b>Microsoft.Storage/storageAccounts/listkeys/action</b>. If you have been assigned a role with this action, then the Azure portal uses the account key for accessing blob and queue data via Shared Key authorization. If you have not been assigned a role with this action, then the Azure portal attempts to access data using your Azure AD account.</p><p>To access blob or queue data from the Azure portal using your Azure AD account, you need permissions to access blob and queue data, and you also need permissions to navigate through the storage account resources in the Azure portal. The built-in roles provided by Azure Storage grant access to blob and queue resources, but they don't grant permissions to storage account resources.</p><p>Access to the portal also requires the assignment of an Azure Resource Manager role such as the <a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles" title="" target="_blank">Reader</a> role, scoped to the level of the storage account or higher. The <b>Reader</b> role grants the most restricted permissions, but another Azure Resource Manager role that grants access to storage account management resources is also acceptable.</p><h3 class="da-h3" id="1191745">Blob Lifecycle Management</h3><p><span><img alt="" src="../Images/1192105-490243.png" width="" height="" /></span></p><p>Data sets have unique lifecycles. Early in the lifecycle, people access some data often. But the need for access drops drastically as the data ages. Some data stays idle in the cloud and is rarely accessed once stored. Some data expires days or months after creation, while other data sets are actively read and modified throughout their lifetimes. Azure Blob storage lifecycle management offers a rich, rule-based policy for GPv2 and Blob storage accounts. Use the policy to transition your data to the appropriate access tiers or expire at the end of the data's lifecycle.</p><p>The lifecycle management policy lets you:</p><ul class="square"><li class="square"><p>Transition blobs to a cooler storage tier (hot to cool, hot to archive, or cool to archive) to optimize for performance and cost.</p></li><li class="square"><p>Delete blobs at the end of their lifecycles.</p></li><li class="square"><p>Define rules to be run once per day at the storage account level.</p></li><li class="square"><p>Apply rules to containers or a subset of blobs (using prefixes as filters).</p></li></ul><p>Consider a scenario where data gets frequent access during the early stages of the lifecycle, but only occasionally after two weeks. Beyond the first month, the data set is rarely accessed. In this scenario, hot storage is best during the early stages. Cool storage is most appropriate for occasional access. Archive storage is the best tier option after the data ages over a month. By adjusting storage tiers in respect to the age of data, you can design the least expensive storage options for your needs. To achieve this transition, lifecycle management policy rules are available to move aging data to cooler tiers.</p><h3 class="da-h3" id="1191702">Select a Load Balancer Solution</h3><p>Two products are available when you create a load balancer in Azure: basic load balancers and standard load balancers.</p><p><b>Basic load balancers</b> allow:</p><ul class="square"><li class="square"><p>Port forwarding</p></li><li class="square"><p>Automatic reconfiguration</p></li><li class="square"><p>Health probes</p></li><li class="square"><p>Outbound connections through source network address translation (SNAT)</p></li><li class="square"><p>Diagnostics through Azure Log Analytics for public-facing load balancers</p></li></ul><p>Basic load balancers can be used only with Virtual machines in a single availability set or a virtual machine scale set.</p><p><b>Standard load balancers</b> support all of the basic features. They also allow:</p><ul class="square"><li class="square"><p>HTTPS health probes</p></li><li class="square"><p>Availability zones</p></li><li class="square"><p>Diagnostics through Azure Monitor, for multidimensional metrics</p></li><li class="square"><p>High availability (HA) ports</p></li><li class="square"><p>Outbound rules</p></li><li class="square"><p>A guaranteed SLA (99.99% for two or more virtual machines)</p></li></ul><p>Standard load balancer can use any virtual machines or virtual machine scale sets in a single virtual network.</p><h4 class="da-h4">Internal and external load balancers</h4><p>An <b>external load balancer</b> operates by distributing client traffic across multiple virtual machines. An external load balancer permits traffic from the internet. The traffic might come from browsers, module apps, or other sources.</p><p>An <b>internal load balancer</b> distributes a load from internal Azure resources to other Azure resources. For example, if you have front-end web servers that need to call business logic that's hosted on multiple middle-tier servers, you can distribute that load evenly by using an internal load balancer. No traffic is allowed from internet sources.</p><h3 class="da-h3" id="1191747">Storage Pricing</h3><p>All storage accounts use a pricing model for blob storage based on the tier of each blob. When using a storage account, the following billing considerations apply:</p><ul class="square"><li class="square"><p><b>Performance tiers</b>: In addition to, the amount of data stored, the cost of storing data varies depending on the storage tier. The per-gigabyte cost decreases as the tier gets cooler.</p></li><li class="square"><p><b>Data access costs</b>: Data access charges increase as the tier gets cooler. For data in the cool and archive storage tier, you are charged a per-gigabyte data access charge for reads.</p></li><li class="square"><p><b>Transaction costs</b>: There is a per-transaction charge for all tiers that increases as the tier gets cooler.</p></li><li class="square"><p><b>Geo-Replication data transfer costs</b>: This charge only applies to accounts with geo-replication configured, including GRS and RA-GRS. Geo-replication data transfer incurs a per-gigabyte charge.</p></li><li class="square"><p><b>Outbound data transfer costs</b>: Outbound data transfers (data that is transferred out of an Azure region) incur billing for bandwidth usage on a per-gigabyte basis, consistent with general-purpose storage accounts.</p></li><li class="square"><p><b>Changing the storage tier</b>: Changing the account storage tier from cool to hot incurs a charge equal to reading all the data existing in the storage account. However, changing the account storage tier from hot to cool incurs a charge equal to writing all the data into the cool tier (GPv2 accounts only).</p></li></ul><h3 class="da-h3" id="1191801">High-Availability and Azure SQL Database</h3><p>There are two high-availability architectural models that are used in Azure SQL Database:</p><ul class="square"><li class="square"><p><b>Standard availability model that is based on a separation of compute and storage</b>. It relies on high availability and reliability of the remote storage tier. This architecture targets budget-oriented business applications that can tolerate some performance degradation during maintenance activities.</p></li><li class="square"><p><b>Premium availability model that is based on a cluster of database engine processes</b>. It relies on the fact that there is always a quorum of available database engine nodes. This architecture targets mission critical applications with high IO performance, high transaction rate and guarantees minimal performance impact to your workload during maintenance activities.</p></li></ul><h4 class="da-h4">Basic, Standard, and General-Purpose service tier availability</h4><p>The Basic, Standard, and General-Purpose service tiers leverage the standard availability architecture for both serverless and provisioned compute. The following figure shows four different nodes with the separated compute and storage layers.</p><p><span><img alt="" src="../Images/1192224-490362.png" width="" height="" /></span></p><p>The standard availability model includes two layers:</p><ul class="square"><li class="square"><p>A <b>stateless compute layer</b> that runs the <span class="code">sqlservr.exe</span> process and contains only transient and cached data, such as TempDB, model databases on the attached SSD, and plan cache, buffer pool, and columnstore pool in memory. This stateless node is operated by Azure Service Fabric that initializes <span class="code">sqlservr.exe</span>, controls health of the node, and performs failover to another node if necessary.</p></li><li class="square"><p>A <b>stateful data layer</b> with the database files (.mdf/.ldf) that are stored in Azure Blob storage. Azure blob storage has built-in data availability and redundancy feature. It guarantees that every record in the log file or page in the data file will be preserved even if SQL Server process crashes.</p></li></ul><h4 class="da-h4">Premium and Business Critical service tier availability</h4><p>Premium and Business Critical service tiers leverage the Premium availability model, which integrates compute resources (SQL Server Database Engine process) and storage (locally attached SSD) on a single node. High availability is achieved by replicating both compute and storage to additional nodes creating a three to four-node cluster.</p><p><span><img alt="" src="../Images/1192225-490363.png" width="" height="" /></span></p><p>The underlying database files (.mdf/.ldf) are placed on the attached SSD storage to provide very low latency IO to your workload. High availability is implemented using a technology similar to SQL Server Always On Availability Groups. The cluster includes a single primary replica (SQL Server process) that is accessible for read-write customer workloads, and up to three secondary replicas (compute and storage) containing copies of data.</p><p>The primary node constantly pushes changes to the secondary nodes in order and ensures that the data is synchronized to at least one secondary replica before committing each transaction. This process guarantees that if the primary node crashes for any reason, there is always a fully synchronized node to fail over to.</p><p>The failover is initiated by the Azure Service Fabric. Once the secondary replica becomes the new primary node, another secondary replica is created to ensure the cluster has enough nodes (quorum set). Once failover is complete, SQL connections are automatically redirected to the new primary node.</p><h4 class="da-h4">Hyperscale service tier availability</h4><p><span><img alt="" src="../Images/1192226-490364.png" width="" height="" /></span></p><p>The availability model in Hyperscale includes four layers:</p><ul class="square"><li class="square"><p>A <b>stateless compute layer</b> that runs the <span class="code">sqlservr.exe</span> processes and contains only transient and cached data, such as non-covering RBPEX cache, TempDB, model database, etc. on the attached SSD, and plan cache, buffer pool, and columnstore pool in memory.</p></li><li class="square"><p>A <b>stateless storage layer</b> formed by page servers. This layer is the distributed storage engine for the <span class="code">sqlservr.exe</span> processes running on the compute replicas. Each page server contains only transient and cached data, such as covering RBPEX cache on the attached SSD, and data pages cached in memory.</p></li><li class="square"><p>A <b>stateful transaction log storage layer</b> formed by the compute node running the Log service process, the transaction log landing zone, and transaction log long term storage.</p></li><li class="square"><p>A <b>stateful data storage layer</b> with the database files (.mdf/.ndf) that are stored in Azure Storage and are updated by page servers. This layer uses data availability and redundancy features of Azure Storage. Compute nodes in all Hyperscale layers run on Azure Service Fabric, which controls health of each node and performs failovers to available healthy nodes as necessary.</p></li></ul><h4 class="da-h4">Zone redundant configuration</h4><p>By default, the cluster of nodes for the premium availability model is created in the same datacenter. With the introduction of Azure Availability Zones, SQL Database can place different replicas of the Business Critical database to different availability zones in the same region. To eliminate a single point of failure, the control ring is also duplicated across multiple zones as three gateway rings (GW). The routing to a specific gateway ring is controlled by Azure Traffic Manager (ATM).</p><p>The zone redundant version of the high availability architecture is illustrated by the following diagram:</p><p><span><img alt="" src="../Images/1192227-490365.png" width="" height="" /></span></p><h3 class="da-h3" id="1191945">Logic Apps</h3><p>This topic helps to decide whether Logic Apps will work for you without any customization. In cases where you do need create custom components, you'll be able to determine how difficult it will be.</p><h4 class="da-h4">Connector</h4><p>A <i>connector</i> is a component that provides an interface to an external service. For example, the Twitter connector allows you to send and retrieve tweets, while the Office 365 Outlook connector lets you manage your email, calendar, and contacts. Logic Apps provides hundreds of pre-built connectors that you can use to create your apps.</p><p>A connector uses the external service's REST or SOAP API to do its work. When you use a connector in your Logic App, the connector calls the service's underlying API for you. The following illustration shows the Twitter connector and its use of the Twitter REST API.</p><p><span><img alt="" src="../Images/1192125-490263.png" width="" height="" /></span></p><h4 class="da-h4">Custom connectors</h4><p>You can write custom connectors to access services that don't have pre-built connectors. The services must have a REST or SOAP API. The requirement that the services provide an API shouldn't be too surprising since connectors are essentially wrappers around that underlying API.</p><p>To create a custom connector, you first generate an OpenAPI or Postman description of the API. You then use that API description to create a Custom Connector resource in the Azure portal. You can give your connector a name, an icon, and a description for each operation. The following illustration shows an example of the process. Notice that there's no coding involved.</p><p><span><img alt="" src="../Images/1192126-490264.png" width="" height="" /></span></p><p>You can use your new connector in your own apps and share it with other people in your organization. You can also submit your connector to Microsoft for certification. Once your connector is certified, it will be included in the set of connectors available to all users.</p><h4 class="da-h4">Triggers and Actions</h4><p>Workflows are built from different types of tasks. For example, in our social-media monitor scenario we start the workflow when a new tweet is posted, perform work like detect the sentiment, and decide based on the sentiment score. Logic Apps uses the terms <i>trigger, action</i>, and <i>control action</i> for these concepts. These operations are the building blocks of Logic Apps. The following illustration shows how we use each type of step in the social-media monitor app.</p><p><span><img alt="" src="../Images/1192127-490265.png" width="" height="" /></span></p><p>Let's be more specific about the definitions for trigger and action:</p><ul class="square"><li class="square"><p>A <i>trigger</i> is an event that occurs when a specific set of conditions is satisfied. Triggers activate automatically when conditions are met. For example, when a timer expires or data becomes available.</p></li><li class="square"><p>An <i>action</i> is an operation that executes a task in your business process. Actions run when a trigger activates or another action completes.</p></li></ul><p>A connector is a container for related triggers and actions. Let's look at a few examples.</p><p>The Twitter connector lets your Logic App interact with Twitter. The social-media monitor app would use a trigger from the Twitter connector to determine when new relevant tweets are available. The following illustration shows the Twitter connector with its trigger and actions.</p><p><span><img alt="" src="../Images/1192128-490266.png" width="" height="" /></span></p><p>Next, we have the Dropbox connector. Suppose you were working with a small team on a project that stored its shared data in Dropbox. You could build a workflow that detects when someone modifies any of your files and sends a notification to the other team members. The following illustration shows the Dropbox connector with its triggers and actions.</p><p><span><img alt="" src="../Images/1192129-490267.png" width="" height="" /></span></p><p>Finally, let's look at the Twilio connector. Most connectors offer both triggers and actions, but this one only has actions. The Twilio connector is great whenever you want to send text messages for notifications. For example, you could use it in the Dropbox scenario to let team members know that a shared file had changed. The following illustration shows the Twilio connector and its actions.</p><p><span><img alt="" src="../Images/1192130-490268.png" width="" height="" /></span></p><h3 class="da-h3" id="1191711">Demonstration - Create an Application Gateway with a Web Application Firewall</h3><p>This demonstration shows how to use the Azure portal to create an Application Gateway with a Web Application Firewall (WAF). The WAF uses <a href="https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project" title="" target="_blank">OWASP</a> rules to protect your application. These rules include protection against attacks such as SQL injection, cross-site scripting attacks, and session hijacks.</p><p>Sign in to the Azure portal at <a href="https://portal.azure.com/" title="" target="_blank">https://portal.azure.com</a>.</p><h4 class="da-h4">Create an application gateway</h4><p>For Azure to communicate between resources, it needs a virtual network. You can either create a new virtual network or use an existing one. In this example, you create a new virtual network. You can create a virtual network at the same time that you create the application gateway. Application Gateway instances are created in separate subnets. You create two subnets in this example: one for the application gateway, and another for the backend servers.</p><p>Select <b>Create a resource</b> on the left menu of the Azure portal. The <b>New</b> window appears.</p><p>Select <b>Networking</b> and then select <b>Application Gateway</b> in the <b>Featured</b> list.</p><h4 class="da-h4">Basics tab</h4><ol class="number"><li><p>On the <b>Basics</b> tab, enter these values for the following application gateway settings:</p></li></ol><ul class="square"><li class="square"><p><b>Resource group</b>: Select <b>myResourceGroupAG</b> for the resource group. If it doesn't exist, select <b>Create new</b> to create it.</p></li><li class="square"><p><b>Application gateway name</b>: Enter <i>myAppGateway</i> for the name of the application gateway.</p></li><li class="square"><p><b>Tier</b>: select <b>WAF V2</b>.</p></li></ul><p><span><img alt="" src="../Images/1192310-490448.png" width="" height="" /></span></p><ol class="number"><li value="2"><p>For Azure to communicate between the resources that you create, it needs a virtual network. You can either create a new virtual network or use an existing one. In this demonstration, you'll create a new virtual network at the same time that you create the application gateway. Application Gateway instances are created in separate subnets. You create two subnets in this example: one for the application gateway, and another for the backend servers.</p></li></ol><p>Under <b>Configure virtual network</b>, create a new virtual network by selecting <b>Create new</b>. In the Create virtual network window that opens, enter the following values to create the virtual network and two subnets:</p><ul class="square"><li class="square"><p><b>Name</b>: Enter <i>myVNet</i> for the name of the virtual network.</p></li><li class="square"><p><b>Subnet name (Application Gateway subnet)</b>: The <b>Subnets</b> grid will show a subnet named Default. Change the name of this subnet to <i>myAGSubnet</i>.<br />
‎The application gateway subnet can contain only application gateways. No other resources are allowed.</p></li><li class="square"><p><b>Subnet name (backend server subnet)</b>: In the second row of the <b>Subnets</b> grid, enter <i>myBackendSubnet</i> in the <b>Subnet name</b> column.</p></li><li class="square"><p><b>Address range (backend server subnet)</b>: In the second row of the <b>Subnets Grid</b>, enter an address range that doesn't overlap with the address range of <i>myAGSubnet</i>. For example, if the address range of <i>myAGSubnet</i> is 10.0.0.0/24, enter <i>10.0.1.0/24</i> for the address range of <i>myBackendSubnet</i>.</p></li></ul><p>Select <b>OK</b> to close the Create virtual network window and save the virtual network settings.</p><p><span><img alt="" src="../Images/1192311-490449.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>On the <b>Basics</b> tab, accept the default values for the other settings and then select <b>Next: Frontends</b>.</p></li></ol><h4 class="da-h4">Frontends tab</h4><ol class="number"><li><p>On the <b>Frontends</b> tab, verify <b>Frontend IP address type</b> is set to <b>Public</b>.<br />
‎You can configure the Frontend IP to be Public or Private as per your use case. In this demonstration, you'll choose a Public Frontend IP.</p></li><li><p>Choose <b>Create new</b> for the <b>Public IP address</b> and enter <i>myAGPublicIPAddress</i> for the public IP address name, and then select <b>OK</b>.</p></li></ol><p><span><img alt="" src="../Images/1192312-490450.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>Select <b>Next: Backends</b>.</p></li></ol><h4 class="da-h4">Backends tab</h4><p>The backend pool is used to route requests to the backend servers that serve the request. Backend pools can be composed of NICs, virtual machine scale sets, public IPs, internal IPs, fully qualified domain names (FQDN), and multi-tenant back-ends like Azure App Service. In this demonstration, you'll create an empty backend pool with your application gateway and then add backend targets to the backend pool.</p><ol class="number"><li><p>On the <b>Backends</b> tab, select <b>+Add a backend pool</b>.</p></li><li><p>In the <b>Add a backend pool</b> window that opens, enter the following values to create an empty backend pool:</p></li></ol><ul class="square"><li class="square"><p><b>Name</b>: Enter <i>myBackendPool</i> for the name of the backend pool.</p></li><li class="square"><p><b>Add backend pool without targets</b>: Select <b>Yes</b> to create a backend pool with no targets. You'll add backend targets after creating the application gateway.</p></li></ul><ol class="number"><li value="3"><p>In the <b>Add a backend pool</b> window, select <b>Add</b> to save the backend pool configuration and return to the <b>Backends</b> tab.</p></li></ol><p><span><img alt="" src="../Images/1192313-490451.png" width="" height="" /></span></p><ol class="number"><li value="4"><p>On the <b>Backends</b> tab, select <b>Next: Configuration</b>.</p></li></ol><h4 class="da-h4">Configuration tab</h4><p>On the <b>Configuration</b> tab, you'll connect the frontend and backend pool you created using a routing rule.</p><ol class="number"><li><p>Select <b>Add a rule</b> in the <b>Routing rules</b> column.</p></li><li><p>In the <b>Add a routing rule window</b> that opens, enter <i>myRoutingRule</i> for the <b>Rule name</b>.</p></li><li><p>A routing rule requires a listener. On the <b>Listener</b> tab within the <b>Add a routing rule</b> window, enter the following values for the listener:</p></li></ol><ul class="square"><li class="square"><p><b>Listener name</b>: Enter <i>myListener</i> for the name of the listener.</p></li><li class="square"><p><b>Frontend IP</b>: Select <b>Public</b> to choose the public IP you created for the frontend.</p></li></ul><p>Accept the default values for the other settings on the <b>Listener</b> tab, then select the <b>Backend targets</b> tab to configure the rest of the routing rule.</p><p><span><img alt="" src="../Images/1192314-490452.png" width="" height="" /></span></p><ol class="number"><li value="4"><p>On the <b>Backend targets</b> tab, select <b>myBackendPool</b> for the <b>Backend target</b>.</p></li><li><p>For the <b>HTTP setting</b>, select <b>Create new</b> to create a new HTTP setting. The HTTP setting will determine the behavior of the routing rule. In the <b>Add an HTTP setting</b> window that opens, enter <i>myHTTPSetting</i> for the <b>HTTP setting name</b>. Accept the default values for the other settings in the <b>Add an HTTP setting</b> window, then select <b>Add</b> to return to the <b>Add a routing rule</b> window.</p></li></ol><p><span><img alt="" src="../Images/1192315-490453.png" width="" height="" /></span></p><ol class="number"><li value="6"><p>On the <b>Add a routing rule</b> window, select <b>Add</b> to save the routing rule and return to the <b>Configuration</b> tab.</p></li></ol><p><span><img alt="" src="../Images/1192316-490454.png" width="" height="" /></span></p><ol class="number"><li value="7"><p>Select <b>Next: Tags</b> and then <b>Next: Review +</b> create.</p></li></ol><h4 class="da-h4">Review + create tab</h4><p>Review the settings on the <b>Review + create</b> tab, and then select <b>Create</b> to create the virtual network, the public IP address, and the application gateway. It may take several minutes for Azure to create the application gateway.</p><h3 class="da-h3" id="1191925">Build an Image using Azure Container Registry</h3><p>Azure Container Registry provides storage for Docker images in the cloud.</p><p>In this topic, you'll use the Azure portal to create a new registry in Azure Container Registry. You'll build a Docker image from the source code for a web app and upload it to a repository in your registry.</p><h4 class="da-h4">Create a registry in Azure Container Registry</h4><ol class="number"><li><p>Sign in to the <a href="https://portal.azure.com/learn.docs.microsoft.com" title="" target="_blank">Azure portal </a> with your Azure subscription.</p></li><li><p>Choose <b>Create a resource</b>, select <b>Containers</b>, and then select <b>Container Registry</b>.</p></li></ol><p><span><img alt="" src="../Images/1192360-490498.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>Specify the values in the following table for each of the properties:</p></li></ol><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Property</p></td><td><p>Value</p></td></tr></thead><tbody><tr><td><p>Registry name</p></td><td><p>Enter a unique name and make a note of it for later.</p></td></tr><tr><td><p>Subscription</p></td><td><p>Select your default Azure subscription in which you are allowed to create and manage resources.</p></td></tr><tr><td><p>Resource Group</p></td><td><p>Create a new resource group with the name <b>learn-deploy-container-acr-rg</b> so that it will be easier to clean up these resources when you're finished with the module. If you choose a different resource group name, remember it for the rest of the exercises in this module.</p></td></tr><tr><td><p>Location</p></td><td><p>Select a location that is close to you.</p></td></tr><tr><td><p>Admin user</p></td><td><p><b>Enable</b></p></td></tr><tr><td><p>SKU</p></td><td><p><b>Standard</b></p></td></tr></tbody></table><ol class="number"><li value="4"><p>Click <b>Create</b>. Wait until the container registry has been created before you continue.</p></li></ol><p>Build a Docker image and upload it to Azure Container Registry</p><ol class="number"><li><p>In the Azure Cloud Shell in the portal, run the following command to download the source code for the sample web app. This web app is simple. It presents a single page that contains static text and a carousel control that rotates through a series of images.</p></li></ol><div class="code language-Bash"><p class="da-divtext"><code><span class="token function">git</span> clone https://github.com/MicrosoftDocs/mslearn-deploy-run-container-app-service.git</code></p></div><ol class="number"><li value="2"><p>Move to the source folder:</p></li></ol><div class="code language-Bash"><p class="da-divtext"><code><span class="token builtin class-name">cd</span> mslearn-deploy-run-container-app-service/dotnet</code></p></div><ol class="number"><li value="3"><p>Run the following command. This command sends the folder's contents to Azure Container Registry, which uses the instructions in the Docker file to build the image and store it. Replace <span class="code">&lt;container_registry_name&gt;</span> with the name of the registry you created earlier. Take care not to leave out the . character at the end of the command.</p></li></ol><div class="code language-Bash"><p class="da-divtext"><code>az acr build --registry <span class="token operator">&lt;</span>container_registry_name<span class="token operator">&gt;</span> --image webimage <span class="token builtin class-name">.</span></code></p></div><p>The Docker file contains the step-by-step instructions for building a Docker image from the source code for the web app. Azure Container Registry runs these steps to build the image, and as each step completes a message is generated. The build process should finish after a couple of minutes without any errors or warnings.</p><h4 class="da-h4">Examine the container registry</h4><p>1.In the <a href="https://portal.azure.com/learn.docs.microsoft.com" title="" target="_blank">Azure portal </a>, navigate to the Overview page for your container registry.</p><p>2.Under <b>Services</b>, select <b>Repositories</b>. You'll see a repository named <span class="code">webimage</span>.</p><p>3.Select the <span class="code">webimage</span> repository. It contains an image with the <span class="code">latest tag</span>. This is the Docker image for the sample web app.</p><p><span><img alt="" src="../Images/1192361-490499.png" width="" height="" /></span></p><p>The Docker image that contains your web app is now available in your registry for deployment to App Service.</p><h3 class="da-h3" id="1191926">Deploy a Web App from a Docker Image</h3><p>Azure App Service provides the hosting environment for an Azure-based web app. You can configure App Service to retrieve the image for the web app from a repository in Azure Container Registry.</p><p>In this topic, you'll see how to create a new web app by using the Docker image stored in Azure Container Registry. You'll use App Service with a predefined App Service plan to host the web app.</p><p>Create a web app</p><ol class="number"><li><p>Sign in to the <a href="https://portal.azure.com/learn.docs.microsoft.com" title="" target="_blank">Azure portal </a>.</p></li><li><p>Select <b>Create a resource &gt; Web &gt; Web App</b>.</p></li></ol><p><span><img alt="" src="../Images/1192134-490272.png" width="" height="" /></span></p><p>3.Specify these settings for each of the properties:</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Property</p></td><td><p>Value</p></td></tr></thead><tbody><tr><td><p>Subscription</p></td><td><p>Select your default Azure subscription   in which you are allowed to create and manage resources.</p></td></tr><tr><td><p>Resource Group</p></td><td><p>Reuse the existing resource   group learn-deploy-container-acr-rg.</p></td></tr><tr><td><p>Name</p></td><td><p>Enter a unique name and make a   note of it for later.</p></td></tr><tr><td><p>Publish</p></td><td><p><b>Docker Image</b></p></td></tr><tr><td><p>OS</p></td><td><p><b>Linux</b></p></td></tr><tr><td><p>App Service plan</p></td><td><p>Use the default.</p></td></tr></tbody></table><ol class="number"><li value="4"><p>Click <b>Next: Docker &gt;</b>.</p></li><li><p>In the <b>Docker</b> tab, specify these settings for each of the properties:</p></li></ol><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Property</p></td><td><p>Value</p></td></tr></thead><tbody><tr><td><p>Options</p></td><td><p><b>Single Container</b></p></td></tr><tr><td><p>Image Source</p></td><td><p><b>Azure Container Registry</b></p></td></tr><tr><td><p>Registry</p></td><td><p>Select your registry.</p></td></tr><tr><td><p>Image</p></td><td><div class="code"><p class="da-divtext">webimage</p></div></td></tr><tr><td><p>Tag</p></td><td><p>latest</p></td></tr><tr><td><p>Startup Command</p></td><td><p>Leave this empty.</p></td></tr></tbody></table><ol class="number"><li value="6"><p>Select <b>Review and create</b>, and then click <b>Create</b>. Wait until the web app has been deployed before you continue.</p></li></ol><h4 class="da-h4">Test the web app</h4><ol class="number"><li><p>Use the <b>All resources</b> view in the Azure portal to go to the <b>Overview</b> page of the web app you just created.</p></li><li><p>Select the <b>Browse</b> button to open the site in a new browser tab.</p></li><li><p>After the cold-start delay while your app's Docker image loads and starts, you'll see a page like this:</p></li></ol><p><span><img alt="" src="../Images/1192135-490273.png" width="" height="" /></span></p><p>App Service is now hosting the app from your Docker image.</p><h3 class="da-h3" id="1191928">Azure App Service Plans</h3><p>In App Service, an app runs in an App Service plan. An App Service plan defines a set of compute resources for a web app to run. These compute resources are analogous to the server farm in conventional web hosting. One or more apps can be configured to run on the same computing resources (or in the same App Service plan).</p><p>When you create an App Service plan in a certain region (for example, West Europe), a set of compute resources is created for that plan in that region. Whatever apps you put into this App Service plan run on these compute resources as defined by your App Service plan. Each App Service plan defines:</p><ul class="square"><li class="square"><p><b>Region</b> (West US, East US, etc.)</p></li><li class="square"><p><b>Number of VM instances</b></p></li><li class="square"><p><b>Size of VM instances</b> (Small, Medium, Large)</p></li></ul><h4 class="da-h4">How the app runs and scales</h4><p>In the Free and Shared tiers, an app receives CPU minutes on a shared VM instance and cannot scale out. In other tiers, an app runs and scales as follows.</p><p>When you create an app in App Service, it is put into an App Service plan. When the app runs, it runs on all the VM instances configured in the App Service plan. If multiple apps are in the same App Service plan, they all share the same VM instances. If you have multiple deployment slots for an app, all deployment slots also run on the same VM instances. If you enable diagnostic logs, perform backups, or run WebJobs, they also use CPU cycles and memory on these VM instances.</p><h4 class="da-h4">Considerations</h4><p>Since you pay for the computing resources your App Service plan allocates, you can potentially save money by putting multiple apps into one App Service plan. You can continue to add apps to an existing plan as long as the plan has enough resources to handle the load. However, keep in mind that apps in the same App Service plan all share the same compute resources. To determine whether the new app has the necessary resources, you need to understand the capacity of the existing App Service plan, and the expected load for the new app. Overloading an App Service plan can potentially cause downtime for your new and existing apps. Isolate your app into a new App Service plan when:</p><ul class="square"><li class="square"><p>The app is resource-intensive.</p></li><li class="square"><p>You want to scale the app independently from the other apps in the existing plan.</p></li><li class="square"><p>The app needs resource in a different geographical region.</p></li></ul><h3 class="da-h3" id="1191716">Azure Traffic Manager</h3><p>Microsoft Azure Traffic Manager allows you to control the distribution of user traffic to your service endpoints running in different datacenters around the world.</p><p><span><img alt="" src="../Images/1192359-490497.png" width="" height="" /></span></p><ul class="square"><li class="square"><p>Traffic Manager works by using the Domain Name System (DNS) to direct end-user requests to the most appropriate endpoint. Service endpoints supported by Traffic Manager include Azure VMs, Web Apps, and cloud services. You can also use Traffic Manager with external, non-Azure endpoints.</p></li><li class="square"><p>Traffic Manager selects an endpoint based on the configured traffic-routing method. Traffic Manager supports a range of traffic-routing methods to suit different application needs. Once the endpoint is selected the clients then connect directly to the appropriate service endpoint.</p></li><li class="square"><p>Traffic Manager provides endpoint health checks and automatic endpoint failover, enabling you to build high-availability applications that are resilient to failure, including the failure of an entire Azure region.</p></li></ul><h3 class="da-h3" id="1191935">Regional VNet Integration</h3><p>Using regional VNet Integration enables your app to access:</p><ul class="square"><li class="square"><p>Resources in a VNet in the same region as your app.</p></li><li class="square"><p>Resources in VNets peered to the VNet your app is integrated with.</p></li><li class="square"><p>Service endpoint secured services.</p></li><li class="square"><p>Resources across Azure ExpressRoute connections.</p></li><li class="square"><p>Resources in the VNet you're integrated with.</p></li><li class="square"><p>Resources across peered connections, which includes Azure ExpressRoute connections.</p></li><li class="square"><p>Private endpoints</p></li></ul><p>When you use VNet Integration with VNets in the same region, you can use the following Azure networking features:</p><ul class="square"><li class="square"><p>Network security groups (NSGs): You can block outbound traffic with an NSG that's placed on your integration subnet. The inbound rules don't apply because you can't use VNet Integration to provide inbound access to your app.</p></li><li class="square"><p>Route tables (UDRs): You can place a route table on the integration subnet to send outbound traffic where you want.</p></li></ul><p>By default, your app routes only RFC1918 traffic into your VNet. If you want to route all of your outbound traffic into your VNet, apply the app setting WEBSITE_VNET_ROUTE_ALL to your app. To configure the app setting:</p><ol class="number"><li><p>Go to the Configuration UI in your app portal. Select <b>New application</b> setting.</p></li><li><p>Enter WEBSITE_VNET_ROUTE_ALL in the <b>Name</b> box, and enter <b>1</b> in the <b>Value</b> box.</p></li></ol><p><span><img alt="" src="../Images/1192247-490385.png" width="" height="" /></span></p><ol class="number"><li value="3"><p>Select <b>OK</b>.</p></li><li><p>Select <b>Save</b>.</p></li></ol><h3 class="da-h3" id="1191897">Azure to Azure Site Recovery - Network Traffic</h3><p>ASR traffic is only <b>outbound</b> from protected VMs. If you are using a URL-based firewall proxy to control outbound connectivity, allow these Site Recovery URLs:</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>URL</p></td><td><p>Purpose</p></td></tr></thead><tbody><tr><td><p>*<b>.blob.core.windows.net</b></p></td><td><p>For storage account writes</p></td></tr><tr><td><p><b>login.microsoftonline.com</b></p></td><td><p>Authorization and authentication to the ASR URLs</p></td></tr><tr><td><p>*<b>.hypervrecoverymanager.windowsazure.com</b></p></td><td><p>ASR service communication channel</p></td></tr><tr><td><p>*<b>.servicebus.wifondows.net</b></p></td><td><p>monitoring and diagnostics</p></td></tr></tbody></table><p>See <a href="https://docs.microsoft.com/en-us/azure/site-recovery/azure-to-azure-about-networking#sample-nsg-configuration" title="" target="_blank">this link</a> for a list of all Site Recovery Service and monitoring IP addresses for each Azure location.</p><p>The following example shows the Site Recovery service and Site Recovery monitoring IP addresses for the Central US region:</p><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p>Location</p></td><td><p>Site Recovery Service IP address</p></td><td><p>Site Recovery Monitoring IP address</p></td></tr></thead><tbody><tr><td><p><b>Central US</b></p></td><td><p>40.69.144.231</p></td><td><p>52.165.34.144</p></td></tr></tbody></table><h3 class="da-h3" id="1191884">Replication - Selecting the VMs to Replicate</h3><p>When configuring the Virtual machines settings, you select the machines you want to replicate. If you've already run an assessment for the VMs, you can apply VM sizing and disk type (premium/standard) recommendations from the assessment results. To do this, in <b>Import migration settings from an Azure Migrate assessment?</b>, select the <b>Yes</b> option. If you didn't run an assessment, or you don't want to use the assessment settings, select the <b>No</b> option. Alternatively, if you selected to use the assessment, select the VM group, and assessment name.</p><p>✔️ This topic continues on from the previous topic.</p><p><span><img alt="" src="../Images/1192073-490211.png" width="" height="" /></span></p><p>In <b>Virtual machines</b>, search for VMs as needed, and check each VM you want to migrate. Then click <b>Next: Target settings</b>.</p><p><span><img alt="" src="../Images/1192074-490212.png" width="" height="" /></span></p><h3 class="da-h3" id="1191722">Demonstration - Deploy Azure Firewall</h3><p>One way to control outbound network access from an Azure subnet is with Azure Firewall. With Azure Firewall, you can configure:</p><ul class="square"><li class="square"><p>Application rules that define fully qualified domain names (FQDNs) that can be accessed from a subnet.</p></li><li class="square"><p>Network rules that define source address, protocol, destination port, and destination address.</p></li></ul><p>For this demonstration, you create a simplified single VNet with three subnets for easy deployment. For production deployments, a hub and spoke model is recommended. The firewall is in its own VNet. The workload servers are in peered VNets in the same region with one or more subnets.</p><ul class="square"><li class="square"><p><b>AzureFirewallSubnet</b> - the firewall is in this subnet.</p></li><li class="square"><p><b>Workload-SN</b> - the workload server is in this subnet. This subnet's network traffic goes through the firewall.</p></li><li class="square"><p><b>Jump-SN</b> - The “jump” server is in this subnet. The jump server has a public IP address that you can connect to using Remote Desktop. From there, you can then connect to (using another Remote Desktop) the workload server.</p></li></ul><p><span><img alt="" src="../Images/1192056-490194.png" width="" height="" /></span></p><p>In this demonstration, you learn how to:</p><ul class="square"><li class="square"><p>Set up a test network environment</p></li><li class="square"><p>Deploy a firewall</p></li></ul><h4 class="da-h4">Set up the network</h4><p>First, create a resource group to contain the resources needed to deploy the firewall.</p><p><b>Create a resource group</b></p><p>The resource group contains all the resources for the demonstration.</p><ol class="number"><li><p>Sign in to the Azure portal at <a href="https://portal.azure.com/" title="" target="_blank">https://portal.azure.com</a>.</p></li><li><p>On the Azure portal menu, select <b>Resource groups</b> or search for and select Resource groups from any page. Then select <b>Add</b>.</p></li><li><p>For <b>Resource group name</b>, enter <i>Test-FW-RG</i>.</p></li><li><p>For Subscription, select your subscription.</p></li><li><p>For <b>Resource group location</b>, select a location. All other resources that you create must be in the same location.</p></li><li><p>Select <b>Create</b>.</p></li></ol><p><b>Create a VNet</b></p><p>This VNet will contain three subnets.</p><ol class="number"><li><p>On the Azure portal menu or from the <b>Home</b> page, select <b>Create a resource</b>.</p></li><li><p>Select <b>Networking &gt; Virtual network</b>.</p></li><li><p>For Name, type <i>Test-FW-VN</i>.</p></li><li><p>For <b>Address space</b>, type <b>10.0.0.0/16</b>.</p></li><li><p>For <b>Subscription</b>, select your subscription.</p></li><li><p>For <b>Resource group</b>, select <b>Test-FW-RG</b>.</p></li><li><p>For <b>Location</b>, select the same location that you used previously.</p></li><li><p>Under <b>Subnet</b>, for <b>Name</b> type <i>AzureFirewallSubnet</i>. The firewall will be in this subnet, and the subnet name must be AzureFirewallSubnet.</p></li><li><p>For <b>Address range</b>, type <i>10.0.1.0/26</i>.</p></li><li><p>Accept the other default settings, and then select <b>Create</b>.</p></li></ol><p><b>Create additional subnets</b></p><p>Next, create subnets for the jump server, and a subnet for the workload servers.</p><ol class="number"><li><p>On the Azure portal menu, select <b>Resource groups</b> or search for and select Resource groups from any page. Then select <b>Test-FW-RG</b>.</p></li><li><p>Select the <b>Test-FW-VN</b> virtual network.</p></li><li><p>Select <b>Subnets</b> &gt; <b>+Subnet</b>.</p></li><li><p>For <b>Name</b>, type <i>Workload-SN</i>.</p></li><li><p>For <b>Address range</b>, type <i>10.0.2.0/2</i>4.</p></li><li><p>Select <b>OK</b>.</p></li></ol><p>Create another subnet named Jump-SN, address range <i>10.0.3.0/24</i>.</p><p><b>Create virtual machines</b></p><p>Now create the jump and workload virtual machines and place them in the appropriate subnets.</p><ol class="number"><li><p>On the Azure portal menu or from the <b>Home</b> page, select <b>Create a resource</b>.</p></li><li><p>Select <b>Compute</b> and then select <b>Windows Server 2016 Datacenter</b> in the Featured list.</p></li><li><p>Enter these values for the virtual machine:</p></li></ol><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Setting</p></td><td><p>Value</p></td></tr></thead><tbody><tr><td><p>Resource group</p></td><td><p><b>Test-FW-RG</b></p></td></tr><tr><td><p>Virtual machine name</p></td><td><p><b>Srv-Jump</b></p></td></tr><tr><td><p>Region</p></td><td><p>Same as previous</p></td></tr><tr><td><p>Administrator user name</p></td><td><p><b>azureuser</b></p></td></tr><tr><td><p>Password</p></td><td><p><b>Azure123456</b>!</p></td></tr></tbody></table><ol class="number"><li value="4"><p>Under <b>Inbound port rules</b>, for <b>Public inbound ports</b>, select <b>Allow selected ports</b>.</p></li><li><p>For <b>Select inbound ports</b>, select <b>RDP (3389)</b>.</p></li><li><p>Accept the other defaults and select <b>Next: Disks</b>.</p></li><li><p>Accept the disk defaults and select <b>Next: Networking</b>.</p></li><li><p>Make sure that <b>Test-FW-VN</b> is selected for the virtual network and the subnet is <b>Jump-SN</b>.</p></li><li><p>For <b>Public IP</b>, accept the default new public ip address name (Srv-Jump-ip).</p></li><li><p>Accept the other defaults and select <b>Next: Management</b>.</p></li><li><p>Select <b>Off</b> to disable boot diagnostics. Accept the other defaults and select <b>Review + create</b>.</p></li><li><p>Review the settings on the summary page, and then select <b>Create</b>.</p></li></ol><p>Use the information in the following table to configure another virtual machine named <b>Srv-Work</b>. The rest of the configuration is the same as the Srv-Jump virtual machine.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Setting</p></td><td><p>Value</p></td></tr></thead><tbody><tr><td><p>Subnet</p></td><td><p><b>Workload-SN</b></p></td></tr><tr><td><p>Public IP</p></td><td><p><b>None</b></p></td></tr><tr><td><p>Public inbound ports</p></td><td><p><b>None</b></p></td></tr></tbody></table><h4 class="da-h4">Deploy the firewall</h4><p>Deploy the firewall into the VNet.</p><ol class="number"><li><p>On the Azure portal menu or from the <b>Home</b> page, select <b>Create a resource</b>.</p></li><li><p>Type <i>firewall</i> in the search box and press <b>Enter</b>.</p></li><li><p>Select <b>Firewall</b> and then select <b>Create</b>.</p></li><li><p>On the <b>Create a Firewall page</b>, use the following table to configure the firewall:</p></li></ol><table style="width:100%" class=""><col width="33.33333333333333%" /><col width="33.33333333333333%" /><col width="33.33333333333333%" /><thead><tr><td><p>Setting</p></td><td><p>Value</p></td><td><p /></td></tr></thead><tbody><tr><td><p>Subscription</p></td><td><p>your subscription</p></td><td><p /></td></tr><tr><td><p>Resource group</p></td><td><p><b>Test-FW-RG</b></p></td><td><p /></td></tr><tr><td><p>Name</p></td><td><p><b>Test-FW01</b></p></td><td><p /></td></tr><tr><td><p>Location</p></td><td><p>Select the same location that you used previously</p></td><td><p /></td></tr><tr><td><p>Choose a virtual network</p></td><td><p><b>Use existing: Test-FW-VN</b></p></td><td><p /></td></tr><tr><td><p>Public IP address</p></td><td><p><b>Add new</b>. The Public IP address must be the Standard SKU type.</p></td><td><p /></td></tr></tbody></table><ol class="number"><li value="5"><p>Select <b>Review + create.</b></p></li><li><p>Review the summary, and then select <b>Create</b> to create the firewall.</p></li></ol><p>This will take a few minutes to deploy.</p><ol class="number"><li value="7"><p>After deployment completes, go to the <b>Test-FW-RG</b> resource group, and select the <b>Test-FW01 firewall</b>.</p></li></ol><h3 class="da-h3" id="1191724">Network Security Groups (NSGs)</h3><p>Network security groups filter network traffic to and from Azure resources. Network security groups contain security rules that you configure to allow or deny inbound and outbound traffic. You can use network security groups to filter traffic between virtual machines or subnets, both within a virtual network and from the internet.</p><h4 class="da-h4">Network security group assignment and evaluation</h4><p>Network security groups are assigned to a network interface or a subnet. When you assign a network security group to a subnet, the rules apply to all network interfaces in that subnet. You can restrict traffic further by associating a network security group to the network interface of a virtual machine.</p><p>When you apply network security groups to both a subnet and a network interface, each network security group is evaluated independently. Inbound traffic is first evaluated by the network security group applied to the subnet, and then by the network security group applied to the network interface. Conversely, outbound traffic from a virtual machine is first evaluated by the network security group applied to the network interface, and then by the network security group applied to the subnet.</p><p><span><img alt="" src="../Images/1192425-490563.png" width="" height="" /></span></p><p>Applying a network security group to a subnet instead of individual network interfaces can reduce administration and management efforts. This approach also ensures that all virtual machines within the specified subnet are secured with the same set of rules.</p><p>Each subnet and network interface can have one network security group applied to it. Network security groups support TCP, UDP, and ICMP, and operate at Layer 4 of the OSI model.</p><h3 class="da-h3" id="1191761">Assign RBAC roles for Access</h3><p>Azure Active Directory (Azure AD) authorizes access rights to secured resources through role-based access control (RBAC). Azure Storage defines a set of built-in RBAC roles that encompass common sets of permissions used to access blob and queue data. You can also define custom roles for access to blob and queue data.</p><p>When an RBAC role is assigned to an Azure AD security principal, Azure grants access to those resources for that security principal. Access can be scoped to the level of the subscription, the resource group, the storage account, or an individual container or queue. An Azure AD security principal may be a user, a group, an application service principal, or a managed identity for Azure resources.</p><p><b>Built-in RBAC roles for blobs and queues</b></p><p>Azure provides the following built-in RBAC roles for authorizing access to blob and queue data using Azure AD and OAuth:</p><ul class="square"><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles" title="" target="_blank">Storage Blob Data Owner</a>: Use to set ownership and manage POSIX access control for Azure Data Lake Storage Gen2. For more information, see <a href="https://docs.microsoft.com/en-us/azure/storage/blobs/data-lake-storage-access-control" title="" target="_blank">Access control in Azure Data Lake Storage Gen2</a>.</p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles" title="" target="_blank">Storage Blob Data Contributor</a>: Use to grant read/write/delete permissions to Blob storage resources.</p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles" title="" target="_blank">Storage Blob Data Reader</a>: Use to grant read-only permissions to Blob storage resources.</p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles" title="" target="_blank">Storage Queue Data Contributor</a>: Use to grant read/write/delete permissions to Azure queues.</p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles" title="" target="_blank">Storage Queue Data Reader</a>: Use to grant read-only permissions to Azure queues.</p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles" title="" target="_blank">Storage Queue Data Message Processor</a>: Use to grant peek, retrieve, and delete permissions to messages in Azure Storage queues.</p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/role-based-access-control/built-in-roles" title="" target="_blank">Storage Queue Data Message Sender</a>: Use to grant add permissions to messages in Azure Storage queues.</p></li></ul><h3 class="da-h3" id="1191939">Create a Deployment Slot</h3><p>Before you create a slot, make sure your web app is running in the Standard, Premium, or Isolated tier:</p><ol class="number"><li><p>Open your web app in the Azure portal.</p></li><li><p>Select the <b>Deployment Slots</b> page.</p></li><li><p>Select <b>Add Slot</b>.</p></li><li><p>Name the slot.</p></li><li><p>Choose whether to clone settings from another slot. If you choose to clone, settings are copied to your new slot from the slot you specify.</p></li></ol><p><span><img alt="" src="../Images/1192427-490565.png" width="" height="" /></span></p><p>Select <b>Add</b> to create the new slot. You now see the new slot in the list on the <b>Deployment Slots</b> page. Select the slot to view its management page.</p><p><span><img alt="" src="../Images/1192428-490566.png" width="" height="" /></span></p><h3 class="da-h3" id="1191762">Resource Scope</h3><p>Before you assign an RBAC role to a security principal, determine the scope of access that the security principal should have. Best practices dictate that it's always best to grant only the narrowest possible scope.</p><p>The following list describes the levels at which you can scope access to Azure blob and queue resources, starting with the narrowest scope:</p><ul class="square"><li class="square"><p><b>An individual container</b> At this scope, a role assignment applies to all of the blobs in the container, as well as container properties and metadata.</p></li><li class="square"><p><b>An individual queue</b> At this scope, a role assignment applies to messages in the queue, as well as queue properties and metadata.</p></li><li class="square"><p><b>The storage account</b> At this scope, a role assignment applies to all containers and their blobs, or to all queues and their messages.</p></li><li class="square"><p><b>The resource group</b> At this scope, a role assignment applies to all of the containers or queues in all of the storage accounts in the resource group.</p></li><li class="square"><p><b>The subscription</b> At this scope, a role assignment applies to all of the containers or queues in all of the storage accounts in all of the resource groups in the subscription.</p></li></ul><h3 class="da-h3" id="1191909">Module 12 Review Questions</h3><p><span><img alt="" src="../Images/1192029-490167.png" width="" height="" /></span></p><h4 class="problem">Review Question 1</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-747eb3fe-075f-ac37-3d50-9c26d321d702"><div class="card quizlib-question"><div class="quizlib-question-title"><p>Your organization needs a way to create application aware snapshots, and backup Linux virtual machines and VMware virtual machines. You have files, folders, volumes,and workloads to protect. You recommend which of the following solutions? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q747eb3fe-075f-ac37-3d50-9c26d321d702" value="1" />Azure Backup (MARS) agent<br /></label></li><li><label><input type="radio" name="q747eb3fe-075f-ac37-3d50-9c26d321d702" value="2" />Azure Backup Server<br /></label></li><li><label><input type="radio" name="q747eb3fe-075f-ac37-3d50-9c26d321d702" value="3" />Enable disk snapshots<br /></label></li><li><label><input type="radio" name="q747eb3fe-075f-ac37-3d50-9c26d321d702" value="4" />Enable backup for individual Azure VMs<br /></label></li></ul></div></div><div id="feedback-problem-747eb3fe-075f-ac37-3d50-9c26d321d702" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Azure backup server provides app aware snapshots, support for Linux virtual machines and VMware virtual machines. Backup server can protect files, folders, volumes, and workloads.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 2</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-b333e98d-55d9-2875-f901-62eb494e7751"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You plan to use Azure Backup to protect your virtual machines and data and are ready to create a backup. What is the first thing you need to do? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="qb333e98d-55d9-2875-f901-62eb494e7751" value="1" />Define recovery points.<br /></label></li><li><label><input type="radio" name="qb333e98d-55d9-2875-f901-62eb494e7751" value="2" />Create a Recovery Services vault.<br /></label></li><li><label><input type="radio" name="qb333e98d-55d9-2875-f901-62eb494e7751" value="3" />Create a Backup policy.<br /></label></li><li><label><input type="radio" name="qb333e98d-55d9-2875-f901-62eb494e7751" value="4" />Install the Azure VM Agent.<br /></label></li></ul></div></div><div id="feedback-problem-b333e98d-55d9-2875-f901-62eb494e7751" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">When performing a virtual machine backup, you must first create a Recovery Services vault in the region where you want to store the data. Recovery points are stored in the Recovery Services vault. While creating a backup policy is a good practice, it is not a dependency to creating a backup. The Azure VM agent is required on an Azure virtual machine for the Backup extension to work. However, if the VM was created from the Azure gallery, then the VM Agent is already present on the virtual machine.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 3</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-1a80e6c3-9136-e9ff-d5a1-32790ad955be"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You have several Azure VMs that are currently running production workloads. You have a mix of Windows Server and Linux servers and you need to implement a backup strategy for your production workloads.<br />
Which feature should you use in this case? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q1a80e6c3-9136-e9ff-d5a1-32790ad955be" value="1" />Managed snapshots.<br /></label></li><li><label><input type="radio" name="q1a80e6c3-9136-e9ff-d5a1-32790ad955be" value="2" />Azure Backup.<br /></label></li><li><label><input type="radio" name="q1a80e6c3-9136-e9ff-d5a1-32790ad955be" value="3" />Azure Site Recovery.<br /></label></li><li><label><input type="radio" name="q1a80e6c3-9136-e9ff-d5a1-32790ad955be" value="4" />Azure Migrate.<br /></label></li></ul></div></div><div id="feedback-problem-1a80e6c3-9136-e9ff-d5a1-32790ad955be" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">For backing up Azure virtual machines running production workloads, use Azure Backup. Azure Backup supports application-consistent backups for both Windows and Linux virtual machines. Azure Site Recovery coordinates virtual-machine and physical-server replication, failover, and failback, but Azure Backup will protect and restore data at a more granular level. Managed snapshots provide a read-only full copy of a managed disk, and is an ideal solution in development and test environments, but Azure Backup is the better option for your production workloads.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 4</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-d40ece47-a7c1-22d7-725e-01b8dda20459"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You deploy several virtual machines (VMs) to Azure. You are responsible for backing up all data processed by the VMs. In the event of a failure, you need to restore the data as quickly as possible. Which of these options would you recommend to restore a database used for development on a data disk? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="qd40ece47-a7c1-22d7-725e-01b8dda20459" value="1" />Virtual machine backup<br /></label></li><li><label><input type="radio" name="qd40ece47-a7c1-22d7-725e-01b8dda20459" value="2" />Azure Site Recovery<br /></label></li><li><label><input type="radio" name="qd40ece47-a7c1-22d7-725e-01b8dda20459" value="3" />Disk image backup<br /></label></li><li><label><input type="radio" name="qd40ece47-a7c1-22d7-725e-01b8dda20459" value="4" />Disk snapshot<br /></label></li></ul></div></div><div id="feedback-problem-d40ece47-a7c1-22d7-725e-01b8dda20459" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">You can use snapshots to quickly restore the database data disks.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h3 class="da-h3" id="1191813">Virtual Disk Images for Azure VMs</h3><p>An Azure virtual machine runs in the cloud, in an Azure datacenter. When you create a virtual machine, you specify a virtual machine image to use. This image contains the operating system and (optionally) other preconfigured software.</p><p>Azure uses this image to create a new virtual hard disk (VHD) from which it can start your virtual machine. You can then customize the virtual machine by configuring and installing additional applications, according to your requirements.</p><p>In this topic, you'll see how you can use VHDs to create standard customized disks for building virtual machines for your organization.</p><p><b>What is an Azure virtual hard disk?</b></p><p>A virtual machine can contain multiple VHDs. Typically, a virtual machine has an operating system VHD on which the operating system is installed. It also has one or more data VHDs that contain the applications and other user-specific data used by the virtual machine.</p><p>The difference between a VHD and a physical hard disk is that a VHD is stored as a virtual file in Azure. It isn't a piece of physical hardware.</p><p><b>What is a virtual machine image?</b></p><p>If you consider a VHD to be like a physical disk, a virtual machine image is a template from which you can create the VHDs to run a virtual machine. The VHDs for a typical virtual machine image contain a preconfigured version of an operating system.</p><p>Azure Marketplace supplies many virtual machine images that you can use as a starting point for your own systems. Examples include:</p><ul class="square"><li class="square"><p>Various versions of Windows Server, optionally with SQL Server installed.</p></li><li class="square"><p>Linux variants with software such as MySQL, MongoDB, Cassandra, or other databases already configured.</p></li></ul><p><b>What is a generalized image?</b></p><p>You can create your own custom virtual machine image in one of two ways:</p><ul class="square"><li class="square"><p>If you're building an image from scratch by using Hyper-V, you first create a blank virtual disk, and then create a virtual machine with this disk. When you start the virtual machine, you install the operating system and any other additional software from source disks (typically DVDs) and other packages.</p></li><li class="square"><p>If you're customizing an image from Azure Marketplace, you build a virtual machine by using an existing image. The image provides the operating system and base functionality. You add your own software, operating system updates, and other packages as required. Unit 3 describes this process in more detail.</p></li></ul><p>After you build and customize a virtual machine, you can save the new image as a set of VHDs.</p><p><b>What is a specialized virtual image?</b></p><p>A specialized virtual image is a copy of a live virtual machine after it has reached a specific state. For example, a specialized image might contain a copy of the configured operating system, software, user accounts, databases, connection information, and other data for your system.</p><p>You can use a specialized virtual image as a backup of your system at a particular point in time. If you need to recover after a catastrophic failure, or you need to roll back the virtual machine, you can restore your virtual machine from this image.</p><p>If you use a specialized image to create a new virtual machine, the new virtual machine will retain all of the data from the image. That data includes the host name, user accounts, and other settings.</p><h3 class="da-h3" id="1191752">Shared Access Signatures</h3><p>A shared access signature (SAS) is a URI that grants restricted access rights to Azure Storage resources (a specific blob in this case). You can provide a shared access signature to clients who should not be trusted with your storage account key but whom you wish to delegate access to certain storage account resources. By distributing a shared access signature URI to these clients, you grant them access to a resource for a specified period of time. SAS is a secure way to share your storage resources without compromising your account keys.</p><p><span><img alt="" src="../Images/1192412-490550.png" width="" height="" /></span></p><p>
 
A SAS gives you granular control over the type of access you grant to clients who have the SAS, including:
</p><ul class="square"><li class="square"><p>An account-level SAS can delegate access to multiple storage services. For example, blob, file, queue, and table.</p></li><li class="square"><p>An interval over which the SAS is valid, including the start time and the expiry time.</p></li><li class="square"><p>The permissions granted by the SAS. For example, a SAS for a blob might grant read and write permissions to that blob, but not delete permissions.</p></li></ul><p>Optionally, you can also:</p><ul class="square"><li class="square"><p>Specify an IP address or range of IP addresses from which Azure Storage will accept the SAS. For example, you might specify a range of IP addresses belonging to your organization.</p></li><li class="square"><p>The protocol over which Azure Storage will accept the SAS. You can use this optional parameter to restrict access to clients using HTTPS.</p></li></ul><p>✔️ There are two types of SAS: <b>account</b> and <b>service</b>. The account SAS delegates access to resources in one or more of the storage services. The service SAS delegates access to a resource in just one of the storage services.</p><p>✔️ A stored access policy can provide an additional level of control over service-level SAS on the server side. You can group shared access signatures and provide additional restrictions for signatures that are bound by the policy.</p><p>For more information:</p><p>What is a shared access signature? - <a href="https://docs.microsoft.com/en-us/azure/storage/common/storage-dotnet-shared-access-signature-part-1?toc=%2fazure%2fstorage%2fblobs%2ftoc.json" title="" target="_blank">https://docs.microsoft.com/en-us/azure/storage/common/storage-dotnet-shared-access-signature-part-1?toc=%2fazure%2fstorage%2fblobs%2ftoc.json#what-is-a-shared-access-signature</a></p><p>Define a stored access policy - <a href="https://docs.microsoft.com/en-us/rest/api/storageservices/define-stored-access-policy" title="" target="_blank">https://docs.microsoft.com/en-us/rest/api/storageservices/define-stored-access-policy</a></p><h3 class="da-h3" id="1191892">Azure IaaS Backup Components</h3><p><span><img alt="" src="../Images/1192142-490280.png" width="" height="" /></span></p><p>The Azure portal provides a wizard, which is built into the portal, to help guide through the process of choosing the component to download and deploy. The wizard, which is part of the Recovery Services vault creation, walks through the steps for selecting a backup goal, and choosing the data or application to protect.</p><p>Depending on the individual component, Azure Backup components have certain advantages or limitations, and differences in what is protected and where the backups are stored. Consider each component listed below in light of these criteria.</p><h4 class="da-h4">Azure Backup Server (can be deployed in Azure and on-premises)</h4><p><b>Benefits</b> - App aware snapshots (VSS)</p><ul class="square"><li class="square"><p>App aware snapshots (VSS)</p></li><li class="square"><p>Full flexibility for when to take backups</p></li><li class="square"><p>Recovery granularity (all)</p></li><li class="square"><p>Can use Recovery Services vault</p></li><li class="square"><p>Linux support on Hyper-V and VMware VMs</p></li><li class="square"><p>Backup and restore VMware VMs</p></li><li class="square"><p>Does not require a System Center license</p></li></ul><p><b>Limits</b></p><ul class="square"><li class="square"><p>Cannot back up Oracle workload</p></li><li class="square"><p>Always requires live Azure subscription</p></li><li class="square"><p>No support for tape backup</p></li></ul><p><b>What is protected?</b></p><ul class="square"><li class="square"><p>Files</p></li><li class="square"><p>Folders</p></li><li class="square"><p>Volumes</p></li><li class="square"><p>VMs</p></li><li class="square"><p>Applications</p></li><li class="square"><p>Workloads</p></li><li class="square"><p>System State</p></li></ul><p><b>Where are backups stored?</b></p><ul class="square"><li class="square"><p>Recovery Services vault</p></li><li class="square"><p>Locally attached disk</p></li></ul><h4 class="da-h4">Azure IaaS VM Backup</h4><p><b>Benefits</b></p><ul class="square"><li class="square"><p>Native backups for Windows/Linux</p></li><li class="square"><p>No specific agent installation required</p></li><li class="square"><p>Fabric-level backup with no backup infrastructure needed</p></li></ul><p><b>Limits</b></p><ul class="square"><li class="square"><p>Back up VMs once-a-day</p></li><li class="square"><p>Restore VMs only at disk level</p></li><li class="square"><p>Cannot back up on-premises</p></li></ul><p><b>What is protected?</b></p><ul class="square"><li class="square"><p>VMs</p></li><li class="square"><p>All disks (using PowerShell)</p></li></ul><p><b>Where are backups stored?</b></p><ul class="square"><li class="square"><p>Recovery Services vault</p></li></ul><h3 class="da-h3" id="1191686">Virtual Machines Scale Sets</h3><p>Azure virtual machine scale sets let you create and manage a group of load balanced VMs. The number of VM instances can automatically increase or decrease in response to demand or a defined schedule. Scale sets provide high availability to your applications, and allow you to centrally manage, configure, and update many VMs. We recommended that two or more VMs are created within a scale set to provide for a highly available application and to meet the 99.95% Azure SLA.</p><p>There is no cost for the scale set itself, you only pay for each VM instance that you create. When a single VM is using Azure premium SSDs, the Azure SLA applies for unplanned maintenance events. Virtual machines in a scale set can be deployed across multiple update domains and fault domains to maximize availability and resilience to outages due to data center outages, and planned or unplanned maintenance events.</p><h4 class="da-h4">Fault Domains and Update Domains</h4><p>Virtual machine scale sets simplify designing for high availability by aligning fault domains and update domains. You will only have to define fault domains count for the scale set. The number of fault domains available to the scale sets may vary by region.</p><h4 class="da-h4">Auto-Scaling (VMSS)</h4><p>Virtual machine scale sets are an Azure Compute resource you can use to deploy and manage a set of <b>identical</b> VMs. With all VMs configured the same, VM scale sets are designed to support true auto-scale – no pre-provisioning of VMs is required – and as such makes it easier to build large-scale services targeting big compute, big data, and containerized workloads. So, as demand goes up more virtual machine instances can be added, and as demand goes down virtual machines instances can be removed. The process can be manual or automated or a combination of both.</p><p><span><img alt="" src="../Images/1192230-490368.png" width="" height="" /></span></p><h4 class="da-h4">Scale Set Benefits</h4><ul class="square"><li class="square"><p>All VM instances are created from the same base OS image and configuration. This approach lets you easily manage hundreds of VMs without additional configuration tasks or network management.</p></li><li class="square"><p>Scale sets support the use of the Azure load balancer for basic layer-4 traffic distribution, and Azure Application Gateway for more advanced layer-7 traffic distribution and SSL termination.</p></li><li class="square"><p>Scale sets are used to run multiple instances of your application. If one of these VM instances has a problem, customers continue to access your application through one of the other VM instances with minimal interruption.</p></li><li class="square"><p>Customer demand for your application may change throughout the day or week. To match customer demand, scale sets can automatically increase the number of VM instances as application demand increases, then reduce the number of VM instances as demand decreases. This is known as autoscale.</p></li><li class="square"><p>Scale sets support up to 1,000 VM instances. If you create and upload your own custom VM images, the limit is 600 VM instances.</p></li></ul><h3 class="da-h3" id="1191698">Module 4 Review Questions</h3><p><span><img alt="" src="../Images/1192029-490167.png" width="" height="" /></span></p><h4 class="problem">Review Question 1</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-75715c4a-3c25-1559-ca77-d79609306650"><div class="card quizlib-question"><div class="quizlib-question-title"><p>A company you are advising is planning to use a line-of-business, third-party software package to perform complicated data analysis. The software will use 350 VMs that are based on an Azure Marketplace VM image.<br />
You are asked to design the infrastructure for the software application server. The solution should meet the following needs:<br /></p><ul class="square"><li class="square"><p>The number of VMs that are running at any time must change when the user workload changes.</p></li><li class="square"><p>When a new version of the application is available in the Azure Marketplace it must be deployed without causing application downtime.</p></li><li class="square"><p>Use VM scale sets.</p></li><li class="square"><p>Minimize the need for ongoing maintenance.</p></li></ul><p>
Which two technologies would you recommend?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="checkbox" name="q75715c4a-3c25-1559-ca77-d79609306650" value="1" />A single placement group<br /></label></li><li><label><input type="checkbox" name="q75715c4a-3c25-1559-ca77-d79609306650" value="2" />Managed disks<br /></label></li><li><label><input type="checkbox" name="q75715c4a-3c25-1559-ca77-d79609306650" value="3" />Autoscale<br /></label></li><li><label><input type="checkbox" name="q75715c4a-3c25-1559-ca77-d79609306650" value="4" />A single storage account<br /></label></li><li><label><input type="checkbox" name="q75715c4a-3c25-1559-ca77-d79609306650" value="5" />A point-to-site VPN<br /></label></li></ul></div></div><div id="feedback-problem-75715c4a-3c25-1559-ca77-d79609306650" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Autoscale facilitates horizontal scaling of VMs depending on a metric such as processor usage or memory usage. Managed disks automate the provisioning of storage capacity for the VMs.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 2</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-46556212-22db-0bd8-2c68-42bdbc5869ae"><div class="card quizlib-question"><div class="quizlib-question-title"><p>An organization you are advising is running a single application that runs on a VM. The traffic to the application as recently been on the increase and continues to rise.<br /></p><ul class="square"><li class="square"><p>The application cannot experience downtime must scale dynamically.</p></li><li class="square"><p>You are asked to recommend an auto-scale approach so the VM can respond well to the workload requirements.</p></li></ul><p>
Which three options would you recommend?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="checkbox" name="q46556212-22db-0bd8-2c68-42bdbc5869ae" value="1" />Deploy application automatic horizontal scaling<br /></label></li><li><label><input type="checkbox" name="q46556212-22db-0bd8-2c68-42bdbc5869ae" value="2" />Implement custom auto-scale<br /></label></li><li><label><input type="checkbox" name="q46556212-22db-0bd8-2c68-42bdbc5869ae" value="3" />Create a VM scale set<br /></label></li><li><label><input type="checkbox" name="q46556212-22db-0bd8-2c68-42bdbc5869ae" value="4" />Implement an Azure Load Balancer<br /></label></li></ul></div></div><div id="feedback-problem-46556212-22db-0bd8-2c68-42bdbc5869ae" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct Answers: Deploy application automatic horizontal scaling, Implement custom auto-scale, and Create a VM scale set.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 3</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-3ce5207f-4f93-3cdd-3e72-80532d4e713f"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You are researching Microsoft Azure for your company. The company is considering deploying Windows-based VMs in Azure. However, before moving forward, the management team has asked you to research the costs associated with Azure VMs. You need to document the configuration options that are likely to save the company money on their Azure VMs. Which options should you document? (Each answer presents part of the solution. Select four.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="checkbox" name="q3ce5207f-4f93-3cdd-3e72-80532d4e713f" value="1" />Use HDD instead of SSD for VM storage.<br /></label></li><li><label><input type="checkbox" name="q3ce5207f-4f93-3cdd-3e72-80532d4e713f" value="2" />Use unmanaged premium storage instead of managed standard storage.<br /></label></li><li><label><input type="checkbox" name="q3ce5207f-4f93-3cdd-3e72-80532d4e713f" value="3" />Bring your own Windows custom images.<br /></label></li><li><label><input type="checkbox" name="q3ce5207f-4f93-3cdd-3e72-80532d4e713f" value="4" />Use different Azure regions.<br /></label></li><li><label><input type="checkbox" name="q3ce5207f-4f93-3cdd-3e72-80532d4e713f" value="5" />Use the least powerful VMs that meet your requirements.<br /></label></li><li><label><input type="checkbox" name="q3ce5207f-4f93-3cdd-3e72-80532d4e713f" value="6" />Place all VMs in the same resource group.<br /></label></li><li><label><input type="checkbox" name="q3ce5207f-4f93-3cdd-3e72-80532d4e713f" value="7" />Bring your own Windows license for each VM.<br /></label></li></ul></div></div><div id="feedback-problem-3ce5207f-4f93-3cdd-3e72-80532d4e713f" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">In this scenario, you need to document which of the options presented are likely to save the company money for their Azure VMs. While this isn’t an exhaustive list, the correct money-saving configuration options are: Use HDD instead of SSD, use different Azure regions, use the least powerful VMs that meet your requirements, and bring your own Windows license (instead of paying for a license with the VM). The other options usually increase cost.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 4</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-8b152f61-b9e6-5b27-f816-0f8229daf3b4"><div class="card quizlib-question"><div class="quizlib-question-title"><p>You are planning to deploy several Linux VMs in Azure. The security team issues a policy that Linux VMs must use an authentication system other than passwords. You need to deploy an authentication method for the Linux VMs to meet the requirement. Which authentication method should you use? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q8b152f61-b9e6-5b27-f816-0f8229daf3b4" value="1" />SSH key pair<br /></label></li><li><label><input type="radio" name="q8b152f61-b9e6-5b27-f816-0f8229daf3b4" value="2" />Azure multi-factor authentication<br /></label></li><li><label><input type="radio" name="q8b152f61-b9e6-5b27-f816-0f8229daf3b4" value="3" />Access keys<br /></label></li><li><label><input type="radio" name="q8b152f61-b9e6-5b27-f816-0f8229daf3b4" value="4" />Shared access signature<br /></label></li><li><label><input type="radio" name="q8b152f61-b9e6-5b27-f816-0f8229daf3b4" value="5" />Security vault certificate<br /></label></li></ul></div></div><div id="feedback-problem-8b152f61-b9e6-5b27-f816-0f8229daf3b4" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Azure supports two authentication methods for Linux VMs - passwords and SSH (via an SSH key pair). Access keys and shared access signatures are access methods for Azure storage, not for Azure VMs. In this scenario, you need to use an SSH key pair to meet the requirement.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 5</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-76b49f53-14f2-b88a-7547-8f0c1a939616"><div class="card quizlib-question"><div class="quizlib-question-title"><p>Another IT administrator creates an Azure virtual machine scale set with 5 VMs. Later, you notice that the VMs are all running at max capacity with the CPU being fully consumed. However, additional VMs are not deploying in the scale set. You need to ensure that additional VMs are deployed when the CPU is 75% consumed. What should you do? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q76b49f53-14f2-b88a-7547-8f0c1a939616" value="1" />Enable the autoscale option.<br /></label></li><li><label><input type="radio" name="q76b49f53-14f2-b88a-7547-8f0c1a939616" value="2" />Increase the instance count.<br /></label></li><li><label><input type="radio" name="q76b49f53-14f2-b88a-7547-8f0c1a939616" value="3" />Add the scale set automation script to the library.<br /></label></li><li><label><input type="radio" name="q76b49f53-14f2-b88a-7547-8f0c1a939616" value="4" />Deploy the scale set automation script.<br /></label></li></ul></div></div><div id="feedback-problem-76b49f53-14f2-b88a-7547-8f0c1a939616" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">When you have a scale set, you can enable automatic scaling with the autoscale option. When you enable the option, you define the parameters for when to scale. To meet the requirements of this scenario, you need to enable the autoscale option so that additional VMs are created when the CPU is 75% consumed. Note that the automation script is used to automate the deployment of scale sets and not related to automating the building of additional VMs in the scale set.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 6</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-17d447dc-e9dd-3fc6-00e0-c7c031757cf4"><div class="card quizlib-question"><div class="quizlib-question-title"><p>Your company is preparing to deploy an application to Microsoft Azure. The app is a self-contained unit that runs independently on several servers. The company is moving the app to the cloud to provide better performance. To get better performance, the team has the following requirements:<br /></p><ul class="square"><li class="square"><p>If the CPU across the servers goes above 85%, a new VM should be deployed to provide additional resources.</p></li><li class="square"><p>If the CPU across the servers drops below 15%, an Azure VM running the app should be decommissioned to reduce costs.</p></li></ul><p>
You need to deploy a solution to meet the requirements while minimizing the administrative overhead to implement and manage the solution. What should you do? Select one.<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q17d447dc-e9dd-3fc6-00e0-c7c031757cf4" value="1" />Deploy the app in a virtual machine scale set.<br /></label></li><li><label><input type="radio" name="q17d447dc-e9dd-3fc6-00e0-c7c031757cf4" value="2" />Deploy the app in a virtual machine availability set.<br /></label></li><li><label><input type="radio" name="q17d447dc-e9dd-3fc6-00e0-c7c031757cf4" value="3" />Deploy the app by using a resource manager template.<br /></label></li><li><label><input type="radio" name="q17d447dc-e9dd-3fc6-00e0-c7c031757cf4" value="4" />Deploy the app and use PowerShell Desired State Configuration (DSC).<br /></label></li></ul></div></div><div id="feedback-problem-17d447dc-e9dd-3fc6-00e0-c7c031757cf4" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">In this scenario, you should use a scale set for the VMs. Scale sets can scale up or down, based on defined criteria (such as the existing set of VMs using a large percentage of the available CPU). This meets the scenario’s requirements.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h3 class="da-h3" id="1191788">Azure Cosmos DB API for MongoDB</h3><p>Azure Cosmos DB is a globally distributed, multi-model database service for mission-critical applications. Azure Cosmos DB provides turn-key global distribution, elastic scaling of throughput and storage worldwide, single-digit millisecond latencies at the 99th percentile, and guaranteed high availability supported by industry-leading SLAs.</p><p>Azure Cosmos DB automatically indexes data without schema and index management. It is multi-model and supports document, key-value, graph, and columnar data models. By default, you can interact with Cosmos DB using SQL API. Additionally, the Cosmos DB service implements wire protocols for common NoSQL APIs including Cassandra, MongoDB, Gremlin, and Azure Table Storage. This allows you to use familiar NoSQL client drivers and tools to interact with your Cosmos database.</p><h4 class="da-h4">Wire protocol compatibility</h4><p>Azure Cosmos DB implements wire protocols of common NoSQL databases including Cassandra, MongoDB, Gremlin, and Azure Tables Storage. By providing a native implementation of the wire protocols directly and efficiently inside Cosmos DB, it allows existing client SDKs, drivers, and tools of the NoSQL databases to interact with Cosmos DB transparently. Cosmos DB does not use any source code of the databases for providing wire-compatible APIs for any of the NoSQL databases.</p><p>By default, new accounts created using Azure Cosmos DB's API for MongoDB are compatible with version 3.6 of the MongoDB wire protocol. Any MongoDB client driver that understands this protocol version should be able to natively connect to Cosmos DB.</p><p><span><img alt="" src="../Images/1192030-490168.png" width="" height="" /></span></p><h4 class="da-h4">Key benefits</h4><p>By natively implementing wire protocols of NoSQL APIs, Cosmos DB provides the following benefits:</p><ul class="square"><li class="square"><p>Migrate applications to Cosmos DB while preserving significant portions of your application logic.</p></li><li class="square"><p>Keep applications portable and continue to remain cloud vendor-agnostic.</p></li><li class="square"><p>Financially backed SLAs for the common NoSQL APIs powered by Cosmos DB.</p></li><li class="square"><p>Turnkey, global distribution with multi-master replication.</p></li></ul><h3 class="da-h3" id="1191895">Azure to Azure Site Recovery</h3><p>With Azure Site to Site recovery, you can replicate Azure VMs to any other Azure location, with no infrastructure to deploy. The process is not tied to the <i>pairing</i> of regions encountered with storage, etc.</p><p>The ASR Mobility Service extension is automatically deployed to protected machines as part of the protection process.</p><p>In this scenario, you can replicate the following:</p><ul class="square"><li class="square"><p>VMs</p></li><li class="square"><p>Virtual Networks</p></li><li class="square"><p>Availability Sets</p></li><li class="square"><p>Storage accounts</p></li></ul><p>Optionally – you can specify your own VNets, Storage Accounts and Availability Sets</p><p>Replication happens on HTTPS channel, port 443 and an Azure egress cost is incurred for outbound traffic from the primary region.</p><p>✔️ If you are using a URL-based firewall proxy to control outbound connectivity, certain Site Recovery URLs need to be allowed. Also, if you are using an IP-based firewall proxy, or NSG rules to control outbound connectivity, certain IP address ranges need to be allowed. For more information about whitelisted URLS and IP ranges, see <a href="https://docs.microsoft.com/en-us/azure/site-recovery/azure-to-azure-about-networking#outbound-connectivity-for-urls" title="" target="_blank">Outbound connectivity for URLs</a> and <a href="https://docs.microsoft.com/en-us/azure/site-recovery/azure-to-azure-about-networking#outbound-connectivity-for-ip-address-ranges" title="" target="_blank">Outbound connectivity for IP address ranges</a>.</p><h3 class="da-h3" id="1191629">Add Guest users to Azure AD in the Azure Portal</h3><p>You can invite anyone to collaborate with your organization by adding them to your directory as a guest user. Then you can either send an invitation email that contains a redemption link or send a direct link to an app you want to share.</p><p>Guest users can sign in with their own work, school, or social identities.</p><p>In this demonstration, you'll add a new guest user to Azure AD and send an invitation.</p><h4 class="da-h4">Prerequisites</h4><p>To complete the scenario in this demonstration, you need:</p><ul class="square"><li class="square"><p>A role that allows you to create users in your tenant directory, like the Global Administrator role or any of the limited administrator directory roles.</p></li><li class="square"><p>A valid email account that you can add to your tenant directory, and that you can use to receive the test invitation email.</p></li></ul><h3 class="da-h3" id="1191737">Azure Storage Services</h3><p>Azure Storage includes these data services, each of which is accessed through a storage account.</p><ul class="square"><li class="square"><p><b>Azure Containers (Blobs)</b>: A massively scalable object store for text and binary data.</p></li><li class="square"><p><b>Azure Files</b>: Managed file shares for cloud or on-premises deployments.</p></li><li class="square"><p><b>Azure Queues</b>: A messaging store for reliable messaging between application components.</p></li><li class="square"><p><b>Azure Tables</b>: A NoSQL store for schemaless storage of structured data.</p></li></ul><h4 class="da-h4">Container (blob) storage</h4><p>Azure Blob storage is Microsoft's object storage solution for the cloud. Blob storage is optimized for storing massive amounts of unstructured data, such as text or binary data. Blob storage is ideal for:</p><ul class="square"><li class="square"><p>Serving images or documents directly to a browser.</p></li><li class="square"><p>Storing files for distributed access.</p></li><li class="square"><p>Streaming video and audio.</p></li><li class="square"><p>Storing data for backup and restore, disaster recovery, and archiving.</p></li><li class="square"><p>Storing data for analysis by an on-premises or Azure-hosted service.</p></li></ul><p>Objects in Blob storage can be accessed from anywhere in the world via HTTP or HTTPS. Users or client applications can access blobs via URLs, the Azure Storage REST API, Azure PowerShell, Azure CLI, or an Azure Storage client library. The storage client libraries are available for multiple languages, including .NET, Java, Node.js, Python, PHP, and Ruby.</p><h4 class="da-h4">Azure Files</h4><p>Azure Files enables you to set up highly available network file shares that can be accessed by using the standard Server Message Block (SMB) protocol. That means that multiple VMs can share the same files with both read and write access.</p><p>One thing that distinguishes Azure Files from files on a corporate file share is that you can access the files from anywhere in the world using a URL that points to the file and includes a shared access signature (SAS) token. You can generate SAS tokens; they allow specific access to a private asset for a specific amount of time.</p><p>File shares can be used for many common scenarios:</p><ul class="square"><li class="square"><p>Many on-premises applications use file shares. This feature makes it easier to migrate those applications that share data to Azure. If you mount the file share to the same drive letter that the on-premises application uses, the part of your application that accesses the file share should work with minimal, if any, changes.</p></li><li class="square"><p>Configuration files can be stored on a file share and accessed from multiple VMs. Tools and utilities used by multiple developers in a group can be stored on a file share, ensuring that everybody can find them, and that they use the same version.</p></li><li class="square"><p>Diagnostic logs, metrics, and crash dumps are just three examples of data that can be written to a file share and processed or analyzed later.</p></li></ul><h4 class="da-h4">Queue storage</h4><p>The Azure Queue service is used to store and retrieve messages. Queue messages can be up to 64 KB in size, and a queue can contain millions of messages. Queues are generally used to store lists of messages to be processed asynchronously.</p><p>For example, say you want your customers to be able to upload pictures, and you want to create thumbnails for each picture. You could have your customer wait for you to create the thumbnails while uploading the pictures. An alternative would be to use a queue. When the customer finishes his upload, write a message to the queue. Then have an Azure Function retrieve the message from the queue and create the thumbnails. Each of the parts of this processing can be scaled separately, giving you more control when tuning it for your usage.</p><h4 class="da-h4">Table storage</h4><p>Azure Table storage is now part of Azure Cosmos DB. In addition to the existing Azure Table storage service, there is a new Azure Cosmos DB Table API offering that provides throughput-optimized tables, global distribution, and automatic secondary indexes. To learn more and try out the new premium experience, please check out Azure Cosmos DB Table API.</p><h3 class="da-h3" id="1191729">Demonstration - Create an Azure Bastion Host</h3><p>This demonstration shows you how to create an Azure Bastion host using the Azure portal. Once you provision the Azure Bastion service in your virtual network, the seamless RDP/SSH experience is available to all of the VMs in the same virtual network. Azure Bastion deployment is per virtual network, not per subscription/account or virtual machine.</p><p>You can create a new bastion host resource in the portal either by specifying all of the settings manually, or by using the settings that correspond to an existing VM.</p><h4 class="da-h4">Create a new Azure Bastion resource from the Azure portal.</h4><ol class="number"><li><p>On the <a href="https://portal.azure.com/" title="" target="_blank">Azure portal</a> menu or from the <b>Home</b> page, select <b>Create a resource</b>.</p></li><li><p>On the <b>New</b> page, in the <b>Search the Marketplace</b>field, type <i>Bastion</i>, then click <b>Enter</b> to get to the search results.</p></li><li><p>From the results, click <b>Bastion</b>. Make sure the publisher is <i>Microsoft</i> and the category is <i>Networking</i>.</p></li><li><p>On the <b>Bastion</b> page, click <b>Create</b> to open the <b>Create a bastion</b> page.</p></li><li><p>On the <b>Create a bastion</b> page, configure a new Bastion resource. Specify the configuration settings for your Bastion resource.</p></li></ol><p><span><img alt="" src="../Images/1192041-490179.png" width="" height="" /></span></p><ul class="square"><li class="square"><p><b>Subscription</b>: The Azure subscription you want to use to create a new Bastion resource.</p></li><li class="square"><p><b>Resource Group</b>: The Azure resource group in which the new Bastion resource will be created in. If you don't have an existing resource group, you can create a new one.</p></li><li class="square"><p><b>Name</b>: The name of the new Bastion resource</p></li><li class="square"><p><b>Region</b>: The Azure public region that the resource will be created in.</p></li><li class="square"><p><b>Virtual network</b>: The virtual network in which the Bastion resource will be created in. You can create a new virtual network in the portal during this process, or use an existing virtual network. If you are using an existing virtual network, make sure the existing virtual network has enough free address space to accommodate the Bastion subnet requirements.</p></li><li class="square"><p><b>Subnet</b>: The subnet in your virtual network where the new Bastion host will be deployed. The subnet will be dedicated to the Bastion host and must be named as AzureBastionSubnet. This subnet must be at least /27 or larger.</p></li></ul><p>AzureBastionSubnet doesn't support User Defined Routes, but does support Network Security Groups.</p><ul class="square"><li class="square"><p><b>Public IP address</b>: The public IP of the Bastion resource on which RDP/SSH will be accessed (over port 443). Create a new public IP, or use an existing one. The public IP address must be in the same region as the Bastion resource you are creating.</p></li><li class="square"><p><b>Public IP address name</b>: The name of the public IP address resource.</p></li><li class="square"><p><b>Public IP address SKU</b>: This setting is prepopulated by default to Standard. Azure Bastion uses/supports only the Standard Public IP SKU.</p></li><li class="square"><p><b>Assignment</b>: This setting is prepopulated by default to Static.</p></li></ul><ol class="number"><li value="6"><p>When you have finished specifying the settings, click <b>Review + Create</b>.</p></li><li><p>On the <b>Create</b> a bastion page, click <b>Create</b>.</p></li><li><p>You will see a message letting you know that your deployment is underway. Status will display on this page as the resources are created. It takes about 5 minutes for the Bastion resource to be created and deployed.</p></li></ol><h3 class="da-h3" id="1191651">Module 2 Review Questions</h3><p><span><img alt="" src="../Images/1192029-490167.png" width="" height="" /></span></p><h4 class="problem">Review Question 1</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-5f725535-5eb4-fa7a-6343-fcccc80966cb"><div class="card quizlib-question"><div class="quizlib-question-title"><p>An organization you advise has an Azure Directory forest named Tailwind.com.<br /></p><ul class="square"><li class="square"><p>They have installed an configured Azure AD Connect to use password hash synchronization as the single sign-on (SSO) approach. Note: Staging mode is enabled.</p></li><li class="square"><p>They have reviewed the synchronization results and noticed that the Synchronization Service Manager doesn’t display any previous sync jobs.</p></li><li class="square"><p>You are asked to find a way to ensure that the synchronization completes successfully.</p></li></ul><p>
What do you advise?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q5f725535-5eb4-fa7a-6343-fcccc80966cb" value="1" />From Synchronization Service Manager, run a full import<br /></label></li><li><label><input type="radio" name="q5f725535-5eb4-fa7a-6343-fcccc80966cb" value="2" />Run AD Connect and disable staging mode.<br /></label></li><li><label><input type="radio" name="q5f725535-5eb4-fa7a-6343-fcccc80966cb" value="3" />Run AD Connect and set the SSO method to Pass-Through authentication.<br /></label></li><li><label><input type="radio" name="q5f725535-5eb4-fa7a-6343-fcccc80966cb" value="4" />Run from Azure PowerShell, Start-AdSyncSyncCycle -policyType Initial.<br /></label></li></ul></div></div><div id="feedback-problem-5f725535-5eb4-fa7a-6343-fcccc80966cb" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct Answer: Run AD Connect and disable staging mode. AD Connect needs to be taken out of staging mode so that objects are synced.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h4 class="problem">Review Question 2</h4><div id="quiz-result" class="card" style="display: none;">
      Score: <span id="quiz-score" />/<span id="quiz-max-score" /><br /></div><div id="problem-9b9648d0-592b-2761-cb23-ed416055e46c"><div class="card quizlib-question"><div class="quizlib-question-title"><p>An organization you advise has a network that contains an on-premises Active Directory forest named Tailwind.com and contains two domains:<br /></p><ul class="square"><li class="square"><p>Tailwind.com</p></li><li class="square"><p>East.Tailwind.com</p></li></ul><p>
The forest contains user as seen below:<br />
Name: Team_User1<br /></p><ul class="square"><li class="square"><p>Domain: Tailwind.com</p></li><li class="square"><p>Member of: Enterprise Admins</p></li></ul><p>
Name: Team _User2<br /></p><ul class="square"><li class="square"><p>Domain: Tailwind.com</p></li><li class="square"><p>Member of: Domain Admins</p></li></ul><p>
Name: Team _User3<br /></p><ul class="square"><li class="square"><p>Domain: East.Tailwind.com</p></li><li class="square"><p>Member of: Domain Admins</p></li></ul><p>
Name: Team _User4<br /></p><ul class="square"><li class="square"><p>Domain: East.Tailwind.com</p></li><li class="square"><p>Member of: Domain Users</p></li></ul><p>
They plan to sync East.Tailwind.com to an Azure AD tenant by using Azure AD Connect.<br />
They need to select an account for Azure AD Connect for the connect to the forest.<br />
Which account do you advise they use?<br /></p></div><div class="quizlib-question-answers"><ul><li><label><input type="radio" name="q9b9648d0-592b-2761-cb23-ed416055e46c" value="1" />Team_User1<br /></label></li><li><label><input type="radio" name="q9b9648d0-592b-2761-cb23-ed416055e46c" value="2" />Team_User2<br /></label></li><li><label><input type="radio" name="q9b9648d0-592b-2761-cb23-ed416055e46c" value="3" />Team_User3<br /></label></li><li><label><input type="radio" name="q9b9648d0-592b-2761-cb23-ed416055e46c" value="4" />Team_User4<br /></label></li></ul></div></div><div id="feedback-problem-9b9648d0-592b-2761-cb23-ed416055e46c" style="display: none;"><p class="da-divtext">Explanation</p><p class="da-divtext">Correct Answer: The Team_User4 account. The account they specify on the Connect your directories page must be present in Active Directory prior to installation.<br /></p></div><button type="button" onclick="showResults(this.parentNode.id);">Check Answers</button></div><h3 class="da-h3" id="1191891">Azure Backup Key Features</h3><p><span><img alt="" src="../Images/1192142-490280.png" width="" height="" /></span></p><p>Microsoft Azure Backup Service integrates with the familiar Windows Server Backup utility in Windows Server, the Data Protection Manager component in System Center and Windows Server Essentials, in order to provide a seamless backup and recovery experience to a local disk, or to the cloud.</p><p><b>Block level incremental backups</b></p><p>The Microsoft Azure Backup Agent performs incremental backups by tracking file and block level changes and only transferring the changed blocks, hence reducing the storage and bandwidth utilization. Different point-in-time versions of the backups use the storage efficiently by only storing the changed blocks between these versions.</p><p><b>Data integrity is verified in the cloud</b></p><p>In addition to the secure backups, the backed-up data is also automatically checked for integrity once the backup is done. As a result, any corruptions which may arise due to data transfer can be easily identified and are fixed automatically.</p><p><b>Configurable retention policies for storing data in the cloud</b></p><p>The Microsoft Azure Backup Service accepts and implements retention policies to recycle backups that exceed the desired retention range, thereby meeting business policies and managing backup costs.</p><h3 class="da-h3" id="1191688">Create a VM Scale Set in the Azure Portal</h3><p>Create a public load balancer using the portal. The name and public IP address you create are automatically configured as the load balancer's front end.</p><ol class="number"><li><p>In the search box, type <i>load balancer</i>. Under Marketplace in the search results, pick <b>Load balancer</b>.</p></li><li><p>In the <b>Basics</b> tab of the Create load balancer page, enter or select the following information:</p></li></ol><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Setting</p></td><td><p>Value</p></td></tr></thead><tbody><tr><td><p>Subscription</p></td><td><p>Select your subscription.</p></td></tr><tr><td><p>Resource group</p></td><td><p>Select Create new and type myVMSSResourceGroup in the text box.</p></td></tr><tr><td><p>Name</p></td><td><p>myLoadBalancer</p></td></tr><tr><td><p>Region</p></td><td><p>Select East US.</p></td></tr><tr><td><p>Type</p></td><td><p>Select Public.</p></td></tr><tr><td><p>SKU</p></td><td><p>Select Standard.</p></td></tr><tr><td><p>Public IP address</p></td><td><p>Select Create new.</p></td></tr><tr><td><p>Public IP address name</p></td><td><p>MyPip</p></td></tr><tr><td><p>Assignment</p></td><td><p>Static</p></td></tr></tbody></table><ol class="number"><li value="3"><p>Select <b>Review + create</b>.</p></li><li><p>Select <b>Create</b>.</p></li></ol><p><span><img alt="" src="../Images/1192100-490238.png" width="" height="" /></span></p><p><b>Create virtual machine scale set</b></p><p>You can deploy a scale set with a Windows Server image or Linux image such as RHEL, CentOS, Ubuntu, or SLES.</p><ol class="number"><li><p>Type <i>Scale set</i> in the search box. In the results, under <b>Marketplace</b>, select <b>Virtual machine scale sets</b>. The <b>Create a virtual machine scale set</b> page will open.</p></li><li><p>In the <b>Basics</b> tab, under <b>Project details</b>, make sure the correct subscription is selected and then choose <b>Create new</b> resource group. Type <i>myVMSSResourceGroup</i> for the name and then select OK .</p></li><li><p>Type <i>myScaleSet</i> as the name for your scale set.</p></li><li><p>In <b>Region</b>, select a region that is close to your area.</p></li><li><p>Leave the default value of <b>ScaleSet VMs</b> for <b>Orchestrator</b>.</p></li><li><p>Select a marketplace image for Image. In this example, we have chosen Ubuntu Server 18.04 LTS.</p></li><li><p>Enter your desired username, and select which authentication type you prefer.</p></li></ol><ul class="square"><li class="square"><p>A <b>Password</b> must be at least 12 characters long and meet three out of the four following complexity requirements: one lower case character, one upper case character, one number, and one special character.</p></li><li class="square"><p>If you select a Linux OS disk image, you can instead choose <b>SSH public key</b>. Only provide your public key, such as ~/.ssh/id_rsa.pub. You can use the Azure Cloud Shell from the portal to create and use SSH keys.</p></li></ul><p><span><img alt="" src="../Images/1192101-490239.png" width="" height="" /></span></p><ol class="number"><li value="8"><p>Select <b>Next</b> to move the the other pages.</p></li><li><p>Leave the defaults for the <b>Instance</b> and <b>Disks</b> pages.</p></li><li><p>On the <b>Networking</b> page, under <b>Load balancing</b>, select <b>Yes</b> to put the scale set instances behind a load balancer.</p></li><li><p>In <b>Load balancing option</b>s, select <b>Azure load balancer</b>.</p></li><li><p>In <b>Select a load balancer</b>, select <b>myLoadBalancer</b> that you created earlier.</p></li><li><p>For Select a <b>backend pool</b>, select <b>Create</b> new, type <i>myBackendPool</i>, and select <b>Create</b>.</p></li><li><p>Select <b>Review + create</b>.</p></li><li><p>Select <b>Create</b> to deploy the scale set.</p></li></ol><h3 class="da-h3" id="1191649">Implement Azure AD Connect Health</h3><p>To install the Azure AD Connect Health agent, do the following:</p><ul class="square"><li class="square"><p>Make sure that you <a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-health-agent-install" title="" target="_blank">satisfy the requirements</a> for Azure AD Connect Health.</p></li><li class="square"><p>Install the Azure AD Connect Health agent</p><ul class="square"><li class="square"><p><a href="https://go.microsoft.com/fwlink/?LinkID=518973" title="" target="_blank">Download Azure AD Connect Health Agent for AD FS.</a></p></li><li class="square"><p><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-health-agent-install" title="" target="_blank">See the installation instructions</a>.</p></li></ul></li><li class="square"><p>Get started using Azure AD Connect Health for sync</p><ul class="square"><li class="square"><p><a href="https://go.microsoft.com/fwlink/?linkid=615771" title="" target="_blank">Download and install the latest version of Azure AD Connect</a>. The Health Agent for sync will be installed as part of the Azure AD Connect installation (version 1.0.9125.0 or higher).</p></li></ul></li></ul><h4 class="da-h4">Azure AD Connect Health portal</h4><p>The Azure AD Connect Health portal shows views of alerts, performance monitoring, and usage analytics. The <a href="https://aka.ms/aadconnecthealth" title="" target="_blank">https://aka.ms/aadconnecthealth</a> URL takes you to the main blade of Azure AD Connect Health. You can think of a blade as a window. On The main blade, you see Quick Start, services within Azure AD Connect Health, and additional configuration options. See the following screenshot and brief explanations that follow the screenshot. After you deploy the agents, the health service automatically identifies the services that Azure AD Connect Health is monitoring.</p><p><span><img alt="" src="../Images/1192147-490285.png" width="" height="" /></span></p><ul class="square"><li class="square"><p><b>Quick Start</b>: When you select this option, the Quick Start blade opens. You can download the Azure AD Connect Health Agent by selecting Get Tools.</p></li><li class="square"><p><b>Azure Active Directory Connect (sync)</b>: This option shows your Azure AD Connect servers that Azure AD Connect Health is currently monitoring. Sync errors entry will show basic sync errors of your first onboarded sync service by categories. When you select the Sync services entry, the blade that opens shows information about your Azure AD Connect servers.</p></li><li class="square"><p><b>Active Directory Federation Services</b>: This option shows all the AD FS services that Azure AD Connect Health is currently monitoring. When you select an instance, the blade that opens shows information about that service instance. This information includes an overview, properties, alerts, monitoring, and usage analytics.</p></li><li class="square"><p><b>Active Directory Domain Services</b>: This option shows all the AD DS forests that Azure AD Connect Health is currently monitoring. When you select a forest, the blade that opens shows information about that forest.</p></li><li class="square"><p><b>Configure</b>: This section includes options to turn the following on or off:</p><ul class="square"><li class="square"><p>The automatic update of the Azure AD Connect Health agent to the latest version: the Azure AD Connect Health agent is automatically updated whenever new versions are available.</p></li><li class="square"><p>Access to data from the Azure AD directory integrity by Microsoft only for troubleshooting purposes: if this option is enabled, Microsoft can access the same data viewed by the user. This information can be useful for troubleshooting and to provide the necessary assistance.</p></li></ul></li><li class="square"><p><b>Role based access control (IAM)</b> is the section to manage the access to Connect Health data in role base.</p></li></ul><h3 class="da-h3" id="1191811">Download the Template using PowerShell</h3><p>You can also download the .json template file using the PowerShell Export-AzResourceGroup cmdlet. You can use the <span class="code">-path</span> parameter to provide the <b>filename</b> and path for the .json file.</p><p>This example shows how to download the template for the resource group named <b>myResourceGroup</b> to the C:\users\public\downloads folder on your local computer.</p><div class="code language-PowerShell"><p class="da-divtext"><code>Export<span class="token operator">-</span>AzResourceGroup <span class="token operator">-</span>ResourceGroupName <span class="token string">"myResourceGroup"</span> <span class="token operator">-</span>Path <span class="token string">"C:\users\public\downloads"</span></code></p></div><h3 class="da-h3" id="1191695">Azure Encryption Technologies</h3><p>The primary encryption-based disk protection technologies for Azure VMs are:</p><ul class="square"><li class="square"><p>Storage Service Encryption (SSE)</p></li><li class="square"><p>Azure Disk Encryption (ADE)</p></li></ul><p>Storage Service Encryption is performed on the physical disks in the data center. If someone were to directly access the physical disk the data would be encrypted. When the data is accessed from the disk, it is decrypted and loaded into memory.</p><p>Azure Disk Encryption encrypts the virtual machine's virtual hard disks (VHDs). If VHD is protected with ADE, the disk image will only be accessible by the virtual machine that owns the disk.</p><p>It's possible to use both services to protect your data.</p><p><b>Storage Service Encryption</b></p><p>Azure Storage Service Encryption (SSE) is an encryption service built into Azure used to protect data at rest. The Azure storage platform automatically encrypts data before it's stored to several storage services, including Azure Managed Disks. Encryption is enabled by default using 256-bit AES encryption, and is managed by the storage account administrator.</p><p>Storage Service Encryption is enabled for all new and existing storage accounts and cannot be disabled. Your data is secured by default; you don't need to modify your code or applications to take advantage of Storage Service Encryption.</p><p>Storage Service Encryption does not affect the performance of Azure storage services.</p><p><b>Azure Disk Encryption</b></p><p>Azure Disk Encryption (ADE) is managed by the VM owner. It controls the encryption of Windows and Linux VM-controlled disks, using <b>BitLocker</b> on Windows VMs and <b>DM-Crypt</b> on Linux VMs. BitLocker Drive Encryption is a data protection feature that integrates with the operating system, and addresses the threats of data theft or exposure from lost, stolen, or inappropriately decommissioned computers. Similarly, DM-Crypt encrypts data at rest for Linux before writing to storage.</p><p>ADE ensures that all data on VM disks are encrypted at rest in Azure storage, and ADE is required for VMs backed up to the Recovery Vault.</p><p>With ADE, VMs boot under customer-controlled keys and policies. ADE is integrated with Azure Key Vault for the management of these disk-encryption keys and secrets.</p><p>✔️<b>Note:</b>
ADE does not support the encryption of Basic tier VMs, and you cannot use an on-premises Key Management Service (KMS) with ADE. Azure Disk Encryption is not available on Basic, A-series VMs, or on virtual machines with a less than 2 GB of memory.
Azure Disk Encryption is not available on Generation 2 VMs and Lsv2-series VMs. See: https://docs.microsoft.com/en-us/azure/virtual-machines/windows/disk-encryption-overview</p><h3 class="da-h3" id="1191687">Implementing Scale Sets</h3><p>Below are considerations for implementing Scale Sets.</p><ul class="square"><li class="square"><p><b>Initial instance count.</b> Number of virtual machines in the scale set (0 to 1000).</p></li><li class="square"><p><b>Instance size.</b> The size of each virtual machine in the scale set.</p></li><li class="square"><p><b>Azure spot instance</b>. Low-priority VMs are allocated from Microsoft Azure's excess compute capacity, enabling several types of workloads to run for a significantly reduced cost.</p></li><li class="square"><p><b>Use managed disks.</b> Managed disks hide the underlying storage accounts and instead shows the abstraction of a disk. Unmanaged disks expose the underlying storage accounts and VHD blobs.</p></li><li class="square"><p><b>Enable scaling beyond 100 instances.</b> If No, the scale set will be limited to 1 placement group and can have a max capacity of 100. If Yes, the scale set can span multiple placement groups. This allows for capacity to be up to 1,000 but changes the availability characteristics of the scale set.</p></li><li class="square"><p><b>Spreading algorithm</b>. We recommend deploying with max spreading for most workloads, as this approach provides the best spreading in most cases.</p></li></ul><p><span><img alt="" src="../Images/1192055-490193.png" width="" height="" /></span></p><h3 class="da-h3" id="1191740">Accessing Storage</h3><p>Every object that you store in Azure Storage has a unique URL address. The storage account name forms the subdomain of that address. The combination of subdomain and domain name, which is specific to each service, forms an endpoint for your storage account.</p><p>For example, if your storage account is named <i>mystorageaccount</i>, then the default endpoints for your storage account are:</p><ul class="square"><li class="square"><p>Container service: http://mystorageaccount.blob.core.windows.net</p></li><li class="square"><p>Table service: http://mystorageaccount.table.core.windows.net</p></li><li class="square"><p>Queue service: http://mystorageaccount.queue.core.windows.net</p></li><li class="square"><p>File service: http://mystorageaccount.file.core.windows.net</p></li></ul><p>The URL for accessing an object in a storage account is built by appending the object's location in the storage account to the endpoint. For example, to access <i>myblob</i> in the <i>mycontainer</i>, use this format: http://mystorageaccount.blob.core.windows.net/mycontainer/myblob.</p><h4 class="da-h4">Configuring a Custom Domain</h4><p>You can configure a custom domain for accessing blob data in your Azure storage account. As mentioned previously, the default endpoint for Azure Blob storage is &lt;storage-account-name&gt;.blob.core.windows.net. You can also use the web endpoint that's generated as a part of the static websites feature. If you map a custom domain and subdomain, such as www.contoso.com, to the blob or web endpoint for your storage account, your users can use that domain to access blob data in your storage account. There are two ways to configure this service: Direct CNAME mapping and an intermediary domain.</p><p>✔️<b>Note:</b> Azure Storage does not yet natively support HTTPS with custom domains. You can currently Use Azure CDN to access blobs by using custom domains over HTTPS.</p><p><b>Direct CNAME mapping</b> for example, to enable a custom domain for the blobs.contoso.com sub domain to an Azure storage account, create a CNAME record that points from blobs.contoso.com to the Azure storage account [storage account].blob.core.windows.net. The following example maps a domain to an Azure storage account in DNS:</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>CNAME record</p></td><td><p>Target</p></td></tr></thead><tbody><tr><td><p>blobs.contoso.com</p></td><td><p>contosoblobs.blob.core.windows.net</p></td></tr></tbody></table><p><b>Intermediary mapping with <i>asverify</i></b> Mapping a domain that is already in use within Azure may result in minor downtime as the domain is updated. If you have an application with an SLA, by using the domain you can avoid the downtime by using a second option, the asverify subdomain, to validate the domain. By prepending asverify to your own subdomain, you permit Azure to recognize your custom domain without modifying the DNS record for the domain. After you modify the DNS record for the domain, it will be mapped to the blob endpoint with no downtime.</p><p>The following examples maps a domain to the Azure storage account in DNS with the asverify intermediary domain:</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>CNAME record</p></td><td><p>Target</p></td></tr></thead><tbody><tr><td><p>asverify.blobs.contoso.com</p></td><td><p>asverify.contosoblobs.blob.core.windows.net</p></td></tr><tr><td><p>blobs.contoso.com</p></td><td><p>contosoblobs.blob.core.windows.net</p></td></tr></tbody></table><p><b>Note:</b> ✔️A Blob storage account only exposes the Blob service endpoint. And, you can also configure a custom domain name to use with your storage account.</p><h3 class="da-h3" id="1191696">Deciding When to use Encryption</h3><p>Computer data is at risk when in transit (transmitted across the Internet or other network), and at rest (saved to a storage device). The at-rest scenario is the primary concern when protecting data on Azure VM disks. For example, someone might download the Virtual Hard Disk (VHD) file associated with an Azure VM, and save it on their laptop. If the VHD is not encrypted, the contents of the VHD are potentially accessible to anyone who can mount the VHD file on their computer.</p><p>For operating system (OS) disks, data such as passwords are encrypted automatically, so even if the VHD is not itself encrypted, it's not easy for information to be accessed. Applications may also automatically encrypt their own data. However, even with  protections, if someone were to gain access to a data disk, and the disk was unencrypted, they might then be able to exploit weaknesses in that application's data protection. With disk encryption in place, such exploits are not possible.</p><p>Storage Service Encryption (SSE) is part of Azure itself, and there should be no noticeable performance impact on the VM disk IO when using SSE. Managed disks with SSE is the default.</p><p>Azure Disk Encryption (ADE) makes use of VM operating system tools (<b>BitLocker</b> and <b>DM-Crypt</b>), so the VM must do some work when encryption or decryption on VM disks is being performed. The impact of this additional VM CPU activity is minimal, except in certain situations. For example, if you have a CPU-intensive application, there may be a case for leaving the OS disk unencrypted to maximize performance.</p><p>Azure provides two complementary encryption technologies that are used to secure Azure VM disks. These technologies, <b>SSE</b> and <b>ADE</b>, encrypt at different layers, and serve different purposes. Both use AES 256-bit encryption. Using both technologies provides a defense-in-depth protection against unauthorized access to your Azure storage, and to specific VHDs.</p><h3 class="da-h3" id="1191896">Azure to Azure Architecture</h3><p>With disaster recovery set up, Azure VMs continuously replicate from the source to a different target region. If an outage occurs, you can fail over VMs to the secondary region, and access them from there. When everything's running normally again, you can fail back and continue working in the primary location. The process shown in the diagram is as follows:</p><p><span><img alt="" src="../Images/1192259-490397.png" width="" height="" /></span></p><ol class="number"><li><p>VM is registered with Azure Site Recovery</p></li><li><p>Data is continuously replicated to cache</p></li><li><p>Cache is replicated to the target storage account</p></li><li><p>During failover the virtual machine is added to the target environment</p></li></ol><h4 class="da-h4">Architectural components</h4><p>The components involved in disaster recovery for Azure VMs are summarized in the following table.</p><table style="width:100%" class=""><col width="50%" /><col width="50%" /><thead><tr><td><p>Component</p></td><td><p>Requirement</p></td></tr></thead><tbody><tr><td><p>VMs in source region</p></td><td><p>One of more Azure VMs in a <a href="https://docs.microsoft.com/en-us/azure/site-recovery/azure-to-azure-support-matrix#region-support" title="" target="_blank">supported source region</a>. VMs can be running any <a href="https://docs.microsoft.com/en-us/azure/site-recovery/azure-to-azure-support-matrix#replicated-machine-operating-systems" title="" target="_blank">supported operating system</a></p></td></tr><tr><td><p>Source VM storage</p></td><td><p>Azure VMs can be managed, or have non-managed disks spread across storage accounts.</p></td></tr><tr><td><p>Source VM networks</p></td><td><p>VMs can be located in one or more subnets in a virtual network (VNet) in the source region.</p></td></tr><tr><td><p>Cache storage account</p></td><td><p>You need a cache storage account in the source network. During replication, VM changes are stored in the cache before being sent to target storage. Using a cache ensures minimal impact on production applications that are running on a VM. <a href="https://docs.microsoft.com/en-us/azure/site-recovery/azure-to-azure-support-matrix#cache-storage" title="" target="_blank">Learn more</a> about cache storage requirements.</p></td></tr><tr><td><p>Target resources</p></td><td><p>Target resources are used during replication, and when a failover occurs. Site Recovery can set up target resource by default, or you can create/customize them. In the target region, check that you're able to create VMs, and that your subscription has enough resources to support VM sizes that will be needed in the target region.</p></td></tr></tbody></table><p>✔️ Using a cache ensures minimal impact on production applications that are running on a VM. <a href="https://docs.microsoft.com/en-us/azure/site-recovery/azure-to-azure-support-matrix" title="" target="_blank">Learn more</a> about cache storage requirements.</p></body>
</html>